{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"tfsec is a static analysis security scanner for your Terraform code. Designed to run locally and in your CI pipelines, developer-friendly output and fully documented checks mean detection and remediation can take place as quickly and efficiently as possible tfsec takes a developer-first approach to scanning your Terraform templates; using static analysis and deep integration with the official HCL parser it ensures thatsecurity issues can be detected before your infrastructure changes take effect. Demo: Misconfiguration Detection tfsec is an Aqua Security open source project. Learn about our open source work and portfolio here . Contact us about any matter by opening a GitHub Discussion here","title":"HOME"},{"location":"checks/aws/home/","text":"The included AWS checks are listed below. For more information about each check, see the link provided. Checks aws-api-gateway-enable-access-logging API Gateway stages for V1 and V2 should have access logging enabled aws-api-gateway-enable-cache-encryption API Gateway must have cache enabled aws-api-gateway-enable-tracing API Gateway must have X-Ray tracing enabled aws-api-gateway-no-public-access No public access to API Gateway methods aws-api-gateway-use-secure-tls-policy API Gateway domain name uses outdated SSL/TLS protocols. aws-athena-enable-at-rest-encryption Athena databases and workgroup configurations are created unencrypted at rest by default, they should be encrypted aws-athena-no-encryption-override Athena workgroups should enforce configuration to prevent client disabling encryption aws-autoscaling-enable-at-rest-encryption Launch configuration with unencrypted block device. aws-autoscaling-no-public-ip A resource has a public IP address. aws-cloudfront-enable-logging Cloudfront distribution should have Access Logging configured aws-cloudfront-enable-waf CloudFront distribution does not have a WAF in front. aws-cloudfront-enforce-https CloudFront distribution allows unencrypted (HTTP) communications. aws-cloudfront-use-secure-tls-policy CloudFront distribution uses outdated SSL/TLS protocols. aws-cloudtrail-enable-all-regions Cloudtrail should be enabled in all regions regardless of where your AWS resources are generally homed aws-cloudtrail-enable-at-rest-encryption Cloudtrail should be encrypted at rest to secure access to sensitive trail data aws-cloudtrail-enable-log-validation Cloudtrail log validation should be enabled to prevent tampering of log data aws-cloudwatch-log-group-customer-key CloudWatch log groups should be encrypted using CMK aws-codebuild-enable-encryption CodeBuild Project artifacts encryption should not be disabled aws-config-aggregate-all-regions Config configuration aggregator should be using all regions for source aws-documentdb-enable-log-export DocumentDB logs export should be enabled aws-documentdb-enable-storage-encryption DocumentDB storage must be encrypted aws-documentdb-encryption-customer-key DocumentDB encryption should use Customer Managed Keys aws-dynamodb-enable-at-rest-encryption DAX Cluster should always encrypt data at rest aws-dynamodb-enable-recovery Point in time recovery should be enabled to protect DynamoDB table aws-dynamodb-table-customer-key DynamoDB tables should use at rest encryption with a Customer Managed Key aws-ebs-enable-volume-encryption EBS volumes must be encrypted aws-ebs-encryption-customer-key EBS volume encryption should use Customer Managed Keys aws-ec2-enforce-http-token-imds aws_instance should activate session tokens for Instance Metadata Service. aws-ec2-no-secrets-in-user-data User data for EC2 instances must not contain sensitive AWS keys aws-ecr-enable-image-scans ECR repository has image scans disabled. aws-ecr-enforce-immutable-repository ECR images tags shouldn't be mutable. aws-ecr-no-public-access ECR repository policy must block public access aws-ecr-repository-customer-key ECR Repository should use customer managed keys to allow more control aws-ecs-enable-container-insight ECS clusters should have container insights enabled aws-ecs-enable-in-transit-encryption ECS Task Definitions with EFS volumes should use in-transit encryption aws-ecs-no-plaintext-secrets Task definition defines sensitive environment variable(s). aws-efs-enable-at-rest-encryption EFS Encryption has not been enabled aws-eks-enable-control-plane-logging EKS Clusters should have cluster control plane logging turned on aws-eks-encrypt-secrets EKS should have the encryption of secrets enabled aws-eks-no-public-cluster-access EKS Clusters should have the public access disabled aws-eks-no-public-cluster-access-to-cidr EKS cluster should not have open CIDR range for public access aws-elastic-search-enable-domain-logging Domain logging should be enabled for Elastic Search domains aws-elastic-search-enable-in-transit-encryption Elasticsearch domain uses plaintext traffic for node to node communication. aws-elastic-search-enable-logging AWS ES Domain should have logging enabled aws-elastic-search-encrypt-replication-group Unencrypted Elasticache Replication Group. aws-elastic-search-enforce-https Elasticsearch doesn't enforce HTTPS traffic. aws-elastic-search-use-secure-tls-policy Elasticsearch domain endpoint is using outdated TLS policy. aws-elastic-service-enable-domain-encryption Elasticsearch domain isn't encrypted at rest. aws-elasticache-add-description-for-security-group Missing description for security group/security group rule. aws-elasticache-enable-backup-retention Redis cluster should have backup retention turned on aws-elasticache-enable-in-transit-encryption Elasticache Replication Group uses unencrypted traffic. aws-elb-drop-invalid-headers Load balancers should drop invalid headers aws-elbv2-alb-not-public Load balancer is exposed to the internet. aws-elbv2-http-not-used Use of plain HTTP. aws-iam-block-kms-policy-wildcard IAM customer managed policies should not allow decryption actions on all KMS keys aws-iam-no-password-reuse IAM Password policy should prevent password reuse. aws-iam-no-policy-wildcards IAM policy should avoid use of wildcards and instead apply the principle of least privilege aws-iam-require-lowercase-in-passwords IAM Password policy should have requirement for at least one lowercase character. aws-iam-require-numbers-in-passwords IAM Password policy should have requirement for at least one number in the password. aws-iam-require-symbols-in-passwords IAM Password policy should have requirement for at least one symbol in the password. aws-iam-require-uppercase-in-passwords IAM Password policy should have requirement for at least one uppercase character. aws-iam-set-max-password-age IAM Password policy should have expiry less than or equal to 90 days. aws-iam-set-minimum-password-length IAM Password policy should have minimum password length of 14 or more characters. aws-kinesis-enable-in-transit-encryption Kinesis stream is unencrypted. aws-kms-auto-rotate-keys A KMS key is not configured to auto-rotate. aws-lambda-enable-tracing Lambda functions should have X-Ray tracing enabled aws-lambda-restrict-source-arn Ensure that lambda function permission has a source arn specified aws-launch-no-sensitive-info Ensure all data stored in the Launch configuration EBS is securely encrypted aws-misc-no-exposing-plaintext-credentials AWS provider has access credentials specified. aws-mq-enable-audit-logging MQ Broker should have audit logging enabled aws-mq-enable-general-logging MQ Broker should have general logging enabled aws-mq-no-public-access Ensure MQ Broker is not publicly exposed aws-msk-enable-in-transit-encryption A MSK cluster allows unencrypted data in transit. aws-msk-enable-logging Ensure MSK Cluster logging is enabled aws-neptune-enable-log-export Nepture logs export should be enabled aws-neptune-enable-storage-encryption Neptune storage must be encrypted at rest aws-rds-backup-retention-specified RDS Cluster and RDS instance should have backup retention longer than default 1 day aws-rds-enable-performance-insights Encryption for RDS Performance Insights should be enabled. aws-rds-encrypt-cluster-storage-data There is no encryption specified or encryption is disabled on the RDS Cluster. aws-rds-encrypt-instance-storage-data RDS encryption has not been enabled at a DB Instance level. aws-rds-no-classic-resources AWS Classic resource usage. aws-rds-no-public-db-access A database resource is marked as publicly accessible. aws-redshift-add-description-to-security-group Missing description for security group/security group rule. aws-redshift-encryption-customer-key Redshift clusters should use at rest encryption aws-redshift-non-default-vpc-deployment Redshift cluster should be deployed into a specific VPC aws-s3-block-public-acls S3 Access block should block public ACL aws-s3-block-public-policy S3 Access block should block public policy aws-s3-enable-bucket-encryption Unencrypted S3 bucket. aws-s3-enable-bucket-logging S3 Bucket does not have logging enabled. aws-s3-enable-versioning S3 Data should be versioned aws-s3-ignore-public-acls S3 Access Block should Ignore Public Acl aws-s3-no-public-access-with-acl S3 Bucket has an ACL defined which allows public access. aws-s3-no-public-buckets S3 Access block should restrict public bucket to limit access aws-s3-specify-public-access-block S3 buckets should each define an aws_s3_bucket_public_access_block aws-sns-enable-topic-encryption Unencrypted SNS topic. aws-sqs-enable-queue-encryption Unencrypted SQS queue. aws-sqs-no-wildcards-in-policy-documents AWS SQS policy document has wildcard action statement. aws-ssm-secret-use-customer-key Secrets Manager should use customer managed keys aws-vpc-add-description-to-security-group Missing description for security group/security group rule. aws-vpc-disallow-mixed-sgr Ensures that usage of security groups with inline rules and security group rule resources are not mixed. aws-vpc-no-default-vpc AWS best practice to not use the default VPC for workflows aws-vpc-no-excessive-port-access An ingress Network ACL rule allows ALL ports. aws-vpc-no-public-egress-sg An inline egress security group rule allows traffic to /0. aws-vpc-no-public-egress-sgr An egress security group rule allows traffic to /0. aws-vpc-no-public-ingress An ingress Network ACL rule allows specific ports from /0. aws-vpc-no-public-ingress-sg An inline ingress security group rule allows traffic from /0. aws-vpc-no-public-ingress-sgr An ingress security group rule allows traffic from /0. aws-vpc-use-secure-tls-policy An outdated SSL policy is in use by a load balancer. aws-workspace-enable-disk-encryption Root and user volumes on Workspaces should be encrypted","title":"aws"},{"location":"checks/aws/api-gateway/enable-access-logging/","text":"Explanation API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for API Gateway stages Insecure Example The following example will fail the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"bad_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" } resource \"aws_api_gateway_stage\" \"bad_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" } Secure Example The following example will pass the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"good_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" access_log_settings { destination_arn = \"\" format = \"\" } } resource \"aws_api_gateway_stage\" \"good_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" access_log_settings { destination_arn = \"\" format = \"\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/apigatewayv2_stage#access_log_settings https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html","title":"enable-access-logging"},{"location":"checks/aws/api-gateway/enable-access-logging/#explanation","text":"API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages.","title":"Explanation"},{"location":"checks/aws/api-gateway/enable-access-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/aws/api-gateway/enable-access-logging/#suggested-resolution","text":"Enable logging for API Gateway stages","title":"Suggested Resolution"},{"location":"checks/aws/api-gateway/enable-access-logging/#insecure-example","text":"The following example will fail the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"bad_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" } resource \"aws_api_gateway_stage\" \"bad_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" }","title":"Insecure Example"},{"location":"checks/aws/api-gateway/enable-access-logging/#secure-example","text":"The following example will pass the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"good_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" access_log_settings { destination_arn = \"\" format = \"\" } } resource \"aws_api_gateway_stage\" \"good_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" access_log_settings { destination_arn = \"\" format = \"\" } }","title":"Secure Example"},{"location":"checks/aws/api-gateway/enable-access-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/apigatewayv2_stage#access_log_settings https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html","title":"Related Links"},{"location":"checks/aws/api-gateway/enable-cache-encryption/","text":"Explanation Method cache encryption ensures that any sensitive data in the cache is not vulnerable to compromise in the event of interception Possible Impact Data stored in the cache that is unencrypted may be vulnerable to compromise Suggested Resolution Enable cache encryption Insecure Example The following example will fail the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_method_settings\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = false } } Secure Example The following example will pass the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_method_settings\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method_settings#cache_data_encrypted","title":"enable-cache-encryption"},{"location":"checks/aws/api-gateway/enable-cache-encryption/#explanation","text":"Method cache encryption ensures that any sensitive data in the cache is not vulnerable to compromise in the event of interception","title":"Explanation"},{"location":"checks/aws/api-gateway/enable-cache-encryption/#possible-impact","text":"Data stored in the cache that is unencrypted may be vulnerable to compromise","title":"Possible Impact"},{"location":"checks/aws/api-gateway/enable-cache-encryption/#suggested-resolution","text":"Enable cache encryption","title":"Suggested Resolution"},{"location":"checks/aws/api-gateway/enable-cache-encryption/#insecure-example","text":"The following example will fail the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_method_settings\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = false } }","title":"Insecure Example"},{"location":"checks/aws/api-gateway/enable-cache-encryption/#secure-example","text":"The following example will pass the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_method_settings\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = true } }","title":"Secure Example"},{"location":"checks/aws/api-gateway/enable-cache-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method_settings#cache_data_encrypted","title":"Related Links"},{"location":"checks/aws/api-gateway/enable-tracing/","text":"Explanation X-Ray tracing enables end-to-end debugging and analysis of all API Gateway HTTP requests. Possible Impact WIthout full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_stage\" \"bad_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = false } Secure Example The following example will pass the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_stage\" \"good_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage#xray_tracing_enabled","title":"enable-tracing"},{"location":"checks/aws/api-gateway/enable-tracing/#explanation","text":"X-Ray tracing enables end-to-end debugging and analysis of all API Gateway HTTP requests.","title":"Explanation"},{"location":"checks/aws/api-gateway/enable-tracing/#possible-impact","text":"WIthout full tracing enabled it is difficult to trace the flow of logs","title":"Possible Impact"},{"location":"checks/aws/api-gateway/enable-tracing/#suggested-resolution","text":"Enable tracing","title":"Suggested Resolution"},{"location":"checks/aws/api-gateway/enable-tracing/#insecure-example","text":"The following example will fail the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_stage\" \"bad_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = false }","title":"Insecure Example"},{"location":"checks/aws/api-gateway/enable-tracing/#secure-example","text":"The following example will pass the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_stage\" \"good_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = true }","title":"Secure Example"},{"location":"checks/aws/api-gateway/enable-tracing/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage#xray_tracing_enabled","title":"Related Links"},{"location":"checks/aws/api-gateway/no-public-access/","text":"Explanation API Gateway methods should be protected by authorization or api key. OPTION verb calls can be used without authorization Possible Impact API gateway methods can be unauthorized accessed Suggested Resolution Use and authorization method or require API Key Insecure Example The following example will fail the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_method\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"NONE\" } Secure Example The following example will pass the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_method\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"AWS_IAM\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method#authorization","title":"no-public-access"},{"location":"checks/aws/api-gateway/no-public-access/#explanation","text":"API Gateway methods should be protected by authorization or api key. OPTION verb calls can be used without authorization","title":"Explanation"},{"location":"checks/aws/api-gateway/no-public-access/#possible-impact","text":"API gateway methods can be unauthorized accessed","title":"Possible Impact"},{"location":"checks/aws/api-gateway/no-public-access/#suggested-resolution","text":"Use and authorization method or require API Key","title":"Suggested Resolution"},{"location":"checks/aws/api-gateway/no-public-access/#insecure-example","text":"The following example will fail the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_method\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"NONE\" }","title":"Insecure Example"},{"location":"checks/aws/api-gateway/no-public-access/#secure-example","text":"The following example will pass the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_method\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"AWS_IAM\" }","title":"Secure Example"},{"location":"checks/aws/api-gateway/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method#authorization","title":"Related Links"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"bad_example\" { security_policy = \"TLS_1_0\" } Secure Example The following example will pass the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"good_example\" { security_policy = \"TLS_1_2\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name#security_policy https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-custom-domain-tls-version.html","title":"use-secure-tls-policy"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/#possible-impact","text":"Outdated SSL policies increase exposure to known vulnerabilities","title":"Possible Impact"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS/SSL policies available","title":"Suggested Resolution"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/#insecure-example","text":"The following example will fail the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"bad_example\" { security_policy = \"TLS_1_0\" }","title":"Insecure Example"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/#secure-example","text":"The following example will pass the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"good_example\" { security_policy = \"TLS_1_2\" }","title":"Secure Example"},{"location":"checks/aws/api-gateway/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name#security_policy https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-custom-domain-tls-version.html","title":"Related Links"},{"location":"checks/aws/athena/enable-at-rest-encryption/","text":"Explanation Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection. Possible Impact Data can be read if the Athena Database is compromised Suggested Resolution Enable encryption at rest for Athena databases and workgroup configurations Insecure Example The following example will fail the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"bad_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" } } } Secure Example The following example will pass the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"good_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#encryption_configuration https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_database#encryption_configuration https://docs.aws.amazon.com/athena/latest/ug/encryption.html","title":"enable-at-rest-encryption"},{"location":"checks/aws/athena/enable-at-rest-encryption/#explanation","text":"Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection.","title":"Explanation"},{"location":"checks/aws/athena/enable-at-rest-encryption/#possible-impact","text":"Data can be read if the Athena Database is compromised","title":"Possible Impact"},{"location":"checks/aws/athena/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption at rest for Athena databases and workgroup configurations","title":"Suggested Resolution"},{"location":"checks/aws/athena/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"bad_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" } } }","title":"Insecure Example"},{"location":"checks/aws/athena/enable-at-rest-encryption/#secure-example","text":"The following example will pass the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"good_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } }","title":"Secure Example"},{"location":"checks/aws/athena/enable-at-rest-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#encryption_configuration https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_database#encryption_configuration https://docs.aws.amazon.com/athena/latest/ug/encryption.html","title":"Related Links"},{"location":"checks/aws/athena/no-encryption-override/","text":"Explanation Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings. Possible Impact Clients can ignore encryption requirements Suggested Resolution Enforce the configuration to prevent client overrides Insecure Example The following example will fail the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = false publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" } Secure Example The following example will pass the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#configuration https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html","title":"no-encryption-override"},{"location":"checks/aws/athena/no-encryption-override/#explanation","text":"Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings.","title":"Explanation"},{"location":"checks/aws/athena/no-encryption-override/#possible-impact","text":"Clients can ignore encryption requirements","title":"Possible Impact"},{"location":"checks/aws/athena/no-encryption-override/#suggested-resolution","text":"Enforce the configuration to prevent client overrides","title":"Suggested Resolution"},{"location":"checks/aws/athena/no-encryption-override/#insecure-example","text":"The following example will fail the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = false publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" }","title":"Insecure Example"},{"location":"checks/aws/athena/no-encryption-override/#secure-example","text":"The following example will pass the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } }","title":"Secure Example"},{"location":"checks/aws/athena/no-encryption-override/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#configuration https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html","title":"Related Links"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/","text":"Explanation Blocks devices should be encrypted to ensure sensitive data is held securely at rest. Possible Impact The block device could be compromised and read from Suggested Resolution Turn on encryption for all block devices Insecure Example The following example will fail the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"bad_example\" { root_block_device { encrypted = false } } Secure Example The following example will pass the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"good_example\" { root_block_device { encrypted = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#ebs-ephemeral-and-root-block-devices https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html","title":"enable-at-rest-encryption"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/#explanation","text":"Blocks devices should be encrypted to ensure sensitive data is held securely at rest.","title":"Explanation"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/#possible-impact","text":"The block device could be compromised and read from","title":"Possible Impact"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/#suggested-resolution","text":"Turn on encryption for all block devices","title":"Suggested Resolution"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"bad_example\" { root_block_device { encrypted = false } }","title":"Insecure Example"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/#secure-example","text":"The following example will pass the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"good_example\" { root_block_device { encrypted = true } }","title":"Secure Example"},{"location":"checks/aws/autoscaling/enable-at-rest-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#ebs-ephemeral-and-root-block-devices https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html","title":"Related Links"},{"location":"checks/aws/autoscaling/no-public-ip/","text":"Explanation You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application. Possible Impact The instance or configuration is publicly accessible Suggested Resolution Set the instance to not be publicly accessible Insecure Example The following example will fail the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"bad_example\" { associate_public_ip_address = true } Secure Example The following example will pass the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"good_example\" { associate_public_ip_address = false } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#associate_public_ip_address https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#associate_public_ip_address https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html","title":"no-public-ip"},{"location":"checks/aws/autoscaling/no-public-ip/#explanation","text":"You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application.","title":"Explanation"},{"location":"checks/aws/autoscaling/no-public-ip/#possible-impact","text":"The instance or configuration is publicly accessible","title":"Possible Impact"},{"location":"checks/aws/autoscaling/no-public-ip/#suggested-resolution","text":"Set the instance to not be publicly accessible","title":"Suggested Resolution"},{"location":"checks/aws/autoscaling/no-public-ip/#insecure-example","text":"The following example will fail the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"bad_example\" { associate_public_ip_address = true }","title":"Insecure Example"},{"location":"checks/aws/autoscaling/no-public-ip/#secure-example","text":"The following example will pass the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"good_example\" { associate_public_ip_address = false }","title":"Secure Example"},{"location":"checks/aws/autoscaling/no-public-ip/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#associate_public_ip_address https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#associate_public_ip_address https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html","title":"Related Links"},{"location":"checks/aws/cloudfront/enable-logging/","text":"Explanation You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for CloudFront distributions Insecure Example The following example will fail the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"bad_example\" { // other config // no logging_config } Secure Example The following example will pass the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"good_example\" { // other config logging_config { include_cookies = false bucket = \"mylogs.s3.amazonaws.com\" prefix = \"myprefix\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#logging_config https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html","title":"enable-logging"},{"location":"checks/aws/cloudfront/enable-logging/#explanation","text":"You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives","title":"Explanation"},{"location":"checks/aws/cloudfront/enable-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/aws/cloudfront/enable-logging/#suggested-resolution","text":"Enable logging for CloudFront distributions","title":"Suggested Resolution"},{"location":"checks/aws/cloudfront/enable-logging/#insecure-example","text":"The following example will fail the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"bad_example\" { // other config // no logging_config }","title":"Insecure Example"},{"location":"checks/aws/cloudfront/enable-logging/#secure-example","text":"The following example will pass the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"good_example\" { // other config logging_config { include_cookies = false bucket = \"mylogs.s3.amazonaws.com\" prefix = \"myprefix\" } }","title":"Secure Example"},{"location":"checks/aws/cloudfront/enable-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#logging_config https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html","title":"Related Links"},{"location":"checks/aws/cloudfront/enable-waf/","text":"Explanation You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application. Possible Impact Complex web application attacks can more easily be performed without a WAF Suggested Resolution Enable WAF for the CloudFront distribution Insecure Example The following example will fail the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"bad_example\" { origin_group { origin_id = \"groupS3\" failover_criteria { status_codes = [ 403 , 404 , 500 , 502 ] } member { origin_id = \"primaryS3\" } } origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } } Secure Example The following example will pass the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"good_example\" { origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } web_acl_id = \"waf_id\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#web_acl_id https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html","title":"enable-waf"},{"location":"checks/aws/cloudfront/enable-waf/#explanation","text":"You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application.","title":"Explanation"},{"location":"checks/aws/cloudfront/enable-waf/#possible-impact","text":"Complex web application attacks can more easily be performed without a WAF","title":"Possible Impact"},{"location":"checks/aws/cloudfront/enable-waf/#suggested-resolution","text":"Enable WAF for the CloudFront distribution","title":"Suggested Resolution"},{"location":"checks/aws/cloudfront/enable-waf/#insecure-example","text":"The following example will fail the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"bad_example\" { origin_group { origin_id = \"groupS3\" failover_criteria { status_codes = [ 403 , 404 , 500 , 502 ] } member { origin_id = \"primaryS3\" } } origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } }","title":"Insecure Example"},{"location":"checks/aws/cloudfront/enable-waf/#secure-example","text":"The following example will pass the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"good_example\" { origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } web_acl_id = \"waf_id\" }","title":"Secure Example"},{"location":"checks/aws/cloudfront/enable-waf/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#web_acl_id https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html","title":"Related Links"},{"location":"checks/aws/cloudfront/enforce-https/","text":"Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact CloudFront is available through an unencrypted connection Suggested Resolution Only allow HTTPS for CloudFront distribution communication Insecure Example The following example will fail the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"bad_example\" { default_cache_behavior { viewer_protocol_policy = \"allow-all\" } } Secure Example The following example will pass the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"good_example\" { default_cache_behavior { viewer_protocol_policy = \"redirect-to-https\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#viewer_protocol_policy https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html","title":"enforce-https"},{"location":"checks/aws/cloudfront/enforce-https/#explanation","text":"Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.","title":"Explanation"},{"location":"checks/aws/cloudfront/enforce-https/#possible-impact","text":"CloudFront is available through an unencrypted connection","title":"Possible Impact"},{"location":"checks/aws/cloudfront/enforce-https/#suggested-resolution","text":"Only allow HTTPS for CloudFront distribution communication","title":"Suggested Resolution"},{"location":"checks/aws/cloudfront/enforce-https/#insecure-example","text":"The following example will fail the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"bad_example\" { default_cache_behavior { viewer_protocol_policy = \"allow-all\" } }","title":"Insecure Example"},{"location":"checks/aws/cloudfront/enforce-https/#secure-example","text":"The following example will pass the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"good_example\" { default_cache_behavior { viewer_protocol_policy = \"redirect-to-https\" } }","title":"Secure Example"},{"location":"checks/aws/cloudfront/enforce-https/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#viewer_protocol_policy https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html","title":"Related Links"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"bad_example\" { viewer_certificate { cloudfront_default_certificate = false minimum_protocol_version = \"TLSv1.0\" } } Secure Example The following example will pass the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"good_example\" { viewer_certificate { cloudfront_default_certificate = false minimum_protocol_version = \"TLSv1.2_2021\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#minimum_protocol_version https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html","title":"use-secure-tls-policy"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/#possible-impact","text":"Outdated SSL policies increase exposure to known vulnerabilities","title":"Possible Impact"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS/SSL policies available","title":"Suggested Resolution"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/#insecure-example","text":"The following example will fail the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"bad_example\" { viewer_certificate { cloudfront_default_certificate = false minimum_protocol_version = \"TLSv1.0\" } }","title":"Insecure Example"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/#secure-example","text":"The following example will pass the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"good_example\" { viewer_certificate { cloudfront_default_certificate = false minimum_protocol_version = \"TLSv1.2_2021\" } }","title":"Secure Example"},{"location":"checks/aws/cloudfront/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#minimum_protocol_version https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html","title":"Related Links"},{"location":"checks/aws/cloudtrail/enable-all-regions/","text":"Explanation When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in. Possible Impact Activity could be happening in your account in a different region Suggested Resolution Enable Cloudtrail in all regions Insecure Example The following example will fail the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"bad_example\" { event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Secure Example The following example will pass the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#is_multi_region_trail https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html","title":"enable-all-regions"},{"location":"checks/aws/cloudtrail/enable-all-regions/#explanation","text":"When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in.","title":"Explanation"},{"location":"checks/aws/cloudtrail/enable-all-regions/#possible-impact","text":"Activity could be happening in your account in a different region","title":"Possible Impact"},{"location":"checks/aws/cloudtrail/enable-all-regions/#suggested-resolution","text":"Enable Cloudtrail in all regions","title":"Suggested Resolution"},{"location":"checks/aws/cloudtrail/enable-all-regions/#insecure-example","text":"The following example will fail the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"bad_example\" { event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }","title":"Insecure Example"},{"location":"checks/aws/cloudtrail/enable-all-regions/#secure-example","text":"The following example will pass the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }","title":"Secure Example"},{"location":"checks/aws/cloudtrail/enable-all-regions/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#is_multi_region_trail https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html","title":"Related Links"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/","text":"Explanation Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach. Possible Impact Data can be freely read if compromised Suggested Resolution Enable encryption at rest Insecure Example The following example will fail the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Secure Example The following example will pass the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true kms_key_id = var.kms_id event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#kms_key_id https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html","title":"enable-at-rest-encryption"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/#explanation","text":"Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach.","title":"Explanation"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/#possible-impact","text":"Data can be freely read if compromised","title":"Possible Impact"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption at rest","title":"Suggested Resolution"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }","title":"Insecure Example"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/#secure-example","text":"The following example will pass the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true kms_key_id = var.kms_id event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }","title":"Secure Example"},{"location":"checks/aws/cloudtrail/enable-at-rest-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#kms_key_id https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html","title":"Related Links"},{"location":"checks/aws/cloudtrail/enable-log-validation/","text":"Explanation Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions. Possible Impact Illicit activity could be removed from the logs Suggested Resolution Turn on log validation for Cloudtrail Insecure Example The following example will fail the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Secure Example The following example will pass the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#enable_log_file_validation https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html","title":"enable-log-validation"},{"location":"checks/aws/cloudtrail/enable-log-validation/#explanation","text":"Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions.","title":"Explanation"},{"location":"checks/aws/cloudtrail/enable-log-validation/#possible-impact","text":"Illicit activity could be removed from the logs","title":"Possible Impact"},{"location":"checks/aws/cloudtrail/enable-log-validation/#suggested-resolution","text":"Turn on log validation for Cloudtrail","title":"Suggested Resolution"},{"location":"checks/aws/cloudtrail/enable-log-validation/#insecure-example","text":"The following example will fail the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }","title":"Insecure Example"},{"location":"checks/aws/cloudtrail/enable-log-validation/#secure-example","text":"The following example will pass the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }","title":"Secure Example"},{"location":"checks/aws/cloudtrail/enable-log-validation/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#enable_log_file_validation https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html","title":"Related Links"},{"location":"checks/aws/cloudwatch/log-group-customer-key/","text":"Explanation CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used. Possible Impact Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs. Suggested Resolution Enable CMK encryption of CloudWatch Log Groups Insecure Example The following example will fail the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"bad_example\" { name = \"bad_example\" } Secure Example The following example will pass the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"good_example\" { name = \"good_example\" kms_key_id = aws_kms_key.log_key.arn } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group#kms_key_id https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html","title":"log-group-customer-key"},{"location":"checks/aws/cloudwatch/log-group-customer-key/#explanation","text":"CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used.","title":"Explanation"},{"location":"checks/aws/cloudwatch/log-group-customer-key/#possible-impact","text":"Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs.","title":"Possible Impact"},{"location":"checks/aws/cloudwatch/log-group-customer-key/#suggested-resolution","text":"Enable CMK encryption of CloudWatch Log Groups","title":"Suggested Resolution"},{"location":"checks/aws/cloudwatch/log-group-customer-key/#insecure-example","text":"The following example will fail the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"bad_example\" { name = \"bad_example\" }","title":"Insecure Example"},{"location":"checks/aws/cloudwatch/log-group-customer-key/#secure-example","text":"The following example will pass the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"good_example\" { name = \"good_example\" kms_key_id = aws_kms_key.log_key.arn }","title":"Secure Example"},{"location":"checks/aws/cloudwatch/log-group-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group#kms_key_id https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html","title":"Related Links"},{"location":"checks/aws/codebuild/enable-encryption/","text":"Explanation All artifacts produced by your CodeBuild project pipeline should always be encrypted Possible Impact CodeBuild project artifacts are unencrypted Suggested Resolution Enable encryption for CodeBuild project artifacts Insecure Example The following example will fail the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"bad_example\" { // other config artifacts { // other artifacts config encryption_disabled = true } } resource \"aws_codebuild_project\" \"bad_example\" { // other config including primary artifacts secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config encryption_disabled = true } } Secure Example The following example will pass the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config encryption_disabled = false } } resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config } } resource \"aws_codebuild_project\" \"codebuild\" { // other config secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project#encryption_disabled https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html","title":"enable-encryption"},{"location":"checks/aws/codebuild/enable-encryption/#explanation","text":"All artifacts produced by your CodeBuild project pipeline should always be encrypted","title":"Explanation"},{"location":"checks/aws/codebuild/enable-encryption/#possible-impact","text":"CodeBuild project artifacts are unencrypted","title":"Possible Impact"},{"location":"checks/aws/codebuild/enable-encryption/#suggested-resolution","text":"Enable encryption for CodeBuild project artifacts","title":"Suggested Resolution"},{"location":"checks/aws/codebuild/enable-encryption/#insecure-example","text":"The following example will fail the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"bad_example\" { // other config artifacts { // other artifacts config encryption_disabled = true } } resource \"aws_codebuild_project\" \"bad_example\" { // other config including primary artifacts secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config encryption_disabled = true } }","title":"Insecure Example"},{"location":"checks/aws/codebuild/enable-encryption/#secure-example","text":"The following example will pass the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config encryption_disabled = false } } resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config } } resource \"aws_codebuild_project\" \"codebuild\" { // other config secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config } }","title":"Secure Example"},{"location":"checks/aws/codebuild/enable-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project#encryption_disabled https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html","title":"Related Links"},{"location":"checks/aws/config/aggregate-all-regions/","text":"Explanation The configuration aggregator should be configured with all_regions for the source. This will help limit the risk of any unmonitored configuration in regions that are thought to be unused. Possible Impact Sources that aren't covered by the aggregator are not include in the configuration Suggested Resolution Set the aggregator to cover all regions Insecure Example The following example will fail the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"bad_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] regions = [ \"us-west-2\", \"eu-west-1\" ] } } Secure Example The following example will pass the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"good_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] all_regions = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_aggregator#all_regions https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html","title":"aggregate-all-regions"},{"location":"checks/aws/config/aggregate-all-regions/#explanation","text":"The configuration aggregator should be configured with all_regions for the source. This will help limit the risk of any unmonitored configuration in regions that are thought to be unused.","title":"Explanation"},{"location":"checks/aws/config/aggregate-all-regions/#possible-impact","text":"Sources that aren't covered by the aggregator are not include in the configuration","title":"Possible Impact"},{"location":"checks/aws/config/aggregate-all-regions/#suggested-resolution","text":"Set the aggregator to cover all regions","title":"Suggested Resolution"},{"location":"checks/aws/config/aggregate-all-regions/#insecure-example","text":"The following example will fail the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"bad_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] regions = [ \"us-west-2\", \"eu-west-1\" ] } }","title":"Insecure Example"},{"location":"checks/aws/config/aggregate-all-regions/#secure-example","text":"The following example will pass the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"good_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] all_regions = true } }","title":"Secure Example"},{"location":"checks/aws/config/aggregate-all-regions/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_aggregator#all_regions https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html","title":"Related Links"},{"location":"checks/aws/documentdb/enable-log-export/","text":"Explanation Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs. Possible Impact Limited visibility of audit trail for changes to the DocumentDB Suggested Resolution Enable export logs Insecure Example The following example will fail the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"something\" } Secure Example The following example will pass the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"audit\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#enabled_cloudwatch_logs_exports","title":"enable-log-export"},{"location":"checks/aws/documentdb/enable-log-export/#explanation","text":"Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs.","title":"Explanation"},{"location":"checks/aws/documentdb/enable-log-export/#possible-impact","text":"Limited visibility of audit trail for changes to the DocumentDB","title":"Possible Impact"},{"location":"checks/aws/documentdb/enable-log-export/#suggested-resolution","text":"Enable export logs","title":"Suggested Resolution"},{"location":"checks/aws/documentdb/enable-log-export/#insecure-example","text":"The following example will fail the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"something\" }","title":"Insecure Example"},{"location":"checks/aws/documentdb/enable-log-export/#secure-example","text":"The following example will pass the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"audit\" }","title":"Secure Example"},{"location":"checks/aws/documentdb/enable-log-export/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#enabled_cloudwatch_logs_exports","title":"Related Links"},{"location":"checks/aws/documentdb/enable-storage-encryption/","text":"Explanation Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable storage encryption Insecure Example The following example will fail the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = false } Secure Example The following example will pass the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#storage_encrypted","title":"enable-storage-encryption"},{"location":"checks/aws/documentdb/enable-storage-encryption/#explanation","text":"Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected.","title":"Explanation"},{"location":"checks/aws/documentdb/enable-storage-encryption/#possible-impact","text":"Unencrypted sensitive data is vulnerable to compromise.","title":"Possible Impact"},{"location":"checks/aws/documentdb/enable-storage-encryption/#suggested-resolution","text":"Enable storage encryption","title":"Suggested Resolution"},{"location":"checks/aws/documentdb/enable-storage-encryption/#insecure-example","text":"The following example will fail the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = false }","title":"Insecure Example"},{"location":"checks/aws/documentdb/enable-storage-encryption/#secure-example","text":"The following example will pass the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = true }","title":"Secure Example"},{"location":"checks/aws/documentdb/enable-storage-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#storage_encrypted","title":"Related Links"},{"location":"checks/aws/documentdb/encryption-customer-key/","text":"Explanation Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the aws-documentdb-encryption-customer-key check. resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true } Secure Example The following example will pass the aws-documentdb-encryption-customer-key check. resource \"aws_kms_key\" \"docdb_encryption\" { enable_key_rotation = true } resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true kms_key_id = aws_kms_key.docdb_encryption.arn } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#kms_key_id","title":"encryption-customer-key"},{"location":"checks/aws/documentdb/encryption-customer-key/#explanation","text":"Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys.","title":"Explanation"},{"location":"checks/aws/documentdb/encryption-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/aws/documentdb/encryption-customer-key/#suggested-resolution","text":"Enable encryption using customer managed keys","title":"Suggested Resolution"},{"location":"checks/aws/documentdb/encryption-customer-key/#insecure-example","text":"The following example will fail the aws-documentdb-encryption-customer-key check. resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true }","title":"Insecure Example"},{"location":"checks/aws/documentdb/encryption-customer-key/#secure-example","text":"The following example will pass the aws-documentdb-encryption-customer-key check. resource \"aws_kms_key\" \"docdb_encryption\" { enable_key_rotation = true } resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true kms_key_id = aws_kms_key.docdb_encryption.arn }","title":"Secure Example"},{"location":"checks/aws/documentdb/encryption-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#kms_key_id","title":"Related Links"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/","text":"Explanation Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage. Possible Impact Data can be freely read if compromised Suggested Resolution Enable encryption at rest for DAX Cluster Insecure Example The following example will fail the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"bad_example\" { // no server side encryption at all } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { // empty server side encryption config } } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { enabled = false // disabled server side encryption } } Secure Example The following example will pass the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"good_example\" { // other DAX config server_side_encryption { enabled = true // enabled server side encryption } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dax_cluster#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html","title":"enable-at-rest-encryption"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/#explanation","text":"Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage.","title":"Explanation"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/#possible-impact","text":"Data can be freely read if compromised","title":"Possible Impact"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption at rest for DAX Cluster","title":"Suggested Resolution"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"bad_example\" { // no server side encryption at all } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { // empty server side encryption config } } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { enabled = false // disabled server side encryption } }","title":"Insecure Example"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/#secure-example","text":"The following example will pass the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"good_example\" { // other DAX config server_side_encryption { enabled = true // enabled server side encryption } }","title":"Secure Example"},{"location":"checks/aws/dynamodb/enable-at-rest-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dax_cluster#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html","title":"Related Links"},{"location":"checks/aws/dynamodb/enable-recovery/","text":"Explanation DynamoDB tables should be protected against accidentally or malicious write/delete actions by ensuring that there is adequate protection. By enabling point-in-time-recovery you can restore to a known point in the event of loss of data. Possible Impact Accidental or malicious writes and deletes can't be rolled back Suggested Resolution Enable point in time recovery Insecure Example The following example will fail the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } } Secure Example The following example will pass the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } point_in_time_recovery { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#point_in_time_recovery https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/PointInTimeRecovery.html","title":"enable-recovery"},{"location":"checks/aws/dynamodb/enable-recovery/#explanation","text":"DynamoDB tables should be protected against accidentally or malicious write/delete actions by ensuring that there is adequate protection. By enabling point-in-time-recovery you can restore to a known point in the event of loss of data.","title":"Explanation"},{"location":"checks/aws/dynamodb/enable-recovery/#possible-impact","text":"Accidental or malicious writes and deletes can't be rolled back","title":"Possible Impact"},{"location":"checks/aws/dynamodb/enable-recovery/#suggested-resolution","text":"Enable point in time recovery","title":"Suggested Resolution"},{"location":"checks/aws/dynamodb/enable-recovery/#insecure-example","text":"The following example will fail the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } }","title":"Insecure Example"},{"location":"checks/aws/dynamodb/enable-recovery/#secure-example","text":"The following example will pass the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } point_in_time_recovery { enabled = true } }","title":"Secure Example"},{"location":"checks/aws/dynamodb/enable-recovery/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#point_in_time_recovery https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/PointInTimeRecovery.html","title":"Related Links"},{"location":"checks/aws/dynamodb/table-customer-key/","text":"Explanation DynamoDB tables are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable server side encryption with a customer managed key Insecure Example The following example will fail the aws-dynamodb-table-customer-key check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } } Secure Example The following example will pass the aws-dynamodb-table-customer-key check. resource \"aws_kms_key\" \"dynamo_db_kms\" { enable_key_rotation = true } resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } server_side_encryption { enabled = true kms_key_arn = aws_kms_key.dynamo_db_kms.key_id } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/EncryptionAtRest.html","title":"table-customer-key"},{"location":"checks/aws/dynamodb/table-customer-key/#explanation","text":"DynamoDB tables are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key.","title":"Explanation"},{"location":"checks/aws/dynamodb/table-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/aws/dynamodb/table-customer-key/#suggested-resolution","text":"Enable server side encryption with a customer managed key","title":"Suggested Resolution"},{"location":"checks/aws/dynamodb/table-customer-key/#insecure-example","text":"The following example will fail the aws-dynamodb-table-customer-key check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } }","title":"Insecure Example"},{"location":"checks/aws/dynamodb/table-customer-key/#secure-example","text":"The following example will pass the aws-dynamodb-table-customer-key check. resource \"aws_kms_key\" \"dynamo_db_kms\" { enable_key_rotation = true } resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } server_side_encryption { enabled = true kms_key_arn = aws_kms_key.dynamo_db_kms.key_id } }","title":"Secure Example"},{"location":"checks/aws/dynamodb/table-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/EncryptionAtRest.html","title":"Related Links"},{"location":"checks/aws/ebs/enable-volume-encryption/","text":"Explanation By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable encryption of EBS volumes Insecure Example The following example will fail the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"bad_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = false } Secure Example The following example will pass the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"good_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#encrypted","title":"enable-volume-encryption"},{"location":"checks/aws/ebs/enable-volume-encryption/#explanation","text":"By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted.","title":"Explanation"},{"location":"checks/aws/ebs/enable-volume-encryption/#possible-impact","text":"Unencrypted sensitive data is vulnerable to compromise.","title":"Possible Impact"},{"location":"checks/aws/ebs/enable-volume-encryption/#suggested-resolution","text":"Enable encryption of EBS volumes","title":"Suggested Resolution"},{"location":"checks/aws/ebs/enable-volume-encryption/#insecure-example","text":"The following example will fail the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"bad_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = false }","title":"Insecure Example"},{"location":"checks/aws/ebs/enable-volume-encryption/#secure-example","text":"The following example will pass the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"good_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = true }","title":"Secure Example"},{"location":"checks/aws/ebs/enable-volume-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#encrypted","title":"Related Links"},{"location":"checks/aws/ebs/encryption-customer-key/","text":"Explanation Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the aws-ebs-encryption-customer-key check. resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } } Secure Example The following example will pass the aws-ebs-encryption-customer-key check. resource \"aws_kms_key\" \"ebs_encryption\" { enable_key_rotation = true } resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 kms_key_id = aws_kms_key.ebs_encryption.arn tags = { Name = \"HelloWorld\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#kms_key_id","title":"encryption-customer-key"},{"location":"checks/aws/ebs/encryption-customer-key/#explanation","text":"Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys.","title":"Explanation"},{"location":"checks/aws/ebs/encryption-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/aws/ebs/encryption-customer-key/#suggested-resolution","text":"Enable encryption using customer managed keys","title":"Suggested Resolution"},{"location":"checks/aws/ebs/encryption-customer-key/#insecure-example","text":"The following example will fail the aws-ebs-encryption-customer-key check. resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } }","title":"Insecure Example"},{"location":"checks/aws/ebs/encryption-customer-key/#secure-example","text":"The following example will pass the aws-ebs-encryption-customer-key check. resource \"aws_kms_key\" \"ebs_encryption\" { enable_key_rotation = true } resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 kms_key_id = aws_kms_key.ebs_encryption.arn tags = { Name = \"HelloWorld\" } }","title":"Secure Example"},{"location":"checks/aws/ebs/encryption-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#kms_key_id","title":"Related Links"},{"location":"checks/aws/ec2/enforce-http-token-imds/","text":"Explanation IMDS v2 (Instance Metadata Service) introduced session authentication tokens which improve security when talking to IMDS. By default aws_instance resource sets IMDS session auth tokens to be optional. To fully protect IMDS you need to enable session tokens by using metadata_options block and its http_tokens variable set to required . Possible Impact Instance metadata service can be interacted with freely Suggested Resolution Enable HTTP token requirement for IMDS Insecure Example The following example will fail the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" } Secure Example The following example will pass the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"good_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" metadata_options { http_tokens = \"required\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#metadata-options https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service","title":"enforce-http-token-imds"},{"location":"checks/aws/ec2/enforce-http-token-imds/#explanation","text":"IMDS v2 (Instance Metadata Service) introduced session authentication tokens which improve security when talking to IMDS. By default aws_instance resource sets IMDS session auth tokens to be optional. To fully protect IMDS you need to enable session tokens by using metadata_options block and its http_tokens variable set to required .","title":"Explanation"},{"location":"checks/aws/ec2/enforce-http-token-imds/#possible-impact","text":"Instance metadata service can be interacted with freely","title":"Possible Impact"},{"location":"checks/aws/ec2/enforce-http-token-imds/#suggested-resolution","text":"Enable HTTP token requirement for IMDS","title":"Suggested Resolution"},{"location":"checks/aws/ec2/enforce-http-token-imds/#insecure-example","text":"The following example will fail the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" }","title":"Insecure Example"},{"location":"checks/aws/ec2/enforce-http-token-imds/#secure-example","text":"The following example will pass the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"good_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" metadata_options { http_tokens = \"required\" } }","title":"Secure Example"},{"location":"checks/aws/ec2/enforce-http-token-imds/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#metadata-options https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service","title":"Related Links"},{"location":"checks/aws/ec2/no-secrets-in-user-data/","text":"Explanation EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services. Possible Impact User data is visible through the AWS Management console Suggested Resolution Remove sensitive data from the EC2 instance user-data Insecure Example The following example will fail the aws-ec2-no-secrets-in-user-data check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" user_data = <<EOF export AWS_ACCESS_KEY_ID = AKIAIOSFODNN 7 EXAMPLE export AWS_SECRET_ACCESS_KEY = wJalrXUtnFEMI/K 7 MDENG/bPxRfiCYEXAMPLEKEY export AWS_DEFAULT_REGION = us-west- 2 EOF } Secure Example The following example will pass the aws-ec2-no-secrets-in-user-data check. resource \"aws_iam_instance_profile\" \"good_example\" { // ... } resource \"aws_instance\" \"good_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" iam_instance_profile = aws_iam_instance_profile.good_profile.arn user_data = <<EOF export GREETING = hello EOF } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#user_data https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html","title":"no-secrets-in-user-data"},{"location":"checks/aws/ec2/no-secrets-in-user-data/#explanation","text":"EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services.","title":"Explanation"},{"location":"checks/aws/ec2/no-secrets-in-user-data/#possible-impact","text":"User data is visible through the AWS Management console","title":"Possible Impact"},{"location":"checks/aws/ec2/no-secrets-in-user-data/#suggested-resolution","text":"Remove sensitive data from the EC2 instance user-data","title":"Suggested Resolution"},{"location":"checks/aws/ec2/no-secrets-in-user-data/#insecure-example","text":"The following example will fail the aws-ec2-no-secrets-in-user-data check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" user_data = <<EOF export AWS_ACCESS_KEY_ID = AKIAIOSFODNN 7 EXAMPLE export AWS_SECRET_ACCESS_KEY = wJalrXUtnFEMI/K 7 MDENG/bPxRfiCYEXAMPLEKEY export AWS_DEFAULT_REGION = us-west- 2 EOF }","title":"Insecure Example"},{"location":"checks/aws/ec2/no-secrets-in-user-data/#secure-example","text":"The following example will pass the aws-ec2-no-secrets-in-user-data check. resource \"aws_iam_instance_profile\" \"good_example\" { // ... } resource \"aws_instance\" \"good_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" iam_instance_profile = aws_iam_instance_profile.good_profile.arn user_data = <<EOF export GREETING = hello EOF }","title":"Secure Example"},{"location":"checks/aws/ec2/no-secrets-in-user-data/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#user_data https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html","title":"Related Links"},{"location":"checks/aws/ecr/enable-image-scans/","text":"Explanation Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible. Possible Impact The ability to scan images is not being used and vulnerabilities will not be highlighted Suggested Resolution Enable ECR image scanning Insecure Example The following example will fail the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = false } } Secure Example The following example will pass the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#image_scanning_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html","title":"enable-image-scans"},{"location":"checks/aws/ecr/enable-image-scans/#explanation","text":"Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible.","title":"Explanation"},{"location":"checks/aws/ecr/enable-image-scans/#possible-impact","text":"The ability to scan images is not being used and vulnerabilities will not be highlighted","title":"Possible Impact"},{"location":"checks/aws/ecr/enable-image-scans/#suggested-resolution","text":"Enable ECR image scanning","title":"Suggested Resolution"},{"location":"checks/aws/ecr/enable-image-scans/#insecure-example","text":"The following example will fail the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = false } }","title":"Insecure Example"},{"location":"checks/aws/ecr/enable-image-scans/#secure-example","text":"The following example will pass the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } }","title":"Secure Example"},{"location":"checks/aws/ecr/enable-image-scans/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#image_scanning_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html","title":"Related Links"},{"location":"checks/aws/ecr/enforce-immutable-repository/","text":"Explanation ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting image_tab_mutability to IMMUTABLE Possible Impact Image tags could be overwritten with compromised images Suggested Resolution Only use immutable images in ECR Insecure Example The following example will fail the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } } Secure Example The following example will pass the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"IMMUTABLE\" image_scanning_configuration { scan_on_push = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository https://sysdig.com/blog/toctou-tag-mutability/","title":"enforce-immutable-repository"},{"location":"checks/aws/ecr/enforce-immutable-repository/#explanation","text":"ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting image_tab_mutability to IMMUTABLE","title":"Explanation"},{"location":"checks/aws/ecr/enforce-immutable-repository/#possible-impact","text":"Image tags could be overwritten with compromised images","title":"Possible Impact"},{"location":"checks/aws/ecr/enforce-immutable-repository/#suggested-resolution","text":"Only use immutable images in ECR","title":"Suggested Resolution"},{"location":"checks/aws/ecr/enforce-immutable-repository/#insecure-example","text":"The following example will fail the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } }","title":"Insecure Example"},{"location":"checks/aws/ecr/enforce-immutable-repository/#secure-example","text":"The following example will pass the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"IMMUTABLE\" image_scanning_configuration { scan_on_push = true } }","title":"Secure Example"},{"location":"checks/aws/ecr/enforce-immutable-repository/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository https://sysdig.com/blog/toctou-tag-mutability/","title":"Related Links"},{"location":"checks/aws/ecr/no-public-access/","text":"Explanation Allowing public access to the ECR repository risks leaking sensitive of abusable information Possible Impact Risk of potential data leakage of sensitive artifacts Suggested Resolution Do not allow public access in the policy Insecure Example The following example will fail the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } Secure Example The following example will pass the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository_policy#policy","title":"no-public-access"},{"location":"checks/aws/ecr/no-public-access/#explanation","text":"Allowing public access to the ECR repository risks leaking sensitive of abusable information","title":"Explanation"},{"location":"checks/aws/ecr/no-public-access/#possible-impact","text":"Risk of potential data leakage of sensitive artifacts","title":"Possible Impact"},{"location":"checks/aws/ecr/no-public-access/#suggested-resolution","text":"Do not allow public access in the policy","title":"Suggested Resolution"},{"location":"checks/aws/ecr/no-public-access/#insecure-example","text":"The following example will fail the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF }","title":"Insecure Example"},{"location":"checks/aws/ecr/no-public-access/#secure-example","text":"The following example will pass the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF }","title":"Secure Example"},{"location":"checks/aws/ecr/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository_policy#policy","title":"Related Links"},{"location":"checks/aws/ecr/repository-customer-key/","text":"Explanation Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Use customer managed keys Insecure Example The following example will fail the aws-ecr-repository-customer-key check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } } Secure Example The following example will pass the aws-ecr-repository-customer-key check. resource \"aws_kms_key\" \"ecr_kms\" { enable_key_rotation = true } resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } encryption_configuration { encryption_type = \"KMS\" kms_key = aws_kms_key.ecr_kms.key_id } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#encryption_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html","title":"repository-customer-key"},{"location":"checks/aws/ecr/repository-customer-key/#explanation","text":"Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key.","title":"Explanation"},{"location":"checks/aws/ecr/repository-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/aws/ecr/repository-customer-key/#suggested-resolution","text":"Use customer managed keys","title":"Suggested Resolution"},{"location":"checks/aws/ecr/repository-customer-key/#insecure-example","text":"The following example will fail the aws-ecr-repository-customer-key check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } }","title":"Insecure Example"},{"location":"checks/aws/ecr/repository-customer-key/#secure-example","text":"The following example will pass the aws-ecr-repository-customer-key check. resource \"aws_kms_key\" \"ecr_kms\" { enable_key_rotation = true } resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } encryption_configuration { encryption_type = \"KMS\" kms_key = aws_kms_key.ecr_kms.key_id } }","title":"Secure Example"},{"location":"checks/aws/ecr/repository-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#encryption_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html","title":"Related Links"},{"location":"checks/aws/ecs/enable-container-insight/","text":"Explanation Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services. Possible Impact Not all metrics and logs may be gathered for containers when Container Insights isn't enabled Suggested Resolution Enable Container Insights Insecure Example The following example will fail the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"bad_example\" { name = \"services-cluster\" } Secure Example The following example will pass the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"good_example\" { name = \"services-cluster\" setting { name = \"containerInsights\" value = \"enabled\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster#setting https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html","title":"enable-container-insight"},{"location":"checks/aws/ecs/enable-container-insight/#explanation","text":"Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services.","title":"Explanation"},{"location":"checks/aws/ecs/enable-container-insight/#possible-impact","text":"Not all metrics and logs may be gathered for containers when Container Insights isn't enabled","title":"Possible Impact"},{"location":"checks/aws/ecs/enable-container-insight/#suggested-resolution","text":"Enable Container Insights","title":"Suggested Resolution"},{"location":"checks/aws/ecs/enable-container-insight/#insecure-example","text":"The following example will fail the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"bad_example\" { name = \"services-cluster\" }","title":"Insecure Example"},{"location":"checks/aws/ecs/enable-container-insight/#secure-example","text":"The following example will pass the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"good_example\" { name = \"services-cluster\" setting { name = \"containerInsights\" value = \"enabled\" } }","title":"Secure Example"},{"location":"checks/aws/ecs/enable-container-insight/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster#setting https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html","title":"Related Links"},{"location":"checks/aws/ecs/enable-in-transit-encryption/","text":"Explanation ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception. Possible Impact Intercepted traffic to and from EFS may lead to data loss Suggested Resolution Enable in transit encryption when using efs Insecure Example The following example will fail the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"bad_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } } Secure Example The following example will pass the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"good_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" transit_encryption = \"ENABLED\" transit_encryption_port = 2999 authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition#transit_encryption https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html","title":"enable-in-transit-encryption"},{"location":"checks/aws/ecs/enable-in-transit-encryption/#explanation","text":"ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception.","title":"Explanation"},{"location":"checks/aws/ecs/enable-in-transit-encryption/#possible-impact","text":"Intercepted traffic to and from EFS may lead to data loss","title":"Possible Impact"},{"location":"checks/aws/ecs/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption when using efs","title":"Suggested Resolution"},{"location":"checks/aws/ecs/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"bad_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } }","title":"Insecure Example"},{"location":"checks/aws/ecs/enable-in-transit-encryption/#secure-example","text":"The following example will pass the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"good_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" transit_encryption = \"ENABLED\" transit_encryption_port = 2999 authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } }","title":"Secure Example"},{"location":"checks/aws/ecs/enable-in-transit-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition#transit_encryption https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html","title":"Related Links"},{"location":"checks/aws/ecs/no-plaintext-secrets/","text":"Explanation You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them. Possible Impact Sensitive data could be exposed in the AWS Management Console Suggested Resolution Use secrets for the task definition Insecure Example The following example will fail the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"bad_example\" { container_definitions = <<EOF [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" }, { \"name\" : \"DATABASE_PASSWORD\", \"value\": \"oh no D:\" } ] } ] EOF } Secure Example The following example will pass the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"good_example\" { container_definitions = <<EOF [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" } ] } ] EOF } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html https://www.vaultproject.io/","title":"no-plaintext-secrets"},{"location":"checks/aws/ecs/no-plaintext-secrets/#explanation","text":"You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them.","title":"Explanation"},{"location":"checks/aws/ecs/no-plaintext-secrets/#possible-impact","text":"Sensitive data could be exposed in the AWS Management Console","title":"Possible Impact"},{"location":"checks/aws/ecs/no-plaintext-secrets/#suggested-resolution","text":"Use secrets for the task definition","title":"Suggested Resolution"},{"location":"checks/aws/ecs/no-plaintext-secrets/#insecure-example","text":"The following example will fail the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"bad_example\" { container_definitions = <<EOF [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" }, { \"name\" : \"DATABASE_PASSWORD\", \"value\": \"oh no D:\" } ] } ] EOF }","title":"Insecure Example"},{"location":"checks/aws/ecs/no-plaintext-secrets/#secure-example","text":"The following example will pass the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"good_example\" { container_definitions = <<EOF [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" } ] } ] EOF }","title":"Secure Example"},{"location":"checks/aws/ecs/no-plaintext-secrets/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html https://www.vaultproject.io/","title":"Related Links"},{"location":"checks/aws/efs/enable-at-rest-encryption/","text":"Explanation If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit. Possible Impact Data can be read from the EFS if compromised Suggested Resolution Enable encryption for EFS Insecure Example The following example will fail the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"bad_example\" { name = \"bar\" encrypted = false kms_key_id = \"\" } Secure Example The following example will pass the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"good_example\" { name = \"bar\" encrypted = true kms_key_id = \"my_kms_key\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system https://docs.aws.amazon.com/efs/latest/ug/encryption.html","title":"enable-at-rest-encryption"},{"location":"checks/aws/efs/enable-at-rest-encryption/#explanation","text":"If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit.","title":"Explanation"},{"location":"checks/aws/efs/enable-at-rest-encryption/#possible-impact","text":"Data can be read from the EFS if compromised","title":"Possible Impact"},{"location":"checks/aws/efs/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption for EFS","title":"Suggested Resolution"},{"location":"checks/aws/efs/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"bad_example\" { name = \"bar\" encrypted = false kms_key_id = \"\" }","title":"Insecure Example"},{"location":"checks/aws/efs/enable-at-rest-encryption/#secure-example","text":"The following example will pass the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"good_example\" { name = \"bar\" encrypted = true kms_key_id = \"my_kms_key\" }","title":"Secure Example"},{"location":"checks/aws/efs/enable-at-rest-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system https://docs.aws.amazon.com/efs/latest/ug/encryption.html","title":"Related Links"},{"location":"checks/aws/eks/enable-control-plane-logging/","text":"Explanation By default cluster control plane logging is not turned on. Logging is available for audit, api, authenticator, controllerManager and scheduler. All logging should be turned on for cluster control plane. Possible Impact Logging provides valuable information about access and usage Suggested Resolution Enable logging for the EKS control plane Insecure Example The following example will fail the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"bad_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Secure Example The following example will pass the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } enabled_cluster_log_types = [ \"api\", \"authenticator\", \"audit\", \"scheduler\", \"controllerManager\" ] name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#enabled_cluster_log_types https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html","title":"enable-control-plane-logging"},{"location":"checks/aws/eks/enable-control-plane-logging/#explanation","text":"By default cluster control plane logging is not turned on. Logging is available for audit, api, authenticator, controllerManager and scheduler. All logging should be turned on for cluster control plane.","title":"Explanation"},{"location":"checks/aws/eks/enable-control-plane-logging/#possible-impact","text":"Logging provides valuable information about access and usage","title":"Possible Impact"},{"location":"checks/aws/eks/enable-control-plane-logging/#suggested-resolution","text":"Enable logging for the EKS control plane","title":"Suggested Resolution"},{"location":"checks/aws/eks/enable-control-plane-logging/#insecure-example","text":"The following example will fail the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"bad_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }","title":"Insecure Example"},{"location":"checks/aws/eks/enable-control-plane-logging/#secure-example","text":"The following example will pass the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } enabled_cluster_log_types = [ \"api\", \"authenticator\", \"audit\", \"scheduler\", \"controllerManager\" ] name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }","title":"Secure Example"},{"location":"checks/aws/eks/enable-control-plane-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#enabled_cluster_log_types https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html","title":"Related Links"},{"location":"checks/aws/eks/encrypt-secrets/","text":"Explanation EKS cluster resources should have the encryption_config block set with protection of the secrets resource. Possible Impact EKS secrets could be read if compromised Suggested Resolution Enable encryption of EKS secrets Insecure Example The following example will fail the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"bad_example\" { name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Secure Example The following example will pass the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#encryption_config https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/","title":"encrypt-secrets"},{"location":"checks/aws/eks/encrypt-secrets/#explanation","text":"EKS cluster resources should have the encryption_config block set with protection of the secrets resource.","title":"Explanation"},{"location":"checks/aws/eks/encrypt-secrets/#possible-impact","text":"EKS secrets could be read if compromised","title":"Possible Impact"},{"location":"checks/aws/eks/encrypt-secrets/#suggested-resolution","text":"Enable encryption of EKS secrets","title":"Suggested Resolution"},{"location":"checks/aws/eks/encrypt-secrets/#insecure-example","text":"The following example will fail the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"bad_example\" { name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }","title":"Insecure Example"},{"location":"checks/aws/eks/encrypt-secrets/#secure-example","text":"The following example will pass the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }","title":"Secure Example"},{"location":"checks/aws/eks/encrypt-secrets/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#encryption_config https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/","title":"Related Links"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/","text":"Explanation EKS Clusters have public access cidrs set to 0.0.0.0/0 by default which is wide open to the internet. This should be explicitly set to a more specific CIDR range Possible Impact EKS can be access from the internet Suggested Resolution Don't enable public access to EKS Clusters Insecure Example The following example will fail the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true } } Secure Example The following example will pass the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"10.2.0.0/8\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config https://docs.aws.amazon.com/eks/latest/userguide/create-public-private-vpc.html","title":"no-public-cluster-access-to-cidr"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/#explanation","text":"EKS Clusters have public access cidrs set to 0.0.0.0/0 by default which is wide open to the internet. This should be explicitly set to a more specific CIDR range","title":"Explanation"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/#possible-impact","text":"EKS can be access from the internet","title":"Possible Impact"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/#suggested-resolution","text":"Don't enable public access to EKS Clusters","title":"Suggested Resolution"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/#insecure-example","text":"The following example will fail the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true } }","title":"Insecure Example"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/#secure-example","text":"The following example will pass the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"10.2.0.0/8\" ] } }","title":"Secure Example"},{"location":"checks/aws/eks/no-public-cluster-access-to-cidr/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config https://docs.aws.amazon.com/eks/latest/userguide/create-public-private-vpc.html","title":"Related Links"},{"location":"checks/aws/eks/no-public-cluster-access/","text":"Explanation EKS clusters are available publicly by default, this should be explicitly disabled in the vpc_config of the EKS cluster resource. Possible Impact EKS can be access from the internet Suggested Resolution Don't enable public access to EKS Clusters Insecure Example The following example will fail the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"0.0.0.0/0\" ] } } Secure Example The following example will pass the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#endpoint_public_access https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html","title":"no-public-cluster-access"},{"location":"checks/aws/eks/no-public-cluster-access/#explanation","text":"EKS clusters are available publicly by default, this should be explicitly disabled in the vpc_config of the EKS cluster resource.","title":"Explanation"},{"location":"checks/aws/eks/no-public-cluster-access/#possible-impact","text":"EKS can be access from the internet","title":"Possible Impact"},{"location":"checks/aws/eks/no-public-cluster-access/#suggested-resolution","text":"Don't enable public access to EKS Clusters","title":"Suggested Resolution"},{"location":"checks/aws/eks/no-public-cluster-access/#insecure-example","text":"The following example will fail the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"0.0.0.0/0\" ] } }","title":"Insecure Example"},{"location":"checks/aws/eks/no-public-cluster-access/#secure-example","text":"The following example will pass the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }","title":"Secure Example"},{"location":"checks/aws/eks/no-public-cluster-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#endpoint_public_access https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html","title":"Related Links"},{"location":"checks/aws/elastic-search/enable-domain-logging/","text":"Explanation Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. Audit logs track user activity for compliance purposes. All the logs are disabled by default. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for ElasticSearch domains Insecure Example The following example will fail the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" } resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" enabled = false } } Secure Example The following example will pass the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" enabled = true } } resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#log_type https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html","title":"enable-domain-logging"},{"location":"checks/aws/elastic-search/enable-domain-logging/#explanation","text":"Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. Audit logs track user activity for compliance purposes. All the logs are disabled by default.","title":"Explanation"},{"location":"checks/aws/elastic-search/enable-domain-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/aws/elastic-search/enable-domain-logging/#suggested-resolution","text":"Enable logging for ElasticSearch domains","title":"Suggested Resolution"},{"location":"checks/aws/elastic-search/enable-domain-logging/#insecure-example","text":"The following example will fail the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" } resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" enabled = false } }","title":"Insecure Example"},{"location":"checks/aws/elastic-search/enable-domain-logging/#secure-example","text":"The following example will pass the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" enabled = true } } resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" enabled = true } }","title":"Secure Example"},{"location":"checks/aws/elastic-search/enable-domain-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#log_type https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html","title":"Related Links"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/","text":"Explanation Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private. Possible Impact In transit data between nodes could be read if intercepted Suggested Resolution Enable encrypted node to node communication Insecure Example The following example will fail the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = false } } Secure Example The following example will pass the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html","title":"enable-in-transit-encryption"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/#explanation","text":"Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private.","title":"Explanation"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/#possible-impact","text":"In transit data between nodes could be read if intercepted","title":"Possible Impact"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/#suggested-resolution","text":"Enable encrypted node to node communication","title":"Suggested Resolution"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = false } }","title":"Insecure Example"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/#secure-example","text":"The following example will pass the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = true } }","title":"Secure Example"},{"location":"checks/aws/elastic-search/enable-in-transit-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html","title":"Related Links"},{"location":"checks/aws/elastic-search/enable-logging/","text":"Explanation AWS ES domain should have logging enabled by default. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for ElasticSearch domains Insecure Example The following example will fail the aws-elastic-search-enable-logging check. resource \"aws_elasticsearch_domain\" \"example\" { // other config // One of the log_publishing_options has to be AUDIT_LOGS log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" } } Secure Example The following example will pass the aws-elastic-search-enable-logging check. resource \"aws_elasticsearch_domain\" \"example\" { // other config // At minimum we should have AUDIT_LOGS enabled log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"AUDIT_LOGS\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#log_publishing_options","title":"enable-logging"},{"location":"checks/aws/elastic-search/enable-logging/#explanation","text":"AWS ES domain should have logging enabled by default.","title":"Explanation"},{"location":"checks/aws/elastic-search/enable-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/aws/elastic-search/enable-logging/#suggested-resolution","text":"Enable logging for ElasticSearch domains","title":"Suggested Resolution"},{"location":"checks/aws/elastic-search/enable-logging/#insecure-example","text":"The following example will fail the aws-elastic-search-enable-logging check. resource \"aws_elasticsearch_domain\" \"example\" { // other config // One of the log_publishing_options has to be AUDIT_LOGS log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"INDEX_SLOW_LOGS\" } }","title":"Insecure Example"},{"location":"checks/aws/elastic-search/enable-logging/#secure-example","text":"The following example will pass the aws-elastic-search-enable-logging check. resource \"aws_elasticsearch_domain\" \"example\" { // other config // At minimum we should have AUDIT_LOGS enabled log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"AUDIT_LOGS\" } }","title":"Secure Example"},{"location":"checks/aws/elastic-search/enable-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#log_publishing_options","title":"Related Links"},{"location":"checks/aws/elastic-search/encrypt-replication-group/","text":"Explanation You should ensure your Elasticache data is encrypted at rest to help prevent sensitive information from being read by unauthorised users. Possible Impact Data in the replication group could be readable if compromised Suggested Resolution Enable encryption for replication group Insecure Example The following example will fail the aws-elastic-search-encrypt-replication-group check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = false } Secure Example The following example will pass the aws-elastic-search-encrypt-replication-group check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#at_rest_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/at-rest-encryption.html","title":"encrypt-replication-group"},{"location":"checks/aws/elastic-search/encrypt-replication-group/#explanation","text":"You should ensure your Elasticache data is encrypted at rest to help prevent sensitive information from being read by unauthorised users.","title":"Explanation"},{"location":"checks/aws/elastic-search/encrypt-replication-group/#possible-impact","text":"Data in the replication group could be readable if compromised","title":"Possible Impact"},{"location":"checks/aws/elastic-search/encrypt-replication-group/#suggested-resolution","text":"Enable encryption for replication group","title":"Suggested Resolution"},{"location":"checks/aws/elastic-search/encrypt-replication-group/#insecure-example","text":"The following example will fail the aws-elastic-search-encrypt-replication-group check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = false }","title":"Insecure Example"},{"location":"checks/aws/elastic-search/encrypt-replication-group/#secure-example","text":"The following example will pass the aws-elastic-search-encrypt-replication-group check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = true }","title":"Secure Example"},{"location":"checks/aws/elastic-search/encrypt-replication-group/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#at_rest_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/at-rest-encryption.html","title":"Related Links"},{"location":"checks/aws/elastic-search/enforce-https/","text":"Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact HTTP traffic can be intercepted and the contents read Suggested Resolution Enforce the use of HTTPS for ElasticSearch Insecure Example The following example will fail the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = false } } Secure Example The following example will pass the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#enforce_https https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"enforce-https"},{"location":"checks/aws/elastic-search/enforce-https/#explanation","text":"Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.","title":"Explanation"},{"location":"checks/aws/elastic-search/enforce-https/#possible-impact","text":"HTTP traffic can be intercepted and the contents read","title":"Possible Impact"},{"location":"checks/aws/elastic-search/enforce-https/#suggested-resolution","text":"Enforce the use of HTTPS for ElasticSearch","title":"Suggested Resolution"},{"location":"checks/aws/elastic-search/enforce-https/#insecure-example","text":"The following example will fail the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = false } }","title":"Insecure Example"},{"location":"checks/aws/elastic-search/enforce-https/#secure-example","text":"The following example will pass the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true } }","title":"Secure Example"},{"location":"checks/aws/elastic-search/enforce-https/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#enforce_https https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"Related Links"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-0-2019-07\" } } Secure Example The following example will pass the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-2-2019-07\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#tls_security_policy https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"use-secure-tls-policy"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/#possible-impact","text":"Outdated SSL policies increase exposure to known vulnerabilities","title":"Possible Impact"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS/SSL policies available","title":"Suggested Resolution"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/#insecure-example","text":"The following example will fail the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-0-2019-07\" } }","title":"Insecure Example"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/#secure-example","text":"The following example will pass the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-2-2019-07\" } }","title":"Secure Example"},{"location":"checks/aws/elastic-search/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#tls_security_policy https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"Related Links"},{"location":"checks/aws/elastic-service/enable-domain-encryption/","text":"Explanation You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users. Possible Impact Data will be readable if compromised Suggested Resolution Enable ElasticSearch domain encryption Insecure Example The following example will fail the aws-elastic-service-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = false } } Secure Example The following example will pass the aws-elastic-service-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html","title":"enable-domain-encryption"},{"location":"checks/aws/elastic-service/enable-domain-encryption/#explanation","text":"You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users.","title":"Explanation"},{"location":"checks/aws/elastic-service/enable-domain-encryption/#possible-impact","text":"Data will be readable if compromised","title":"Possible Impact"},{"location":"checks/aws/elastic-service/enable-domain-encryption/#suggested-resolution","text":"Enable ElasticSearch domain encryption","title":"Suggested Resolution"},{"location":"checks/aws/elastic-service/enable-domain-encryption/#insecure-example","text":"The following example will fail the aws-elastic-service-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = false } }","title":"Insecure Example"},{"location":"checks/aws/elastic-service/enable-domain-encryption/#secure-example","text":"The following example will pass the aws-elastic-service-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = true } }","title":"Secure Example"},{"location":"checks/aws/elastic-service/enable-domain-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html","title":"Related Links"},{"location":"checks/aws/elasticache/add-description-for-security-group/","text":"Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"bad_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"\" } Secure Example The following example will pass the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"good_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"something\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_security_group#description","title":"add-description-for-security-group"},{"location":"checks/aws/elasticache/add-description-for-security-group/#explanation","text":"Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/aws/elasticache/add-description-for-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/aws/elasticache/add-description-for-security-group/#suggested-resolution","text":"Add descriptions for all security groups and rules","title":"Suggested Resolution"},{"location":"checks/aws/elasticache/add-description-for-security-group/#insecure-example","text":"The following example will fail the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"bad_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"\" }","title":"Insecure Example"},{"location":"checks/aws/elasticache/add-description-for-security-group/#secure-example","text":"The following example will pass the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"good_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"something\" }","title":"Secure Example"},{"location":"checks/aws/elasticache/add-description-for-security-group/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_security_group#description","title":"Related Links"},{"location":"checks/aws/elasticache/enable-backup-retention/","text":"Explanation Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required. Possible Impact Without backups of the redis cluster recovery is made difficult Suggested Resolution Configure snapshot retention for redis cluster Insecure Example The following example will fail the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"bad_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 } Secure Example The following example will pass the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"good_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 snapshot_retention_limit = 5 } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_cluster#snapshot_retention_limit https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html","title":"enable-backup-retention"},{"location":"checks/aws/elasticache/enable-backup-retention/#explanation","text":"Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required.","title":"Explanation"},{"location":"checks/aws/elasticache/enable-backup-retention/#possible-impact","text":"Without backups of the redis cluster recovery is made difficult","title":"Possible Impact"},{"location":"checks/aws/elasticache/enable-backup-retention/#suggested-resolution","text":"Configure snapshot retention for redis cluster","title":"Suggested Resolution"},{"location":"checks/aws/elasticache/enable-backup-retention/#insecure-example","text":"The following example will fail the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"bad_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 }","title":"Insecure Example"},{"location":"checks/aws/elasticache/enable-backup-retention/#secure-example","text":"The following example will pass the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"good_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 snapshot_retention_limit = 5 }","title":"Secure Example"},{"location":"checks/aws/elasticache/enable-backup-retention/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_cluster#snapshot_retention_limit https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html","title":"Related Links"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/","text":"Explanation Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private. Possible Impact In transit data in the Replication Group could be read if intercepted Suggested Resolution Enable in transit encryption for replication group Insecure Example The following example will fail the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = false } Secure Example The following example will pass the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#transit_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html","title":"enable-in-transit-encryption"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/#explanation","text":"Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private.","title":"Explanation"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/#possible-impact","text":"In transit data in the Replication Group could be read if intercepted","title":"Possible Impact"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption for replication group","title":"Suggested Resolution"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = false }","title":"Insecure Example"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/#secure-example","text":"The following example will pass the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = true }","title":"Secure Example"},{"location":"checks/aws/elasticache/enable-in-transit-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#transit_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html","title":"Related Links"},{"location":"checks/aws/elb/drop-invalid-headers/","text":"Explanation Passing unknown or invalid headers through to the target poses a potential risk of compromise. By setting drop_invalid_header_fields to true, anything that doe not conform to well known, defined headers will be removed by the load balancer. Possible Impact Invalid headers being passed through to the target of the load balance may exploit vulnerabilities Suggested Resolution Set drop_invalid_header_fields to true Insecure Example The following example will fail the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"bad_example\" { name = \"bad_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = false } Secure Example The following example will pass the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"good_example\" { name = \"good_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb#drop_invalid_header_fields https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html","title":"drop-invalid-headers"},{"location":"checks/aws/elb/drop-invalid-headers/#explanation","text":"Passing unknown or invalid headers through to the target poses a potential risk of compromise. By setting drop_invalid_header_fields to true, anything that doe not conform to well known, defined headers will be removed by the load balancer.","title":"Explanation"},{"location":"checks/aws/elb/drop-invalid-headers/#possible-impact","text":"Invalid headers being passed through to the target of the load balance may exploit vulnerabilities","title":"Possible Impact"},{"location":"checks/aws/elb/drop-invalid-headers/#suggested-resolution","text":"Set drop_invalid_header_fields to true","title":"Suggested Resolution"},{"location":"checks/aws/elb/drop-invalid-headers/#insecure-example","text":"The following example will fail the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"bad_example\" { name = \"bad_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = false }","title":"Insecure Example"},{"location":"checks/aws/elb/drop-invalid-headers/#secure-example","text":"The following example will pass the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"good_example\" { name = \"good_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = true }","title":"Secure Example"},{"location":"checks/aws/elb/drop-invalid-headers/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb#drop_invalid_header_fields https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html","title":"Related Links"},{"location":"checks/aws/elbv2/alb-not-public/","text":"Explanation There are many scenarios in which you would want to expose a load balancer to the wider internet, but this check exists as a warning to prevent accidental exposure of internal assets. You should ensure that this resource should be exposed publicly. Possible Impact The load balancer is exposed on the internet Suggested Resolution Switch to an internal load balancer or add a tfsec ignore Insecure Example The following example will fail the aws-elbv2-alb-not-public check. resource \"aws_alb\" \"bad_example\" { internal = false } Secure Example The following example will pass the aws-elbv2-alb-not-public check. resource \"aws_alb\" \"good_example\" { internal = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb","title":"alb-not-public"},{"location":"checks/aws/elbv2/alb-not-public/#explanation","text":"There are many scenarios in which you would want to expose a load balancer to the wider internet, but this check exists as a warning to prevent accidental exposure of internal assets. You should ensure that this resource should be exposed publicly.","title":"Explanation"},{"location":"checks/aws/elbv2/alb-not-public/#possible-impact","text":"The load balancer is exposed on the internet","title":"Possible Impact"},{"location":"checks/aws/elbv2/alb-not-public/#suggested-resolution","text":"Switch to an internal load balancer or add a tfsec ignore","title":"Suggested Resolution"},{"location":"checks/aws/elbv2/alb-not-public/#insecure-example","text":"The following example will fail the aws-elbv2-alb-not-public check. resource \"aws_alb\" \"bad_example\" { internal = false }","title":"Insecure Example"},{"location":"checks/aws/elbv2/alb-not-public/#secure-example","text":"The following example will pass the aws-elbv2-alb-not-public check. resource \"aws_alb\" \"good_example\" { internal = true }","title":"Secure Example"},{"location":"checks/aws/elbv2/alb-not-public/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb","title":"Related Links"},{"location":"checks/aws/elbv2/http-not-used/","text":"Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact Your traffic is not protected Suggested Resolution Switch to HTTPS to benefit from TLS security features Insecure Example The following example will fail the aws-elbv2-http-not-used check. resource \"aws_alb_listener\" \"bad_example\" { protocol = \"HTTP\" } Secure Example The following example will pass the aws-elbv2-http-not-used check. resource \"aws_alb_listener\" \"good_example\" { protocol = \"HTTPS\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener https://www.cloudflare.com/en-gb/learning/ssl/why-is-http-not-secure/","title":"http-not-used"},{"location":"checks/aws/elbv2/http-not-used/#explanation","text":"Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.","title":"Explanation"},{"location":"checks/aws/elbv2/http-not-used/#possible-impact","text":"Your traffic is not protected","title":"Possible Impact"},{"location":"checks/aws/elbv2/http-not-used/#suggested-resolution","text":"Switch to HTTPS to benefit from TLS security features","title":"Suggested Resolution"},{"location":"checks/aws/elbv2/http-not-used/#insecure-example","text":"The following example will fail the aws-elbv2-http-not-used check. resource \"aws_alb_listener\" \"bad_example\" { protocol = \"HTTP\" }","title":"Insecure Example"},{"location":"checks/aws/elbv2/http-not-used/#secure-example","text":"The following example will pass the aws-elbv2-http-not-used check. resource \"aws_alb_listener\" \"good_example\" { protocol = \"HTTPS\" }","title":"Secure Example"},{"location":"checks/aws/elbv2/http-not-used/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener https://www.cloudflare.com/en-gb/learning/ssl/why-is-http-not-secure/","title":"Related Links"},{"location":"checks/aws/iam/block-kms-policy-wildcard/","text":"Explanation IAM policies define which actions an identity (user, group, or role) can perform on which resources. Following security best practices, AWS recommends that you allow least privilege. In other words, you should grant to identities only the kms:Decrypt or kms:ReEncryptFrom permissions and only for the keys that are required to perform a task. Possible Impact Identities may be able to decrypt data which they should not have access to Suggested Resolution Scope down the resources of the IAM policy to specific keys Insecure Example The following example will fail the aws-iam-block-kms-policy-wildcard check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.kms_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"ec2.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"kms_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"kms:*\" ] resources = [ \"*\" ] } } Secure Example The following example will pass the aws-iam-block-kms-policy-wildcard check. resource \"aws_kms_key\" \"main\" { enable_key_rotation = true } resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.kms_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"ec2.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"kms_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"kms:*\" ] resources = [ aws_kms_key.main.arn ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-kms-1","title":"block-kms-policy-wildcard"},{"location":"checks/aws/iam/block-kms-policy-wildcard/#explanation","text":"IAM policies define which actions an identity (user, group, or role) can perform on which resources. Following security best practices, AWS recommends that you allow least privilege. In other words, you should grant to identities only the kms:Decrypt or kms:ReEncryptFrom permissions and only for the keys that are required to perform a task.","title":"Explanation"},{"location":"checks/aws/iam/block-kms-policy-wildcard/#possible-impact","text":"Identities may be able to decrypt data which they should not have access to","title":"Possible Impact"},{"location":"checks/aws/iam/block-kms-policy-wildcard/#suggested-resolution","text":"Scope down the resources of the IAM policy to specific keys","title":"Suggested Resolution"},{"location":"checks/aws/iam/block-kms-policy-wildcard/#insecure-example","text":"The following example will fail the aws-iam-block-kms-policy-wildcard check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.kms_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"ec2.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"kms_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"kms:*\" ] resources = [ \"*\" ] } }","title":"Insecure Example"},{"location":"checks/aws/iam/block-kms-policy-wildcard/#secure-example","text":"The following example will pass the aws-iam-block-kms-policy-wildcard check. resource \"aws_kms_key\" \"main\" { enable_key_rotation = true } resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.kms_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"ec2.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"kms_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"kms:*\" ] resources = [ aws_kms_key.main.arn ] } }","title":"Secure Example"},{"location":"checks/aws/iam/block-kms-policy-wildcard/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-kms-1","title":"Related Links"},{"location":"checks/aws/iam/no-password-reuse/","text":"Explanation IAM account password policies should prevent the reuse of passwords. The account password policy should be set to prevent using any of the last five used passwords. Possible Impact Password reuse increase the risk of compromised passwords being abused Suggested Resolution Prevent password reuse in the policy Insecure Example The following example will fail the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... password_reuse_prevention = 1 # ... } Secure Example The following example will pass the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... password_reuse_prevention = 5 # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"no-password-reuse"},{"location":"checks/aws/iam/no-password-reuse/#explanation","text":"IAM account password policies should prevent the reuse of passwords. The account password policy should be set to prevent using any of the last five used passwords.","title":"Explanation"},{"location":"checks/aws/iam/no-password-reuse/#possible-impact","text":"Password reuse increase the risk of compromised passwords being abused","title":"Possible Impact"},{"location":"checks/aws/iam/no-password-reuse/#suggested-resolution","text":"Prevent password reuse in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/no-password-reuse/#insecure-example","text":"The following example will fail the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... password_reuse_prevention = 1 # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/no-password-reuse/#secure-example","text":"The following example will pass the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... password_reuse_prevention = 5 # ... }","title":"Secure Example"},{"location":"checks/aws/iam/no-password-reuse/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/iam/no-policy-wildcards/","text":"Explanation You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals. Possible Impact Overly permissive policies may grant access to sensitive resources Suggested Resolution Specify the exact permissions required, and to which resources they should apply instead of using wildcards. Insecure Example The following example will fail the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:*\" ] resources = [ \"*\" ] } } Secure Example The following example will pass the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:GetObject\" ] resources = [ aws_s3_bucket.example.arn ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html","title":"no-policy-wildcards"},{"location":"checks/aws/iam/no-policy-wildcards/#explanation","text":"You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals.","title":"Explanation"},{"location":"checks/aws/iam/no-policy-wildcards/#possible-impact","text":"Overly permissive policies may grant access to sensitive resources","title":"Possible Impact"},{"location":"checks/aws/iam/no-policy-wildcards/#suggested-resolution","text":"Specify the exact permissions required, and to which resources they should apply instead of using wildcards.","title":"Suggested Resolution"},{"location":"checks/aws/iam/no-policy-wildcards/#insecure-example","text":"The following example will fail the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:*\" ] resources = [ \"*\" ] } }","title":"Insecure Example"},{"location":"checks/aws/iam/no-policy-wildcards/#secure-example","text":"The following example will pass the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:GetObject\" ] resources = [ aws_s3_bucket.example.arn ] } }","title":"Secure Example"},{"location":"checks/aws/iam/no-policy-wildcards/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html","title":"Related Links"},{"location":"checks/aws/iam/require-lowercase-in-passwords/","text":"Explanation IAM account password policies should ensure that passwords content including at least one lowercase character. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_lowercase_characters not set # ... } Secure Example The following example will pass the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_lowercase_characters = true # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"require-lowercase-in-passwords"},{"location":"checks/aws/iam/require-lowercase-in-passwords/#explanation","text":"IAM account password policies should ensure that passwords content including at least one lowercase character.","title":"Explanation"},{"location":"checks/aws/iam/require-lowercase-in-passwords/#possible-impact","text":"Short, simple passwords are easier to compromise","title":"Possible Impact"},{"location":"checks/aws/iam/require-lowercase-in-passwords/#suggested-resolution","text":"Enforce longer, more complex passwords in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/require-lowercase-in-passwords/#insecure-example","text":"The following example will fail the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_lowercase_characters not set # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/require-lowercase-in-passwords/#secure-example","text":"The following example will pass the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_lowercase_characters = true # ... }","title":"Secure Example"},{"location":"checks/aws/iam/require-lowercase-in-passwords/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/iam/require-numbers-in-passwords/","text":"Explanation IAM account password policies should ensure that passwords content including at least one number. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_numbers not set # ... } Secure Example The following example will pass the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_numbers = true # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"require-numbers-in-passwords"},{"location":"checks/aws/iam/require-numbers-in-passwords/#explanation","text":"IAM account password policies should ensure that passwords content including at least one number.","title":"Explanation"},{"location":"checks/aws/iam/require-numbers-in-passwords/#possible-impact","text":"Short, simple passwords are easier to compromise","title":"Possible Impact"},{"location":"checks/aws/iam/require-numbers-in-passwords/#suggested-resolution","text":"Enforce longer, more complex passwords in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/require-numbers-in-passwords/#insecure-example","text":"The following example will fail the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_numbers not set # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/require-numbers-in-passwords/#secure-example","text":"The following example will pass the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_numbers = true # ... }","title":"Secure Example"},{"location":"checks/aws/iam/require-numbers-in-passwords/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/iam/require-symbols-in-passwords/","text":"Explanation IAM account password policies should ensure that passwords content including a symbol. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_symbols not set # ... } Secure Example The following example will pass the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_symbols = true # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"require-symbols-in-passwords"},{"location":"checks/aws/iam/require-symbols-in-passwords/#explanation","text":"IAM account password policies should ensure that passwords content including a symbol.","title":"Explanation"},{"location":"checks/aws/iam/require-symbols-in-passwords/#possible-impact","text":"Short, simple passwords are easier to compromise","title":"Possible Impact"},{"location":"checks/aws/iam/require-symbols-in-passwords/#suggested-resolution","text":"Enforce longer, more complex passwords in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/require-symbols-in-passwords/#insecure-example","text":"The following example will fail the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_symbols not set # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/require-symbols-in-passwords/#secure-example","text":"The following example will pass the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_symbols = true # ... }","title":"Secure Example"},{"location":"checks/aws/iam/require-symbols-in-passwords/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/iam/require-uppercase-in-passwords/","text":"Explanation , IAM account password policies should ensure that passwords content including at least one uppercase character. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_uppercase_characters not set # ... } Secure Example The following example will pass the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_uppercase_characters = true # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"require-uppercase-in-passwords"},{"location":"checks/aws/iam/require-uppercase-in-passwords/#explanation","text":", IAM account password policies should ensure that passwords content including at least one uppercase character.","title":"Explanation"},{"location":"checks/aws/iam/require-uppercase-in-passwords/#possible-impact","text":"Short, simple passwords are easier to compromise","title":"Possible Impact"},{"location":"checks/aws/iam/require-uppercase-in-passwords/#suggested-resolution","text":"Enforce longer, more complex passwords in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/require-uppercase-in-passwords/#insecure-example","text":"The following example will fail the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_uppercase_characters not set # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/require-uppercase-in-passwords/#secure-example","text":"The following example will pass the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_uppercase_characters = true # ... }","title":"Secure Example"},{"location":"checks/aws/iam/require-uppercase-in-passwords/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/iam/set-max-password-age/","text":"Explanation IAM account password policies should have a maximum age specified. The account password policy should be set to expire passwords after 90 days or less. Possible Impact Long life password increase the likelihood of a password eventually being compromised Suggested Resolution Limit the password duration with an expiry in the policy Insecure Example The following example will fail the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # max_password_age not set # ... } Secure Example The following example will pass the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... max_password_age = 90 # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"set-max-password-age"},{"location":"checks/aws/iam/set-max-password-age/#explanation","text":"IAM account password policies should have a maximum age specified. The account password policy should be set to expire passwords after 90 days or less.","title":"Explanation"},{"location":"checks/aws/iam/set-max-password-age/#possible-impact","text":"Long life password increase the likelihood of a password eventually being compromised","title":"Possible Impact"},{"location":"checks/aws/iam/set-max-password-age/#suggested-resolution","text":"Limit the password duration with an expiry in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/set-max-password-age/#insecure-example","text":"The following example will fail the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # max_password_age not set # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/set-max-password-age/#secure-example","text":"The following example will pass the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... max_password_age = 90 # ... }","title":"Secure Example"},{"location":"checks/aws/iam/set-max-password-age/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/iam/set-minimum-password-length/","text":"Explanation IAM account password policies should ensure that passwords have a minimum length. The account password policy should be set to enforce minimum password length of at least 14 characters. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # minimum_password_length not set # ... } Secure Example The following example will pass the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... minimum_password_length = 14 # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"set-minimum-password-length"},{"location":"checks/aws/iam/set-minimum-password-length/#explanation","text":"IAM account password policies should ensure that passwords have a minimum length. The account password policy should be set to enforce minimum password length of at least 14 characters.","title":"Explanation"},{"location":"checks/aws/iam/set-minimum-password-length/#possible-impact","text":"Short, simple passwords are easier to compromise","title":"Possible Impact"},{"location":"checks/aws/iam/set-minimum-password-length/#suggested-resolution","text":"Enforce longer, more complex passwords in the policy","title":"Suggested Resolution"},{"location":"checks/aws/iam/set-minimum-password-length/#insecure-example","text":"The following example will fail the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # minimum_password_length not set # ... }","title":"Insecure Example"},{"location":"checks/aws/iam/set-minimum-password-length/#secure-example","text":"The following example will pass the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... minimum_password_length = 14 # ... }","title":"Secure Example"},{"location":"checks/aws/iam/set-minimum-password-length/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details","title":"Related Links"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/","text":"Explanation Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured. Possible Impact Intercepted data can be read in transit Suggested Resolution Enable in transit encryption Insecure Example The following example will fail the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"bad_example\" { encryption_type = \"NONE\" } Secure Example The following example will pass the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"good_example\" { encryption_type = \"KMS\" kms_key_id = \"my/special/key\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kinesis_stream#encryption_type https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html","title":"enable-in-transit-encryption"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/#explanation","text":"Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured.","title":"Explanation"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/#possible-impact","text":"Intercepted data can be read in transit","title":"Possible Impact"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption","title":"Suggested Resolution"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"bad_example\" { encryption_type = \"NONE\" }","title":"Insecure Example"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/#secure-example","text":"The following example will pass the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"good_example\" { encryption_type = \"KMS\" kms_key_id = \"my/special/key\" }","title":"Secure Example"},{"location":"checks/aws/kinesis/enable-in-transit-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kinesis_stream#encryption_type https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html","title":"Related Links"},{"location":"checks/aws/kms/auto-rotate-keys/","text":"Explanation You should configure your KMS keys to auto rotate to maintain security and defend against compromise. Possible Impact Long life KMS keys increase the attack surface when compromised Suggested Resolution Configure KMS key to auto rotate Insecure Example The following example will fail the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"bad_example\" { enable_key_rotation = false } Secure Example The following example will pass the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"good_example\" { enable_key_rotation = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key#enable_key_rotation https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html","title":"auto-rotate-keys"},{"location":"checks/aws/kms/auto-rotate-keys/#explanation","text":"You should configure your KMS keys to auto rotate to maintain security and defend against compromise.","title":"Explanation"},{"location":"checks/aws/kms/auto-rotate-keys/#possible-impact","text":"Long life KMS keys increase the attack surface when compromised","title":"Possible Impact"},{"location":"checks/aws/kms/auto-rotate-keys/#suggested-resolution","text":"Configure KMS key to auto rotate","title":"Suggested Resolution"},{"location":"checks/aws/kms/auto-rotate-keys/#insecure-example","text":"The following example will fail the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"bad_example\" { enable_key_rotation = false }","title":"Insecure Example"},{"location":"checks/aws/kms/auto-rotate-keys/#secure-example","text":"The following example will pass the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"good_example\" { enable_key_rotation = true }","title":"Secure Example"},{"location":"checks/aws/kms/auto-rotate-keys/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key#enable_key_rotation https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html","title":"Related Links"},{"location":"checks/aws/lambda/enable-tracing/","text":"Explanation X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts. Possible Impact Without full tracing enabled, it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"bad_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"\" } } Secure Example The following example will pass the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"good_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"something\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_function#mode","title":"enable-tracing"},{"location":"checks/aws/lambda/enable-tracing/#explanation","text":"X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts.","title":"Explanation"},{"location":"checks/aws/lambda/enable-tracing/#possible-impact","text":"Without full tracing enabled, it is difficult to trace the flow of logs","title":"Possible Impact"},{"location":"checks/aws/lambda/enable-tracing/#suggested-resolution","text":"Enable tracing","title":"Suggested Resolution"},{"location":"checks/aws/lambda/enable-tracing/#insecure-example","text":"The following example will fail the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"bad_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"\" } }","title":"Insecure Example"},{"location":"checks/aws/lambda/enable-tracing/#secure-example","text":"The following example will pass the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"good_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"something\" } }","title":"Secure Example"},{"location":"checks/aws/lambda/enable-tracing/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_function#mode","title":"Related Links"},{"location":"checks/aws/lambda/restrict-source-arn/","text":"Explanation When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API Possible Impact Not providing the source ARN allows any resource from principal, even from other accounts Suggested Resolution Always provide a source arn for Lambda permissions Insecure Example The following example will fail the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"bad_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" } Secure Example The following example will pass the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"good_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" source_arn = aws_sns_topic.default.arn } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_permission https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html","title":"restrict-source-arn"},{"location":"checks/aws/lambda/restrict-source-arn/#explanation","text":"When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API","title":"Explanation"},{"location":"checks/aws/lambda/restrict-source-arn/#possible-impact","text":"Not providing the source ARN allows any resource from principal, even from other accounts","title":"Possible Impact"},{"location":"checks/aws/lambda/restrict-source-arn/#suggested-resolution","text":"Always provide a source arn for Lambda permissions","title":"Suggested Resolution"},{"location":"checks/aws/lambda/restrict-source-arn/#insecure-example","text":"The following example will fail the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"bad_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" }","title":"Insecure Example"},{"location":"checks/aws/lambda/restrict-source-arn/#secure-example","text":"The following example will pass the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"good_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" source_arn = aws_sns_topic.default.arn }","title":"Secure Example"},{"location":"checks/aws/lambda/restrict-source-arn/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_permission https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html","title":"Related Links"},{"location":"checks/aws/launch/no-sensitive-info/","text":"Explanation When creating Launch Configurations, user data can be used for the initial configuration of the instance. User data must not contain any sensitive data. Possible Impact Sensitive credentials in user data can be leaked Suggested Resolution Don't use sensitive data in user data Insecure Example The following example will fail the aws-launch-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = <<EOF export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } Secure Example The following example will pass the aws-launch-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = <<EOF export GREETING = \"Hello there\" EOF } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#user_data,user_data_base64","title":"no-sensitive-info"},{"location":"checks/aws/launch/no-sensitive-info/#explanation","text":"When creating Launch Configurations, user data can be used for the initial configuration of the instance. User data must not contain any sensitive data.","title":"Explanation"},{"location":"checks/aws/launch/no-sensitive-info/#possible-impact","text":"Sensitive credentials in user data can be leaked","title":"Possible Impact"},{"location":"checks/aws/launch/no-sensitive-info/#suggested-resolution","text":"Don't use sensitive data in user data","title":"Suggested Resolution"},{"location":"checks/aws/launch/no-sensitive-info/#insecure-example","text":"The following example will fail the aws-launch-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = <<EOF export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF }","title":"Insecure Example"},{"location":"checks/aws/launch/no-sensitive-info/#secure-example","text":"The following example will pass the aws-launch-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = <<EOF export GREETING = \"Hello there\" EOF }","title":"Secure Example"},{"location":"checks/aws/launch/no-sensitive-info/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#user_data,user_data_base64","title":"Related Links"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/","text":"Explanation The AWS provider block should not contain hardcoded credentials. These can be passed in securely as runtime using environment variables. Possible Impact Exposing the credentials in the Terraform provider increases the risk of secret leakage Suggested Resolution Don't include access credentials in plain text Insecure Example The following example will fail the aws-misc-no-exposing-plaintext-credentials check. provider \"aws\" { access_key = \"AKIAABCD12ABCDEF1ABC\" secret_key = \"s8d7ghas9dghd9ophgs9\" } Secure Example The following example will pass the aws-misc-no-exposing-plaintext-credentials check. provider \"aws\" { } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs#argument-reference https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html","title":"no-exposing-plaintext-credentials"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/#explanation","text":"The AWS provider block should not contain hardcoded credentials. These can be passed in securely as runtime using environment variables.","title":"Explanation"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/#possible-impact","text":"Exposing the credentials in the Terraform provider increases the risk of secret leakage","title":"Possible Impact"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/#suggested-resolution","text":"Don't include access credentials in plain text","title":"Suggested Resolution"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/#insecure-example","text":"The following example will fail the aws-misc-no-exposing-plaintext-credentials check. provider \"aws\" { access_key = \"AKIAABCD12ABCDEF1ABC\" secret_key = \"s8d7ghas9dghd9ophgs9\" }","title":"Insecure Example"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/#secure-example","text":"The following example will pass the aws-misc-no-exposing-plaintext-credentials check. provider \"aws\" { }","title":"Secure Example"},{"location":"checks/aws/misc/no-exposing-plaintext-credentials/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs#argument-reference https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html","title":"Related Links"},{"location":"checks/aws/mq/enable-audit-logging/","text":"Explanation Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation Possible Impact Without audit logging it is difficult to trace activity in the MQ broker Suggested Resolution Enable audit logging Insecure Example The following example will fail the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = false } } Secure Example The following example will pass the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#audit","title":"enable-audit-logging"},{"location":"checks/aws/mq/enable-audit-logging/#explanation","text":"Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation","title":"Explanation"},{"location":"checks/aws/mq/enable-audit-logging/#possible-impact","text":"Without audit logging it is difficult to trace activity in the MQ broker","title":"Possible Impact"},{"location":"checks/aws/mq/enable-audit-logging/#suggested-resolution","text":"Enable audit logging","title":"Suggested Resolution"},{"location":"checks/aws/mq/enable-audit-logging/#insecure-example","text":"The following example will fail the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = false } }","title":"Insecure Example"},{"location":"checks/aws/mq/enable-audit-logging/#secure-example","text":"The following example will pass the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = true } }","title":"Secure Example"},{"location":"checks/aws/mq/enable-audit-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#audit","title":"Related Links"},{"location":"checks/aws/mq/enable-general-logging/","text":"Explanation Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation Possible Impact Without logging it is difficult to trace issues Suggested Resolution Enable general logging Insecure Example The following example will fail the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = false } } Secure Example The following example will pass the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#general","title":"enable-general-logging"},{"location":"checks/aws/mq/enable-general-logging/#explanation","text":"Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation","title":"Explanation"},{"location":"checks/aws/mq/enable-general-logging/#possible-impact","text":"Without logging it is difficult to trace issues","title":"Possible Impact"},{"location":"checks/aws/mq/enable-general-logging/#suggested-resolution","text":"Enable general logging","title":"Suggested Resolution"},{"location":"checks/aws/mq/enable-general-logging/#insecure-example","text":"The following example will fail the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = false } }","title":"Insecure Example"},{"location":"checks/aws/mq/enable-general-logging/#secure-example","text":"The following example will pass the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = true } }","title":"Secure Example"},{"location":"checks/aws/mq/enable-general-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#general","title":"Related Links"},{"location":"checks/aws/mq/no-public-access/","text":"Explanation Public access of the MQ broker should be disabled and only allow routes to applications that require access. Possible Impact Publicly accessible MQ Broker may be vulnerable to compromise Suggested Resolution Disable public access when not required Insecure Example The following example will fail the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = true } Secure Example The following example will pass the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = false } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#publicly_accessible","title":"no-public-access"},{"location":"checks/aws/mq/no-public-access/#explanation","text":"Public access of the MQ broker should be disabled and only allow routes to applications that require access.","title":"Explanation"},{"location":"checks/aws/mq/no-public-access/#possible-impact","text":"Publicly accessible MQ Broker may be vulnerable to compromise","title":"Possible Impact"},{"location":"checks/aws/mq/no-public-access/#suggested-resolution","text":"Disable public access when not required","title":"Suggested Resolution"},{"location":"checks/aws/mq/no-public-access/#insecure-example","text":"The following example will fail the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = true }","title":"Insecure Example"},{"location":"checks/aws/mq/no-public-access/#secure-example","text":"The following example will pass the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = false }","title":"Secure Example"},{"location":"checks/aws/mq/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#publicly_accessible","title":"Related Links"},{"location":"checks/aws/msk/enable-in-transit-encryption/","text":"Explanation Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private. Possible Impact Intercepted data can be read in transit Suggested Resolution Enable in transit encryption Insecure Example The following example will fail the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"bad_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS_PLAINTEXT\" in_cluster = true } } } Secure Example The following example will pass the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"good_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS\" in_cluster = true } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster#encryption_info-argument-reference https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html","title":"enable-in-transit-encryption"},{"location":"checks/aws/msk/enable-in-transit-encryption/#explanation","text":"Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private.","title":"Explanation"},{"location":"checks/aws/msk/enable-in-transit-encryption/#possible-impact","text":"Intercepted data can be read in transit","title":"Possible Impact"},{"location":"checks/aws/msk/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption","title":"Suggested Resolution"},{"location":"checks/aws/msk/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"bad_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS_PLAINTEXT\" in_cluster = true } } }","title":"Insecure Example"},{"location":"checks/aws/msk/enable-in-transit-encryption/#secure-example","text":"The following example will pass the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"good_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS\" in_cluster = true } } }","title":"Secure Example"},{"location":"checks/aws/msk/enable-in-transit-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster#encryption_info-argument-reference https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html","title":"Related Links"},{"location":"checks/aws/msk/enable-logging/","text":"Explanation Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to Possible Impact Without logging it is difficult to trace issues Suggested Resolution Enable logging Insecure Example The following example will fail the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } tags = { foo = \"bar\" } } Secure Example The following example will pass the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } logging_info { broker_logs { firehose { enabled = false delivery_stream = aws_kinesis_firehose_delivery_stream.test_stream.name } s3 { enabled = true bucket = aws_s3_bucket.bucket.id prefix = \"logs/msk-\" } } } tags = { foo = \"bar\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster#","title":"enable-logging"},{"location":"checks/aws/msk/enable-logging/#explanation","text":"Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to","title":"Explanation"},{"location":"checks/aws/msk/enable-logging/#possible-impact","text":"Without logging it is difficult to trace issues","title":"Possible Impact"},{"location":"checks/aws/msk/enable-logging/#suggested-resolution","text":"Enable logging","title":"Suggested Resolution"},{"location":"checks/aws/msk/enable-logging/#insecure-example","text":"The following example will fail the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } tags = { foo = \"bar\" } }","title":"Insecure Example"},{"location":"checks/aws/msk/enable-logging/#secure-example","text":"The following example will pass the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } logging_info { broker_logs { firehose { enabled = false delivery_stream = aws_kinesis_firehose_delivery_stream.test_stream.name } s3 { enabled = true bucket = aws_s3_bucket.bucket.id prefix = \"logs/msk-\" } } } tags = { foo = \"bar\" } }","title":"Secure Example"},{"location":"checks/aws/msk/enable-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster#","title":"Related Links"},{"location":"checks/aws/neptune/enable-log-export/","text":"Explanation Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs. Possible Impact Limited visibility of audit trail for changes to Neptune Suggested Resolution Enable export logs Insecure Example The following example will fail the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [] } Secure Example The following example will pass the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [ \"audit\" ] } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#enable_cloudwatch_logs_exports","title":"enable-log-export"},{"location":"checks/aws/neptune/enable-log-export/#explanation","text":"Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs.","title":"Explanation"},{"location":"checks/aws/neptune/enable-log-export/#possible-impact","text":"Limited visibility of audit trail for changes to Neptune","title":"Possible Impact"},{"location":"checks/aws/neptune/enable-log-export/#suggested-resolution","text":"Enable export logs","title":"Suggested Resolution"},{"location":"checks/aws/neptune/enable-log-export/#insecure-example","text":"The following example will fail the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [] }","title":"Insecure Example"},{"location":"checks/aws/neptune/enable-log-export/#secure-example","text":"The following example will pass the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [ \"audit\" ] }","title":"Secure Example"},{"location":"checks/aws/neptune/enable-log-export/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#enable_cloudwatch_logs_exports","title":"Related Links"},{"location":"checks/aws/neptune/enable-storage-encryption/","text":"Explanation Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable encryption of Neptune storage Insecure Example The following example will fail the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = false } Secure Example The following example will pass the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#storage_encrypted","title":"enable-storage-encryption"},{"location":"checks/aws/neptune/enable-storage-encryption/#explanation","text":"Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected.","title":"Explanation"},{"location":"checks/aws/neptune/enable-storage-encryption/#possible-impact","text":"Unencrypted sensitive data is vulnerable to compromise.","title":"Possible Impact"},{"location":"checks/aws/neptune/enable-storage-encryption/#suggested-resolution","text":"Enable encryption of Neptune storage","title":"Suggested Resolution"},{"location":"checks/aws/neptune/enable-storage-encryption/#insecure-example","text":"The following example will fail the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = false }","title":"Insecure Example"},{"location":"checks/aws/neptune/enable-storage-encryption/#secure-example","text":"The following example will pass the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = true }","title":"Secure Example"},{"location":"checks/aws/neptune/enable-storage-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#storage_encrypted","title":"Related Links"},{"location":"checks/aws/rds/backup-retention-specified/","text":"Explanation RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk. Possible Impact Potential loss of data and short opportunity for recovery Suggested Resolution Explicitly set the retention period to greater than the default Insecure Example The following example will fail the aws-rds-backup-retention-specified check. resource \"aws_db_instance\" \"bad_example\" { allocated_storage = 10 engine = \"mysql\" engine_version = \"5.7\" instance_class = \"db.t3.micro\" name = \"mydb\" username = \"foo\" password = \"foobarbaz\" parameter_group_name = \"default.mysql5.7\" skip_final_snapshot = true } resource \"aws_rds_cluster\" \"bad_example\" { cluster_identifier = \"aurora-cluster-demo\" engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.03.2\" availability_zones = [ \"us-west-2a\", \"us-west-2b\", \"us-west-2c\" ] database_name = \"mydb\" master_username = \"foo\" master_password = \"bar\" preferred_backup_window = \"07:00-09:00\" } Secure Example The following example will pass the aws-rds-backup-retention-specified check. resource \"aws_rds_cluster\" \"good_example\" { cluster_identifier = \"aurora-cluster-demo\" engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.03.2\" availability_zones = [ \"us-west-2a\", \"us-west-2b\", \"us-west-2c\" ] database_name = \"mydb\" master_username = \"foo\" master_password = \"bar\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" } resource \"aws_db_instance\" \"good_example\" { allocated_storage = 10 engine = \"mysql\" engine_version = \"5.7\" instance_class = \"db.t3.micro\" name = \"mydb\" username = \"foo\" password = \"foobarbaz\" parameter_group_name = \"default.mysql5.7\" backup_retention_period = 5 skip_final_snapshot = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster#backup_retention_period https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#backup_retention_period https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention","title":"backup-retention-specified"},{"location":"checks/aws/rds/backup-retention-specified/#explanation","text":"RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk.","title":"Explanation"},{"location":"checks/aws/rds/backup-retention-specified/#possible-impact","text":"Potential loss of data and short opportunity for recovery","title":"Possible Impact"},{"location":"checks/aws/rds/backup-retention-specified/#suggested-resolution","text":"Explicitly set the retention period to greater than the default","title":"Suggested Resolution"},{"location":"checks/aws/rds/backup-retention-specified/#insecure-example","text":"The following example will fail the aws-rds-backup-retention-specified check. resource \"aws_db_instance\" \"bad_example\" { allocated_storage = 10 engine = \"mysql\" engine_version = \"5.7\" instance_class = \"db.t3.micro\" name = \"mydb\" username = \"foo\" password = \"foobarbaz\" parameter_group_name = \"default.mysql5.7\" skip_final_snapshot = true } resource \"aws_rds_cluster\" \"bad_example\" { cluster_identifier = \"aurora-cluster-demo\" engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.03.2\" availability_zones = [ \"us-west-2a\", \"us-west-2b\", \"us-west-2c\" ] database_name = \"mydb\" master_username = \"foo\" master_password = \"bar\" preferred_backup_window = \"07:00-09:00\" }","title":"Insecure Example"},{"location":"checks/aws/rds/backup-retention-specified/#secure-example","text":"The following example will pass the aws-rds-backup-retention-specified check. resource \"aws_rds_cluster\" \"good_example\" { cluster_identifier = \"aurora-cluster-demo\" engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.03.2\" availability_zones = [ \"us-west-2a\", \"us-west-2b\", \"us-west-2c\" ] database_name = \"mydb\" master_username = \"foo\" master_password = \"bar\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" } resource \"aws_db_instance\" \"good_example\" { allocated_storage = 10 engine = \"mysql\" engine_version = \"5.7\" instance_class = \"db.t3.micro\" name = \"mydb\" username = \"foo\" password = \"foobarbaz\" parameter_group_name = \"default.mysql5.7\" backup_retention_period = 5 skip_final_snapshot = true }","title":"Secure Example"},{"location":"checks/aws/rds/backup-retention-specified/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster#backup_retention_period https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#backup_retention_period https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention","title":"Related Links"},{"location":"checks/aws/rds/enable-performance-insights/","text":"Explanation When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided. The encryption key specified in performance_insights_kms_key_id references a KMS ARN Possible Impact Data can be read from the RDS Performance Insights if it is compromised Suggested Resolution Enable encryption for RDS clusters and instances Insecure Example The following example will fail the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"bad_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"\" } Secure Example The following example will pass the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"good_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster_instance#performance_insights_kms_key_id https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#performance_insights_kms_key_id https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm","title":"enable-performance-insights"},{"location":"checks/aws/rds/enable-performance-insights/#explanation","text":"When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided. The encryption key specified in performance_insights_kms_key_id references a KMS ARN","title":"Explanation"},{"location":"checks/aws/rds/enable-performance-insights/#possible-impact","text":"Data can be read from the RDS Performance Insights if it is compromised","title":"Possible Impact"},{"location":"checks/aws/rds/enable-performance-insights/#suggested-resolution","text":"Enable encryption for RDS clusters and instances","title":"Suggested Resolution"},{"location":"checks/aws/rds/enable-performance-insights/#insecure-example","text":"The following example will fail the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"bad_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"\" }","title":"Insecure Example"},{"location":"checks/aws/rds/enable-performance-insights/#secure-example","text":"The following example will pass the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"good_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" }","title":"Secure Example"},{"location":"checks/aws/rds/enable-performance-insights/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster_instance#performance_insights_kms_key_id https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#performance_insights_kms_key_id https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm","title":"Related Links"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/","text":"Explanation Encryption should be enabled for an RDS Aurora cluster. When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true. Possible Impact Data can be read from the RDS cluster if it is compromised Suggested Resolution Enable encryption for RDS clusters Insecure Example The following example will fail the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"bad_example\" { name = \"bar\" kms_key_id = \"\" } Secure Example The following example will pass the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"good_example\" { name = \"bar\" kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" storage_encrypted = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"encrypt-cluster-storage-data"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/#explanation","text":"Encryption should be enabled for an RDS Aurora cluster. When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true.","title":"Explanation"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/#possible-impact","text":"Data can be read from the RDS cluster if it is compromised","title":"Possible Impact"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/#suggested-resolution","text":"Enable encryption for RDS clusters","title":"Suggested Resolution"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/#insecure-example","text":"The following example will fail the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"bad_example\" { name = \"bar\" kms_key_id = \"\" }","title":"Insecure Example"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/#secure-example","text":"The following example will pass the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"good_example\" { name = \"bar\" kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" storage_encrypted = true }","title":"Secure Example"},{"location":"checks/aws/rds/encrypt-cluster-storage-data/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"Related Links"},{"location":"checks/aws/rds/encrypt-instance-storage-data/","text":"Explanation Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id. Possible Impact Data can be read from RDS instances if compromised Suggested Resolution Enable encryption for RDS instances Insecure Example The following example will fail the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"bad_example\" { } Secure Example The following example will pass the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"good_example\" { storage_encrypted = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"encrypt-instance-storage-data"},{"location":"checks/aws/rds/encrypt-instance-storage-data/#explanation","text":"Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id.","title":"Explanation"},{"location":"checks/aws/rds/encrypt-instance-storage-data/#possible-impact","text":"Data can be read from RDS instances if compromised","title":"Possible Impact"},{"location":"checks/aws/rds/encrypt-instance-storage-data/#suggested-resolution","text":"Enable encryption for RDS instances","title":"Suggested Resolution"},{"location":"checks/aws/rds/encrypt-instance-storage-data/#insecure-example","text":"The following example will fail the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"bad_example\" { }","title":"Insecure Example"},{"location":"checks/aws/rds/encrypt-instance-storage-data/#secure-example","text":"The following example will pass the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"good_example\" { storage_encrypted = true }","title":"Secure Example"},{"location":"checks/aws/rds/encrypt-instance-storage-data/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"Related Links"},{"location":"checks/aws/rds/no-classic-resources/","text":"Explanation AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead. Possible Impact Classic resources are running in a shared environment with other customers Suggested Resolution Switch to VPC resources Insecure Example The following example will fail the aws-rds-no-classic-resources check. resource \"aws_db_security_group\" \"bad_example\" { # ... } Secure Example The following example will pass the aws-rds-no-classic-resources check. resource \"aws_security_group\" \"good_example\" { # ... } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_security_group https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html","title":"no-classic-resources"},{"location":"checks/aws/rds/no-classic-resources/#explanation","text":"AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead.","title":"Explanation"},{"location":"checks/aws/rds/no-classic-resources/#possible-impact","text":"Classic resources are running in a shared environment with other customers","title":"Possible Impact"},{"location":"checks/aws/rds/no-classic-resources/#suggested-resolution","text":"Switch to VPC resources","title":"Suggested Resolution"},{"location":"checks/aws/rds/no-classic-resources/#insecure-example","text":"The following example will fail the aws-rds-no-classic-resources check. resource \"aws_db_security_group\" \"bad_example\" { # ... }","title":"Insecure Example"},{"location":"checks/aws/rds/no-classic-resources/#secure-example","text":"The following example will pass the aws-rds-no-classic-resources check. resource \"aws_security_group\" \"good_example\" { # ... }","title":"Secure Example"},{"location":"checks/aws/rds/no-classic-resources/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_security_group https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html","title":"Related Links"},{"location":"checks/aws/rds/no-public-db-access/","text":"Explanation Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function. Possible Impact The database instance is publicly accessible Suggested Resolution Set the database to not be publicly accessible Insecure Example The following example will fail the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"bad_example\" { publicly_accessible = true } Secure Example The following example will pass the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"good_example\" { publicly_accessible = false } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance","title":"no-public-db-access"},{"location":"checks/aws/rds/no-public-db-access/#explanation","text":"Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function.","title":"Explanation"},{"location":"checks/aws/rds/no-public-db-access/#possible-impact","text":"The database instance is publicly accessible","title":"Possible Impact"},{"location":"checks/aws/rds/no-public-db-access/#suggested-resolution","text":"Set the database to not be publicly accessible","title":"Suggested Resolution"},{"location":"checks/aws/rds/no-public-db-access/#insecure-example","text":"The following example will fail the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"bad_example\" { publicly_accessible = true }","title":"Insecure Example"},{"location":"checks/aws/rds/no-public-db-access/#secure-example","text":"The following example will pass the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"good_example\" { publicly_accessible = false }","title":"Secure Example"},{"location":"checks/aws/rds/no-public-db-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance","title":"Related Links"},{"location":"checks/aws/redshift/add-description-to-security-group/","text":"Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the aws-redshift-add-description-to-security-group check. resource \"aws_redshift_security_group\" \"bad_example\" { name = \"http\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Secure Example The following example will pass the aws-redshift-add-description-to-security-group check. resource \"aws_redshift_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"add-description-to-security-group"},{"location":"checks/aws/redshift/add-description-to-security-group/#explanation","text":"Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/aws/redshift/add-description-to-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/aws/redshift/add-description-to-security-group/#suggested-resolution","text":"Add descriptions for all security groups and rules","title":"Suggested Resolution"},{"location":"checks/aws/redshift/add-description-to-security-group/#insecure-example","text":"The following example will fail the aws-redshift-add-description-to-security-group check. resource \"aws_redshift_security_group\" \"bad_example\" { name = \"http\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }","title":"Insecure Example"},{"location":"checks/aws/redshift/add-description-to-security-group/#secure-example","text":"The following example will pass the aws-redshift-add-description-to-security-group check. resource \"aws_redshift_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }","title":"Secure Example"},{"location":"checks/aws/redshift/add-description-to-security-group/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"Related Links"},{"location":"checks/aws/redshift/encryption-customer-key/","text":"Explanation Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised. Possible Impact Data may be leaked if infrastructure is compromised Suggested Resolution Enable encryption using CMK Insecure Example The following example will fail the aws-redshift-encryption-customer-key check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" } Secure Example The following example will pass the aws-redshift-encryption-customer-key check. resource \"aws_kms_key\" \"redshift\" { enable_key_rotation = true } resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" encrypted = true kms_key_id = aws_kms_key.redshift.key_id } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#encrypted https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html","title":"encryption-customer-key"},{"location":"checks/aws/redshift/encryption-customer-key/#explanation","text":"Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised.","title":"Explanation"},{"location":"checks/aws/redshift/encryption-customer-key/#possible-impact","text":"Data may be leaked if infrastructure is compromised","title":"Possible Impact"},{"location":"checks/aws/redshift/encryption-customer-key/#suggested-resolution","text":"Enable encryption using CMK","title":"Suggested Resolution"},{"location":"checks/aws/redshift/encryption-customer-key/#insecure-example","text":"The following example will fail the aws-redshift-encryption-customer-key check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" }","title":"Insecure Example"},{"location":"checks/aws/redshift/encryption-customer-key/#secure-example","text":"The following example will pass the aws-redshift-encryption-customer-key check. resource \"aws_kms_key\" \"redshift\" { enable_key_rotation = true } resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" encrypted = true kms_key_id = aws_kms_key.redshift.key_id }","title":"Secure Example"},{"location":"checks/aws/redshift/encryption-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#encrypted https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html","title":"Related Links"},{"location":"checks/aws/redshift/non-default-vpc-deployment/","text":"Explanation Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant. In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set. Possible Impact Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode Suggested Resolution Deploy Redshift cluster into a non default VPC Insecure Example The following example will fail the aws-redshift-non-default-vpc-deployment check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" } Secure Example The following example will pass the aws-redshift-non-default-vpc-deployment check. resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" cluster_subnet_group_name = \"redshift_subnet\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#cluster_subnet_group_name https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html","title":"non-default-vpc-deployment"},{"location":"checks/aws/redshift/non-default-vpc-deployment/#explanation","text":"Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant. In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set.","title":"Explanation"},{"location":"checks/aws/redshift/non-default-vpc-deployment/#possible-impact","text":"Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode","title":"Possible Impact"},{"location":"checks/aws/redshift/non-default-vpc-deployment/#suggested-resolution","text":"Deploy Redshift cluster into a non default VPC","title":"Suggested Resolution"},{"location":"checks/aws/redshift/non-default-vpc-deployment/#insecure-example","text":"The following example will fail the aws-redshift-non-default-vpc-deployment check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" }","title":"Insecure Example"},{"location":"checks/aws/redshift/non-default-vpc-deployment/#secure-example","text":"The following example will pass the aws-redshift-non-default-vpc-deployment check. resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" cluster_subnet_group_name = \"redshift_subnet\" }","title":"Secure Example"},{"location":"checks/aws/redshift/non-default-vpc-deployment/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#cluster_subnet_group_name https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html","title":"Related Links"},{"location":"checks/aws/s3/block-public-acls/","text":"Explanation S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a. Possible Impact PUT calls with public ACLs specified can make objects public Suggested Resolution Enable blocking any PUT calls with a public ACL specified Insecure Example The following example will fail the aws-s3-block-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } Secure Example The following example will pass the aws-s3-block-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id block_public_acls = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"block-public-acls"},{"location":"checks/aws/s3/block-public-acls/#explanation","text":"S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a.","title":"Explanation"},{"location":"checks/aws/s3/block-public-acls/#possible-impact","text":"PUT calls with public ACLs specified can make objects public","title":"Possible Impact"},{"location":"checks/aws/s3/block-public-acls/#suggested-resolution","text":"Enable blocking any PUT calls with a public ACL specified","title":"Suggested Resolution"},{"location":"checks/aws/s3/block-public-acls/#insecure-example","text":"The following example will fail the aws-s3-block-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id }","title":"Insecure Example"},{"location":"checks/aws/s3/block-public-acls/#secure-example","text":"The following example will pass the aws-s3-block-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id block_public_acls = true }","title":"Secure Example"},{"location":"checks/aws/s3/block-public-acls/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/aws/s3/block-public-policy/","text":"Explanation S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access. Possible Impact Users could put a policy that allows public access Suggested Resolution Prevent policies that allow public access being PUT Insecure Example The following example will fail the aws-s3-block-public-policy check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id block_public_policy = false } Secure Example The following example will pass the aws-s3-block-public-policy check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id block_public_policy = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_policy https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"block-public-policy"},{"location":"checks/aws/s3/block-public-policy/#explanation","text":"S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access.","title":"Explanation"},{"location":"checks/aws/s3/block-public-policy/#possible-impact","text":"Users could put a policy that allows public access","title":"Possible Impact"},{"location":"checks/aws/s3/block-public-policy/#suggested-resolution","text":"Prevent policies that allow public access being PUT","title":"Suggested Resolution"},{"location":"checks/aws/s3/block-public-policy/#insecure-example","text":"The following example will fail the aws-s3-block-public-policy check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id block_public_policy = false }","title":"Insecure Example"},{"location":"checks/aws/s3/block-public-policy/#secure-example","text":"The following example will pass the aws-s3-block-public-policy check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id block_public_policy = true }","title":"Secure Example"},{"location":"checks/aws/s3/block-public-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_policy https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/aws/s3/enable-bucket-encryption/","text":"Explanation S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets. Possible Impact The bucket objects could be read if compromised Suggested Resolution Configure bucket encryption Insecure Example The following example will fail the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"bad_example\" { bucket = \"mybucket\" } Secure Example The following example will pass the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"good_example\" { bucket = \"mybucket\" server_side_encryption_configuration { rule { apply_server_side_encryption_by_default { kms_master_key_id = \"arn\" sse_algorithm = \"aws:kms\" } } } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#enable-default-server-side-encryption https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html","title":"enable-bucket-encryption"},{"location":"checks/aws/s3/enable-bucket-encryption/#explanation","text":"S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets.","title":"Explanation"},{"location":"checks/aws/s3/enable-bucket-encryption/#possible-impact","text":"The bucket objects could be read if compromised","title":"Possible Impact"},{"location":"checks/aws/s3/enable-bucket-encryption/#suggested-resolution","text":"Configure bucket encryption","title":"Suggested Resolution"},{"location":"checks/aws/s3/enable-bucket-encryption/#insecure-example","text":"The following example will fail the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"bad_example\" { bucket = \"mybucket\" }","title":"Insecure Example"},{"location":"checks/aws/s3/enable-bucket-encryption/#secure-example","text":"The following example will pass the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"good_example\" { bucket = \"mybucket\" server_side_encryption_configuration { rule { apply_server_side_encryption_by_default { kms_master_key_id = \"arn\" sse_algorithm = \"aws:kms\" } } } }","title":"Secure Example"},{"location":"checks/aws/s3/enable-bucket-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#enable-default-server-side-encryption https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html","title":"Related Links"},{"location":"checks/aws/s3/enable-bucket-logging/","text":"Explanation Buckets should have logging enabled so that access can be audited. Possible Impact There is no way to determine the access to this bucket Suggested Resolution Add a logging block to the resource to enable access logging Insecure Example The following example will fail the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"bad_example\" { } Secure Example The following example will pass the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"good_example\" { logging { target_bucket = \"target-bucket\" } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html","title":"enable-bucket-logging"},{"location":"checks/aws/s3/enable-bucket-logging/#explanation","text":"Buckets should have logging enabled so that access can be audited.","title":"Explanation"},{"location":"checks/aws/s3/enable-bucket-logging/#possible-impact","text":"There is no way to determine the access to this bucket","title":"Possible Impact"},{"location":"checks/aws/s3/enable-bucket-logging/#suggested-resolution","text":"Add a logging block to the resource to enable access logging","title":"Suggested Resolution"},{"location":"checks/aws/s3/enable-bucket-logging/#insecure-example","text":"The following example will fail the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"bad_example\" { }","title":"Insecure Example"},{"location":"checks/aws/s3/enable-bucket-logging/#secure-example","text":"The following example will pass the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"good_example\" { logging { target_bucket = \"target-bucket\" } }","title":"Secure Example"},{"location":"checks/aws/s3/enable-bucket-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html","title":"Related Links"},{"location":"checks/aws/s3/enable-versioning/","text":"Explanation Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures. Possible Impact Deleted or modified data would not be recoverable Suggested Resolution Enable versioning to protect against accidental/malicious removal or modification Insecure Example The following example will fail the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"bad_example\" { } Secure Example The following example will pass the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"good_example\" { versioning { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html","title":"enable-versioning"},{"location":"checks/aws/s3/enable-versioning/#explanation","text":"Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures.","title":"Explanation"},{"location":"checks/aws/s3/enable-versioning/#possible-impact","text":"Deleted or modified data would not be recoverable","title":"Possible Impact"},{"location":"checks/aws/s3/enable-versioning/#suggested-resolution","text":"Enable versioning to protect against accidental/malicious removal or modification","title":"Suggested Resolution"},{"location":"checks/aws/s3/enable-versioning/#insecure-example","text":"The following example will fail the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"bad_example\" { }","title":"Insecure Example"},{"location":"checks/aws/s3/enable-versioning/#secure-example","text":"The following example will pass the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"good_example\" { versioning { enabled = true } }","title":"Secure Example"},{"location":"checks/aws/s3/enable-versioning/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html","title":"Related Links"},{"location":"checks/aws/s3/ignore-public-acls/","text":"Explanation S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored. Possible Impact PUT calls with public ACLs specified can make objects public Suggested Resolution Enable ignoring the application of public ACLs in PUT calls Insecure Example The following example will fail the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = false } Secure Example The following example will pass the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#ignore_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"ignore-public-acls"},{"location":"checks/aws/s3/ignore-public-acls/#explanation","text":"S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored.","title":"Explanation"},{"location":"checks/aws/s3/ignore-public-acls/#possible-impact","text":"PUT calls with public ACLs specified can make objects public","title":"Possible Impact"},{"location":"checks/aws/s3/ignore-public-acls/#suggested-resolution","text":"Enable ignoring the application of public ACLs in PUT calls","title":"Suggested Resolution"},{"location":"checks/aws/s3/ignore-public-acls/#insecure-example","text":"The following example will fail the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = false }","title":"Insecure Example"},{"location":"checks/aws/s3/ignore-public-acls/#secure-example","text":"The following example will pass the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = true }","title":"Secure Example"},{"location":"checks/aws/s3/ignore-public-acls/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#ignore_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/aws/s3/no-public-access-with-acl/","text":"Explanation S3 bucket permissions should be set to deny public access unless explicitly required. Granting write access publicly with public-read-write is especially dangerous as you will be billed for any uploaded files. Additionally, you should not use the authenticated-read canned ACL, as this provides read access to any authenticated AWS user, not just AWS users within your organisation. Possible Impact The contents of the bucket can be accessed publicly Suggested Resolution Apply a more restrictive bucket ACL Insecure Example The following example will fail the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"bad_example\" { acl = \"public-read\" } Secure Example The following example will pass the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"good_example\" { acl = \"private\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://aws.amazon.com/premiumsupport/knowledge-center/secure-s3-resources/","title":"no-public-access-with-acl"},{"location":"checks/aws/s3/no-public-access-with-acl/#explanation","text":"S3 bucket permissions should be set to deny public access unless explicitly required. Granting write access publicly with public-read-write is especially dangerous as you will be billed for any uploaded files. Additionally, you should not use the authenticated-read canned ACL, as this provides read access to any authenticated AWS user, not just AWS users within your organisation.","title":"Explanation"},{"location":"checks/aws/s3/no-public-access-with-acl/#possible-impact","text":"The contents of the bucket can be accessed publicly","title":"Possible Impact"},{"location":"checks/aws/s3/no-public-access-with-acl/#suggested-resolution","text":"Apply a more restrictive bucket ACL","title":"Suggested Resolution"},{"location":"checks/aws/s3/no-public-access-with-acl/#insecure-example","text":"The following example will fail the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"bad_example\" { acl = \"public-read\" }","title":"Insecure Example"},{"location":"checks/aws/s3/no-public-access-with-acl/#secure-example","text":"The following example will pass the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"good_example\" { acl = \"private\" }","title":"Secure Example"},{"location":"checks/aws/s3/no-public-access-with-acl/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://aws.amazon.com/premiumsupport/knowledge-center/secure-s3-resources/","title":"Related Links"},{"location":"checks/aws/s3/no-public-buckets/","text":"Explanation S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy. Possible Impact Public buckets can be accessed by anyone Suggested Resolution Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront) Insecure Example The following example will fail the aws-s3-no-public-buckets check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = false } Secure Example The following example will pass the aws-s3-no-public-buckets check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#restrict_public_buckets\u00a1 https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"no-public-buckets"},{"location":"checks/aws/s3/no-public-buckets/#explanation","text":"S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy.","title":"Explanation"},{"location":"checks/aws/s3/no-public-buckets/#possible-impact","text":"Public buckets can be accessed by anyone","title":"Possible Impact"},{"location":"checks/aws/s3/no-public-buckets/#suggested-resolution","text":"Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront)","title":"Suggested Resolution"},{"location":"checks/aws/s3/no-public-buckets/#insecure-example","text":"The following example will fail the aws-s3-no-public-buckets check. resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = false }","title":"Insecure Example"},{"location":"checks/aws/s3/no-public-buckets/#secure-example","text":"The following example will pass the aws-s3-no-public-buckets check. resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = true }","title":"Secure Example"},{"location":"checks/aws/s3/no-public-buckets/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#restrict_public_buckets\u00a1 https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/aws/s3/specify-public-access-block/","text":"Explanation The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central definition for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it. Possible Impact Public access policies may be applied to sensitive data buckets Suggested Resolution Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies Insecure Example The following example will fail the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" } Secure Example The following example will pass the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" } resource \"aws_s3_bucket_public_access_block\" \"example\" { bucket = aws_s3_bucket.example.id block_public_acls = true block_public_policy = true } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#bucket https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"specify-public-access-block"},{"location":"checks/aws/s3/specify-public-access-block/#explanation","text":"The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central definition for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it.","title":"Explanation"},{"location":"checks/aws/s3/specify-public-access-block/#possible-impact","text":"Public access policies may be applied to sensitive data buckets","title":"Possible Impact"},{"location":"checks/aws/s3/specify-public-access-block/#suggested-resolution","text":"Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies","title":"Suggested Resolution"},{"location":"checks/aws/s3/specify-public-access-block/#insecure-example","text":"The following example will fail the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" }","title":"Insecure Example"},{"location":"checks/aws/s3/specify-public-access-block/#secure-example","text":"The following example will pass the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" } resource \"aws_s3_bucket_public_access_block\" \"example\" { bucket = aws_s3_bucket.example.id block_public_acls = true block_public_policy = true }","title":"Secure Example"},{"location":"checks/aws/s3/specify-public-access-block/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#bucket https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/aws/sns/enable-topic-encryption/","text":"Explanation Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues. Possible Impact The SNS topic messages could be read if compromised Suggested Resolution Turn on SNS Topic encryption Insecure Example The following example will fail the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"bad_example\" { # no key id specified } Secure Example The following example will pass the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"good_example\" { kms_master_key_id = \"/blah\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic#example-with-server-side-encryption-sse https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html","title":"enable-topic-encryption"},{"location":"checks/aws/sns/enable-topic-encryption/#explanation","text":"Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.","title":"Explanation"},{"location":"checks/aws/sns/enable-topic-encryption/#possible-impact","text":"The SNS topic messages could be read if compromised","title":"Possible Impact"},{"location":"checks/aws/sns/enable-topic-encryption/#suggested-resolution","text":"Turn on SNS Topic encryption","title":"Suggested Resolution"},{"location":"checks/aws/sns/enable-topic-encryption/#insecure-example","text":"The following example will fail the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"bad_example\" { # no key id specified }","title":"Insecure Example"},{"location":"checks/aws/sns/enable-topic-encryption/#secure-example","text":"The following example will pass the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"good_example\" { kms_master_key_id = \"/blah\" }","title":"Secure Example"},{"location":"checks/aws/sns/enable-topic-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic#example-with-server-side-encryption-sse https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html","title":"Related Links"},{"location":"checks/aws/sqs/enable-queue-encryption/","text":"Explanation Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues. Possible Impact The SQS queue messages could be read if compromised Suggested Resolution Turn on SQS Queue encryption Insecure Example The following example will fail the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"bad_example\" { # no key specified } Secure Example The following example will pass the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"good_example\" { kms_master_key_id = \"/blah\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue#server-side-encryption-sse https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html","title":"enable-queue-encryption"},{"location":"checks/aws/sqs/enable-queue-encryption/#explanation","text":"Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.","title":"Explanation"},{"location":"checks/aws/sqs/enable-queue-encryption/#possible-impact","text":"The SQS queue messages could be read if compromised","title":"Possible Impact"},{"location":"checks/aws/sqs/enable-queue-encryption/#suggested-resolution","text":"Turn on SQS Queue encryption","title":"Suggested Resolution"},{"location":"checks/aws/sqs/enable-queue-encryption/#insecure-example","text":"The following example will fail the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"bad_example\" { # no key specified }","title":"Insecure Example"},{"location":"checks/aws/sqs/enable-queue-encryption/#secure-example","text":"The following example will pass the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"good_example\" { kms_master_key_id = \"/blah\" }","title":"Secure Example"},{"location":"checks/aws/sqs/enable-queue-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue#server-side-encryption-sse https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html","title":"Related Links"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/","text":"Explanation SQS Policy actions should always be restricted to a specific set. This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed. Possible Impact SQS policies with wildcard actions allow more that is required Suggested Resolution Keep policy scope to the minimum that is required to be effective Insecure Example The following example will fail the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"bad_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"*\" } ] } POLICY } Secure Example The following example will pass the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"good_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"sqs:SendMessage\" } ] } POLICY } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue_policy https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html","title":"no-wildcards-in-policy-documents"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/#explanation","text":"SQS Policy actions should always be restricted to a specific set. This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed.","title":"Explanation"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/#possible-impact","text":"SQS policies with wildcard actions allow more that is required","title":"Possible Impact"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/#suggested-resolution","text":"Keep policy scope to the minimum that is required to be effective","title":"Suggested Resolution"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/#insecure-example","text":"The following example will fail the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"bad_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"*\" } ] } POLICY }","title":"Insecure Example"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/#secure-example","text":"The following example will pass the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"good_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"sqs:SendMessage\" } ] } POLICY }","title":"Secure Example"},{"location":"checks/aws/sqs/no-wildcards-in-policy-documents/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue_policy https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html","title":"Related Links"},{"location":"checks/aws/ssm/secret-use-customer-key/","text":"Explanation Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly. Possible Impact Using AWS managed keys reduces the flexibility and control over the encryption key Suggested Resolution Use customer managed keys Insecure Example The following example will fail the aws-ssm-secret-use-customer-key check. resource \"aws_secretsmanager_secret\" \"bad_example\" { name = \"lambda_password\" } Secure Example The following example will pass the aws-ssm-secret-use-customer-key check. resource \"aws_kms_key\" \"secrets\" { enable_key_rotation = true } resource \"aws_secretsmanager_secret\" \"good_example\" { name = \"lambda_password\" kms_key_id = aws_kms_key.secrets.arn } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret#kms_key_id https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt","title":"secret-use-customer-key"},{"location":"checks/aws/ssm/secret-use-customer-key/#explanation","text":"Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly.","title":"Explanation"},{"location":"checks/aws/ssm/secret-use-customer-key/#possible-impact","text":"Using AWS managed keys reduces the flexibility and control over the encryption key","title":"Possible Impact"},{"location":"checks/aws/ssm/secret-use-customer-key/#suggested-resolution","text":"Use customer managed keys","title":"Suggested Resolution"},{"location":"checks/aws/ssm/secret-use-customer-key/#insecure-example","text":"The following example will fail the aws-ssm-secret-use-customer-key check. resource \"aws_secretsmanager_secret\" \"bad_example\" { name = \"lambda_password\" }","title":"Insecure Example"},{"location":"checks/aws/ssm/secret-use-customer-key/#secure-example","text":"The following example will pass the aws-ssm-secret-use-customer-key check. resource \"aws_kms_key\" \"secrets\" { enable_key_rotation = true } resource \"aws_secretsmanager_secret\" \"good_example\" { name = \"lambda_password\" kms_key_id = aws_kms_key.secrets.arn }","title":"Secure Example"},{"location":"checks/aws/ssm/secret-use-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret#kms_key_id https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt","title":"Related Links"},{"location":"checks/aws/vpc/add-decription-to-security-group/","text":"Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the aws-vpc-add-decription-to-security-group check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Secure Example The following example will pass the aws-vpc-add-decription-to-security-group check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"add-decription-to-security-group"},{"location":"checks/aws/vpc/add-decription-to-security-group/#explanation","text":"Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/aws/vpc/add-decription-to-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/aws/vpc/add-decription-to-security-group/#suggested-resolution","text":"Add descriptions for all security groups and rules","title":"Suggested Resolution"},{"location":"checks/aws/vpc/add-decription-to-security-group/#insecure-example","text":"The following example will fail the aws-vpc-add-decription-to-security-group check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }","title":"Insecure Example"},{"location":"checks/aws/vpc/add-decription-to-security-group/#secure-example","text":"The following example will pass the aws-vpc-add-decription-to-security-group check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }","title":"Secure Example"},{"location":"checks/aws/vpc/add-decription-to-security-group/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"Related Links"},{"location":"checks/aws/vpc/add-description-to-security-group/","text":"Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" ingress { from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Secure Example The following example will pass the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"add-description-to-security-group"},{"location":"checks/aws/vpc/add-description-to-security-group/#explanation","text":"Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/aws/vpc/add-description-to-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/aws/vpc/add-description-to-security-group/#suggested-resolution","text":"Add descriptions for all security groups and rules","title":"Suggested Resolution"},{"location":"checks/aws/vpc/add-description-to-security-group/#insecure-example","text":"The following example will fail the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" ingress { from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }","title":"Insecure Example"},{"location":"checks/aws/vpc/add-description-to-security-group/#secure-example","text":"The following example will pass the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }","title":"Secure Example"},{"location":"checks/aws/vpc/add-description-to-security-group/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"Related Links"},{"location":"checks/aws/vpc/disallow-mixed-sgr/","text":"Explanation Mixing Terraform standalone security_group_rule resource and security_group resource with inline ingress/egress rules results in rules being overwritten during Terraform apply. Possible Impact Security group rules will be overwritten and will result in unintended blocking of network traffic Suggested Resolution Either define all of a security group's rules inline, or none of the security group's rules inline Insecure Example The following example will fail the aws-vpc-disallow-mixed-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { security_group_id = aws_security_group.bad_example_sg.id type = \"ingress\" cidr_blocks = [ \"172.31.0.0/16\" ] } resource \"aws_security_group\" \"bad_example_sg\" { ingress { cidr_blocks = [ \"10.0.0.0/16\" ] } } Secure Example The following example will pass the aws-vpc-disallow-mixed-sgr check. resource \"aws_security_group_rule\" \"good_example\" { security_group_id = aws_security_group.good_example_sg.id type = \"ingress\" cidr_blocks = [ \"10.0.0.0/16\", \"172.31.0.0/16\" ] } resource \"aws_security_group\" \"good_example_sg\" { } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group#resource-aws_security_group https://github.com/hashicorp/terraform/issues/11011#issuecomment-283076580","title":"disallow-mixed-sgr"},{"location":"checks/aws/vpc/disallow-mixed-sgr/#explanation","text":"Mixing Terraform standalone security_group_rule resource and security_group resource with inline ingress/egress rules results in rules being overwritten during Terraform apply.","title":"Explanation"},{"location":"checks/aws/vpc/disallow-mixed-sgr/#possible-impact","text":"Security group rules will be overwritten and will result in unintended blocking of network traffic","title":"Possible Impact"},{"location":"checks/aws/vpc/disallow-mixed-sgr/#suggested-resolution","text":"Either define all of a security group's rules inline, or none of the security group's rules inline","title":"Suggested Resolution"},{"location":"checks/aws/vpc/disallow-mixed-sgr/#insecure-example","text":"The following example will fail the aws-vpc-disallow-mixed-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { security_group_id = aws_security_group.bad_example_sg.id type = \"ingress\" cidr_blocks = [ \"172.31.0.0/16\" ] } resource \"aws_security_group\" \"bad_example_sg\" { ingress { cidr_blocks = [ \"10.0.0.0/16\" ] } }","title":"Insecure Example"},{"location":"checks/aws/vpc/disallow-mixed-sgr/#secure-example","text":"The following example will pass the aws-vpc-disallow-mixed-sgr check. resource \"aws_security_group_rule\" \"good_example\" { security_group_id = aws_security_group.good_example_sg.id type = \"ingress\" cidr_blocks = [ \"10.0.0.0/16\", \"172.31.0.0/16\" ] } resource \"aws_security_group\" \"good_example_sg\" { }","title":"Secure Example"},{"location":"checks/aws/vpc/disallow-mixed-sgr/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group#resource-aws_security_group https://github.com/hashicorp/terraform/issues/11011#issuecomment-283076580","title":"Related Links"},{"location":"checks/aws/vpc/no-default-vpc/","text":"Explanation Default VPC does not have a lot of the critical security features that standard VPC comes with, new resources should not be created in the default VPC and it should not be present in the Terraform. Possible Impact The default VPC does not have critical security features applied Suggested Resolution Create a non-default vpc for resources to be created in Insecure Example The following example will fail the aws-vpc-no-default-vpc check. resource \"aws_default_vpc\" \"default\" { tags = { Name = \"Default VPC\" } } Secure Example The following example will pass the aws-vpc-no-default-vpc check. # no aws default vpc present Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_vpc https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html","title":"no-default-vpc"},{"location":"checks/aws/vpc/no-default-vpc/#explanation","text":"Default VPC does not have a lot of the critical security features that standard VPC comes with, new resources should not be created in the default VPC and it should not be present in the Terraform.","title":"Explanation"},{"location":"checks/aws/vpc/no-default-vpc/#possible-impact","text":"The default VPC does not have critical security features applied","title":"Possible Impact"},{"location":"checks/aws/vpc/no-default-vpc/#suggested-resolution","text":"Create a non-default vpc for resources to be created in","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-default-vpc/#insecure-example","text":"The following example will fail the aws-vpc-no-default-vpc check. resource \"aws_default_vpc\" \"default\" { tags = { Name = \"Default VPC\" } }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-default-vpc/#secure-example","text":"The following example will pass the aws-vpc-no-default-vpc check. # no aws default vpc present","title":"Secure Example"},{"location":"checks/aws/vpc/no-default-vpc/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_vpc https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html","title":"Related Links"},{"location":"checks/aws/vpc/no-excessive-port-access/","text":"Explanation Ensure access to specific required ports is allowed, and nothing else. Possible Impact All ports exposed for egressing data Suggested Resolution Set specific allowed ports Insecure Example The following example will fail the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"all\" rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" } Secure Example The following example will pass the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#to_port https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"no-excessive-port-access"},{"location":"checks/aws/vpc/no-excessive-port-access/#explanation","text":"Ensure access to specific required ports is allowed, and nothing else.","title":"Explanation"},{"location":"checks/aws/vpc/no-excessive-port-access/#possible-impact","text":"All ports exposed for egressing data","title":"Possible Impact"},{"location":"checks/aws/vpc/no-excessive-port-access/#suggested-resolution","text":"Set specific allowed ports","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-excessive-port-access/#insecure-example","text":"The following example will fail the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"all\" rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-excessive-port-access/#secure-example","text":"The following example will pass the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" }","title":"Secure Example"},{"location":"checks/aws/vpc/no-excessive-port-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#to_port https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"Related Links"},{"location":"checks/aws/vpc/no-public-egress-sg/","text":"Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The port is exposed for egressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-egress-sg check. resource \"aws_security_group\" \"bad_example\" { egress { cidr_blocks = [ \"0.0.0.0/0\" ] } } Secure Example The following example will pass the aws-vpc-no-public-egress-sg check. resource \"aws_security_group\" \"good_example\" { egress { cidr_blocks = [ \"1.2.3.4/32\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group","title":"no-public-egress-sg"},{"location":"checks/aws/vpc/no-public-egress-sg/#explanation","text":"Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/aws/vpc/no-public-egress-sg/#possible-impact","text":"The port is exposed for egressing data to the internet","title":"Possible Impact"},{"location":"checks/aws/vpc/no-public-egress-sg/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-public-egress-sg/#insecure-example","text":"The following example will fail the aws-vpc-no-public-egress-sg check. resource \"aws_security_group\" \"bad_example\" { egress { cidr_blocks = [ \"0.0.0.0/0\" ] } }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-public-egress-sg/#secure-example","text":"The following example will pass the aws-vpc-no-public-egress-sg check. resource \"aws_security_group\" \"good_example\" { egress { cidr_blocks = [ \"1.2.3.4/32\" ] } }","title":"Secure Example"},{"location":"checks/aws/vpc/no-public-egress-sg/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group","title":"Related Links"},{"location":"checks/aws/vpc/no-public-egress-sgr/","text":"Explanation Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible. Possible Impact Your port is egressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { type = \"egress\" cidr_blocks = [ \"0.0.0.0/0\" ] } Secure Example The following example will pass the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group_rule\" \"good_example\" { type = \"egress\" cidr_blocks = [ \"10.0.0.0/16\" ] } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule","title":"no-public-egress-sgr"},{"location":"checks/aws/vpc/no-public-egress-sgr/#explanation","text":"Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible.","title":"Explanation"},{"location":"checks/aws/vpc/no-public-egress-sgr/#possible-impact","text":"Your port is egressing data to the internet","title":"Possible Impact"},{"location":"checks/aws/vpc/no-public-egress-sgr/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-public-egress-sgr/#insecure-example","text":"The following example will fail the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { type = \"egress\" cidr_blocks = [ \"0.0.0.0/0\" ] }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-public-egress-sgr/#secure-example","text":"The following example will pass the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group_rule\" \"good_example\" { type = \"egress\" cidr_blocks = [ \"10.0.0.0/16\" ] }","title":"Secure Example"},{"location":"checks/aws/vpc/no-public-egress-sgr/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule","title":"Related Links"},{"location":"checks/aws/vpc/no-public-ingress-sg/","text":"Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-ingress-sg check. resource \"aws_security_group\" \"bad_example\" { ingress { cidr_blocks = [ \"0.0.0.0/0\" ] } } Secure Example The following example will pass the aws-vpc-no-public-ingress-sg check. resource \"aws_security_group\" \"good_example\" { ingress { cidr_blocks = [ \"1.2.3.4/32\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group","title":"no-public-ingress-sg"},{"location":"checks/aws/vpc/no-public-ingress-sg/#explanation","text":"Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/aws/vpc/no-public-ingress-sg/#possible-impact","text":"The port is exposed for ingress from the internet","title":"Possible Impact"},{"location":"checks/aws/vpc/no-public-ingress-sg/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-public-ingress-sg/#insecure-example","text":"The following example will fail the aws-vpc-no-public-ingress-sg check. resource \"aws_security_group\" \"bad_example\" { ingress { cidr_blocks = [ \"0.0.0.0/0\" ] } }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-public-ingress-sg/#secure-example","text":"The following example will pass the aws-vpc-no-public-ingress-sg check. resource \"aws_security_group\" \"good_example\" { ingress { cidr_blocks = [ \"1.2.3.4/32\" ] } }","title":"Secure Example"},{"location":"checks/aws/vpc/no-public-ingress-sg/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group","title":"Related Links"},{"location":"checks/aws/vpc/no-public-ingress-sgr/","text":"Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact Your port exposed to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { type = \"ingress\" cidr_blocks = [ \"0.0.0.0/0\" ] } Secure Example The following example will pass the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"good_example\" { type = \"ingress\" cidr_blocks = [ \"10.0.0.0/16\" ] } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule#cidr_blocks https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html","title":"no-public-ingress-sgr"},{"location":"checks/aws/vpc/no-public-ingress-sgr/#explanation","text":"Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/aws/vpc/no-public-ingress-sgr/#possible-impact","text":"Your port exposed to the internet","title":"Possible Impact"},{"location":"checks/aws/vpc/no-public-ingress-sgr/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-public-ingress-sgr/#insecure-example","text":"The following example will fail the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { type = \"ingress\" cidr_blocks = [ \"0.0.0.0/0\" ] }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-public-ingress-sgr/#secure-example","text":"The following example will pass the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"good_example\" { type = \"ingress\" cidr_blocks = [ \"10.0.0.0/16\" ] }","title":"Secure Example"},{"location":"checks/aws/vpc/no-public-ingress-sgr/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule#cidr_blocks https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html","title":"Related Links"},{"location":"checks/aws/vpc/no-public-ingress/","text":"Explanation Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The ports are exposed for ingressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-ingress check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" } Secure Example The following example will pass the aws-vpc-no-public-ingress check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"10.0.0.0/16\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#cidr_block https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"no-public-ingress"},{"location":"checks/aws/vpc/no-public-ingress/#explanation","text":"Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/aws/vpc/no-public-ingress/#possible-impact","text":"The ports are exposed for ingressing data to the internet","title":"Possible Impact"},{"location":"checks/aws/vpc/no-public-ingress/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/aws/vpc/no-public-ingress/#insecure-example","text":"The following example will fail the aws-vpc-no-public-ingress check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" }","title":"Insecure Example"},{"location":"checks/aws/vpc/no-public-ingress/#secure-example","text":"The following example will pass the aws-vpc-no-public-ingress check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"10.0.0.0/16\" }","title":"Secure Example"},{"location":"checks/aws/vpc/no-public-ingress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#cidr_block https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"Related Links"},{"location":"checks/aws/vpc/use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact The SSL policy is outdated and has known vulnerabilities Suggested Resolution Use a more recent TLS/SSL policy for the load balancer Insecure Example The following example will fail the aws-vpc-use-secure-tls-policy check. resource \"aws_alb_listener\" \"bad_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-1-2017-01\" protocol = \"HTTPS\" } Secure Example The following example will pass the aws-vpc-use-secure-tls-policy check. resource \"aws_alb_listener\" \"good_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-2-2017-01\" protocol = \"HTTPS\" } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener","title":"use-secure-tls-policy"},{"location":"checks/aws/vpc/use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/aws/vpc/use-secure-tls-policy/#possible-impact","text":"The SSL policy is outdated and has known vulnerabilities","title":"Possible Impact"},{"location":"checks/aws/vpc/use-secure-tls-policy/#suggested-resolution","text":"Use a more recent TLS/SSL policy for the load balancer","title":"Suggested Resolution"},{"location":"checks/aws/vpc/use-secure-tls-policy/#insecure-example","text":"The following example will fail the aws-vpc-use-secure-tls-policy check. resource \"aws_alb_listener\" \"bad_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-1-2017-01\" protocol = \"HTTPS\" }","title":"Insecure Example"},{"location":"checks/aws/vpc/use-secure-tls-policy/#secure-example","text":"The following example will pass the aws-vpc-use-secure-tls-policy check. resource \"aws_alb_listener\" \"good_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-2-2017-01\" protocol = \"HTTPS\" }","title":"Secure Example"},{"location":"checks/aws/vpc/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener","title":"Related Links"},{"location":"checks/aws/workspace/enable-disk-encryption/","text":"Explanation Workspace volumes for both user and root should be encrypted to protect the data stored on them. Possible Impact Data can be freely read if compromised Suggested Resolution Root and user volume encryption should be enabled Insecure Example The following example will fail the aws-workspace-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"bad_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } } Secure Example The following example will pass the aws-workspace-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"good_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" root_volume_encryption_enabled = true user_volume_encryption_enabled = true workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } } Related Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/workspaces_workspace#root_volume_encryption_enabled https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html","title":"enable-disk-encryption"},{"location":"checks/aws/workspace/enable-disk-encryption/#explanation","text":"Workspace volumes for both user and root should be encrypted to protect the data stored on them.","title":"Explanation"},{"location":"checks/aws/workspace/enable-disk-encryption/#possible-impact","text":"Data can be freely read if compromised","title":"Possible Impact"},{"location":"checks/aws/workspace/enable-disk-encryption/#suggested-resolution","text":"Root and user volume encryption should be enabled","title":"Suggested Resolution"},{"location":"checks/aws/workspace/enable-disk-encryption/#insecure-example","text":"The following example will fail the aws-workspace-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"bad_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } }","title":"Insecure Example"},{"location":"checks/aws/workspace/enable-disk-encryption/#secure-example","text":"The following example will pass the aws-workspace-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"good_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" root_volume_encryption_enabled = true user_volume_encryption_enabled = true workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } }","title":"Secure Example"},{"location":"checks/aws/workspace/enable-disk-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/workspaces_workspace#root_volume_encryption_enabled https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html","title":"Related Links"},{"location":"checks/azure/home/","text":"The included Azure checks are listed below. For more information about each check, see the link provided. Checks azure-appservice-account-identity-registered Web App has registration with AD enabled azure-appservice-authentication-enabled App Service authentication is activated azure-appservice-detailed-error-messages-enabled App service disables detailed error messages azure-appservice-dotnet-framework-version Azure App Service Web app does not use the latest .Net Core version azure-appservice-enable-http2 Web App uses the latest HTTP version azure-appservice-enable-https-only Ensure App Service can only be accessed via HTTPS. The default is false azure-appservice-failed-request-tracing-enabled App service does not enable failed request tracing azure-appservice-ftp-deployments-disabled Ensure FTP Deployments are disabled azure-appservice-http-logs-enabled App service does not enable HTTP logging azure-appservice-php-version Azure App Service Web app does not use the latest PHP version azure-appservice-python-version Azure App Service Web app does not use the latest Python version azure-appservice-require-client-cert Web App accepts incoming client certificate azure-appservice-use-secure-tls-policy Web App uses latest TLS version azure-authorization-limit-role-actions Roles limited to the required actions azure-compute-disable-password-authentication Password authentication should be disabled on Azure virtual machines azure-compute-enable-disk-encryption Enable disk encryption on managed disk azure-compute-no-secrets-in-custom-data Ensure that no sensitive credentials are exposed in VM custom_data azure-compute-ssh-authentication Password authentication in use instead of SSH keys. azure-container-configured-network-policy Ensure AKS cluster has Network Policy configured azure-container-limit-authorized-ips Ensure AKS has an API Server Authorized IP Ranges enabled azure-container-logging Ensure AKS logging to Azure Monitoring is Configured azure-container-use-rbac-permissions Ensure RBAC is enabled on AKS clusters azure-database-enable-audit Auditing should be enabled on Azure SQL Databases azure-database-enable-ssl-enforcement SSL should be enforced on database connections where applicable azure-database-mysql-threat-detection-enabled Ensure databases are not publicly accessible azure-database-no-public-access Ensure databases are not publicly accessible azure-database-no-public-firewall-access Ensure database firewalls do not permit public access azure-database-postgres-configuration-log-checkpoints Ensure server parameter 'log_checkpoints' is set to 'ON' for PostgreSQL Database Server azure-database-postgres-configuration-log-connection-throttling Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL Database Server azure-database-postgres-configuration-log-connections Ensure server parameter 'log_connections' is set to 'ON' for PostgreSQL Database Server azure-database-retention-period-set Database auditing rentention period should be longer than 90 days azure-database-secure-tls-policy Databases should have the minimum TLS set for connections azure-datafactory-no-public-access Data Factory should have public access disabled, the default is enabled. azure-datalake-enable-at-rest-encryption Unencrypted data lake storage. azure-functionapp-authentication-enabled Function App authentication is activated azure-functionapp-enable-http2 Web App uses the latest HTTP version azure-keyvault-content-type-for-secret Key vault Secret should have a content type set azure-keyvault-ensure-key-expiry Ensure that the expiration date is set on all keys azure-keyvault-ensure-secret-expiry Key Vault Secret should have an expiration date set azure-keyvault-no-purge Key vault should have purge protection enabled azure-keyvault-specify-network-acl Key vault should have the network acl block specified azure-monitor-activity-log-retention-set Ensure the activity retention log is set to at least a year azure-monitor-capture-all-activities Ensure log profile captures all activities azure-monitor-capture-all-regions Ensure activitys are captured for all locations azure-mssql-all-threat-alerts-enabled No threat detections are set azure-mssql-threat-alert-email-set At least one email address is set for threat alerts azure-mssql-threat-alert-email-to-owner Security threat alerts go to subcription owners and co-administrators azure-network-disable-rdp-from-internet RDP access should not be accessible from the Internet, should be blocked on port 3389 azure-network-no-public-egress An outbound network security rule allows traffic to /0. azure-network-no-public-ingress An inbound network security rule allows traffic from /0. azure-network-retention-policy-set Retention policy for flow logs should be enabled and set to greater than 90 days azure-network-ssh-blocked-from-internet SSH access should not be accessible from the Internet, should be blocked on port 22 azure-security-center-alert-on-severe-notifications Send notification emails for high severity alerts azure-security-center-defender-on-appservices Ensure Azure Defender is set to On for container registries azure-security-center-defender-on-container-registry Ensure Azure Defender is set to On for container registries azure-security-center-defender-on-keyvault Ensure Azure Defender is set to On for key vaults azure-security-center-defender-on-kubernetes Ensure Azure Defender is set to On for Kubernetes azure-security-center-defender-on-servers Ensure Azure Defender is set to On for Servers azure-security-center-defender-on-sql-servers Ensure Azure Defender is set to On for SQL Servers azure-security-center-defender-on-sql-servers-vms Ensure Azure Defender is set to On for Sql Server on Machines azure-security-center-defender-on-storage Ensure Azure Defender is set to On for storage accounts azure-security-center-enable-standard-subscription Enable the standard security center subscription tier azure-security-center-set-required-contact-details The required contact details should be set for security center azure-storage-allow-microsoft-service-bypass Trusted Microsoft Services should have bypass access to Storage accounts azure-storage-container-activity-logs-not-public Ensure public access level for Blob Containers is set to private azure-storage-default-action-deny The default action on Storage account network rules should be set to deny azure-storage-enforce-https Storage accounts should be configured to only accept transfers that are over secure connections azure-storage-no-public-access Storage containers in blob storage mode should not have public access azure-storage-queue-services-logging-enabled When using Queue Services for a storage account, logging should be enabled. azure-storage-use-secure-tls-policy The minimum TLS version for Storage Accounts should be TLS1_2 azure-synapse-virtual-network-enabled Synapse Workspace should have managed virtual network enabled, the default is disabled.","title":"azure"},{"location":"checks/azure/appservice/account-identity-registered/","text":"Explanation Registering the identity used by an App with AD allows it to interact with other services without using username and password Possible Impact Interaction between services can't easily be achieved without username/password Suggested Resolution Register the app identity with AD Insecure Example The following example will fail the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id identity { type = \"UserAssigned\" identity_ids = \"webapp1\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#identity","title":"account-identity-registered"},{"location":"checks/azure/appservice/account-identity-registered/#explanation","text":"Registering the identity used by an App with AD allows it to interact with other services without using username and password","title":"Explanation"},{"location":"checks/azure/appservice/account-identity-registered/#possible-impact","text":"Interaction between services can't easily be achieved without username/password","title":"Possible Impact"},{"location":"checks/azure/appservice/account-identity-registered/#suggested-resolution","text":"Register the app identity with AD","title":"Suggested Resolution"},{"location":"checks/azure/appservice/account-identity-registered/#insecure-example","text":"The following example will fail the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/account-identity-registered/#secure-example","text":"The following example will pass the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id identity { type = \"UserAssigned\" identity_ids = \"webapp1\" } }","title":"Secure Example"},{"location":"checks/azure/appservice/account-identity-registered/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#identity","title":"Related Links"},{"location":"checks/azure/appservice/authentication-enabled/","text":"Explanation Enabling authentication ensures that all communications in the application are authenticated. The auth_settings block needs to be filled out with the appropriate auth backend settings Possible Impact Anonymous HTTP requests will be accepted Suggested Resolution Enable authentication to prevent anonymous request being accepted Insecure Example The following example will fail the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id auth_settings { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#enabled","title":"authentication-enabled"},{"location":"checks/azure/appservice/authentication-enabled/#explanation","text":"Enabling authentication ensures that all communications in the application are authenticated. The auth_settings block needs to be filled out with the appropriate auth backend settings","title":"Explanation"},{"location":"checks/azure/appservice/authentication-enabled/#possible-impact","text":"Anonymous HTTP requests will be accepted","title":"Possible Impact"},{"location":"checks/azure/appservice/authentication-enabled/#suggested-resolution","text":"Enable authentication to prevent anonymous request being accepted","title":"Suggested Resolution"},{"location":"checks/azure/appservice/authentication-enabled/#insecure-example","text":"The following example will fail the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/authentication-enabled/#secure-example","text":"The following example will pass the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id auth_settings { enabled = true } }","title":"Secure Example"},{"location":"checks/azure/appservice/authentication-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#enabled","title":"Related Links"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/","text":"Explanation Copies of the .htm error pages that would have been sent to the client browser. For security reasons, detailed error pages shouldn't be sent to clients in production, but App Service can save the error page each time an application error occurs that has HTTP code 400 or greater. The page may contain information that can help determine why the server returns the error code. Possible Impact Missing crucial details in the error messages Suggested Resolution Enable detailed_error_messages_enabled Insecure Example The following example will fail the azure-appservice-detailed-error-messages-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-detailed-error-messages-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id logs { detailed_error_messages_enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#detailed_error_messages_enabled https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs","title":"detailed-error-messages-enabled"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/#explanation","text":"Copies of the .htm error pages that would have been sent to the client browser. For security reasons, detailed error pages shouldn't be sent to clients in production, but App Service can save the error page each time an application error occurs that has HTTP code 400 or greater. The page may contain information that can help determine why the server returns the error code.","title":"Explanation"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/#possible-impact","text":"Missing crucial details in the error messages","title":"Possible Impact"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/#suggested-resolution","text":"Enable detailed_error_messages_enabled","title":"Suggested Resolution"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/#insecure-example","text":"The following example will fail the azure-appservice-detailed-error-messages-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/#secure-example","text":"The following example will pass the azure-appservice-detailed-error-messages-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id logs { detailed_error_messages_enabled = true } }","title":"Secure Example"},{"location":"checks/azure/appservice/detailed-error-messages-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#detailed_error_messages_enabled https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs","title":"Related Links"},{"location":"checks/azure/appservice/dotnet-framework-version/","text":"Explanation Azure App Service web applications developed with the .NET software stack should use the latest available version of .NET to ensure the latest security fixes are in use. Possible Impact Outdated .NET could contain open vulnerabilities Suggested Resolution Use the latest version of the .NET framework Insecure Example The following example will fail the azure-appservice-dotnet-framework-version check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-dotnet-framework-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { dotnet_framework_version = \"v5.0\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#dotnet_framework_version https://docs.microsoft.com/en-us/azure/app-service/configure-language-dotnetcore","title":"dotnet-framework-version"},{"location":"checks/azure/appservice/dotnet-framework-version/#explanation","text":"Azure App Service web applications developed with the .NET software stack should use the latest available version of .NET to ensure the latest security fixes are in use.","title":"Explanation"},{"location":"checks/azure/appservice/dotnet-framework-version/#possible-impact","text":"Outdated .NET could contain open vulnerabilities","title":"Possible Impact"},{"location":"checks/azure/appservice/dotnet-framework-version/#suggested-resolution","text":"Use the latest version of the .NET framework","title":"Suggested Resolution"},{"location":"checks/azure/appservice/dotnet-framework-version/#insecure-example","text":"The following example will fail the azure-appservice-dotnet-framework-version check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/dotnet-framework-version/#secure-example","text":"The following example will pass the azure-appservice-dotnet-framework-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { dotnet_framework_version = \"v5.0\" } }","title":"Secure Example"},{"location":"checks/azure/appservice/dotnet-framework-version/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#dotnet_framework_version https://docs.microsoft.com/en-us/azure/app-service/configure-language-dotnetcore","title":"Related Links"},{"location":"checks/azure/appservice/enable-http2/","text":"Explanation Use the latest version of HTTP to ensure you are benefiting from security fixes Possible Impact Outdated versions of HTTP has security vulnerabilities Suggested Resolution Use the latest version of HTTP Insecure Example The following example will fail the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { http2_enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http2_enabled","title":"enable-http2"},{"location":"checks/azure/appservice/enable-http2/#explanation","text":"Use the latest version of HTTP to ensure you are benefiting from security fixes","title":"Explanation"},{"location":"checks/azure/appservice/enable-http2/#possible-impact","text":"Outdated versions of HTTP has security vulnerabilities","title":"Possible Impact"},{"location":"checks/azure/appservice/enable-http2/#suggested-resolution","text":"Use the latest version of HTTP","title":"Suggested Resolution"},{"location":"checks/azure/appservice/enable-http2/#insecure-example","text":"The following example will fail the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/enable-http2/#secure-example","text":"The following example will pass the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { http2_enabled = true } }","title":"Secure Example"},{"location":"checks/azure/appservice/enable-http2/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http2_enabled","title":"Related Links"},{"location":"checks/azure/appservice/enable-https-only/","text":"Explanation By default, clients can connect to App Service by using both HTTP or HTTPS. HTTP should be disabled enabling the HTTPS Only setting. Possible Impact Anyone can access App Service using HTTP. Suggested Resolution Enable HTTPS only Insecure Example The following example will fail the azure-appservice-enable-https-only check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-enable-https-only check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id https_only = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#https_only https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https","title":"enable-https-only"},{"location":"checks/azure/appservice/enable-https-only/#explanation","text":"By default, clients can connect to App Service by using both HTTP or HTTPS. HTTP should be disabled enabling the HTTPS Only setting.","title":"Explanation"},{"location":"checks/azure/appservice/enable-https-only/#possible-impact","text":"Anyone can access App Service using HTTP.","title":"Possible Impact"},{"location":"checks/azure/appservice/enable-https-only/#suggested-resolution","text":"Enable HTTPS only","title":"Suggested Resolution"},{"location":"checks/azure/appservice/enable-https-only/#insecure-example","text":"The following example will fail the azure-appservice-enable-https-only check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/enable-https-only/#secure-example","text":"The following example will pass the azure-appservice-enable-https-only check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id https_only = true }","title":"Secure Example"},{"location":"checks/azure/appservice/enable-https-only/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#https_only https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https","title":"Related Links"},{"location":"checks/azure/appservice/enforce-https/","text":"Explanation By default, clients can connect to function endpoints by using both HTTP or HTTPS. You should redirect HTTP to HTTPs because HTTPS uses the SSL/TLS protocol to provide a secure connection, which is both encrypted and authenticated. Possible Impact Anyone can access the Function App using HTTP. Suggested Resolution You can redirect all HTTP requests to the HTTPS port. Insecure Example The following example will fail the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"bad_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" } Secure Example The following example will pass the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"good_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" https_only = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#https_only https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https https://docs.microsoft.com/en-us/azure/azure-functions/security-concepts","title":"enforce-https"},{"location":"checks/azure/appservice/enforce-https/#explanation","text":"By default, clients can connect to function endpoints by using both HTTP or HTTPS. You should redirect HTTP to HTTPs because HTTPS uses the SSL/TLS protocol to provide a secure connection, which is both encrypted and authenticated.","title":"Explanation"},{"location":"checks/azure/appservice/enforce-https/#possible-impact","text":"Anyone can access the Function App using HTTP.","title":"Possible Impact"},{"location":"checks/azure/appservice/enforce-https/#suggested-resolution","text":"You can redirect all HTTP requests to the HTTPS port.","title":"Suggested Resolution"},{"location":"checks/azure/appservice/enforce-https/#insecure-example","text":"The following example will fail the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"bad_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" }","title":"Insecure Example"},{"location":"checks/azure/appservice/enforce-https/#secure-example","text":"The following example will pass the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"good_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" https_only = true }","title":"Secure Example"},{"location":"checks/azure/appservice/enforce-https/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#https_only https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https https://docs.microsoft.com/en-us/azure/azure-functions/security-concepts","title":"Related Links"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/","text":"Explanation Detailed tracing information on failed requests, including a trace of the IIS components used to process the request and the time taken in each component. It's useful if you want to improve site performance or isolate a specific HTTP error. One folder is generated for each failed request, which contains the XML log file, and the XSL stylesheet to view the log file with. Possible Impact Logging of failed request tracing will not be logged Suggested Resolution Enable failed_request_tracing_enabled Insecure Example The following example will fail the azure-appservice-failed-request-tracing-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-failed-request-tracing-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id logs { failed_request_tracing_enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#failed_request_tracing_enabled https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs","title":"failed-request-tracing-enabled"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/#explanation","text":"Detailed tracing information on failed requests, including a trace of the IIS components used to process the request and the time taken in each component. It's useful if you want to improve site performance or isolate a specific HTTP error. One folder is generated for each failed request, which contains the XML log file, and the XSL stylesheet to view the log file with.","title":"Explanation"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/#possible-impact","text":"Logging of failed request tracing will not be logged","title":"Possible Impact"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/#suggested-resolution","text":"Enable failed_request_tracing_enabled","title":"Suggested Resolution"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/#insecure-example","text":"The following example will fail the azure-appservice-failed-request-tracing-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/#secure-example","text":"The following example will pass the azure-appservice-failed-request-tracing-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id logs { failed_request_tracing_enabled = true } }","title":"Secure Example"},{"location":"checks/azure/appservice/failed-request-tracing-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#failed_request_tracing_enabled https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs","title":"Related Links"},{"location":"checks/azure/appservice/ftp-deployments-disabled/","text":"Explanation FTPS (Secure FTP) is used to enhance security for Azure web application using App Service as it adds an extra layer of security to the FTP protocol, and help you to comply with the industry standards and regulations. For enhanced security, it is highly advices to use FTP over TLS/SSL only. You can also disable both FTP and FTPS if you don't use FTP deployment. Possible Impact FTP is insecure and can lead to loss of data Suggested Resolution Disable FTP Insecure Example The following example will fail the azure-appservice-ftp-deployments-disabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-ftp-deployments-disabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { ftps_state = \"Disabled\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#ftps_state https://docs.microsoft.com/en-us/azure/app-service/deploy-ftp","title":"ftp-deployments-disabled"},{"location":"checks/azure/appservice/ftp-deployments-disabled/#explanation","text":"FTPS (Secure FTP) is used to enhance security for Azure web application using App Service as it adds an extra layer of security to the FTP protocol, and help you to comply with the industry standards and regulations. For enhanced security, it is highly advices to use FTP over TLS/SSL only. You can also disable both FTP and FTPS if you don't use FTP deployment.","title":"Explanation"},{"location":"checks/azure/appservice/ftp-deployments-disabled/#possible-impact","text":"FTP is insecure and can lead to loss of data","title":"Possible Impact"},{"location":"checks/azure/appservice/ftp-deployments-disabled/#suggested-resolution","text":"Disable FTP","title":"Suggested Resolution"},{"location":"checks/azure/appservice/ftp-deployments-disabled/#insecure-example","text":"The following example will fail the azure-appservice-ftp-deployments-disabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/ftp-deployments-disabled/#secure-example","text":"The following example will pass the azure-appservice-ftp-deployments-disabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { ftps_state = \"Disabled\" } }","title":"Secure Example"},{"location":"checks/azure/appservice/ftp-deployments-disabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#ftps_state https://docs.microsoft.com/en-us/azure/app-service/deploy-ftp","title":"Related Links"},{"location":"checks/azure/appservice/http-logs-enabled/","text":"Explanation Raw HTTP request data in the W3C extended log file format. Each log message includes data such as the HTTP method, resource URI, client IP, client port, user agent, response code, and so on. Possible Impact Missed logs related to HTTP requests Suggested Resolution Enable http_logs Insecure Example The following example will fail the azure-appservice-http-logs-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-http-logs-enabled check. resource \"azurerm_app_service\" \"good_example_one\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id logs { http_logs { file_system { retention_in_days = 4 retention_in_mb = 25 } } } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http_logs https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs","title":"http-logs-enabled"},{"location":"checks/azure/appservice/http-logs-enabled/#explanation","text":"Raw HTTP request data in the W3C extended log file format. Each log message includes data such as the HTTP method, resource URI, client IP, client port, user agent, response code, and so on.","title":"Explanation"},{"location":"checks/azure/appservice/http-logs-enabled/#possible-impact","text":"Missed logs related to HTTP requests","title":"Possible Impact"},{"location":"checks/azure/appservice/http-logs-enabled/#suggested-resolution","text":"Enable http_logs","title":"Suggested Resolution"},{"location":"checks/azure/appservice/http-logs-enabled/#insecure-example","text":"The following example will fail the azure-appservice-http-logs-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/http-logs-enabled/#secure-example","text":"The following example will pass the azure-appservice-http-logs-enabled check. resource \"azurerm_app_service\" \"good_example_one\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id logs { http_logs { file_system { retention_in_days = 4 retention_in_mb = 25 } } } }","title":"Secure Example"},{"location":"checks/azure/appservice/http-logs-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http_logs https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs","title":"Related Links"},{"location":"checks/azure/appservice/php-version/","text":"Explanation Azure App Service web applications developed with the PHP should use the latest available version of PHP to ensure the latest security fixes are in use. Possible Impact Old PHP Versions can contain vulnerabilities which lead to compromised Web Applications Suggested Resolution Ensure Latest PHP Version is being used Insecure Example The following example will fail the azure-appservice-php-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { php_version = \"7.3\" } } Secure Example The following example will pass the azure-appservice-php-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { php_version = \"7.4\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#php_version","title":"php-version"},{"location":"checks/azure/appservice/php-version/#explanation","text":"Azure App Service web applications developed with the PHP should use the latest available version of PHP to ensure the latest security fixes are in use.","title":"Explanation"},{"location":"checks/azure/appservice/php-version/#possible-impact","text":"Old PHP Versions can contain vulnerabilities which lead to compromised Web Applications","title":"Possible Impact"},{"location":"checks/azure/appservice/php-version/#suggested-resolution","text":"Ensure Latest PHP Version is being used","title":"Suggested Resolution"},{"location":"checks/azure/appservice/php-version/#insecure-example","text":"The following example will fail the azure-appservice-php-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { php_version = \"7.3\" } }","title":"Insecure Example"},{"location":"checks/azure/appservice/php-version/#secure-example","text":"The following example will pass the azure-appservice-php-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { php_version = \"7.4\" } }","title":"Secure Example"},{"location":"checks/azure/appservice/php-version/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#php_version","title":"Related Links"},{"location":"checks/azure/appservice/python-version/","text":"Explanation Azure App Service web applications developed with the Python should use the latest available version of Python to ensure the latest security fixes are in use. Possible Impact Old Python Versions can contain vulnerabilities which lead to compromised Web Applications Suggested Resolution Ensure Latest Python Version is being used Insecure Example The following example will fail the azure-appservice-python-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { python_version = \"2.7\" } } Secure Example The following example will pass the azure-appservice-python-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { python_version = \"3.4\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#python_version","title":"python-version"},{"location":"checks/azure/appservice/python-version/#explanation","text":"Azure App Service web applications developed with the Python should use the latest available version of Python to ensure the latest security fixes are in use.","title":"Explanation"},{"location":"checks/azure/appservice/python-version/#possible-impact","text":"Old Python Versions can contain vulnerabilities which lead to compromised Web Applications","title":"Possible Impact"},{"location":"checks/azure/appservice/python-version/#suggested-resolution","text":"Ensure Latest Python Version is being used","title":"Suggested Resolution"},{"location":"checks/azure/appservice/python-version/#insecure-example","text":"The following example will fail the azure-appservice-python-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { python_version = \"2.7\" } }","title":"Insecure Example"},{"location":"checks/azure/appservice/python-version/#secure-example","text":"The following example will pass the azure-appservice-python-version check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { python_version = \"3.4\" } }","title":"Secure Example"},{"location":"checks/azure/appservice/python-version/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#python_version","title":"Related Links"},{"location":"checks/azure/appservice/require-client-cert/","text":"Explanation The TLS mutual authentication technique in enterprise environments ensures the authenticity of clients to the server. If incoming client certificates are enabled only an authenticated client with valid certificates can access the app. Possible Impact Mutual TLS is not being used Suggested Resolution Enable incoming certificates for clients Insecure Example The following example will fail the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id client_cert_enabled = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#client_cert_enabled","title":"require-client-cert"},{"location":"checks/azure/appservice/require-client-cert/#explanation","text":"The TLS mutual authentication technique in enterprise environments ensures the authenticity of clients to the server. If incoming client certificates are enabled only an authenticated client with valid certificates can access the app.","title":"Explanation"},{"location":"checks/azure/appservice/require-client-cert/#possible-impact","text":"Mutual TLS is not being used","title":"Possible Impact"},{"location":"checks/azure/appservice/require-client-cert/#suggested-resolution","text":"Enable incoming certificates for clients","title":"Suggested Resolution"},{"location":"checks/azure/appservice/require-client-cert/#insecure-example","text":"The following example will fail the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/appservice/require-client-cert/#secure-example","text":"The following example will pass the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id client_cert_enabled = true }","title":"Secure Example"},{"location":"checks/azure/appservice/require-client-cert/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#client_cert_enabled","title":"Related Links"},{"location":"checks/azure/appservice/use-secure-tls-policy/","text":"Explanation Use a more recent TLS/SSL policy for the App Service Possible Impact The minimum TLS version for apps should be TLS1_2 Suggested Resolution The TLS version being outdated and has known vulnerabilities Insecure Example The following example will fail the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { min_tls_version = \"1.0\" } } Secure Example The following example will pass the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#min_tls_version","title":"use-secure-tls-policy"},{"location":"checks/azure/appservice/use-secure-tls-policy/#explanation","text":"Use a more recent TLS/SSL policy for the App Service","title":"Explanation"},{"location":"checks/azure/appservice/use-secure-tls-policy/#possible-impact","text":"The minimum TLS version for apps should be TLS1_2","title":"Possible Impact"},{"location":"checks/azure/appservice/use-secure-tls-policy/#suggested-resolution","text":"The TLS version being outdated and has known vulnerabilities","title":"Suggested Resolution"},{"location":"checks/azure/appservice/use-secure-tls-policy/#insecure-example","text":"The following example will fail the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { min_tls_version = \"1.0\" } }","title":"Insecure Example"},{"location":"checks/azure/appservice/use-secure-tls-policy/#secure-example","text":"The following example will pass the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Secure Example"},{"location":"checks/azure/appservice/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#min_tls_version","title":"Related Links"},{"location":"checks/azure/authorization/limit-role-actions/","text":"Explanation The permissions granted to a role should be kept to the minimum required to be able to do the task. Wildcard permissions must not be used. Possible Impact Open permissions for subscriptions could result in an easily compromisable account Suggested Resolution Use targeted permissions for roles Insecure Example The following example will fail the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ \"/\" ] } Secure Example The following example will pass the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ data.azurerm_subscription.primary.id , ] } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_definition#actions","title":"limit-role-actions"},{"location":"checks/azure/authorization/limit-role-actions/#explanation","text":"The permissions granted to a role should be kept to the minimum required to be able to do the task. Wildcard permissions must not be used.","title":"Explanation"},{"location":"checks/azure/authorization/limit-role-actions/#possible-impact","text":"Open permissions for subscriptions could result in an easily compromisable account","title":"Possible Impact"},{"location":"checks/azure/authorization/limit-role-actions/#suggested-resolution","text":"Use targeted permissions for roles","title":"Suggested Resolution"},{"location":"checks/azure/authorization/limit-role-actions/#insecure-example","text":"The following example will fail the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ \"/\" ] }","title":"Insecure Example"},{"location":"checks/azure/authorization/limit-role-actions/#secure-example","text":"The following example will pass the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ data.azurerm_subscription.primary.id , ] }","title":"Secure Example"},{"location":"checks/azure/authorization/limit-role-actions/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_definition#actions","title":"Related Links"},{"location":"checks/azure/compute/disable-password-authentication/","text":"Explanation Access to virtual machines should be authenticated using SSH keys. Removing the option of password authentication enforces more secure methods while removing the risks inherent with passwords. Possible Impact Using password authentication is less secure that ssh keys may result in compromised servers Suggested Resolution Use ssh authentication for virtual machines Insecure Example The following example will fail the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"bad_linux_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" disable_password_authentication = false } resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" os_profile { computer_name = \"hostname\" admin_username = \"testadmin\" admin_password = \"Password1234!\" } os_profile_linux_config { disable_password_authentication = false } } Secure Example The following example will pass the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"good_linux_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" admin_ssh_key { username = \"adminuser\" public_key = file ( \"~/.ssh/id_rsa.pub\" ) } } resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" os_profile_linux_config { ssh_keys = [{ key_data = file ( \"~/.ssh/id_rsa.pub\" ) path = \"~/.ssh/id_rsa.pub\" }] disable_password_authentication = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_virtual_machine#disable_password_authentication https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#disable_password_authentication","title":"disable-password-authentication"},{"location":"checks/azure/compute/disable-password-authentication/#explanation","text":"Access to virtual machines should be authenticated using SSH keys. Removing the option of password authentication enforces more secure methods while removing the risks inherent with passwords.","title":"Explanation"},{"location":"checks/azure/compute/disable-password-authentication/#possible-impact","text":"Using password authentication is less secure that ssh keys may result in compromised servers","title":"Possible Impact"},{"location":"checks/azure/compute/disable-password-authentication/#suggested-resolution","text":"Use ssh authentication for virtual machines","title":"Suggested Resolution"},{"location":"checks/azure/compute/disable-password-authentication/#insecure-example","text":"The following example will fail the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"bad_linux_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" disable_password_authentication = false } resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" os_profile { computer_name = \"hostname\" admin_username = \"testadmin\" admin_password = \"Password1234!\" } os_profile_linux_config { disable_password_authentication = false } }","title":"Insecure Example"},{"location":"checks/azure/compute/disable-password-authentication/#secure-example","text":"The following example will pass the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"good_linux_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" admin_ssh_key { username = \"adminuser\" public_key = file ( \"~/.ssh/id_rsa.pub\" ) } } resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" os_profile_linux_config { ssh_keys = [{ key_data = file ( \"~/.ssh/id_rsa.pub\" ) path = \"~/.ssh/id_rsa.pub\" }] disable_password_authentication = true } }","title":"Secure Example"},{"location":"checks/azure/compute/disable-password-authentication/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_virtual_machine#disable_password_authentication https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#disable_password_authentication","title":"Related Links"},{"location":"checks/azure/compute/enable-disk-encryption/","text":"Explanation Manage disks should be encrypted at rest. When specifying the encryption_settings block, the enabled attribute should be set to true . Possible Impact Data could be read if compromised Suggested Resolution Enable encryption on managed disks Insecure Example The following example will fail the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"bad_example\" { encryption_settings { enabled = false } } Secure Example The following example will pass the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"good_example\" { encryption_settings { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/managed_disk https://docs.microsoft.com/en-us/azure/virtual-machines/linux/disk-encryption","title":"enable-disk-encryption"},{"location":"checks/azure/compute/enable-disk-encryption/#explanation","text":"Manage disks should be encrypted at rest. When specifying the encryption_settings block, the enabled attribute should be set to true .","title":"Explanation"},{"location":"checks/azure/compute/enable-disk-encryption/#possible-impact","text":"Data could be read if compromised","title":"Possible Impact"},{"location":"checks/azure/compute/enable-disk-encryption/#suggested-resolution","text":"Enable encryption on managed disks","title":"Suggested Resolution"},{"location":"checks/azure/compute/enable-disk-encryption/#insecure-example","text":"The following example will fail the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"bad_example\" { encryption_settings { enabled = false } }","title":"Insecure Example"},{"location":"checks/azure/compute/enable-disk-encryption/#secure-example","text":"The following example will pass the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"good_example\" { encryption_settings { enabled = true } }","title":"Secure Example"},{"location":"checks/azure/compute/enable-disk-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/managed_disk https://docs.microsoft.com/en-us/azure/virtual-machines/linux/disk-encryption","title":"Related Links"},{"location":"checks/azure/compute/no-secrets-in-custom-data/","text":"Explanation When creating Azure Virtual Machines, custom_data is used to pass start up information into the EC2 instance. This custom_dat must not contain access key credentials. Possible Impact Sensitive credentials in custom_data can be leaked Suggested Resolution Don't use sensitive credentials in the VM custom_data Insecure Example The following example will fail the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad_example\" custom_data = <<EOF export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } Secure Example The following example will pass the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good_example\" custom_data = <<EOF export GREETING = \"Hello there\" EOF } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#custom_data","title":"no-secrets-in-custom-data"},{"location":"checks/azure/compute/no-secrets-in-custom-data/#explanation","text":"When creating Azure Virtual Machines, custom_data is used to pass start up information into the EC2 instance. This custom_dat must not contain access key credentials.","title":"Explanation"},{"location":"checks/azure/compute/no-secrets-in-custom-data/#possible-impact","text":"Sensitive credentials in custom_data can be leaked","title":"Possible Impact"},{"location":"checks/azure/compute/no-secrets-in-custom-data/#suggested-resolution","text":"Don't use sensitive credentials in the VM custom_data","title":"Suggested Resolution"},{"location":"checks/azure/compute/no-secrets-in-custom-data/#insecure-example","text":"The following example will fail the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad_example\" custom_data = <<EOF export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF }","title":"Insecure Example"},{"location":"checks/azure/compute/no-secrets-in-custom-data/#secure-example","text":"The following example will pass the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good_example\" custom_data = <<EOF export GREETING = \"Hello there\" EOF }","title":"Secure Example"},{"location":"checks/azure/compute/no-secrets-in-custom-data/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#custom_data","title":"Related Links"},{"location":"checks/azure/compute/ssh-authentication/","text":"Explanation Access to instances should be authenticated using SSH keys. Removing the option of password authentication enforces more secure methods while removing the risks inherent with passwords. Possible Impact Passwords are potentially easier to compromise than SSH Keys Suggested Resolution Use SSH keys for authentication Insecure Example The following example will fail the azure-compute-ssh-authentication check. resource \"azurerm_virtual_machine\" \"bad_example\" { os_profile_linux_config { disable_password_authentication = false } } Secure Example The following example will pass the azure-compute-ssh-authentication check. resource \"azurerm_virtual_machine\" \"good_example\" { os_profile_linux_config { disable_password_authentication = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-ssh-keys-detailed","title":"ssh-authentication"},{"location":"checks/azure/compute/ssh-authentication/#explanation","text":"Access to instances should be authenticated using SSH keys. Removing the option of password authentication enforces more secure methods while removing the risks inherent with passwords.","title":"Explanation"},{"location":"checks/azure/compute/ssh-authentication/#possible-impact","text":"Passwords are potentially easier to compromise than SSH Keys","title":"Possible Impact"},{"location":"checks/azure/compute/ssh-authentication/#suggested-resolution","text":"Use SSH keys for authentication","title":"Suggested Resolution"},{"location":"checks/azure/compute/ssh-authentication/#insecure-example","text":"The following example will fail the azure-compute-ssh-authentication check. resource \"azurerm_virtual_machine\" \"bad_example\" { os_profile_linux_config { disable_password_authentication = false } }","title":"Insecure Example"},{"location":"checks/azure/compute/ssh-authentication/#secure-example","text":"The following example will pass the azure-compute-ssh-authentication check. resource \"azurerm_virtual_machine\" \"good_example\" { os_profile_linux_config { disable_password_authentication = true } }","title":"Secure Example"},{"location":"checks/azure/compute/ssh-authentication/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-ssh-keys-detailed","title":"Related Links"},{"location":"checks/azure/container/configured-network-policy/","text":"Explanation The Kubernetes object type NetworkPolicy should be defined to have opportunity allow or block traffic to pods, as in a Kubernetes cluster configured with default settings, all pods can discover and communicate with each other without any restrictions. Possible Impact No network policy is protecting the AKS cluster Suggested Resolution Configure a network policy Insecure Example The following example will fail the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { network_profile { } } Secure Example The following example will pass the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { network_profile { network_policy = \"calico\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#network_policy https://kubernetes.io/docs/concepts/services-networking/network-policies","title":"configured-network-policy"},{"location":"checks/azure/container/configured-network-policy/#explanation","text":"The Kubernetes object type NetworkPolicy should be defined to have opportunity allow or block traffic to pods, as in a Kubernetes cluster configured with default settings, all pods can discover and communicate with each other without any restrictions.","title":"Explanation"},{"location":"checks/azure/container/configured-network-policy/#possible-impact","text":"No network policy is protecting the AKS cluster","title":"Possible Impact"},{"location":"checks/azure/container/configured-network-policy/#suggested-resolution","text":"Configure a network policy","title":"Suggested Resolution"},{"location":"checks/azure/container/configured-network-policy/#insecure-example","text":"The following example will fail the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { network_profile { } }","title":"Insecure Example"},{"location":"checks/azure/container/configured-network-policy/#secure-example","text":"The following example will pass the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { network_profile { network_policy = \"calico\" } }","title":"Secure Example"},{"location":"checks/azure/container/configured-network-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#network_policy https://kubernetes.io/docs/concepts/services-networking/network-policies","title":"Related Links"},{"location":"checks/azure/container/limit-authorized-ips/","text":"Explanation The API server is the central way to interact with and manage a cluster. To improve cluster security and minimize attacks, the API server should only be accessible from a limited set of IP address ranges. Possible Impact Any IP can interact with the API server Suggested Resolution Limit the access to the API server to a limited IP range Insecure Example The following example will fail the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { } Secure Example The following example will pass the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { api_server_authorized_ip_ranges = [ \"1.2.3.4/32\" ] } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#api_server_authorized_ip_ranges https://docs.microsoft.com/en-us/azure/aks/api-server-authorized-ip-ranges","title":"limit-authorized-ips"},{"location":"checks/azure/container/limit-authorized-ips/#explanation","text":"The API server is the central way to interact with and manage a cluster. To improve cluster security and minimize attacks, the API server should only be accessible from a limited set of IP address ranges.","title":"Explanation"},{"location":"checks/azure/container/limit-authorized-ips/#possible-impact","text":"Any IP can interact with the API server","title":"Possible Impact"},{"location":"checks/azure/container/limit-authorized-ips/#suggested-resolution","text":"Limit the access to the API server to a limited IP range","title":"Suggested Resolution"},{"location":"checks/azure/container/limit-authorized-ips/#insecure-example","text":"The following example will fail the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { }","title":"Insecure Example"},{"location":"checks/azure/container/limit-authorized-ips/#secure-example","text":"The following example will pass the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { api_server_authorized_ip_ranges = [ \"1.2.3.4/32\" ] }","title":"Secure Example"},{"location":"checks/azure/container/limit-authorized-ips/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#api_server_authorized_ip_ranges https://docs.microsoft.com/en-us/azure/aks/api-server-authorized-ip-ranges","title":"Related Links"},{"location":"checks/azure/container/logging/","text":"Explanation Ensure AKS logging to Azure Monitoring is configured for containers to monitor the performance of workloads. Possible Impact Logging provides valuable information about access and usage Suggested Resolution Enable logging for AKS Insecure Example The following example will fail the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { addon_profile {} } Secure Example The following example will pass the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { addon_profile { oms_agent { enabled = true } } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#oms_agent https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-onboard","title":"logging"},{"location":"checks/azure/container/logging/#explanation","text":"Ensure AKS logging to Azure Monitoring is configured for containers to monitor the performance of workloads.","title":"Explanation"},{"location":"checks/azure/container/logging/#possible-impact","text":"Logging provides valuable information about access and usage","title":"Possible Impact"},{"location":"checks/azure/container/logging/#suggested-resolution","text":"Enable logging for AKS","title":"Suggested Resolution"},{"location":"checks/azure/container/logging/#insecure-example","text":"The following example will fail the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { addon_profile {} }","title":"Insecure Example"},{"location":"checks/azure/container/logging/#secure-example","text":"The following example will pass the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { addon_profile { oms_agent { enabled = true } } }","title":"Secure Example"},{"location":"checks/azure/container/logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#oms_agent https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-onboard","title":"Related Links"},{"location":"checks/azure/container/use-rbac-permissions/","text":"Explanation Using Kubernetes role-based access control (RBAC), you can grant users, groups, and service accounts access to only the resources they need. Possible Impact No role based access control is in place for the AKS cluster Suggested Resolution Enable RBAC Insecure Example The following example will fail the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { role_based_access_control { enabled = false } } Secure Example The following example will pass the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { role_based_access_control { enabled = true } } Related Links https://www.terraform.io/docs/providers/azurerm/r/kubernetes_cluster.html#role_based_access_control https://docs.microsoft.com/en-us/azure/aks/concepts-identity","title":"use-rbac-permissions"},{"location":"checks/azure/container/use-rbac-permissions/#explanation","text":"Using Kubernetes role-based access control (RBAC), you can grant users, groups, and service accounts access to only the resources they need.","title":"Explanation"},{"location":"checks/azure/container/use-rbac-permissions/#possible-impact","text":"No role based access control is in place for the AKS cluster","title":"Possible Impact"},{"location":"checks/azure/container/use-rbac-permissions/#suggested-resolution","text":"Enable RBAC","title":"Suggested Resolution"},{"location":"checks/azure/container/use-rbac-permissions/#insecure-example","text":"The following example will fail the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { role_based_access_control { enabled = false } }","title":"Insecure Example"},{"location":"checks/azure/container/use-rbac-permissions/#secure-example","text":"The following example will pass the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { role_based_access_control { enabled = true } }","title":"Secure Example"},{"location":"checks/azure/container/use-rbac-permissions/#related-links","text":"https://www.terraform.io/docs/providers/azurerm/r/kubernetes_cluster.html#role_based_access_control https://docs.microsoft.com/en-us/azure/aks/concepts-identity","title":"Related Links"},{"location":"checks/azure/database/enable-audit/","text":"Explanation Auditing helps you maintain regulatory compliance, understand database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations. Possible Impact Auditing provides valuable information about access and usage Suggested Resolution Enable auditing on Azure SQL databases Insecure Example The following example will fail the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" } Secure Example The following example will pass the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" extended_auditing_policy { storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = true retention_in_days = 6 } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_server#extended_auditing_policy https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview","title":"enable-audit"},{"location":"checks/azure/database/enable-audit/#explanation","text":"Auditing helps you maintain regulatory compliance, understand database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations.","title":"Explanation"},{"location":"checks/azure/database/enable-audit/#possible-impact","text":"Auditing provides valuable information about access and usage","title":"Possible Impact"},{"location":"checks/azure/database/enable-audit/#suggested-resolution","text":"Enable auditing on Azure SQL databases","title":"Suggested Resolution"},{"location":"checks/azure/database/enable-audit/#insecure-example","text":"The following example will fail the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" }","title":"Insecure Example"},{"location":"checks/azure/database/enable-audit/#secure-example","text":"The following example will pass the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" extended_auditing_policy { storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = true retention_in_days = 6 } }","title":"Secure Example"},{"location":"checks/azure/database/enable-audit/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_server#extended_auditing_policy https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview","title":"Related Links"},{"location":"checks/azure/database/enable-ssl-enforcement/","text":"Explanation SSL connections should be enforced were available to ensure secure transfer and reduce the risk of compromising data in flight. Possible Impact Insecure connections could lead to data loss and other vulnerabilities Suggested Resolution Enable SSL enforcement Insecure Example The following example will fail the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Secure Example The following example will pass the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"good_example\" public_network_access_enabled = false ssl_enforcement_enabled = true ssl_minimal_tls_version_enforced = \"TLS1_2\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#ssl_enforcement_enabled","title":"enable-ssl-enforcement"},{"location":"checks/azure/database/enable-ssl-enforcement/#explanation","text":"SSL connections should be enforced were available to ensure secure transfer and reduce the risk of compromising data in flight.","title":"Explanation"},{"location":"checks/azure/database/enable-ssl-enforcement/#possible-impact","text":"Insecure connections could lead to data loss and other vulnerabilities","title":"Possible Impact"},{"location":"checks/azure/database/enable-ssl-enforcement/#suggested-resolution","text":"Enable SSL enforcement","title":"Suggested Resolution"},{"location":"checks/azure/database/enable-ssl-enforcement/#insecure-example","text":"The following example will fail the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }","title":"Insecure Example"},{"location":"checks/azure/database/enable-ssl-enforcement/#secure-example","text":"The following example will pass the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"good_example\" public_network_access_enabled = false ssl_enforcement_enabled = true ssl_minimal_tls_version_enforced = \"TLS1_2\" }","title":"Secure Example"},{"location":"checks/azure/database/enable-ssl-enforcement/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#ssl_enforcement_enabled","title":"Related Links"},{"location":"checks/azure/database/mysql-threat-detection-enabled/","text":"Explanation My SQL server does not enable Threat Detection policy Possible Impact Threat detection helps prevent compromise by alerting on threat detections Suggested Resolution Enable threat detection on Mysql database Insecure Example The following example will fail the azure-database-mysql-threat-detection-enabled check. resource \"azurerm_mysql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" threat_detection_policy { enabled = false } } Secure Example The following example will pass the azure-database-mysql-threat-detection-enabled check. resource \"azurerm_mysql_server\" \"good_example\" { name = \"good_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" threat_detection_policy { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/mysql_server#threat_detection_policy","title":"mysql-threat-detection-enabled"},{"location":"checks/azure/database/mysql-threat-detection-enabled/#explanation","text":"My SQL server does not enable Threat Detection policy","title":"Explanation"},{"location":"checks/azure/database/mysql-threat-detection-enabled/#possible-impact","text":"Threat detection helps prevent compromise by alerting on threat detections","title":"Possible Impact"},{"location":"checks/azure/database/mysql-threat-detection-enabled/#suggested-resolution","text":"Enable threat detection on Mysql database","title":"Suggested Resolution"},{"location":"checks/azure/database/mysql-threat-detection-enabled/#insecure-example","text":"The following example will fail the azure-database-mysql-threat-detection-enabled check. resource \"azurerm_mysql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" threat_detection_policy { enabled = false } }","title":"Insecure Example"},{"location":"checks/azure/database/mysql-threat-detection-enabled/#secure-example","text":"The following example will pass the azure-database-mysql-threat-detection-enabled check. resource \"azurerm_mysql_server\" \"good_example\" { name = \"good_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" threat_detection_policy { enabled = true } }","title":"Secure Example"},{"location":"checks/azure/database/mysql-threat-detection-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/mysql_server#threat_detection_policy","title":"Related Links"},{"location":"checks/azure/database/no-public-access/","text":"Explanation Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function. Possible Impact Publicly accessible database could lead to compromised data Suggested Resolution Disable public access to database when not required Insecure Example The following example will fail the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Secure Example The following example will pass the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#public_network_access_enabled","title":"no-public-access"},{"location":"checks/azure/database/no-public-access/#explanation","text":"Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function.","title":"Explanation"},{"location":"checks/azure/database/no-public-access/#possible-impact","text":"Publicly accessible database could lead to compromised data","title":"Possible Impact"},{"location":"checks/azure/database/no-public-access/#suggested-resolution","text":"Disable public access to database when not required","title":"Suggested Resolution"},{"location":"checks/azure/database/no-public-access/#insecure-example","text":"The following example will fail the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }","title":"Insecure Example"},{"location":"checks/azure/database/no-public-access/#secure-example","text":"The following example will pass the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }","title":"Secure Example"},{"location":"checks/azure/database/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#public_network_access_enabled","title":"Related Links"},{"location":"checks/azure/database/no-public-firewall-access/","text":"Explanation Azure services can be allowed access through the firewall using a start and end IP address of 0.0.0.0. No other end ip address should be combined with a start of 0.0.0.0 Possible Impact Publicly accessible databases could lead to compromised data Suggested Resolution Don't use wide ip ranges for the sql firewall Insecure Example The following example will fail the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"bad_example\" { name = \"bad_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" } resource \"azurerm_postgresql_firewall_rule\" \"bad_example\" { name = \"bad_example\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" } Secure Example The following example will pass the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"good_example\" { name = \"good_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"0.0.0.0\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_firewall_rule#end_ip_address https://docs.microsoft.com/en-us/rest/api/sql/2021-02-01-preview/firewall-rules/create-or-update","title":"no-public-firewall-access"},{"location":"checks/azure/database/no-public-firewall-access/#explanation","text":"Azure services can be allowed access through the firewall using a start and end IP address of 0.0.0.0. No other end ip address should be combined with a start of 0.0.0.0","title":"Explanation"},{"location":"checks/azure/database/no-public-firewall-access/#possible-impact","text":"Publicly accessible databases could lead to compromised data","title":"Possible Impact"},{"location":"checks/azure/database/no-public-firewall-access/#suggested-resolution","text":"Don't use wide ip ranges for the sql firewall","title":"Suggested Resolution"},{"location":"checks/azure/database/no-public-firewall-access/#insecure-example","text":"The following example will fail the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"bad_example\" { name = \"bad_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" } resource \"azurerm_postgresql_firewall_rule\" \"bad_example\" { name = \"bad_example\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" }","title":"Insecure Example"},{"location":"checks/azure/database/no-public-firewall-access/#secure-example","text":"The following example will pass the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"good_example\" { name = \"good_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"0.0.0.0\" }","title":"Secure Example"},{"location":"checks/azure/database/no-public-firewall-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_firewall_rule#end_ip_address https://docs.microsoft.com/en-us/rest/api/sql/2021-02-01-preview/firewall-rules/create-or-update","title":"Related Links"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/","text":"Explanation Postgresql can generate logs for checkpoints to improve visibility for audit and configuration issue resolution. Possible Impact No error and query logs generated on checkpoint Suggested Resolution Enable checkpoint logging Insecure Example The following example will fail the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } Secure Example The following example will pass the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_checkpoints\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging","title":"postgres-configuration-log-checkpoints"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/#explanation","text":"Postgresql can generate logs for checkpoints to improve visibility for audit and configuration issue resolution.","title":"Explanation"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/#possible-impact","text":"No error and query logs generated on checkpoint","title":"Possible Impact"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/#suggested-resolution","text":"Enable checkpoint logging","title":"Suggested Resolution"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/#insecure-example","text":"The following example will fail the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 }","title":"Insecure Example"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/#secure-example","text":"The following example will pass the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_checkpoints\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" }","title":"Secure Example"},{"location":"checks/azure/database/postgres-configuration-log-checkpoints/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging","title":"Related Links"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/","text":"Explanation Postgresql can generate logs for connection throttling to improve visibility for audit and configuration issue resolution. Possible Impact No log information to help diagnosing connection contention issues Suggested Resolution Enable connection throttling logging Insecure Example The following example will fail the azure-database-postgres-configuration-log-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } Secure Example The following example will pass the azure-database-postgres-configuration-log-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"connection_throttling\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging","title":"postgres-configuration-log-connection-throttling"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/#explanation","text":"Postgresql can generate logs for connection throttling to improve visibility for audit and configuration issue resolution.","title":"Explanation"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/#possible-impact","text":"No log information to help diagnosing connection contention issues","title":"Possible Impact"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/#suggested-resolution","text":"Enable connection throttling logging","title":"Suggested Resolution"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/#insecure-example","text":"The following example will fail the azure-database-postgres-configuration-log-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 }","title":"Insecure Example"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/#secure-example","text":"The following example will pass the azure-database-postgres-configuration-log-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"connection_throttling\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" }","title":"Secure Example"},{"location":"checks/azure/database/postgres-configuration-log-connection-throttling/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging","title":"Related Links"},{"location":"checks/azure/database/postgres-configuration-log-connections/","text":"Explanation Postgresql can generate logs for successful connections to improve visibility for audit and configuration issue resolution. Possible Impact No visibility of successful connections Suggested Resolution Enable connection logging Insecure Example The following example will fail the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } Secure Example The following example will pass the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_connections\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging","title":"postgres-configuration-log-connections"},{"location":"checks/azure/database/postgres-configuration-log-connections/#explanation","text":"Postgresql can generate logs for successful connections to improve visibility for audit and configuration issue resolution.","title":"Explanation"},{"location":"checks/azure/database/postgres-configuration-log-connections/#possible-impact","text":"No visibility of successful connections","title":"Possible Impact"},{"location":"checks/azure/database/postgres-configuration-log-connections/#suggested-resolution","text":"Enable connection logging","title":"Suggested Resolution"},{"location":"checks/azure/database/postgres-configuration-log-connections/#insecure-example","text":"The following example will fail the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 }","title":"Insecure Example"},{"location":"checks/azure/database/postgres-configuration-log-connections/#secure-example","text":"The following example will pass the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_connections\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" }","title":"Secure Example"},{"location":"checks/azure/database/postgres-configuration-log-connections/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging","title":"Related Links"},{"location":"checks/azure/database/retention-period-set/","text":"Explanation When Auditing is configured for a SQL database, if the retention period is not set, the retention will be unlimited. If the retention period is to be explicitly set, it should be set for no less than 90 days. Possible Impact Short logging retention could result in missing valuable historical information Suggested Resolution Set retention periods of database auditing to greater than 90 days Insecure Example The following example will fail the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"bad_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 6 } Secure Example The following example will pass the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false } resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 90 } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_database_extended_auditing_policy https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#retention_in_days https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview","title":"retention-period-set"},{"location":"checks/azure/database/retention-period-set/#explanation","text":"When Auditing is configured for a SQL database, if the retention period is not set, the retention will be unlimited. If the retention period is to be explicitly set, it should be set for no less than 90 days.","title":"Explanation"},{"location":"checks/azure/database/retention-period-set/#possible-impact","text":"Short logging retention could result in missing valuable historical information","title":"Possible Impact"},{"location":"checks/azure/database/retention-period-set/#suggested-resolution","text":"Set retention periods of database auditing to greater than 90 days","title":"Suggested Resolution"},{"location":"checks/azure/database/retention-period-set/#insecure-example","text":"The following example will fail the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"bad_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 6 }","title":"Insecure Example"},{"location":"checks/azure/database/retention-period-set/#secure-example","text":"The following example will pass the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false } resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 90 }","title":"Secure Example"},{"location":"checks/azure/database/retention-period-set/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_database_extended_auditing_policy https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#retention_in_days https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview","title":"Related Links"},{"location":"checks/azure/database/secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated TLS policies increase exposure to known issues Suggested Resolution Use the most modern TLS policies available Insecure Example The following example will fail the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.1\" } resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_1\" } Secure Example The following example will pass the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.2\" } resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#minimum_tls_version https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_minimal_tls_version_enforced https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_minimal_tls_version_enforced","title":"secure-tls-policy"},{"location":"checks/azure/database/secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/azure/database/secure-tls-policy/#possible-impact","text":"Outdated TLS policies increase exposure to known issues","title":"Possible Impact"},{"location":"checks/azure/database/secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS policies available","title":"Suggested Resolution"},{"location":"checks/azure/database/secure-tls-policy/#insecure-example","text":"The following example will fail the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.1\" } resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_1\" }","title":"Insecure Example"},{"location":"checks/azure/database/secure-tls-policy/#secure-example","text":"The following example will pass the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.2\" } resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }","title":"Secure Example"},{"location":"checks/azure/database/secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#minimum_tls_version https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_minimal_tls_version_enforced https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_minimal_tls_version_enforced","title":"Related Links"},{"location":"checks/azure/datafactory/no-public-access/","text":"Explanation Data Factory has public access set to true by default. Disabling public network access is applicable only to the self-hosted integration runtime, not to Azure Integration Runtime and SQL Server Integration Services (SSIS) Integration Runtime. Possible Impact Data factory is publicly accessible Suggested Resolution Set public access to disabled for Data Factory Insecure Example The following example will fail the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"bad_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name } Secure Example The following example will pass the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"good_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name public_network_enabled = false } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_factory#public_network_enabled https://docs.microsoft.com/en-us/azure/data-factory/data-movement-security-considerations#hybrid-scenarios","title":"no-public-access"},{"location":"checks/azure/datafactory/no-public-access/#explanation","text":"Data Factory has public access set to true by default. Disabling public network access is applicable only to the self-hosted integration runtime, not to Azure Integration Runtime and SQL Server Integration Services (SSIS) Integration Runtime.","title":"Explanation"},{"location":"checks/azure/datafactory/no-public-access/#possible-impact","text":"Data factory is publicly accessible","title":"Possible Impact"},{"location":"checks/azure/datafactory/no-public-access/#suggested-resolution","text":"Set public access to disabled for Data Factory","title":"Suggested Resolution"},{"location":"checks/azure/datafactory/no-public-access/#insecure-example","text":"The following example will fail the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"bad_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name }","title":"Insecure Example"},{"location":"checks/azure/datafactory/no-public-access/#secure-example","text":"The following example will pass the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"good_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name public_network_enabled = false }","title":"Secure Example"},{"location":"checks/azure/datafactory/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_factory#public_network_enabled https://docs.microsoft.com/en-us/azure/data-factory/data-movement-security-considerations#hybrid-scenarios","title":"Related Links"},{"location":"checks/azure/datalake/enable-at-rest-encryption/","text":"Explanation Datalake storage encryption defaults to Enabled, it shouldn't be overridden to Disabled. Possible Impact Data could be read if compromised Suggested Resolution Enable encryption of data lake storage Insecure Example The following example will fail the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"bad_example\" { encryption_state = \"Disabled\" } Secure Example The following example will pass the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"good_example\" { encryption_state = \"Enabled\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-security-overview","title":"enable-at-rest-encryption"},{"location":"checks/azure/datalake/enable-at-rest-encryption/#explanation","text":"Datalake storage encryption defaults to Enabled, it shouldn't be overridden to Disabled.","title":"Explanation"},{"location":"checks/azure/datalake/enable-at-rest-encryption/#possible-impact","text":"Data could be read if compromised","title":"Possible Impact"},{"location":"checks/azure/datalake/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption of data lake storage","title":"Suggested Resolution"},{"location":"checks/azure/datalake/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"bad_example\" { encryption_state = \"Disabled\" }","title":"Insecure Example"},{"location":"checks/azure/datalake/enable-at-rest-encryption/#secure-example","text":"The following example will pass the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"good_example\" { encryption_state = \"Enabled\" }","title":"Secure Example"},{"location":"checks/azure/datalake/enable-at-rest-encryption/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-security-overview","title":"Related Links"},{"location":"checks/azure/functionapp/authentication-enabled/","text":"Explanation Enabling authentication ensures that all communications in the application are authenticated. The auth_settings block needs to be filled out with the appropriate auth backend settings Possible Impact Anonymous HTTP requests will be accepted Suggested Resolution Enable authentication to prevent anonymous request being accepted Insecure Example The following example will fail the azure-functionapp-authentication-enabled check. resource \"azurerm_function_app\" \"bad_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_function_app_plan.example.id } Secure Example The following example will pass the azure-functionapp-authentication-enabled check. resource \"azurerm_function_app\" \"good_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_function_app_plan.example.id auth_settings { enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#enabled","title":"authentication-enabled"},{"location":"checks/azure/functionapp/authentication-enabled/#explanation","text":"Enabling authentication ensures that all communications in the application are authenticated. The auth_settings block needs to be filled out with the appropriate auth backend settings","title":"Explanation"},{"location":"checks/azure/functionapp/authentication-enabled/#possible-impact","text":"Anonymous HTTP requests will be accepted","title":"Possible Impact"},{"location":"checks/azure/functionapp/authentication-enabled/#suggested-resolution","text":"Enable authentication to prevent anonymous request being accepted","title":"Suggested Resolution"},{"location":"checks/azure/functionapp/authentication-enabled/#insecure-example","text":"The following example will fail the azure-functionapp-authentication-enabled check. resource \"azurerm_function_app\" \"bad_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_function_app_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/functionapp/authentication-enabled/#secure-example","text":"The following example will pass the azure-functionapp-authentication-enabled check. resource \"azurerm_function_app\" \"good_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_function_app_plan.example.id auth_settings { enabled = true } }","title":"Secure Example"},{"location":"checks/azure/functionapp/authentication-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#enabled","title":"Related Links"},{"location":"checks/azure/functionapp/enable-http2/","text":"Explanation Use the latest version of HTTP to ensure you are benefiting from security fixes Possible Impact Outdated versions of HTTP has security vulnerabilities Suggested Resolution Use the latest version of HTTP Insecure Example The following example will fail the azure-functionapp-enable-http2 check. resource \"azurerm_function_app\" \"bad_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-functionapp-enable-http2 check. resource \"azurerm_function_app\" \"good_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { http2_enabled = true } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#http2_enabled","title":"enable-http2"},{"location":"checks/azure/functionapp/enable-http2/#explanation","text":"Use the latest version of HTTP to ensure you are benefiting from security fixes","title":"Explanation"},{"location":"checks/azure/functionapp/enable-http2/#possible-impact","text":"Outdated versions of HTTP has security vulnerabilities","title":"Possible Impact"},{"location":"checks/azure/functionapp/enable-http2/#suggested-resolution","text":"Use the latest version of HTTP","title":"Suggested Resolution"},{"location":"checks/azure/functionapp/enable-http2/#insecure-example","text":"The following example will fail the azure-functionapp-enable-http2 check. resource \"azurerm_function_app\" \"bad_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }","title":"Insecure Example"},{"location":"checks/azure/functionapp/enable-http2/#secure-example","text":"The following example will pass the azure-functionapp-enable-http2 check. resource \"azurerm_function_app\" \"good_example\" { name = \"example-function-app\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { http2_enabled = true } }","title":"Secure Example"},{"location":"checks/azure/functionapp/enable-http2/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#http2_enabled","title":"Related Links"},{"location":"checks/azure/keyvault/content-type-for-secret/","text":"Explanation Content Type is an optional Key Vault Secret behavior and is not enabled by default. Clients may specify the content type of a secret to assist in interpreting the secret data when it's retrieved. The maximum length of this field is 255 characters. There are no pre-defined values. The suggested usage is as a hint for interpreting the secret data. Possible Impact The secret's type is unclear without a content type Suggested Resolution Provide content type for secrets to aid interpretation on retrieval Insecure Example The following example will fail the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id } Secure Example The following example will pass the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id content_type = \"password\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#content_type https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets","title":"content-type-for-secret"},{"location":"checks/azure/keyvault/content-type-for-secret/#explanation","text":"Content Type is an optional Key Vault Secret behavior and is not enabled by default. Clients may specify the content type of a secret to assist in interpreting the secret data when it's retrieved. The maximum length of this field is 255 characters. There are no pre-defined values. The suggested usage is as a hint for interpreting the secret data.","title":"Explanation"},{"location":"checks/azure/keyvault/content-type-for-secret/#possible-impact","text":"The secret's type is unclear without a content type","title":"Possible Impact"},{"location":"checks/azure/keyvault/content-type-for-secret/#suggested-resolution","text":"Provide content type for secrets to aid interpretation on retrieval","title":"Suggested Resolution"},{"location":"checks/azure/keyvault/content-type-for-secret/#insecure-example","text":"The following example will fail the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id }","title":"Insecure Example"},{"location":"checks/azure/keyvault/content-type-for-secret/#secure-example","text":"The following example will pass the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id content_type = \"password\" }","title":"Secure Example"},{"location":"checks/azure/keyvault/content-type-for-secret/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#content_type https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets","title":"Related Links"},{"location":"checks/azure/keyvault/ensure-key-expiry/","text":"Explanation Expiration Date is an optional Key Vault Key behavior and is not set by default. Set when the resource will be become inactive. Possible Impact Long life keys increase the attack surface when compromised Suggested Resolution Set an expiration date on the vault key Insecure Example The following example will fail the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"bad_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] } Secure Example The following example will pass the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"good_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 expiration_date = \"1982-12-31T00:00:00Z\" key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_key#expiration_date https://docs.microsoft.com/en-us/powershell/module/az.keyvault/update-azkeyvaultkey?view=azps-5.8.0#example-1--modify-a-key-to-enable-it--and-set-the-expiration-date-and-tags","title":"ensure-key-expiry"},{"location":"checks/azure/keyvault/ensure-key-expiry/#explanation","text":"Expiration Date is an optional Key Vault Key behavior and is not set by default. Set when the resource will be become inactive.","title":"Explanation"},{"location":"checks/azure/keyvault/ensure-key-expiry/#possible-impact","text":"Long life keys increase the attack surface when compromised","title":"Possible Impact"},{"location":"checks/azure/keyvault/ensure-key-expiry/#suggested-resolution","text":"Set an expiration date on the vault key","title":"Suggested Resolution"},{"location":"checks/azure/keyvault/ensure-key-expiry/#insecure-example","text":"The following example will fail the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"bad_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] }","title":"Insecure Example"},{"location":"checks/azure/keyvault/ensure-key-expiry/#secure-example","text":"The following example will pass the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"good_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 expiration_date = \"1982-12-31T00:00:00Z\" key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] }","title":"Secure Example"},{"location":"checks/azure/keyvault/ensure-key-expiry/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_key#expiration_date https://docs.microsoft.com/en-us/powershell/module/az.keyvault/update-azkeyvaultkey?view=azps-5.8.0#example-1--modify-a-key-to-enable-it--and-set-the-expiration-date-and-tags","title":"Related Links"},{"location":"checks/azure/keyvault/ensure-secret-expiry/","text":"Explanation Expiration Date is an optional Key Vault Secret behavior and is not set by default. Set when the resource will be become inactive. Possible Impact Long life secrets increase the opportunity for compromise Suggested Resolution Set an expiry for secrets Insecure Example The following example will fail the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id } Secure Example The following example will pass the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id expiration_date = \"1982-12-31T00:00:00Z\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#expiration_date https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets","title":"ensure-secret-expiry"},{"location":"checks/azure/keyvault/ensure-secret-expiry/#explanation","text":"Expiration Date is an optional Key Vault Secret behavior and is not set by default. Set when the resource will be become inactive.","title":"Explanation"},{"location":"checks/azure/keyvault/ensure-secret-expiry/#possible-impact","text":"Long life secrets increase the opportunity for compromise","title":"Possible Impact"},{"location":"checks/azure/keyvault/ensure-secret-expiry/#suggested-resolution","text":"Set an expiry for secrets","title":"Suggested Resolution"},{"location":"checks/azure/keyvault/ensure-secret-expiry/#insecure-example","text":"The following example will fail the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id }","title":"Insecure Example"},{"location":"checks/azure/keyvault/ensure-secret-expiry/#secure-example","text":"The following example will pass the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id expiration_date = \"1982-12-31T00:00:00Z\" }","title":"Secure Example"},{"location":"checks/azure/keyvault/ensure-secret-expiry/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#expiration_date https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets","title":"Related Links"},{"location":"checks/azure/keyvault/no-purge/","text":"Explanation Purge protection is an optional Key Vault behavior and is not enabled by default. Purge protection can only be enabled once soft-delete is enabled. It can be turned on via CLI or PowerShell. Possible Impact Keys could be purged from the vault without protection Suggested Resolution Enable purge protection for key vaults Insecure Example The following example will fail the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true purge_protection_enabled = false } Secure Example The following example will pass the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#purge_protection_enabled https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview#purge-protection","title":"no-purge"},{"location":"checks/azure/keyvault/no-purge/#explanation","text":"Purge protection is an optional Key Vault behavior and is not enabled by default. Purge protection can only be enabled once soft-delete is enabled. It can be turned on via CLI or PowerShell.","title":"Explanation"},{"location":"checks/azure/keyvault/no-purge/#possible-impact","text":"Keys could be purged from the vault without protection","title":"Possible Impact"},{"location":"checks/azure/keyvault/no-purge/#suggested-resolution","text":"Enable purge protection for key vaults","title":"Suggested Resolution"},{"location":"checks/azure/keyvault/no-purge/#insecure-example","text":"The following example will fail the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true purge_protection_enabled = false }","title":"Insecure Example"},{"location":"checks/azure/keyvault/no-purge/#secure-example","text":"The following example will pass the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = true }","title":"Secure Example"},{"location":"checks/azure/keyvault/no-purge/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#purge_protection_enabled https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview#purge-protection","title":"Related Links"},{"location":"checks/azure/keyvault/specify-network-acl/","text":"Explanation Network ACLs allow you to reduce your exposure to risk by limiting what can access your key vault. The default action of the Network ACL should be set to deny for when IPs are not matched. Azure services can be allowed to bypass. Possible Impact Without a network ACL the key vault is freely accessible Suggested Resolution Set a network ACL for the key vault Insecure Example The following example will fail the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false } Secure Example The following example will pass the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false network_acls { bypass = \"AzureServices\" default_action = \"Deny\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#network_acls https://docs.microsoft.com/en-us/azure/key-vault/general/network-security","title":"specify-network-acl"},{"location":"checks/azure/keyvault/specify-network-acl/#explanation","text":"Network ACLs allow you to reduce your exposure to risk by limiting what can access your key vault. The default action of the Network ACL should be set to deny for when IPs are not matched. Azure services can be allowed to bypass.","title":"Explanation"},{"location":"checks/azure/keyvault/specify-network-acl/#possible-impact","text":"Without a network ACL the key vault is freely accessible","title":"Possible Impact"},{"location":"checks/azure/keyvault/specify-network-acl/#suggested-resolution","text":"Set a network ACL for the key vault","title":"Suggested Resolution"},{"location":"checks/azure/keyvault/specify-network-acl/#insecure-example","text":"The following example will fail the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false }","title":"Insecure Example"},{"location":"checks/azure/keyvault/specify-network-acl/#secure-example","text":"The following example will pass the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false network_acls { bypass = \"AzureServices\" default_action = \"Deny\" } }","title":"Secure Example"},{"location":"checks/azure/keyvault/specify-network-acl/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#network_acls https://docs.microsoft.com/en-us/azure/key-vault/general/network-security","title":"Related Links"},{"location":"checks/azure/monitor/activity-log-retention-set/","text":"Explanation The average time to detect a breach is up to 210 days, to ensure that all the information required for an effective investigation is available, the retention period should allow for delayed starts to investigating. Possible Impact Short life activity logs can lead to missing records when investigating a breach Suggested Resolution Set a retention period that will allow for delayed investigation Insecure Example The following example will fail the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" retention_policy { enabled = true days = 365 } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#retention_policy https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/platform-logs-overview","title":"activity-log-retention-set"},{"location":"checks/azure/monitor/activity-log-retention-set/#explanation","text":"The average time to detect a breach is up to 210 days, to ensure that all the information required for an effective investigation is available, the retention period should allow for delayed starts to investigating.","title":"Explanation"},{"location":"checks/azure/monitor/activity-log-retention-set/#possible-impact","text":"Short life activity logs can lead to missing records when investigating a breach","title":"Possible Impact"},{"location":"checks/azure/monitor/activity-log-retention-set/#suggested-resolution","text":"Set a retention period that will allow for delayed investigation","title":"Suggested Resolution"},{"location":"checks/azure/monitor/activity-log-retention-set/#insecure-example","text":"The following example will fail the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" retention_policy { enabled = true days = 7 } }","title":"Insecure Example"},{"location":"checks/azure/monitor/activity-log-retention-set/#secure-example","text":"The following example will pass the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" retention_policy { enabled = true days = 365 } }","title":"Secure Example"},{"location":"checks/azure/monitor/activity-log-retention-set/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#retention_policy https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/platform-logs-overview","title":"Related Links"},{"location":"checks/azure/monitor/capture-all-activities/","text":"Explanation Log profiles should capture all categories to ensure that all events are logged Possible Impact Log profile must capture all activity to be able to ensure that all relevant information possible is available for an investigation Suggested Resolution Configure log profile to capture all activities Insecure Example The following example will fail the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" categories = [ \"Action\" , \"Delete\" , \"Write\" , ] retention_policy { enabled = true days = 365 } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#categories https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters","title":"capture-all-activities"},{"location":"checks/azure/monitor/capture-all-activities/#explanation","text":"Log profiles should capture all categories to ensure that all events are logged","title":"Explanation"},{"location":"checks/azure/monitor/capture-all-activities/#possible-impact","text":"Log profile must capture all activity to be able to ensure that all relevant information possible is available for an investigation","title":"Possible Impact"},{"location":"checks/azure/monitor/capture-all-activities/#suggested-resolution","text":"Configure log profile to capture all activities","title":"Suggested Resolution"},{"location":"checks/azure/monitor/capture-all-activities/#insecure-example","text":"The following example will fail the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] retention_policy { enabled = true days = 7 } }","title":"Insecure Example"},{"location":"checks/azure/monitor/capture-all-activities/#secure-example","text":"The following example will pass the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" categories = [ \"Action\" , \"Delete\" , \"Write\" , ] retention_policy { enabled = true days = 365 } }","title":"Secure Example"},{"location":"checks/azure/monitor/capture-all-activities/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#categories https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters","title":"Related Links"},{"location":"checks/azure/monitor/capture-all-regions/","text":"Explanation Log profiles should capture all regions to ensure that all events are logged Possible Impact Activity may be occurring in locations that aren't being monitored Suggested Resolution Enable capture for all locations Insecure Example The following example will fail the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"westus\" , \"global\" , ] retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"eastus\" , \"eastus2\" , \"southcentralus\" , \"westus2\" , \"westus3\" , \"australiaeast\" , \"southeastasia\" , \"northeurope\" , \"swedencentral\" , \"uksouth\" , \"westeurope\" , \"centralus\" , \"northcentralus\" , \"westus\" , \"southafricanorth\" , \"centralindia\" , \"eastasia\" , \"japaneast\" , \"jioindiawest\" , \"koreacentral\" , \"canadacentral\" , \"francecentral\" , \"germanywestcentral\" , \"norwayeast\" , \"switzerlandnorth\" , \"uaenorth\" , \"brazilsouth\" , \"centralusstage\" , \"eastusstage\" , \"eastus2stage\" , \"northcentralusstage\" , \"southcentralusstage\" , \"westusstage\" , \"westus2stage\" , \"asia\" , \"asiapacific\" , \"australia\" , \"brazil\" , \"canada\" , \"europe\" , \"global\" , \"india\" , \"japan\" , \"uk\" , \"unitedstates\" , \"eastasiastage\" , \"southeastasiastage\" , \"centraluseuap\" , \"eastus2euap\" , \"westcentralus\" , \"southafricawest\" , \"australiacentral\" , \"australiacentral2\" , \"australiasoutheast\" , \"japanwest\" , \"jioindiacentral\" , \"koreasouth\" , \"southindia\" , \"westindia\" , \"canadaeast\" , \"francesouth\" , \"germanynorth\" , \"norwaywest\" , \"swedensouth\" , \"switzerlandwest\" , \"ukwest\" , \"uaecentral\" , \"brazilsoutheast\" , ] retention_policy { enabled = true days = 7 } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#locations https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters","title":"capture-all-regions"},{"location":"checks/azure/monitor/capture-all-regions/#explanation","text":"Log profiles should capture all regions to ensure that all events are logged","title":"Explanation"},{"location":"checks/azure/monitor/capture-all-regions/#possible-impact","text":"Activity may be occurring in locations that aren't being monitored","title":"Possible Impact"},{"location":"checks/azure/monitor/capture-all-regions/#suggested-resolution","text":"Enable capture for all locations","title":"Suggested Resolution"},{"location":"checks/azure/monitor/capture-all-regions/#insecure-example","text":"The following example will fail the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"westus\" , \"global\" , ] retention_policy { enabled = true days = 7 } }","title":"Insecure Example"},{"location":"checks/azure/monitor/capture-all-regions/#secure-example","text":"The following example will pass the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"eastus\" , \"eastus2\" , \"southcentralus\" , \"westus2\" , \"westus3\" , \"australiaeast\" , \"southeastasia\" , \"northeurope\" , \"swedencentral\" , \"uksouth\" , \"westeurope\" , \"centralus\" , \"northcentralus\" , \"westus\" , \"southafricanorth\" , \"centralindia\" , \"eastasia\" , \"japaneast\" , \"jioindiawest\" , \"koreacentral\" , \"canadacentral\" , \"francecentral\" , \"germanywestcentral\" , \"norwayeast\" , \"switzerlandnorth\" , \"uaenorth\" , \"brazilsouth\" , \"centralusstage\" , \"eastusstage\" , \"eastus2stage\" , \"northcentralusstage\" , \"southcentralusstage\" , \"westusstage\" , \"westus2stage\" , \"asia\" , \"asiapacific\" , \"australia\" , \"brazil\" , \"canada\" , \"europe\" , \"global\" , \"india\" , \"japan\" , \"uk\" , \"unitedstates\" , \"eastasiastage\" , \"southeastasiastage\" , \"centraluseuap\" , \"eastus2euap\" , \"westcentralus\" , \"southafricawest\" , \"australiacentral\" , \"australiacentral2\" , \"australiasoutheast\" , \"japanwest\" , \"jioindiacentral\" , \"koreasouth\" , \"southindia\" , \"westindia\" , \"canadaeast\" , \"francesouth\" , \"germanynorth\" , \"norwaywest\" , \"swedensouth\" , \"switzerlandwest\" , \"ukwest\" , \"uaecentral\" , \"brazilsoutheast\" , ] retention_policy { enabled = true days = 7 } }","title":"Secure Example"},{"location":"checks/azure/monitor/capture-all-regions/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#locations https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters","title":"Related Links"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/","text":"Explanation SQL Server can alert for security issues including SQL Injection, vulnerabilities, access anomalies and data exfiltration. Ensure none of these are disabled to benefit from the best protection Possible Impact Disabling threat alerts means you are not getting the full benefit of server security protection Suggested Resolution Use all provided threat alerts Insecure Example The following example will fail the azure-mssql-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] retention_days = 20 } Secure Example The following example will pass the azure-mssql-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] retention_days = 20 } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#disabled_alerts","title":"all-threat-alerts-enabled"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/#explanation","text":"SQL Server can alert for security issues including SQL Injection, vulnerabilities, access anomalies and data exfiltration. Ensure none of these are disabled to benefit from the best protection","title":"Explanation"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/#possible-impact","text":"Disabling threat alerts means you are not getting the full benefit of server security protection","title":"Possible Impact"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/#suggested-resolution","text":"Use all provided threat alerts","title":"Suggested Resolution"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/#insecure-example","text":"The following example will fail the azure-mssql-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] retention_days = 20 }","title":"Insecure Example"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/#secure-example","text":"The following example will pass the azure-mssql-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] retention_days = 20 }","title":"Secure Example"},{"location":"checks/azure/mssql/all-threat-alerts-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#disabled_alerts","title":"Related Links"},{"location":"checks/azure/mssql/threat-alert-email-set/","text":"Explanation SQL Server sends alerts for threat detection via email, if there are no email addresses set then mitigation will be delayed. Possible Impact Nobody will be prompty alerted in the case of a threat being detected Suggested Resolution Provide at least one email address for threat alerts Insecure Example The following example will fail the azure-mssql-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [] } Secure Example The following example will pass the azure-mssql-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [ \"db-security@acme.org\" ] } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_addresses","title":"threat-alert-email-set"},{"location":"checks/azure/mssql/threat-alert-email-set/#explanation","text":"SQL Server sends alerts for threat detection via email, if there are no email addresses set then mitigation will be delayed.","title":"Explanation"},{"location":"checks/azure/mssql/threat-alert-email-set/#possible-impact","text":"Nobody will be prompty alerted in the case of a threat being detected","title":"Possible Impact"},{"location":"checks/azure/mssql/threat-alert-email-set/#suggested-resolution","text":"Provide at least one email address for threat alerts","title":"Suggested Resolution"},{"location":"checks/azure/mssql/threat-alert-email-set/#insecure-example","text":"The following example will fail the azure-mssql-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [] }","title":"Insecure Example"},{"location":"checks/azure/mssql/threat-alert-email-set/#secure-example","text":"The following example will pass the azure-mssql-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [ \"db-security@acme.org\" ] }","title":"Secure Example"},{"location":"checks/azure/mssql/threat-alert-email-set/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_addresses","title":"Related Links"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/","text":"Explanation Subscription owners should be notified when there are security alerts. By ensuring the administrators of the account have been notified they can quickly assist in any required remediation Possible Impact Administrators and subscription owners may have a delayed response Suggested Resolution Enable email to subscription owners Insecure Example The following example will fail the azure-mssql-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ ] email_account_admins = false } Secure Example The following example will pass the azure-mssql-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] email_account_admins = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_account_admins","title":"threat-alert-email-to-owner"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/#explanation","text":"Subscription owners should be notified when there are security alerts. By ensuring the administrators of the account have been notified they can quickly assist in any required remediation","title":"Explanation"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/#possible-impact","text":"Administrators and subscription owners may have a delayed response","title":"Possible Impact"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/#suggested-resolution","text":"Enable email to subscription owners","title":"Suggested Resolution"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/#insecure-example","text":"The following example will fail the azure-mssql-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ ] email_account_admins = false }","title":"Insecure Example"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/#secure-example","text":"The following example will pass the azure-mssql-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] email_account_admins = true }","title":"Secure Example"},{"location":"checks/azure/mssql/threat-alert-email-to-owner/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_account_admins","title":"Related Links"},{"location":"checks/azure/network/disable-rdp-from-internet/","text":"Explanation RDP access can be configured on either the network security group or in the network security group rule. RDP access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any). Consider using the Azure Bastion Service. Possible Impact Anyone from the internet can potentially RDP onto an instance Suggested Resolution Block RDP port from internet Insecure Example The following example will fail the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } } Secure Example The following example will pass the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges https://docs.microsoft.com/en-us/azure/bastion/tutorial-create-host-portal","title":"disable-rdp-from-internet"},{"location":"checks/azure/network/disable-rdp-from-internet/#explanation","text":"RDP access can be configured on either the network security group or in the network security group rule. RDP access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any). Consider using the Azure Bastion Service.","title":"Explanation"},{"location":"checks/azure/network/disable-rdp-from-internet/#possible-impact","text":"Anyone from the internet can potentially RDP onto an instance","title":"Possible Impact"},{"location":"checks/azure/network/disable-rdp-from-internet/#suggested-resolution","text":"Block RDP port from internet","title":"Suggested Resolution"},{"location":"checks/azure/network/disable-rdp-from-internet/#insecure-example","text":"The following example will fail the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } }","title":"Insecure Example"},{"location":"checks/azure/network/disable-rdp-from-internet/#secure-example","text":"The following example will pass the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } }","title":"Secure Example"},{"location":"checks/azure/network/disable-rdp-from-internet/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges https://docs.microsoft.com/en-us/azure/bastion/tutorial-create-host-portal","title":"Related Links"},{"location":"checks/azure/network/no-public-egress/","text":"Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets. Possible Impact The port is exposed for egress to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Outbound\" destination_address_prefix = \"0.0.0.0/0\" access = \"Allow\" } Secure Example The following example will pass the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Outbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices","title":"no-public-egress"},{"location":"checks/azure/network/no-public-egress/#explanation","text":"Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets.","title":"Explanation"},{"location":"checks/azure/network/no-public-egress/#possible-impact","text":"The port is exposed for egress to the internet","title":"Possible Impact"},{"location":"checks/azure/network/no-public-egress/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/azure/network/no-public-egress/#insecure-example","text":"The following example will fail the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Outbound\" destination_address_prefix = \"0.0.0.0/0\" access = \"Allow\" }","title":"Insecure Example"},{"location":"checks/azure/network/no-public-egress/#secure-example","text":"The following example will pass the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Outbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" }","title":"Secure Example"},{"location":"checks/azure/network/no-public-egress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices","title":"Related Links"},{"location":"checks/azure/network/no-public-ingress/","text":"Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Inbound\" source_address_prefix = \"0.0.0.0/0\" access = \"Allow\" } Secure Example The following example will pass the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Inbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices","title":"no-public-ingress"},{"location":"checks/azure/network/no-public-ingress/#explanation","text":"Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets.","title":"Explanation"},{"location":"checks/azure/network/no-public-ingress/#possible-impact","text":"The port is exposed for ingress from the internet","title":"Possible Impact"},{"location":"checks/azure/network/no-public-ingress/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/azure/network/no-public-ingress/#insecure-example","text":"The following example will fail the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Inbound\" source_address_prefix = \"0.0.0.0/0\" access = \"Allow\" }","title":"Insecure Example"},{"location":"checks/azure/network/no-public-ingress/#secure-example","text":"The following example will pass the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Inbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" }","title":"Secure Example"},{"location":"checks/azure/network/no-public-ingress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices","title":"Related Links"},{"location":"checks/azure/network/retention-policy-set/","text":"Explanation Flow logs are the source of truth for all network activity in your cloud environment. To enable analysis in security event that was detected late, you need to have the logs available. Setting an retention policy will help ensure as much information is available for review. Possible Impact Not enabling retention or having short expiry on flow logs could lead to compromise being undetected limiting time for analysis Suggested Resolution Ensure flow log retention is turned on with an expiry of >90 days Insecure Example The following example will fail the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"bad_watcher\" { network_watcher_name = \"bad_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"good_watcher\" { network_watcher_name = \"good_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 90 } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_watcher_flow_log#retention_policy https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview","title":"retention-policy-set"},{"location":"checks/azure/network/retention-policy-set/#explanation","text":"Flow logs are the source of truth for all network activity in your cloud environment. To enable analysis in security event that was detected late, you need to have the logs available. Setting an retention policy will help ensure as much information is available for review.","title":"Explanation"},{"location":"checks/azure/network/retention-policy-set/#possible-impact","text":"Not enabling retention or having short expiry on flow logs could lead to compromise being undetected limiting time for analysis","title":"Possible Impact"},{"location":"checks/azure/network/retention-policy-set/#suggested-resolution","text":"Ensure flow log retention is turned on with an expiry of >90 days","title":"Suggested Resolution"},{"location":"checks/azure/network/retention-policy-set/#insecure-example","text":"The following example will fail the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"bad_watcher\" { network_watcher_name = \"bad_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 7 } }","title":"Insecure Example"},{"location":"checks/azure/network/retention-policy-set/#secure-example","text":"The following example will pass the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"good_watcher\" { network_watcher_name = \"good_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 90 } }","title":"Secure Example"},{"location":"checks/azure/network/retention-policy-set/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_watcher_flow_log#retention_policy https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview","title":"Related Links"},{"location":"checks/azure/network/ssh-blocked-from-internet/","text":"Explanation SSH access can be configured on either the network security group or in the network security group rule. SSH access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any) Possible Impact Its dangerous to allow SSH access from the internet Suggested Resolution Block port 22 access from the internet Insecure Example The following example will fail the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"22\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"22\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } } Secure Example The following example will pass the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"22\" ] source_address_prefix = \"82.102.23.23\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"22\" ] source_address_prefix = \"82.102.23.23\" destination_address_prefix = \"*\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges","title":"ssh-blocked-from-internet"},{"location":"checks/azure/network/ssh-blocked-from-internet/#explanation","text":"SSH access can be configured on either the network security group or in the network security group rule. SSH access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any)","title":"Explanation"},{"location":"checks/azure/network/ssh-blocked-from-internet/#possible-impact","text":"Its dangerous to allow SSH access from the internet","title":"Possible Impact"},{"location":"checks/azure/network/ssh-blocked-from-internet/#suggested-resolution","text":"Block port 22 access from the internet","title":"Suggested Resolution"},{"location":"checks/azure/network/ssh-blocked-from-internet/#insecure-example","text":"The following example will fail the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"22\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"22\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } }","title":"Insecure Example"},{"location":"checks/azure/network/ssh-blocked-from-internet/#secure-example","text":"The following example will pass the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = [ \"22\" ] source_address_prefix = \"82.102.23.23\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_range = [ \"22\" ] source_address_prefix = \"82.102.23.23\" destination_address_prefix = \"*\" } }","title":"Secure Example"},{"location":"checks/azure/network/ssh-blocked-from-internet/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges","title":"Related Links"},{"location":"checks/azure/security-center/alert-on-severe-notifications/","text":"Explanation It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident using email and require alerting to be turned on. Possible Impact The ability to react to high severity notifications could be delayed Suggested Resolution Set alert notifications to be on Insecure Example The following example will fail the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = false alerts_to_admins = false } Secure Example The following example will pass the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#alert_notifications https://azure.microsoft.com/en-us/services/security-center/","title":"alert-on-severe-notifications"},{"location":"checks/azure/security-center/alert-on-severe-notifications/#explanation","text":"It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident using email and require alerting to be turned on.","title":"Explanation"},{"location":"checks/azure/security-center/alert-on-severe-notifications/#possible-impact","text":"The ability to react to high severity notifications could be delayed","title":"Possible Impact"},{"location":"checks/azure/security-center/alert-on-severe-notifications/#suggested-resolution","text":"Set alert notifications to be on","title":"Suggested Resolution"},{"location":"checks/azure/security-center/alert-on-severe-notifications/#insecure-example","text":"The following example will fail the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = false alerts_to_admins = false }","title":"Insecure Example"},{"location":"checks/azure/security-center/alert-on-severe-notifications/#secure-example","text":"The following example will pass the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true }","title":"Secure Example"},{"location":"checks/azure/security-center/alert-on-severe-notifications/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#alert_notifications https://azure.microsoft.com/en-us/services/security-center/","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-appservices/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Possible Impact Azure Defender for App Service detects attacks targeting applications running over App Service. Suggested Resolution Enable AppServices in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-appservices check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-appservices check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,AppServices\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-app-service-introduction","title":"defender-on-appservices"},{"location":"checks/azure/security-center/defender-on-appservices/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded).","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-appservices/#possible-impact","text":"Azure Defender for App Service detects attacks targeting applications running over App Service.","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-appservices/#suggested-resolution","text":"Enable AppServices in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-appservices/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-appservices check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-appservices/#secure-example","text":"The following example will pass the azure-security-center-defender-on-appservices check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,AppServices\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-appservices/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-app-service-introduction","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-container-registry/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Azure Defender for container registries includes a vulnerability scanner to scan the images in Azure Resource Manager-based Azure Container Registry registries and provide deeper visibility image vulnerabilities. Possible Impact Not enabling defender for container registries could lead to compromised account Suggested Resolution Enable ContainerRegistry in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-container-registry check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-container-registry check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,ContainerRegistry\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-container-registries-introduction","title":"defender-on-container-registry"},{"location":"checks/azure/security-center/defender-on-container-registry/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Azure Defender for container registries includes a vulnerability scanner to scan the images in Azure Resource Manager-based Azure Container Registry registries and provide deeper visibility image vulnerabilities.","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-container-registry/#possible-impact","text":"Not enabling defender for container registries could lead to compromised account","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-container-registry/#suggested-resolution","text":"Enable ContainerRegistry in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-container-registry/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-container-registry check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-container-registry/#secure-example","text":"The following example will pass the azure-security-center-defender-on-container-registry check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,ContainerRegistry\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-container-registry/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-container-registries-introduction","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-keyvault/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Azure Defender detects unusual and potentially harmful attempts to access or exploit Key Vault accounts. Resource Manager-based Azure Container Registry registries and provide deeper visibility image vulnerabilities. Possible Impact Azure Defender detects unusual and potentially harmful attempts to access or exploit Key Vault accounts. Suggested Resolution Enable KeyVaults in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-keyvault check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-keyvault check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,KeyVaults\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-key-vault-introduction","title":"defender-on-keyvault"},{"location":"checks/azure/security-center/defender-on-keyvault/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Azure Defender detects unusual and potentially harmful attempts to access or exploit Key Vault accounts. Resource Manager-based Azure Container Registry registries and provide deeper visibility image vulnerabilities.","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-keyvault/#possible-impact","text":"Azure Defender detects unusual and potentially harmful attempts to access or exploit Key Vault accounts.","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-keyvault/#suggested-resolution","text":"Enable KeyVaults in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-keyvault/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-keyvault check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-keyvault/#secure-example","text":"The following example will pass the azure-security-center-defender-on-keyvault check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,KeyVaults\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-keyvault/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-key-vault-introduction","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-kubernetes/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Azure Defender for Kubernetes provides cluster-level threat protection by monitoring your AKS-managed services through the logs retrieved by Azure Kubernetes Service (AKS). Possible Impact Not enabling defender for container registries could lead to compromised account Suggested Resolution Enable KubernetesService in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-kubernetes check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-kubernetes check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,KubernetesService\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-kubernetes-introduction","title":"defender-on-kubernetes"},{"location":"checks/azure/security-center/defender-on-kubernetes/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Azure Defender for Kubernetes provides cluster-level threat protection by monitoring your AKS-managed services through the logs retrieved by Azure Kubernetes Service (AKS).","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-kubernetes/#possible-impact","text":"Not enabling defender for container registries could lead to compromised account","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-kubernetes/#suggested-resolution","text":"Enable KubernetesService in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-kubernetes/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-kubernetes check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-kubernetes/#secure-example","text":"The following example will pass the azure-security-center-defender-on-kubernetes check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,KubernetesService\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-kubernetes/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-kubernetes-introduction","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-servers/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Possible Impact Azure Defender for servers adds threat detection and advanced defenses for Windows and Linux machines. Suggested Resolution Enable VirtualMachines in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-servers check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"AppServices\" } Secure Example The following example will pass the azure-security-center-defender-on-servers check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"AppServices,VirtualMachines\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-servers-introduction","title":"defender-on-servers"},{"location":"checks/azure/security-center/defender-on-servers/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded).","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-servers/#possible-impact","text":"Azure Defender for servers adds threat detection and advanced defenses for Windows and Linux machines.","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-servers/#suggested-resolution","text":"Enable VirtualMachines in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-servers/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-servers check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"AppServices\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-servers/#secure-example","text":"The following example will pass the azure-security-center-defender-on-servers check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"AppServices,VirtualMachines\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-servers/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-servers-introduction","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Possible Impact Azure Defender for SQL servers on machines extends the protections for your Azure-native SQL Servers to fully support hybrid environments and protect SQL servers (all supported version) hosted in Azure. Suggested Resolution Enable ContainerRegistry in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-sql-servers-vms check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-sql-servers-vms check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,SqlServerVirtualMachines\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-usage","title":"defender-on-sql-servers-vms"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded).","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/#possible-impact","text":"Azure Defender for SQL servers on machines extends the protections for your Azure-native SQL Servers to fully support hybrid environments and protect SQL servers (all supported version) hosted in Azure.","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/#suggested-resolution","text":"Enable ContainerRegistry in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-sql-servers-vms check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/#secure-example","text":"The following example will pass the azure-security-center-defender-on-sql-servers-vms check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,SqlServerVirtualMachines\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-sql-servers-vms/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-usage","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-sql-servers/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Possible Impact Azure Defender for SQL servers on machines extends the protections for your Azure-native SQL Servers to fully support hybrid environments and protect SQL servers (all supported version) hosted in Azure Suggested Resolution Enable SqlServers in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-sql-servers check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-sql-servers check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,SqlServers\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-introduction","title":"defender-on-sql-servers"},{"location":"checks/azure/security-center/defender-on-sql-servers/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded).","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-sql-servers/#possible-impact","text":"Azure Defender for SQL servers on machines extends the protections for your Azure-native SQL Servers to fully support hybrid environments and protect SQL servers (all supported version) hosted in Azure","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-sql-servers/#suggested-resolution","text":"Enable SqlServers in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-sql-servers/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-sql-servers check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-sql-servers/#secure-example","text":"The following example will pass the azure-security-center-defender-on-sql-servers check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,SqlServers\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-sql-servers/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-introduction","title":"Related Links"},{"location":"checks/azure/security-center/defender-on-storage/","text":"Explanation Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded). Possible Impact Azure Defender for Storage detects unusual and potentially harmful attempts to access or exploit storage accounts. Suggested Resolution Enable StorageAccounts in Azure Defender Insecure Example The following example will fail the azure-security-center-defender-on-storage check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-defender-on-storage check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,StorageAccounts\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-storage-introduction","title":"defender-on-storage"},{"location":"checks/azure/security-center/defender-on-storage/#explanation","text":"Azure Defender is a cloud workload protection service that utilizes and agent-based deployment to analyze signals from Azure network fabric and the service control plane, to detect threats across all Azure resources. It can also analyze non-Azure resources, utilizing Azure Arc, including those on-premises and in both AWS and GCP (once they've been onboarded).","title":"Explanation"},{"location":"checks/azure/security-center/defender-on-storage/#possible-impact","text":"Azure Defender for Storage detects unusual and potentially harmful attempts to access or exploit storage accounts.","title":"Possible Impact"},{"location":"checks/azure/security-center/defender-on-storage/#suggested-resolution","text":"Enable StorageAccounts in Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/defender-on-storage/#insecure-example","text":"The following example will fail the azure-security-center-defender-on-storage check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/defender-on-storage/#secure-example","text":"The following example will pass the azure-security-center-defender-on-storage check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines,StorageAccounts\" }","title":"Secure Example"},{"location":"checks/azure/security-center/defender-on-storage/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#resource_type https://docs.microsoft.com/en-us/azure/security-center/defender-for-storage-introduction","title":"Related Links"},{"location":"checks/azure/security-center/enable-standard-subscription/","text":"Explanation To benefit from Azure Defender you should use the Standard subscription tier. Enabling Azure Defender extends the capabilities of the free mode to workloads running in private and other public clouds, providing unified security management and threat protection across your hybrid cloud workloads. Possible Impact Using free subscription does not enable Azure Defender for the resource type Suggested Resolution Enable standard subscription tier to benefit from Azure Defender Insecure Example The following example will fail the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#tier https://docs.microsoft.com/en-us/azure/security-center/security-center-pricing","title":"enable-standard-subscription"},{"location":"checks/azure/security-center/enable-standard-subscription/#explanation","text":"To benefit from Azure Defender you should use the Standard subscription tier. Enabling Azure Defender extends the capabilities of the free mode to workloads running in private and other public clouds, providing unified security management and threat protection across your hybrid cloud workloads.","title":"Explanation"},{"location":"checks/azure/security-center/enable-standard-subscription/#possible-impact","text":"Using free subscription does not enable Azure Defender for the resource type","title":"Possible Impact"},{"location":"checks/azure/security-center/enable-standard-subscription/#suggested-resolution","text":"Enable standard subscription tier to benefit from Azure Defender","title":"Suggested Resolution"},{"location":"checks/azure/security-center/enable-standard-subscription/#insecure-example","text":"The following example will fail the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }","title":"Insecure Example"},{"location":"checks/azure/security-center/enable-standard-subscription/#secure-example","text":"The following example will pass the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines\" }","title":"Secure Example"},{"location":"checks/azure/security-center/enable-standard-subscription/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#tier https://docs.microsoft.com/en-us/azure/security-center/security-center-pricing","title":"Related Links"},{"location":"checks/azure/security-center/set-required-contact-details/","text":"Explanation It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident and will look to use a telephone number in cases where a prompt response is required. Possible Impact Without a telephone number set, Azure support can't contact Suggested Resolution Set a telephone number for security center contact Insecure Example The following example will fail the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_contact@example.com\" phone = \"\" alert_notifications = true alerts_to_admins = true } Secure Example The following example will pass the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_contact@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#phone https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#email https://azure.microsoft.com/en-us/services/security-center/","title":"set-required-contact-details"},{"location":"checks/azure/security-center/set-required-contact-details/#explanation","text":"It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident and will look to use a telephone number in cases where a prompt response is required.","title":"Explanation"},{"location":"checks/azure/security-center/set-required-contact-details/#possible-impact","text":"Without a telephone number set, Azure support can't contact","title":"Possible Impact"},{"location":"checks/azure/security-center/set-required-contact-details/#suggested-resolution","text":"Set a telephone number for security center contact","title":"Suggested Resolution"},{"location":"checks/azure/security-center/set-required-contact-details/#insecure-example","text":"The following example will fail the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_contact@example.com\" phone = \"\" alert_notifications = true alerts_to_admins = true }","title":"Insecure Example"},{"location":"checks/azure/security-center/set-required-contact-details/#secure-example","text":"The following example will pass the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_contact@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true }","title":"Secure Example"},{"location":"checks/azure/security-center/set-required-contact-details/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#phone https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#email https://azure.microsoft.com/en-us/services/security-center/","title":"Related Links"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/","text":"Explanation Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules Possible Impact Trusted Microsoft Services won't be able to access storage account unless rules set to allow Suggested Resolution Allow Trusted Microsoft Services to bypass Insecure Example The following example will fail the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] } Secure Example The following example will pass the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\", \"AzureServices\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\", \"AzureServices\" ] } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#bypass https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#bypass https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security#trusted-microsoft-services","title":"allow-microsoft-service-bypass"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/#explanation","text":"Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules","title":"Explanation"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/#possible-impact","text":"Trusted Microsoft Services won't be able to access storage account unless rules set to allow","title":"Possible Impact"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/#suggested-resolution","text":"Allow Trusted Microsoft Services to bypass","title":"Suggested Resolution"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/#insecure-example","text":"The following example will fail the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] }","title":"Insecure Example"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/#secure-example","text":"The following example will pass the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\", \"AzureServices\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\", \"AzureServices\" ] }","title":"Secure Example"},{"location":"checks/azure/storage/allow-microsoft-service-bypass/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#bypass https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#bypass https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security#trusted-microsoft-services","title":"Related Links"},{"location":"checks/azure/storage/container-activity-logs-not-public/","text":"Explanation Anonymous, public read access to a container and its blobs can be enabled in Azure Blob storage. It grants read-only access to these resources without sharing the account key or requiring a shared access signature. We recommend you do not provide anonymous access to blob containers until, and unless, it is strongly desired. A shared access signature token should be used for providing controlled and timed access to blob containers. Possible Impact Data in the storage container could be exposed publicly Suggested Resolution Disable public access to storage containers Insecure Example The following example will fail the azure-storage-container-activity-logs-not-public check. resource \"azurerm_storage_container\" \"bad_example\" { name = \"terraform-container-storage\" container_access_type = \"public\" } Secure Example The following example will pass the azure-storage-container-activity-logs-not-public check. resource \"azurerm_storage_container\" \"good_example\" { name = \"terraform-container-storage\" container_access_type = \"private\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_container#container_access_type","title":"container-activity-logs-not-public"},{"location":"checks/azure/storage/container-activity-logs-not-public/#explanation","text":"Anonymous, public read access to a container and its blobs can be enabled in Azure Blob storage. It grants read-only access to these resources without sharing the account key or requiring a shared access signature. We recommend you do not provide anonymous access to blob containers until, and unless, it is strongly desired. A shared access signature token should be used for providing controlled and timed access to blob containers.","title":"Explanation"},{"location":"checks/azure/storage/container-activity-logs-not-public/#possible-impact","text":"Data in the storage container could be exposed publicly","title":"Possible Impact"},{"location":"checks/azure/storage/container-activity-logs-not-public/#suggested-resolution","text":"Disable public access to storage containers","title":"Suggested Resolution"},{"location":"checks/azure/storage/container-activity-logs-not-public/#insecure-example","text":"The following example will fail the azure-storage-container-activity-logs-not-public check. resource \"azurerm_storage_container\" \"bad_example\" { name = \"terraform-container-storage\" container_access_type = \"public\" }","title":"Insecure Example"},{"location":"checks/azure/storage/container-activity-logs-not-public/#secure-example","text":"The following example will pass the azure-storage-container-activity-logs-not-public check. resource \"azurerm_storage_container\" \"good_example\" { name = \"terraform-container-storage\" container_access_type = \"private\" }","title":"Secure Example"},{"location":"checks/azure/storage/container-activity-logs-not-public/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_container#container_access_type","title":"Related Links"},{"location":"checks/azure/storage/default-action-deny/","text":"Explanation The default_action for network rules should come into effect when no other rules are matched. The default action should be set to Deny. Possible Impact Network rules that allow could cause data to be exposed publicly Suggested Resolution Set network rules to deny Insecure Example The following example will fail the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"bad_example\" { default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] } Secure Example The following example will pass the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"good_example\" { default_action = \"Deny\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#default_action https://docs.microsoft.com/en-us/azure/firewall/rule-processing","title":"default-action-deny"},{"location":"checks/azure/storage/default-action-deny/#explanation","text":"The default_action for network rules should come into effect when no other rules are matched. The default action should be set to Deny.","title":"Explanation"},{"location":"checks/azure/storage/default-action-deny/#possible-impact","text":"Network rules that allow could cause data to be exposed publicly","title":"Possible Impact"},{"location":"checks/azure/storage/default-action-deny/#suggested-resolution","text":"Set network rules to deny","title":"Suggested Resolution"},{"location":"checks/azure/storage/default-action-deny/#insecure-example","text":"The following example will fail the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"bad_example\" { default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] }","title":"Insecure Example"},{"location":"checks/azure/storage/default-action-deny/#secure-example","text":"The following example will pass the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"good_example\" { default_action = \"Deny\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] }","title":"Secure Example"},{"location":"checks/azure/storage/default-action-deny/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#default_action https://docs.microsoft.com/en-us/azure/firewall/rule-processing","title":"Related Links"},{"location":"checks/azure/storage/enforce-https/","text":"Explanation You can configure your storage account to accept requests from secure connections only by setting the Secure transfer required property for the storage account. When you require secure transfer, any requests originating from an insecure connection are rejected. Microsoft recommends that you always require secure transfer for all of your storage accounts. Possible Impact Insecure transfer of data into secure accounts could be read if intercepted Suggested Resolution Only allow secure connection for transferring data into storage accounts Insecure Example The following example will fail the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = false } Secure Example The following example will pass the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = true } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#enable_https_traffic_only https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer","title":"enforce-https"},{"location":"checks/azure/storage/enforce-https/#explanation","text":"You can configure your storage account to accept requests from secure connections only by setting the Secure transfer required property for the storage account. When you require secure transfer, any requests originating from an insecure connection are rejected. Microsoft recommends that you always require secure transfer for all of your storage accounts.","title":"Explanation"},{"location":"checks/azure/storage/enforce-https/#possible-impact","text":"Insecure transfer of data into secure accounts could be read if intercepted","title":"Possible Impact"},{"location":"checks/azure/storage/enforce-https/#suggested-resolution","text":"Only allow secure connection for transferring data into storage accounts","title":"Suggested Resolution"},{"location":"checks/azure/storage/enforce-https/#insecure-example","text":"The following example will fail the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = false }","title":"Insecure Example"},{"location":"checks/azure/storage/enforce-https/#secure-example","text":"The following example will pass the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = true }","title":"Secure Example"},{"location":"checks/azure/storage/enforce-https/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#enable_https_traffic_only https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer","title":"Related Links"},{"location":"checks/azure/storage/no-public-access/","text":"Explanation Storage container public access should be off. It can be configured for blobs only, containers and blobs or off entirely. The default is off, with no public access. Explicitly overriding publicAccess to anything other than off should be avoided. Possible Impact Data in the storage container could be exposed publicly Suggested Resolution Disable public access to storage containers Insecure Example The following example will fail the azure-storage-no-public-access check. resource \"azure_storage_container\" \"bad_example\" { name = \"terraform-container-storage\" container_access_type = \"blob\" properties = { \"publicAccess\" = \"blob\" } } Secure Example The following example will pass the azure-storage-no-public-access check. resource \"azure_storage_container\" \"good_example\" { name = \"terraform-container-storage\" container_access_type = \"blob\" properties = { \"publicAccess\" = \"off\" } } Related Links https://www.terraform.io/docs/providers/azure/r/storage_container.html#properties https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure?tabs=portal#set-the-public-access-level-for-a-container","title":"no-public-access"},{"location":"checks/azure/storage/no-public-access/#explanation","text":"Storage container public access should be off. It can be configured for blobs only, containers and blobs or off entirely. The default is off, with no public access. Explicitly overriding publicAccess to anything other than off should be avoided.","title":"Explanation"},{"location":"checks/azure/storage/no-public-access/#possible-impact","text":"Data in the storage container could be exposed publicly","title":"Possible Impact"},{"location":"checks/azure/storage/no-public-access/#suggested-resolution","text":"Disable public access to storage containers","title":"Suggested Resolution"},{"location":"checks/azure/storage/no-public-access/#insecure-example","text":"The following example will fail the azure-storage-no-public-access check. resource \"azure_storage_container\" \"bad_example\" { name = \"terraform-container-storage\" container_access_type = \"blob\" properties = { \"publicAccess\" = \"blob\" } }","title":"Insecure Example"},{"location":"checks/azure/storage/no-public-access/#secure-example","text":"The following example will pass the azure-storage-no-public-access check. resource \"azure_storage_container\" \"good_example\" { name = \"terraform-container-storage\" container_access_type = \"blob\" properties = { \"publicAccess\" = \"off\" } }","title":"Secure Example"},{"location":"checks/azure/storage/no-public-access/#related-links","text":"https://www.terraform.io/docs/providers/azure/r/storage_container.html#properties https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure?tabs=portal#set-the-public-access-level-for-a-container","title":"Related Links"},{"location":"checks/azure/storage/queue-services-logging-enabled/","text":"Explanation Storage Analytics logs detailed information about successful and failed requests to a storage service. This information can be used to monitor individual requests and to diagnose issues with a storage service. Requests are logged on a best-effort basis. Possible Impact Logging provides valuable information about access and usage Suggested Resolution Enable logging for Queue Services Insecure Example The following example will fail the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { } } Secure Example The following example will pass the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"good_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { logging { delete = true read = true write = true version = \"1.0\" retention_policy_days = 10 } } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#logging https://docs.microsoft.com/en-us/azure/storage/common/storage-analytics-logging?tabs=dotnet","title":"queue-services-logging-enabled"},{"location":"checks/azure/storage/queue-services-logging-enabled/#explanation","text":"Storage Analytics logs detailed information about successful and failed requests to a storage service. This information can be used to monitor individual requests and to diagnose issues with a storage service. Requests are logged on a best-effort basis.","title":"Explanation"},{"location":"checks/azure/storage/queue-services-logging-enabled/#possible-impact","text":"Logging provides valuable information about access and usage","title":"Possible Impact"},{"location":"checks/azure/storage/queue-services-logging-enabled/#suggested-resolution","text":"Enable logging for Queue Services","title":"Suggested Resolution"},{"location":"checks/azure/storage/queue-services-logging-enabled/#insecure-example","text":"The following example will fail the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { } }","title":"Insecure Example"},{"location":"checks/azure/storage/queue-services-logging-enabled/#secure-example","text":"The following example will pass the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"good_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { logging { delete = true read = true write = true version = \"1.0\" retention_policy_days = 10 } } }","title":"Secure Example"},{"location":"checks/azure/storage/queue-services-logging-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#logging https://docs.microsoft.com/en-us/azure/storage/common/storage-analytics-logging?tabs=dotnet","title":"Related Links"},{"location":"checks/azure/storage/use-secure-tls-policy/","text":"Explanation Azure Storage currently supports three versions of the TLS protocol: 1.0, 1.1, and 1.2. Azure Storage uses TLS 1.2 on public HTTPS endpoints, but TLS 1.0 and TLS 1.1 are still supported for backward compatibility. This check will warn if the minimum TLS is not set to TLS1_2. Possible Impact The TLS version being outdated and has known vulnerabilities Suggested Resolution Use a more recent TLS/SSL policy for the load balancer Insecure Example The following example will fail the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location } Secure Example The following example will pass the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location min_tls_version = \"TLS1_2\" } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#min_tls_version https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version","title":"use-secure-tls-policy"},{"location":"checks/azure/storage/use-secure-tls-policy/#explanation","text":"Azure Storage currently supports three versions of the TLS protocol: 1.0, 1.1, and 1.2. Azure Storage uses TLS 1.2 on public HTTPS endpoints, but TLS 1.0 and TLS 1.1 are still supported for backward compatibility. This check will warn if the minimum TLS is not set to TLS1_2.","title":"Explanation"},{"location":"checks/azure/storage/use-secure-tls-policy/#possible-impact","text":"The TLS version being outdated and has known vulnerabilities","title":"Possible Impact"},{"location":"checks/azure/storage/use-secure-tls-policy/#suggested-resolution","text":"Use a more recent TLS/SSL policy for the load balancer","title":"Suggested Resolution"},{"location":"checks/azure/storage/use-secure-tls-policy/#insecure-example","text":"The following example will fail the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location }","title":"Insecure Example"},{"location":"checks/azure/storage/use-secure-tls-policy/#secure-example","text":"The following example will pass the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location min_tls_version = \"TLS1_2\" }","title":"Secure Example"},{"location":"checks/azure/storage/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#min_tls_version https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version","title":"Related Links"},{"location":"checks/azure/synapse/virtual-network-enabled/","text":"Explanation Synapse Workspace does not have managed virtual network enabled by default. When you create your Azure Synapse workspace, you can choose to associate it to a Microsoft Azure Virtual Network. The Virtual Network associated with your workspace is managed by Azure Synapse. This Virtual Network is called a Managed workspace Virtual Network. Managed private endpoints are private endpoints created in a Managed Virtual Network associated with your Azure Synapse workspace. Managed private endpoints establish a private link to Azure resources. You can only use private links in a workspace that has a Managed workspace Virtual Network. Possible Impact Your Synapse workspace is not using the private endpoints Suggested Resolution Set manage virtual network to enabled Insecure Example The following example will fail the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"bad_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } } Secure Example The following example will pass the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"good_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" managed_virtual_network_enabled = true aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } } Related Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/synapse_workspace#managed_virtual_network_enabled https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-private-endpoints https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-vnet","title":"virtual-network-enabled"},{"location":"checks/azure/synapse/virtual-network-enabled/#explanation","text":"Synapse Workspace does not have managed virtual network enabled by default. When you create your Azure Synapse workspace, you can choose to associate it to a Microsoft Azure Virtual Network. The Virtual Network associated with your workspace is managed by Azure Synapse. This Virtual Network is called a Managed workspace Virtual Network. Managed private endpoints are private endpoints created in a Managed Virtual Network associated with your Azure Synapse workspace. Managed private endpoints establish a private link to Azure resources. You can only use private links in a workspace that has a Managed workspace Virtual Network.","title":"Explanation"},{"location":"checks/azure/synapse/virtual-network-enabled/#possible-impact","text":"Your Synapse workspace is not using the private endpoints","title":"Possible Impact"},{"location":"checks/azure/synapse/virtual-network-enabled/#suggested-resolution","text":"Set manage virtual network to enabled","title":"Suggested Resolution"},{"location":"checks/azure/synapse/virtual-network-enabled/#insecure-example","text":"The following example will fail the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"bad_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } }","title":"Insecure Example"},{"location":"checks/azure/synapse/virtual-network-enabled/#secure-example","text":"The following example will pass the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"good_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" managed_virtual_network_enabled = true aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } }","title":"Secure Example"},{"location":"checks/azure/synapse/virtual-network-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/synapse_workspace#managed_virtual_network_enabled https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-private-endpoints https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-vnet","title":"Related Links"},{"location":"checks/cloudstack/home/","text":"The included Cloudstack checks are listed below. For more information about each check, see the link provided. Checks cloudstack-compute-no-sensitive-info No sensitive data stored in user_data","title":"cloudstack"},{"location":"checks/cloudstack/compute/no-sensitive-info/","text":"Explanation When creating instances, user data can be used during the initial configuration. User data must not contain sensitive information Possible Impact Sensitive credentials in the user data can be leaked Suggested Resolution Don't use sensitive data in the user data section Insecure Example The following example will fail the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = <<EOF export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } Secure Example The following example will pass the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = <<EOF export GREETING = \"Hello there\" EOF } Related Links https://registry.terraform.io/providers/hashicorp/cloudstack/latest/docs/resources/instance#","title":"no-sensitive-info"},{"location":"checks/cloudstack/compute/no-sensitive-info/#explanation","text":"When creating instances, user data can be used during the initial configuration. User data must not contain sensitive information","title":"Explanation"},{"location":"checks/cloudstack/compute/no-sensitive-info/#possible-impact","text":"Sensitive credentials in the user data can be leaked","title":"Possible Impact"},{"location":"checks/cloudstack/compute/no-sensitive-info/#suggested-resolution","text":"Don't use sensitive data in the user data section","title":"Suggested Resolution"},{"location":"checks/cloudstack/compute/no-sensitive-info/#insecure-example","text":"The following example will fail the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = <<EOF export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF }","title":"Insecure Example"},{"location":"checks/cloudstack/compute/no-sensitive-info/#secure-example","text":"The following example will pass the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = <<EOF export GREETING = \"Hello there\" EOF }","title":"Secure Example"},{"location":"checks/cloudstack/compute/no-sensitive-info/#related-links","text":"https://registry.terraform.io/providers/hashicorp/cloudstack/latest/docs/resources/instance#","title":"Related Links"},{"location":"checks/digitalocean/home/","text":"The included Digital Ocean checks are listed below. For more information about each check, see the link provided. Checks digitalocean-compute-no-public-egress The firewall has an outbound rule with open access digitalocean-compute-no-public-ingress The firewall has an inbound rule with open access digitalocean-droplet-use-ssh-keys SSH Keys are the preferred way to connect to your droplet, no keys are supplied digitalocean-loadbalancing-enforce-https The load balancer forwarding rule is using an insecure protocol as an entrypoint digitalocean-spaces-acl-no-public-read Spaces bucket or bucket object has public read acl set digitalocean-spaces-disable-force-destroy Force destroy is enabled on Spaces bucket which is dangerous digitalocean-spaces-versioning-enabled Spaces buckets should have versioning enabled","title":"digitalocean"},{"location":"checks/digitalocean/compute/no-public-egress/","text":"Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } } Secure Example The following example will pass the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"192.168.1.0/24\", \"2002:1:2::/48\" ] } } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/","title":"no-public-egress"},{"location":"checks/digitalocean/compute/no-public-egress/#explanation","text":"Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/digitalocean/compute/no-public-egress/#possible-impact","text":"The port is exposed for ingress from the internet","title":"Possible Impact"},{"location":"checks/digitalocean/compute/no-public-egress/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/digitalocean/compute/no-public-egress/#insecure-example","text":"The following example will fail the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } }","title":"Insecure Example"},{"location":"checks/digitalocean/compute/no-public-egress/#secure-example","text":"The following example will pass the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"192.168.1.0/24\", \"2002:1:2::/48\" ] } }","title":"Secure Example"},{"location":"checks/digitalocean/compute/no-public-egress/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/","title":"Related Links"},{"location":"checks/digitalocean/compute/no-public-ingress/","text":"Explanation Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible. Possible Impact Your port is exposed to the internet Suggested Resolution Set a more restrictive CIRDR range Insecure Example The following example will fail the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } } Secure Example The following example will pass the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"192.168.1.0/24\", \"2002:1:2::/48\" ] } } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/","title":"no-public-ingress"},{"location":"checks/digitalocean/compute/no-public-ingress/#explanation","text":"Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible.","title":"Explanation"},{"location":"checks/digitalocean/compute/no-public-ingress/#possible-impact","text":"Your port is exposed to the internet","title":"Possible Impact"},{"location":"checks/digitalocean/compute/no-public-ingress/#suggested-resolution","text":"Set a more restrictive CIRDR range","title":"Suggested Resolution"},{"location":"checks/digitalocean/compute/no-public-ingress/#insecure-example","text":"The following example will fail the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } }","title":"Insecure Example"},{"location":"checks/digitalocean/compute/no-public-ingress/#secure-example","text":"The following example will pass the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"192.168.1.0/24\", \"2002:1:2::/48\" ] } }","title":"Secure Example"},{"location":"checks/digitalocean/compute/no-public-ingress/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/","title":"Related Links"},{"location":"checks/digitalocean/droplet/use-ssh-keys/","text":"Explanation When working with a server, you\u2019ll likely spend most of your time in a terminal session connected to your server through SSH. A more secure alternative to password-based logins, SSH keys use encryption to provide a secure way of logging into your server and are recommended for all users. Possible Impact Logging in with username and password is easier to compromise Suggested Resolution Use ssh keys for login Insecure Example The following example will fail the digitalocean-droplet-use-ssh-keys check. resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" } Secure Example The following example will pass the digitalocean-droplet-use-ssh-keys check. data \"digitalocean_ssh_key\" \"terraform\" { name = \"myKey\" } resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" ssh_keys = [ data.digitalocean_ssh_key.myKey.id ] } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet#ssh_keys https://www.digitalocean.com/community/tutorials/understanding-the-ssh-encryption-and-connection-process","title":"use-ssh-keys"},{"location":"checks/digitalocean/droplet/use-ssh-keys/#explanation","text":"When working with a server, you\u2019ll likely spend most of your time in a terminal session connected to your server through SSH. A more secure alternative to password-based logins, SSH keys use encryption to provide a secure way of logging into your server and are recommended for all users.","title":"Explanation"},{"location":"checks/digitalocean/droplet/use-ssh-keys/#possible-impact","text":"Logging in with username and password is easier to compromise","title":"Possible Impact"},{"location":"checks/digitalocean/droplet/use-ssh-keys/#suggested-resolution","text":"Use ssh keys for login","title":"Suggested Resolution"},{"location":"checks/digitalocean/droplet/use-ssh-keys/#insecure-example","text":"The following example will fail the digitalocean-droplet-use-ssh-keys check. resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" }","title":"Insecure Example"},{"location":"checks/digitalocean/droplet/use-ssh-keys/#secure-example","text":"The following example will pass the digitalocean-droplet-use-ssh-keys check. data \"digitalocean_ssh_key\" \"terraform\" { name = \"myKey\" } resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" ssh_keys = [ data.digitalocean_ssh_key.myKey.id ] }","title":"Secure Example"},{"location":"checks/digitalocean/droplet/use-ssh-keys/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet#ssh_keys https://www.digitalocean.com/community/tutorials/understanding-the-ssh-encryption-and-connection-process","title":"Related Links"},{"location":"checks/digitalocean/loadbalancing/enforce-https/","text":"Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact Your inbound traffic is not protected Suggested Resolution Switch to HTTPS to benefit from TLS security features Insecure Example The following example will fail the digitalocean-loadbalancing-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 80 entry_protocol = \"http\" target_port = 80 target_protocol = \"http\" } droplet_ids = [ digitalocean_droplet.web.id ] } Secure Example The following example will pass the digitalocean-loadbalancing-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 443 entry_protocol = \"https\" target_port = 443 target_protocol = \"https\" } droplet_ids = [ digitalocean_droplet.web.id ] } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/loadbalancer https://docs.digitalocean.com/products/networking/load-balancers/","title":"enforce-https"},{"location":"checks/digitalocean/loadbalancing/enforce-https/#explanation","text":"Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.","title":"Explanation"},{"location":"checks/digitalocean/loadbalancing/enforce-https/#possible-impact","text":"Your inbound traffic is not protected","title":"Possible Impact"},{"location":"checks/digitalocean/loadbalancing/enforce-https/#suggested-resolution","text":"Switch to HTTPS to benefit from TLS security features","title":"Suggested Resolution"},{"location":"checks/digitalocean/loadbalancing/enforce-https/#insecure-example","text":"The following example will fail the digitalocean-loadbalancing-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 80 entry_protocol = \"http\" target_port = 80 target_protocol = \"http\" } droplet_ids = [ digitalocean_droplet.web.id ] }","title":"Insecure Example"},{"location":"checks/digitalocean/loadbalancing/enforce-https/#secure-example","text":"The following example will pass the digitalocean-loadbalancing-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 443 entry_protocol = \"https\" target_port = 443 target_protocol = \"https\" } droplet_ids = [ digitalocean_droplet.web.id ] }","title":"Secure Example"},{"location":"checks/digitalocean/loadbalancing/enforce-https/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/loadbalancer https://docs.digitalocean.com/products/networking/load-balancers/","title":"Related Links"},{"location":"checks/digitalocean/spaces/acl-no-public-read/","text":"Explanation Space bucket and bucket object permissions should be set to deny public access unless explicitly required. Possible Impact The contents of the space can be accessed publicly Suggested Resolution Apply a more restrictive ACL Insecure Example The following example will fail the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"public_space\" region = \"nyc3\" acl = \"public-read\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.bad_example.region bucket = digitalocean_spaces_bucket.bad_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" acl = \"public-read\" } Secure Example The following example will pass the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"private_space\" region = \"nyc3\" acl = \"private\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.good_example.region bucket = digitalocean_spaces_bucket.good_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#acl https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket_object#acl https://docs.digitalocean.com/reference/api/spaces-api/#access-control-lists-acls","title":"acl-no-public-read"},{"location":"checks/digitalocean/spaces/acl-no-public-read/#explanation","text":"Space bucket and bucket object permissions should be set to deny public access unless explicitly required.","title":"Explanation"},{"location":"checks/digitalocean/spaces/acl-no-public-read/#possible-impact","text":"The contents of the space can be accessed publicly","title":"Possible Impact"},{"location":"checks/digitalocean/spaces/acl-no-public-read/#suggested-resolution","text":"Apply a more restrictive ACL","title":"Suggested Resolution"},{"location":"checks/digitalocean/spaces/acl-no-public-read/#insecure-example","text":"The following example will fail the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"public_space\" region = \"nyc3\" acl = \"public-read\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.bad_example.region bucket = digitalocean_spaces_bucket.bad_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" acl = \"public-read\" }","title":"Insecure Example"},{"location":"checks/digitalocean/spaces/acl-no-public-read/#secure-example","text":"The following example will pass the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"private_space\" region = \"nyc3\" acl = \"private\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.good_example.region bucket = digitalocean_spaces_bucket.good_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" }","title":"Secure Example"},{"location":"checks/digitalocean/spaces/acl-no-public-read/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#acl https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket_object#acl https://docs.digitalocean.com/reference/api/spaces-api/#access-control-lists-acls","title":"Related Links"},{"location":"checks/digitalocean/spaces/disable-force-destroy/","text":"Explanation Enabling force destroy on a Spaces bucket means that the bucket can be deleted without the additional check that it is empty. This risks important data being accidentally deleted by a bucket removal process. Possible Impact Accidental deletion of bucket objects Suggested Resolution Don't use force destroy on bucket configuration Insecure Example The following example will fail the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" force_destroy = true } Secure Example The following example will pass the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#force_destroy","title":"disable-force-destroy"},{"location":"checks/digitalocean/spaces/disable-force-destroy/#explanation","text":"Enabling force destroy on a Spaces bucket means that the bucket can be deleted without the additional check that it is empty. This risks important data being accidentally deleted by a bucket removal process.","title":"Explanation"},{"location":"checks/digitalocean/spaces/disable-force-destroy/#possible-impact","text":"Accidental deletion of bucket objects","title":"Possible Impact"},{"location":"checks/digitalocean/spaces/disable-force-destroy/#suggested-resolution","text":"Don't use force destroy on bucket configuration","title":"Suggested Resolution"},{"location":"checks/digitalocean/spaces/disable-force-destroy/#insecure-example","text":"The following example will fail the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" force_destroy = true }","title":"Insecure Example"},{"location":"checks/digitalocean/spaces/disable-force-destroy/#secure-example","text":"The following example will pass the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" }","title":"Secure Example"},{"location":"checks/digitalocean/spaces/disable-force-destroy/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#force_destroy","title":"Related Links"},{"location":"checks/digitalocean/spaces/versioning-enabled/","text":"Explanation Versioning is a means of keeping multiple variants of an object in the same bucket. You can use the Spaces (S3) Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures. Possible Impact Deleted or modified data would not be recoverable Suggested Resolution Enable versioning to protect against accidental or malicious removal or modification Insecure Example The following example will fail the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" } resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = false } } Secure Example The following example will pass the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = true } } Related Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html","title":"versioning-enabled"},{"location":"checks/digitalocean/spaces/versioning-enabled/#explanation","text":"Versioning is a means of keeping multiple variants of an object in the same bucket. You can use the Spaces (S3) Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures.","title":"Explanation"},{"location":"checks/digitalocean/spaces/versioning-enabled/#possible-impact","text":"Deleted or modified data would not be recoverable","title":"Possible Impact"},{"location":"checks/digitalocean/spaces/versioning-enabled/#suggested-resolution","text":"Enable versioning to protect against accidental or malicious removal or modification","title":"Suggested Resolution"},{"location":"checks/digitalocean/spaces/versioning-enabled/#insecure-example","text":"The following example will fail the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" } resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = false } }","title":"Insecure Example"},{"location":"checks/digitalocean/spaces/versioning-enabled/#secure-example","text":"The following example will pass the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = true } }","title":"Secure Example"},{"location":"checks/digitalocean/spaces/versioning-enabled/#related-links","text":"https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html","title":"Related Links"},{"location":"checks/general/home/","text":"The included General checks are listed below. For more information about each check, see the link provided. Checks general-secrets-sensitive-in-attribute Potentially sensitive data stored in block attribute. general-secrets-sensitive-in-attribute-value The attribute has potentially sensitive data, passwords, tokens or keys in it general-secrets-sensitive-in-local Potentially sensitive data stored in local value. general-secrets-sensitive-in-variable Potentially sensitive data stored in \"default\" value of variable.","title":"general"},{"location":"checks/general/secrets/sensitive-in-attribute-value/","text":"Explanation Sensitive data stored in attributes can result in compromised data. Sensitive data should be passed in through secret variables Possible Impact Sensitive credentials may be compromised Suggested Resolution Check the code for vulnerabilities and move to variables Insecure Example The following example will fail the general-secrets-sensitive-in-attribute-value check. resource \"aws_instance\" \"bad_example\" { instance_type = \"t2.small\" user_data = <<EOF Password = \"something secret\" EOF } Secure Example The following example will pass the general-secrets-sensitive-in-attribute-value check. variable \"password\" { type = string } resource \"aws_instance\" \"good_instance\" { instance_type = \"t2.small\" user_data = <<EOF export EDITOR = vimacs EOF } Related Links https://www.terraform.io/docs/state/sensitive-data.html","title":"sensitive-in-attribute-value"},{"location":"checks/general/secrets/sensitive-in-attribute-value/#explanation","text":"Sensitive data stored in attributes can result in compromised data. Sensitive data should be passed in through secret variables","title":"Explanation"},{"location":"checks/general/secrets/sensitive-in-attribute-value/#possible-impact","text":"Sensitive credentials may be compromised","title":"Possible Impact"},{"location":"checks/general/secrets/sensitive-in-attribute-value/#suggested-resolution","text":"Check the code for vulnerabilities and move to variables","title":"Suggested Resolution"},{"location":"checks/general/secrets/sensitive-in-attribute-value/#insecure-example","text":"The following example will fail the general-secrets-sensitive-in-attribute-value check. resource \"aws_instance\" \"bad_example\" { instance_type = \"t2.small\" user_data = <<EOF Password = \"something secret\" EOF }","title":"Insecure Example"},{"location":"checks/general/secrets/sensitive-in-attribute-value/#secure-example","text":"The following example will pass the general-secrets-sensitive-in-attribute-value check. variable \"password\" { type = string } resource \"aws_instance\" \"good_instance\" { instance_type = \"t2.small\" user_data = <<EOF export EDITOR = vimacs EOF }","title":"Secure Example"},{"location":"checks/general/secrets/sensitive-in-attribute-value/#related-links","text":"https://www.terraform.io/docs/state/sensitive-data.html","title":"Related Links"},{"location":"checks/general/secrets/sensitive-in-attribute/","text":"Explanation Sensitive attributes such as passwords and API tokens should not be available in your templates, especially in a plaintext form. You can declare variables to hold the secrets, assuming you can provide values for those variables in a secure fashion. Alternatively, you can store these secrets in a secure secret store, such as AWS KMS. NOTE: It is also recommended to store your Terraform state in an encrypted form. Possible Impact Block attribute could be leaking secrets Suggested Resolution Don't include sensitive data in blocks Insecure Example The following example will fail the general-secrets-sensitive-in-attribute check. resource \"evil_corp\" \"bad_example\" { root_password = \"p4ssw0rd\" } Secure Example The following example will pass the general-secrets-sensitive-in-attribute check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"good_example\" { root_password = var.passwordx } Related Links https://www.terraform.io/docs/state/sensitive-data.html","title":"sensitive-in-attribute"},{"location":"checks/general/secrets/sensitive-in-attribute/#explanation","text":"Sensitive attributes such as passwords and API tokens should not be available in your templates, especially in a plaintext form. You can declare variables to hold the secrets, assuming you can provide values for those variables in a secure fashion. Alternatively, you can store these secrets in a secure secret store, such as AWS KMS. NOTE: It is also recommended to store your Terraform state in an encrypted form.","title":"Explanation"},{"location":"checks/general/secrets/sensitive-in-attribute/#possible-impact","text":"Block attribute could be leaking secrets","title":"Possible Impact"},{"location":"checks/general/secrets/sensitive-in-attribute/#suggested-resolution","text":"Don't include sensitive data in blocks","title":"Suggested Resolution"},{"location":"checks/general/secrets/sensitive-in-attribute/#insecure-example","text":"The following example will fail the general-secrets-sensitive-in-attribute check. resource \"evil_corp\" \"bad_example\" { root_password = \"p4ssw0rd\" }","title":"Insecure Example"},{"location":"checks/general/secrets/sensitive-in-attribute/#secure-example","text":"The following example will pass the general-secrets-sensitive-in-attribute check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"good_example\" { root_password = var.passwordx }","title":"Secure Example"},{"location":"checks/general/secrets/sensitive-in-attribute/#related-links","text":"https://www.terraform.io/docs/state/sensitive-data.html","title":"Related Links"},{"location":"checks/general/secrets/sensitive-in-local/","text":"Explanation Sensitive attributes such as passwords and API tokens should not be available in your templates, especially in a plaintext form. You can declare variables to hold the secrets, assuming you can provide values for those variables in a secure fashion. Alternatively, you can store these secrets in a secure secret store, such as AWS KMS. NOTE: It is also recommended to store your Terraform state in an encrypted form. Possible Impact Local value could be leaking secrets Suggested Resolution Don't include sensitive data in locals Insecure Example The following example will fail the general-secrets-sensitive-in-local check. locals { password = \"p4ssw0rd\" } resource \"evil_corp\" \"bad_example\" { root_password = local.password } Secure Example The following example will pass the general-secrets-sensitive-in-local check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"good_example\" { root_password = var.password } Related Links https://www.terraform.io/docs/state/sensitive-data.html","title":"sensitive-in-local"},{"location":"checks/general/secrets/sensitive-in-local/#explanation","text":"Sensitive attributes such as passwords and API tokens should not be available in your templates, especially in a plaintext form. You can declare variables to hold the secrets, assuming you can provide values for those variables in a secure fashion. Alternatively, you can store these secrets in a secure secret store, such as AWS KMS. NOTE: It is also recommended to store your Terraform state in an encrypted form.","title":"Explanation"},{"location":"checks/general/secrets/sensitive-in-local/#possible-impact","text":"Local value could be leaking secrets","title":"Possible Impact"},{"location":"checks/general/secrets/sensitive-in-local/#suggested-resolution","text":"Don't include sensitive data in locals","title":"Suggested Resolution"},{"location":"checks/general/secrets/sensitive-in-local/#insecure-example","text":"The following example will fail the general-secrets-sensitive-in-local check. locals { password = \"p4ssw0rd\" } resource \"evil_corp\" \"bad_example\" { root_password = local.password }","title":"Insecure Example"},{"location":"checks/general/secrets/sensitive-in-local/#secure-example","text":"The following example will pass the general-secrets-sensitive-in-local check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"good_example\" { root_password = var.password }","title":"Secure Example"},{"location":"checks/general/secrets/sensitive-in-local/#related-links","text":"https://www.terraform.io/docs/state/sensitive-data.html","title":"Related Links"},{"location":"checks/general/secrets/sensitive-in-variable/","text":"Explanation Sensitive attributes such as passwords and API tokens should not be available in your templates, especially in a plaintext form. You can declare variables to hold the secrets, assuming you can provide values for those variables in a secure fashion. Alternatively, you can store these secrets in a secure secret store, such as AWS KMS. NOTE: It is also recommended to store your Terraform state in an encrypted form. Possible Impact Default values could be exposing sensitive data Suggested Resolution Don't include sensitive data in variable defaults Insecure Example The following example will fail the general-secrets-sensitive-in-variable check. variable \"password\" { description = \"The root password for our VM\" type = string default = \"p4ssw0rd\" } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password } Secure Example The following example will pass the general-secrets-sensitive-in-variable check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password } Related Links https://www.terraform.io/docs/state/sensitive-data.html","title":"sensitive-in-variable"},{"location":"checks/general/secrets/sensitive-in-variable/#explanation","text":"Sensitive attributes such as passwords and API tokens should not be available in your templates, especially in a plaintext form. You can declare variables to hold the secrets, assuming you can provide values for those variables in a secure fashion. Alternatively, you can store these secrets in a secure secret store, such as AWS KMS. NOTE: It is also recommended to store your Terraform state in an encrypted form.","title":"Explanation"},{"location":"checks/general/secrets/sensitive-in-variable/#possible-impact","text":"Default values could be exposing sensitive data","title":"Possible Impact"},{"location":"checks/general/secrets/sensitive-in-variable/#suggested-resolution","text":"Don't include sensitive data in variable defaults","title":"Suggested Resolution"},{"location":"checks/general/secrets/sensitive-in-variable/#insecure-example","text":"The following example will fail the general-secrets-sensitive-in-variable check. variable \"password\" { description = \"The root password for our VM\" type = string default = \"p4ssw0rd\" } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password }","title":"Insecure Example"},{"location":"checks/general/secrets/sensitive-in-variable/#secure-example","text":"The following example will pass the general-secrets-sensitive-in-variable check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password }","title":"Secure Example"},{"location":"checks/general/secrets/sensitive-in-variable/#related-links","text":"https://www.terraform.io/docs/state/sensitive-data.html","title":"Related Links"},{"location":"checks/github/home/","text":"The included Github checks are listed below. For more information about each check, see the link provided. Checks github-repositories-private Github repository shouldn't be public. github-repositories-require-signed-commits Require signed commits should be enabled. github-repositories-vulnerability-alerts Github vulnerability alerts should be enabled.","title":"github"},{"location":"checks/github/repositories/private/","text":"Explanation Github repository should be set to be private. You can do this by either setting private attribute to 'true' or visibility attribute to 'internal' or 'private'. Possible Impact Anyone can read the contents of the GitHub repository and leak IP Suggested Resolution Make sensitive or commercially important repositories private Insecure Example The following example will fail the github-repositories-private check. resource \"github_repository\" \"bad_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"public\" template { owner = \"github\" repository = \"terraform-module-template\" } } Secure Example The following example will pass the github-repositories-private check. resource \"github_repository\" \"good_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"private\" template { owner = \"github\" repository = \"terraform-module-template\" } } Related Links https://registry.terraform.io/providers/integrations/github/latest/docs/resources/repository https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility#about-internal-repositories","title":"private"},{"location":"checks/github/repositories/private/#explanation","text":"Github repository should be set to be private. You can do this by either setting private attribute to 'true' or visibility attribute to 'internal' or 'private'.","title":"Explanation"},{"location":"checks/github/repositories/private/#possible-impact","text":"Anyone can read the contents of the GitHub repository and leak IP","title":"Possible Impact"},{"location":"checks/github/repositories/private/#suggested-resolution","text":"Make sensitive or commercially important repositories private","title":"Suggested Resolution"},{"location":"checks/github/repositories/private/#insecure-example","text":"The following example will fail the github-repositories-private check. resource \"github_repository\" \"bad_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"public\" template { owner = \"github\" repository = \"terraform-module-template\" } }","title":"Insecure Example"},{"location":"checks/github/repositories/private/#secure-example","text":"The following example will pass the github-repositories-private check. resource \"github_repository\" \"good_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"private\" template { owner = \"github\" repository = \"terraform-module-template\" } }","title":"Secure Example"},{"location":"checks/github/repositories/private/#related-links","text":"https://registry.terraform.io/providers/integrations/github/latest/docs/resources/repository https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility#about-internal-repositories","title":"Related Links"},{"location":"checks/github/repositories/require-signed-commits/","text":"Explanation You can do this setting the require_signed_commits attribute to 'true'. Possible Impact You cannot guarantee the source of unsigned commits. Suggested Resolution Require signed commits for all protected branches. Insecure Example The following example will fail the github-repositories-require-signed-commits check. resource \"github_branch_protection\" \"bad_example\" { repository_id = github_repository.example.node_id pattern = \"main\" enforce_admins = true allows_deletions = true require_signed_commits = false } Secure Example The following example will pass the github-repositories-require-signed-commits check. resource \"github_branch_protection\" \"good_example\" { repository_id = github_repository.example.node_id pattern = \"main\" enforce_admins = true allows_deletions = true require_signed_commits = true } Related Links https://registry.terraform.io/providers/hashicorp/github/latest/docs/resources/branch_protection#require_signed_commits https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification","title":"require-signed-commits"},{"location":"checks/github/repositories/require-signed-commits/#explanation","text":"You can do this setting the require_signed_commits attribute to 'true'.","title":"Explanation"},{"location":"checks/github/repositories/require-signed-commits/#possible-impact","text":"You cannot guarantee the source of unsigned commits.","title":"Possible Impact"},{"location":"checks/github/repositories/require-signed-commits/#suggested-resolution","text":"Require signed commits for all protected branches.","title":"Suggested Resolution"},{"location":"checks/github/repositories/require-signed-commits/#insecure-example","text":"The following example will fail the github-repositories-require-signed-commits check. resource \"github_branch_protection\" \"bad_example\" { repository_id = github_repository.example.node_id pattern = \"main\" enforce_admins = true allows_deletions = true require_signed_commits = false }","title":"Insecure Example"},{"location":"checks/github/repositories/require-signed-commits/#secure-example","text":"The following example will pass the github-repositories-require-signed-commits check. resource \"github_branch_protection\" \"good_example\" { repository_id = github_repository.example.node_id pattern = \"main\" enforce_admins = true allows_deletions = true require_signed_commits = true }","title":"Secure Example"},{"location":"checks/github/repositories/require-signed-commits/#related-links","text":"https://registry.terraform.io/providers/hashicorp/github/latest/docs/resources/branch_protection#require_signed_commits https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification","title":"Related Links"},{"location":"checks/github/repositories/vulnerability-alerts/","text":"Explanation You can do this by setting the vulnerability_alerts attribute to 'true'. Possible Impact Insecure vulnerabilities might be used in the codebase. Suggested Resolution Enable vulnerability alerts for all repositories. Insecure Example The following example will fail the github-repositories-vulnerability-alerts check. resource \"github_repository\" \"bad_example\" { name = \"example\" description = \"My awesome codebase\" vulnerability_alerts = false } Secure Example The following example will pass the github-repositories-vulnerability-alerts check. resource \"github_repository\" \"good_example\" { name = \"example\" description = \"My awesome codebase\" vulnerability_alerts = true } Related Links https://registry.terraform.io/providers/hashicorp/github/latest/docs/resources/repository#vulnerability_alerts https://docs.github.com/en/code-security/supply-chain-security/managing-vulnerabilities-in-your-projects-dependencies/about-alerts-for-vulnerable-dependencies","title":"vulnerability-alerts"},{"location":"checks/github/repositories/vulnerability-alerts/#explanation","text":"You can do this by setting the vulnerability_alerts attribute to 'true'.","title":"Explanation"},{"location":"checks/github/repositories/vulnerability-alerts/#possible-impact","text":"Insecure vulnerabilities might be used in the codebase.","title":"Possible Impact"},{"location":"checks/github/repositories/vulnerability-alerts/#suggested-resolution","text":"Enable vulnerability alerts for all repositories.","title":"Suggested Resolution"},{"location":"checks/github/repositories/vulnerability-alerts/#insecure-example","text":"The following example will fail the github-repositories-vulnerability-alerts check. resource \"github_repository\" \"bad_example\" { name = \"example\" description = \"My awesome codebase\" vulnerability_alerts = false }","title":"Insecure Example"},{"location":"checks/github/repositories/vulnerability-alerts/#secure-example","text":"The following example will pass the github-repositories-vulnerability-alerts check. resource \"github_repository\" \"good_example\" { name = \"example\" description = \"My awesome codebase\" vulnerability_alerts = true }","title":"Secure Example"},{"location":"checks/github/repositories/vulnerability-alerts/#related-links","text":"https://registry.terraform.io/providers/hashicorp/github/latest/docs/resources/repository#vulnerability_alerts https://docs.github.com/en/code-security/supply-chain-security/managing-vulnerabilities-in-your-projects-dependencies/about-alerts-for-vulnerable-dependencies","title":"Related Links"},{"location":"checks/google/home/","text":"The included Google checks are listed below. For more information about each check, see the link provided. Checks google-bigquery-no-public-access BigQuery datasets should only be accessible within the organisation google-compute-disk-encryption-customer-key Disks should be encrypted with Customer Supplied Encryption Keys google-compute-disk-encryption-customer-keys Encrypted compute disk with unmanaged keys. google-compute-disk-encryption-required The encryption key used to encrypt a compute disk has been specified in plaintext. google-compute-enable-shielded-vm Instances should have Shielded VM enabled google-compute-enable-vpc-flow-logs VPC flow logs should be enabled for all subnets google-compute-no-default-service-account Instances should not use the default service account google-compute-no-ip-forwarding Instances should not have IP forwarding enabled google-compute-no-oslogin-override Instances should not override the project setting for OS Login google-compute-no-plaintext-disk-keys Disk encryption keys should not be provided in plaintext google-compute-no-plaintext-vm-disk-keys VM disk encryption keys should not be provided in plaintext google-compute-no-project-wide-ssh-keys Disable project-wide SSH keys for all instances google-compute-no-public-egress An outbound firewall rule allows traffic to /0. google-compute-no-public-ingress An inbound firewall rule allows traffic from /0. google-compute-no-public-ip Instances should not have public IP addresses google-compute-no-serial-port Disable serial port connectivity for all instances google-compute-project-level-oslogin OS Login should be enabled at project level google-compute-use-secure-tls-policy SSL policies should enforce secure versions of TLS google-compute-vm-disk-encryption-customer-key VM disks should be encrypted with Customer Supplied Encryption Keys google-dns-enable-dnssec Cloud DNS should use DNSSEC google-dns-no-rsa-sha1 Zone signing should not use RSA SHA1 google-gke-enable-auto-repair Kubernetes should have 'Automatic repair' enabled google-gke-enable-auto-upgrade Kubernetes should have 'Automatic upgrade' enabled google-gke-enable-ip-aliasing Clusters should have IP aliasing enabled google-gke-enable-master-networks Master authorized networks should be configured on GKE clusters google-gke-enable-network-policy Network Policy should be enabled on GKE clusters google-gke-enable-private-cluster Clusters should be set to private google-gke-enable-stackdriver-logging Stackdriver Logging should be enabled google-gke-enable-stackdriver-monitoring Stackdriver Monitoring should be enabled google-gke-enforce-pod-security-policy Pod security policy enforcement not defined. google-gke-metadata-endpoints-disabled Legacy metadata endpoints enabled. google-gke-no-legacy-auth Clusters should use client certificates for authentication google-gke-no-public-control-plane GKE Control Plane should not be publicly accessible google-gke-node-metadata-security Node metadata value disables metadata concealment. google-gke-node-pool-uses-cos Ensure Container-Optimized OS (cos) is used for Kubernetes Engine Clusters Node image google-gke-node-shielding-enabled Shielded GKE nodes not enabled. google-gke-use-cluster-labels Clusters should be configured with Labels google-gke-use-rbac-permissions Legacy ABAC permissions are enabled. google-gke-use-service-account Checks for service account defined for GKE nodes google-iam-no-folder-level-default-service-account-assignment Roles should not be assigned to default service accounts google-iam-no-folder-level-service-account-impersonation Users should not be granted service account access at the folder level google-iam-no-org-level-default-service-account-assignment Roles should not be assigned to default service accounts google-iam-no-org-level-service-account-impersonation Users should not be granted service account access at the organization level google-iam-no-privileged-service-accounts Service accounts should not have roles assigned with excessive privileges google-iam-no-project-level-default-service-account-assignment Roles should not be assigned to default service accounts google-iam-no-project-level-service-account-impersonation Users should not be granted service account access at the project level google-iam-no-user-granted-permissions IAM granted directly to user. google-kms-rotate-kms-keys KMS keys should be rotated at least every 90 days google-project-no-default-network Default network should not be created at project level google-sql-enable-backup Enable automated backups to recover from data-loss google-sql-enable-pg-temp-file-logging Temporary file logging should be enabled for all temporary files. google-sql-encrypt-in-transit-data SSL connections to a SQL database instance should be enforced. google-sql-mysql-no-local-infile Disable local_infile setting in MySQL google-sql-no-contained-db-auth Contained database authentication should be disabled google-sql-no-cross-db-ownership-chaining Cross-database ownership chaining should be disabled google-sql-no-public-access Ensure that Cloud SQL Database Instances are not publicly exposed google-sql-pg-log-checkpoints Ensure that logging of checkpoints is enabled. google-sql-pg-log-connections Ensure that logging of connections is enabled. google-sql-pg-log-disconnections Ensure that logging of disconnections is enabled. google-sql-pg-log-errors Ensure that Postgres errors are logged google-sql-pg-log-lock-waits Ensure that logging of lock waits is enabled. google-sql-pg-no-min-statement-logging Ensure that logging of long statements is disabled. google-storage-enable-ubla Ensure that Cloud Storage buckets have uniform bucket-level access enabled google-storage-no-public-access Ensure that Cloud Storage bucket is not anonymously or publicly accessible.","title":"google"},{"location":"checks/google/bigquery/no-public-access/","text":"Explanation Using 'allAuthenticatedUsers' provides any GCP user - even those outside of your organisation - access to your BigQuery dataset. Possible Impact Exposure of sensitive data to the public iniernet Suggested Resolution Configure access permissions with higher granularity Insecure Example The following example will fail the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"bad_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" special_group = \"allAuthenticatedUsers\" } access { role = \"READER\" domain = \"hashicorp.com\" } } Secure Example The following example will pass the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"good_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" user_by_email = google_service_account.bqowner.email } access { role = \"READER\" domain = \"hashicorp.com\" } } resource \"google_service_account\" \"bqowner\" { account_id = \"bqowner\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#special_group","title":"no-public-access"},{"location":"checks/google/bigquery/no-public-access/#explanation","text":"Using 'allAuthenticatedUsers' provides any GCP user - even those outside of your organisation - access to your BigQuery dataset.","title":"Explanation"},{"location":"checks/google/bigquery/no-public-access/#possible-impact","text":"Exposure of sensitive data to the public iniernet","title":"Possible Impact"},{"location":"checks/google/bigquery/no-public-access/#suggested-resolution","text":"Configure access permissions with higher granularity","title":"Suggested Resolution"},{"location":"checks/google/bigquery/no-public-access/#insecure-example","text":"The following example will fail the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"bad_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" special_group = \"allAuthenticatedUsers\" } access { role = \"READER\" domain = \"hashicorp.com\" } }","title":"Insecure Example"},{"location":"checks/google/bigquery/no-public-access/#secure-example","text":"The following example will pass the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"good_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" user_by_email = google_service_account.bqowner.email } access { role = \"READER\" domain = \"hashicorp.com\" } } resource \"google_service_account\" \"bqowner\" { account_id = \"bqowner\" }","title":"Secure Example"},{"location":"checks/google/bigquery/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#special_group","title":"Related Links"},{"location":"checks/google/compute/disk-encryption-customer-key/","text":"Explanation Using unmanaged keys makes rotation and general management difficult. Possible Impact Using unmanaged keys does not allow for proper management Suggested Resolution Use managed keys Insecure Example The following example will fail the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 } Secure Example The following example will pass the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { kms_key_self_link = \"something\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link","title":"disk-encryption-customer-key"},{"location":"checks/google/compute/disk-encryption-customer-key/#explanation","text":"Using unmanaged keys makes rotation and general management difficult.","title":"Explanation"},{"location":"checks/google/compute/disk-encryption-customer-key/#possible-impact","text":"Using unmanaged keys does not allow for proper management","title":"Possible Impact"},{"location":"checks/google/compute/disk-encryption-customer-key/#suggested-resolution","text":"Use managed keys","title":"Suggested Resolution"},{"location":"checks/google/compute/disk-encryption-customer-key/#insecure-example","text":"The following example will fail the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 }","title":"Insecure Example"},{"location":"checks/google/compute/disk-encryption-customer-key/#secure-example","text":"The following example will pass the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { kms_key_self_link = \"something\" } }","title":"Secure Example"},{"location":"checks/google/compute/disk-encryption-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link","title":"Related Links"},{"location":"checks/google/compute/disk-encryption-customer-keys/","text":"Explanation By default, Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. If the disk_encryption_key block is included in the resource declaration then it must include a raw_key or kms_key_self_link . Possible Impact Encryption of disk using unmanaged keys. Suggested Resolution Enable encryption using a customer-managed key. Insecure Example The following example will fail the google-compute-disk-encryption-customer-keys check. resource \"google_compute_disk\" \"bad_example\" { # ... } Secure Example The following example will pass the google-compute-disk-encryption-customer-keys check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { kms_key_self_link = \"something\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk https://cloud.google.com/compute/docs/disks/customer-supplied-encryption","title":"disk-encryption-customer-keys"},{"location":"checks/google/compute/disk-encryption-customer-keys/#explanation","text":"By default, Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. If the disk_encryption_key block is included in the resource declaration then it must include a raw_key or kms_key_self_link .","title":"Explanation"},{"location":"checks/google/compute/disk-encryption-customer-keys/#possible-impact","text":"Encryption of disk using unmanaged keys.","title":"Possible Impact"},{"location":"checks/google/compute/disk-encryption-customer-keys/#suggested-resolution","text":"Enable encryption using a customer-managed key.","title":"Suggested Resolution"},{"location":"checks/google/compute/disk-encryption-customer-keys/#insecure-example","text":"The following example will fail the google-compute-disk-encryption-customer-keys check. resource \"google_compute_disk\" \"bad_example\" { # ... }","title":"Insecure Example"},{"location":"checks/google/compute/disk-encryption-customer-keys/#secure-example","text":"The following example will pass the google-compute-disk-encryption-customer-keys check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { kms_key_self_link = \"something\" } }","title":"Secure Example"},{"location":"checks/google/compute/disk-encryption-customer-keys/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk https://cloud.google.com/compute/docs/disks/customer-supplied-encryption","title":"Related Links"},{"location":"checks/google/compute/disk-encryption-required/","text":"Explanation Sensitive values such as raw encryption keys should not be included in your Terraform code, and should be stored securely by a secrets manager. Possible Impact The encryption key should be considered compromised as it is not stored securely. Suggested Resolution Reference a managed key rather than include the key in raw format. Insecure Example The following example will fail the google-compute-disk-encryption-required check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { raw_key = \"b2ggbm8gdGhpcyBpcyBiYWQ=\" } } Secure Example The following example will pass the google-compute-disk-encryption-required check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { kms_key_self_link = google_kms_crypto_key.my_crypto_key.id } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link https://cloud.google.com/compute/docs/disks/customer-supplied-encryption","title":"disk-encryption-required"},{"location":"checks/google/compute/disk-encryption-required/#explanation","text":"Sensitive values such as raw encryption keys should not be included in your Terraform code, and should be stored securely by a secrets manager.","title":"Explanation"},{"location":"checks/google/compute/disk-encryption-required/#possible-impact","text":"The encryption key should be considered compromised as it is not stored securely.","title":"Possible Impact"},{"location":"checks/google/compute/disk-encryption-required/#suggested-resolution","text":"Reference a managed key rather than include the key in raw format.","title":"Suggested Resolution"},{"location":"checks/google/compute/disk-encryption-required/#insecure-example","text":"The following example will fail the google-compute-disk-encryption-required check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { raw_key = \"b2ggbm8gdGhpcyBpcyBiYWQ=\" } }","title":"Insecure Example"},{"location":"checks/google/compute/disk-encryption-required/#secure-example","text":"The following example will pass the google-compute-disk-encryption-required check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { kms_key_self_link = google_kms_crypto_key.my_crypto_key.id } }","title":"Secure Example"},{"location":"checks/google/compute/disk-encryption-required/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link https://cloud.google.com/compute/docs/disks/customer-supplied-encryption","title":"Related Links"},{"location":"checks/google/compute/enable-shielded-vm/","text":"Explanation A Shielded VM is a VM with enhanced defences/detection for rootkits/bootkits. Possible Impact Unable to detect rootkits Suggested Resolution Enable Shielded VM Insecure Example The following example will fail the google-compute-enable-shielded-vm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = false enable_integrity_monitoring = false } } Secure Example The following example will pass the google-compute-enable-shielded-vm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = true enable_integrity_monitoring = true } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#enable_vtpm","title":"enable-shielded-vm"},{"location":"checks/google/compute/enable-shielded-vm/#explanation","text":"A Shielded VM is a VM with enhanced defences/detection for rootkits/bootkits.","title":"Explanation"},{"location":"checks/google/compute/enable-shielded-vm/#possible-impact","text":"Unable to detect rootkits","title":"Possible Impact"},{"location":"checks/google/compute/enable-shielded-vm/#suggested-resolution","text":"Enable Shielded VM","title":"Suggested Resolution"},{"location":"checks/google/compute/enable-shielded-vm/#insecure-example","text":"The following example will fail the google-compute-enable-shielded-vm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = false enable_integrity_monitoring = false } }","title":"Insecure Example"},{"location":"checks/google/compute/enable-shielded-vm/#secure-example","text":"The following example will pass the google-compute-enable-shielded-vm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = true enable_integrity_monitoring = true } }","title":"Secure Example"},{"location":"checks/google/compute/enable-shielded-vm/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#enable_vtpm","title":"Related Links"},{"location":"checks/google/compute/enable-vpc-flow-logs/","text":"Explanation VPC flow logs record information about all traffic, which is a vital tool in reviewing anomalous traffic. Possible Impact Limited auditing capability and awareness Suggested Resolution Enable VPC flow logs Insecure Example The following example will fail the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"bad_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } enable_flow_logs = false } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false } Secure Example The following example will pass the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"good_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } enable_flow_logs = true } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork#enable_flow_logs","title":"enable-vpc-flow-logs"},{"location":"checks/google/compute/enable-vpc-flow-logs/#explanation","text":"VPC flow logs record information about all traffic, which is a vital tool in reviewing anomalous traffic.","title":"Explanation"},{"location":"checks/google/compute/enable-vpc-flow-logs/#possible-impact","text":"Limited auditing capability and awareness","title":"Possible Impact"},{"location":"checks/google/compute/enable-vpc-flow-logs/#suggested-resolution","text":"Enable VPC flow logs","title":"Suggested Resolution"},{"location":"checks/google/compute/enable-vpc-flow-logs/#insecure-example","text":"The following example will fail the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"bad_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } enable_flow_logs = false } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false }","title":"Insecure Example"},{"location":"checks/google/compute/enable-vpc-flow-logs/#secure-example","text":"The following example will pass the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"good_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } enable_flow_logs = true } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false }","title":"Secure Example"},{"location":"checks/google/compute/enable-vpc-flow-logs/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork#enable_flow_logs","title":"Related Links"},{"location":"checks/google/compute/no-default-service-account/","text":"Explanation The default service account has full project access. Instances should instead be assigned the minimal access they need. Possible Impact Instance has full access to the project Suggested Resolution Remove use of default service account Insecure Example The following example will fail the google-compute-no-default-service-account check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = \"1234567890-compute@developer.gserviceaccount.com\" scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-default-service-account check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"no-default-service-account"},{"location":"checks/google/compute/no-default-service-account/#explanation","text":"The default service account has full project access. Instances should instead be assigned the minimal access they need.","title":"Explanation"},{"location":"checks/google/compute/no-default-service-account/#possible-impact","text":"Instance has full access to the project","title":"Possible Impact"},{"location":"checks/google/compute/no-default-service-account/#suggested-resolution","text":"Remove use of default service account","title":"Suggested Resolution"},{"location":"checks/google/compute/no-default-service-account/#insecure-example","text":"The following example will fail the google-compute-no-default-service-account check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = \"1234567890-compute@developer.gserviceaccount.com\" scopes = [ \"cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/compute/no-default-service-account/#secure-example","text":"The following example will pass the google-compute-no-default-service-account check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/compute/no-default-service-account/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"Related Links"},{"location":"checks/google/compute/no-ip-forwarding/","text":"Explanation Disabling IP forwarding ensuresthe instance can only receive packets addressed to the instance and can only send packets with a source address of the instance. Possible Impact Instance can send/receive packets without the explicit instance address Suggested Resolution Disable IP forwarding Insecure Example The following example will fail the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = true } Secure Example The following example will pass the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = false } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#can_ip_forward","title":"no-ip-forwarding"},{"location":"checks/google/compute/no-ip-forwarding/#explanation","text":"Disabling IP forwarding ensuresthe instance can only receive packets addressed to the instance and can only send packets with a source address of the instance.","title":"Explanation"},{"location":"checks/google/compute/no-ip-forwarding/#possible-impact","text":"Instance can send/receive packets without the explicit instance address","title":"Possible Impact"},{"location":"checks/google/compute/no-ip-forwarding/#suggested-resolution","text":"Disable IP forwarding","title":"Suggested Resolution"},{"location":"checks/google/compute/no-ip-forwarding/#insecure-example","text":"The following example will fail the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = true }","title":"Insecure Example"},{"location":"checks/google/compute/no-ip-forwarding/#secure-example","text":"The following example will pass the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = false }","title":"Secure Example"},{"location":"checks/google/compute/no-ip-forwarding/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#can_ip_forward","title":"Related Links"},{"location":"checks/google/compute/no-oslogin-override/","text":"Explanation OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked. Possible Impact Access via SSH key cannot be revoked automatically when an IAM user is removed. Suggested Resolution Enable OS Login at project level and remove instance-level overrides Insecure Example The following example will fail the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { enable-oslogin = false } } Secure Example The following example will pass the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"no-oslogin-override"},{"location":"checks/google/compute/no-oslogin-override/#explanation","text":"OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked.","title":"Explanation"},{"location":"checks/google/compute/no-oslogin-override/#possible-impact","text":"Access via SSH key cannot be revoked automatically when an IAM user is removed.","title":"Possible Impact"},{"location":"checks/google/compute/no-oslogin-override/#suggested-resolution","text":"Enable OS Login at project level and remove instance-level overrides","title":"Suggested Resolution"},{"location":"checks/google/compute/no-oslogin-override/#insecure-example","text":"The following example will fail the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { enable-oslogin = false } }","title":"Insecure Example"},{"location":"checks/google/compute/no-oslogin-override/#secure-example","text":"The following example will pass the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { } }","title":"Secure Example"},{"location":"checks/google/compute/no-oslogin-override/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"Related Links"},{"location":"checks/google/compute/no-plaintext-disk-keys/","text":"Explanation Providing your encryption key in plaintext format means anyone with access to the source code also has access to the key. Possible Impact Compromise of encryption keys Suggested Resolution Use managed keys or provide the raw key via a secrets manager Insecure Example The following example will fail the google-compute-no-plaintext-disk-keys check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { raw_key = \"something\" } } Secure Example The following example will pass the google-compute-no-plaintext-disk-keys check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#raw_key","title":"no-plaintext-disk-keys"},{"location":"checks/google/compute/no-plaintext-disk-keys/#explanation","text":"Providing your encryption key in plaintext format means anyone with access to the source code also has access to the key.","title":"Explanation"},{"location":"checks/google/compute/no-plaintext-disk-keys/#possible-impact","text":"Compromise of encryption keys","title":"Possible Impact"},{"location":"checks/google/compute/no-plaintext-disk-keys/#suggested-resolution","text":"Use managed keys or provide the raw key via a secrets manager","title":"Suggested Resolution"},{"location":"checks/google/compute/no-plaintext-disk-keys/#insecure-example","text":"The following example will fail the google-compute-no-plaintext-disk-keys check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { raw_key = \"something\" } }","title":"Insecure Example"},{"location":"checks/google/compute/no-plaintext-disk-keys/#secure-example","text":"The following example will pass the google-compute-no-plaintext-disk-keys check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 }","title":"Secure Example"},{"location":"checks/google/compute/no-plaintext-disk-keys/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#raw_key","title":"Related Links"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/","text":"Explanation Providing your encryption key in plaintext format means anyone with access to the source code also has access to the key. Possible Impact Compromise of encryption keys Suggested Resolution Use managed keys or provide the raw key via a secrets manager Insecure Example The following example will fail the google-compute-no-plaintext-vm-disk-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } disk_encryption_key_raw = \"something\" } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-plaintext-vm-disk-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#disk_encryption_key_raw","title":"no-plaintext-vm-disk-keys"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/#explanation","text":"Providing your encryption key in plaintext format means anyone with access to the source code also has access to the key.","title":"Explanation"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/#possible-impact","text":"Compromise of encryption keys","title":"Possible Impact"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/#suggested-resolution","text":"Use managed keys or provide the raw key via a secrets manager","title":"Suggested Resolution"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/#insecure-example","text":"The following example will fail the google-compute-no-plaintext-vm-disk-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } disk_encryption_key_raw = \"something\" } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/#secure-example","text":"The following example will pass the google-compute-no-plaintext-vm-disk-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/compute/no-plaintext-vm-disk-keys/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#disk_encryption_key_raw","title":"Related Links"},{"location":"checks/google/compute/no-project-wide-ssh-keys/","text":"Explanation Use of project-wide SSH keys means that a compromise of any one of these key pairs can result in all instances being compromised. It is recommended to use instance-level keys. Possible Impact Compromise of a single key pair compromises all instances Suggested Resolution Disable project-wide SSH keys Insecure Example The following example will fail the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"no-project-wide-ssh-keys"},{"location":"checks/google/compute/no-project-wide-ssh-keys/#explanation","text":"Use of project-wide SSH keys means that a compromise of any one of these key pairs can result in all instances being compromised. It is recommended to use instance-level keys.","title":"Explanation"},{"location":"checks/google/compute/no-project-wide-ssh-keys/#possible-impact","text":"Compromise of a single key pair compromises all instances","title":"Possible Impact"},{"location":"checks/google/compute/no-project-wide-ssh-keys/#suggested-resolution","text":"Disable project-wide SSH keys","title":"Suggested Resolution"},{"location":"checks/google/compute/no-project-wide-ssh-keys/#insecure-example","text":"The following example will fail the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/compute/no-project-wide-ssh-keys/#secure-example","text":"The following example will pass the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/compute/no-project-wide-ssh-keys/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"Related Links"},{"location":"checks/google/compute/no-public-egress/","text":"Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet. Possible Impact The port is exposed for egress to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"bad_example\" { destination_ranges = [ \"0.0.0.0/0\" ] } Secure Example The following example will pass the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"good_example\" { destination_ranges = [ \"1.2.3.4/32\" ] } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall https://cloud.google.com/vpc/docs/using-firewalls","title":"no-public-egress"},{"location":"checks/google/compute/no-public-egress/#explanation","text":"Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet.","title":"Explanation"},{"location":"checks/google/compute/no-public-egress/#possible-impact","text":"The port is exposed for egress to the internet","title":"Possible Impact"},{"location":"checks/google/compute/no-public-egress/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/google/compute/no-public-egress/#insecure-example","text":"The following example will fail the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"bad_example\" { destination_ranges = [ \"0.0.0.0/0\" ] }","title":"Insecure Example"},{"location":"checks/google/compute/no-public-egress/#secure-example","text":"The following example will pass the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"good_example\" { destination_ranges = [ \"1.2.3.4/32\" ] }","title":"Secure Example"},{"location":"checks/google/compute/no-public-egress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall https://cloud.google.com/vpc/docs/using-firewalls","title":"Related Links"},{"location":"checks/google/compute/no-public-ingress/","text":"Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"bad_example\" { source_ranges = [ \"0.0.0.0/0\" ] } Secure Example The following example will pass the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"good_example\" { source_ranges = [ \"1.2.3.4/32\" ] } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall#source_ranges https://cloud.google.com/vpc/docs/using-firewalls https://www.terraform.io/docs/providers/google/r/compute_firewall.html","title":"no-public-ingress"},{"location":"checks/google/compute/no-public-ingress/#explanation","text":"Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet.","title":"Explanation"},{"location":"checks/google/compute/no-public-ingress/#possible-impact","text":"The port is exposed for ingress from the internet","title":"Possible Impact"},{"location":"checks/google/compute/no-public-ingress/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/google/compute/no-public-ingress/#insecure-example","text":"The following example will fail the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"bad_example\" { source_ranges = [ \"0.0.0.0/0\" ] }","title":"Insecure Example"},{"location":"checks/google/compute/no-public-ingress/#secure-example","text":"The following example will pass the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"good_example\" { source_ranges = [ \"1.2.3.4/32\" ] }","title":"Secure Example"},{"location":"checks/google/compute/no-public-ingress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall#source_ranges https://cloud.google.com/vpc/docs/using-firewalls https://www.terraform.io/docs/providers/google/r/compute_firewall.html","title":"Related Links"},{"location":"checks/google/compute/no-public-ip/","text":"Explanation Instances should not be publicly exposed to the internet Possible Impact Direct exposure of an instance to the public internet Suggested Resolution Remove public IP Insecure Example The following example will fail the google-compute-no-public-ip check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } } Secure Example The following example will pass the google-compute-no-public-ip check. resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#access_config","title":"no-public-ip"},{"location":"checks/google/compute/no-public-ip/#explanation","text":"Instances should not be publicly exposed to the internet","title":"Explanation"},{"location":"checks/google/compute/no-public-ip/#possible-impact","text":"Direct exposure of an instance to the public internet","title":"Possible Impact"},{"location":"checks/google/compute/no-public-ip/#suggested-resolution","text":"Remove public IP","title":"Suggested Resolution"},{"location":"checks/google/compute/no-public-ip/#insecure-example","text":"The following example will fail the google-compute-no-public-ip check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } }","title":"Insecure Example"},{"location":"checks/google/compute/no-public-ip/#secure-example","text":"The following example will pass the google-compute-no-public-ip check. resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" } }","title":"Secure Example"},{"location":"checks/google/compute/no-public-ip/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#access_config","title":"Related Links"},{"location":"checks/google/compute/no-serial-port/","text":"Explanation When serial port access is enabled, the access is not governed by network security rules meaning the port can be exposed publicly. Possible Impact Unrestricted network access to the serial console of the instance Suggested Resolution Disable serial port access Insecure Example The following example will fail the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"no-serial-port"},{"location":"checks/google/compute/no-serial-port/#explanation","text":"When serial port access is enabled, the access is not governed by network security rules meaning the port can be exposed publicly.","title":"Explanation"},{"location":"checks/google/compute/no-serial-port/#possible-impact","text":"Unrestricted network access to the serial console of the instance","title":"Possible Impact"},{"location":"checks/google/compute/no-serial-port/#suggested-resolution","text":"Disable serial port access","title":"Suggested Resolution"},{"location":"checks/google/compute/no-serial-port/#insecure-example","text":"The following example will fail the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/compute/no-serial-port/#secure-example","text":"The following example will pass the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/compute/no-serial-port/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#","title":"Related Links"},{"location":"checks/google/compute/project-level-oslogin/","text":"Explanation OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked. Possible Impact Access via SSH key cannot be revoked automatically when an IAM user is removed. Suggested Resolution Enable OS Login at project level Insecure Example The following example will fail the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = false } } Secure Example The following example will pass the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = true } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_project_metadata#","title":"project-level-oslogin"},{"location":"checks/google/compute/project-level-oslogin/#explanation","text":"OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked.","title":"Explanation"},{"location":"checks/google/compute/project-level-oslogin/#possible-impact","text":"Access via SSH key cannot be revoked automatically when an IAM user is removed.","title":"Possible Impact"},{"location":"checks/google/compute/project-level-oslogin/#suggested-resolution","text":"Enable OS Login at project level","title":"Suggested Resolution"},{"location":"checks/google/compute/project-level-oslogin/#insecure-example","text":"The following example will fail the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = false } }","title":"Insecure Example"},{"location":"checks/google/compute/project-level-oslogin/#secure-example","text":"The following example will pass the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = true } }","title":"Secure Example"},{"location":"checks/google/compute/project-level-oslogin/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_project_metadata#","title":"Related Links"},{"location":"checks/google/compute/use-secure-tls-policy/","text":"Explanation TLS versions prior to 1.2 are outdated and insecure. You should use 1.2 as aminimum version. Possible Impact Data in transit is not sufficiently secured Suggested Resolution Enforce a minimum TLS version of 1.2 Insecure Example The following example will fail the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"bad_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_1\" } Secure Example The following example will pass the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"good_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_2\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_ssl_policy#min_tls_version","title":"use-secure-tls-policy"},{"location":"checks/google/compute/use-secure-tls-policy/#explanation","text":"TLS versions prior to 1.2 are outdated and insecure. You should use 1.2 as aminimum version.","title":"Explanation"},{"location":"checks/google/compute/use-secure-tls-policy/#possible-impact","text":"Data in transit is not sufficiently secured","title":"Possible Impact"},{"location":"checks/google/compute/use-secure-tls-policy/#suggested-resolution","text":"Enforce a minimum TLS version of 1.2","title":"Suggested Resolution"},{"location":"checks/google/compute/use-secure-tls-policy/#insecure-example","text":"The following example will fail the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"bad_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_1\" }","title":"Insecure Example"},{"location":"checks/google/compute/use-secure-tls-policy/#secure-example","text":"The following example will pass the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"good_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_2\" }","title":"Secure Example"},{"location":"checks/google/compute/use-secure-tls-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_ssl_policy#min_tls_version","title":"Related Links"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/","text":"Explanation Using unmanaged keys makes rotation and general management difficult. Possible Impact Using unmanaged keys does not allow for proper management Suggested Resolution Use managed keys Insecure Example The following example will fail the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } kms_key_self_link = \"something\" } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#kms_key_self_link","title":"vm-disk-encryption-customer-key"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/#explanation","text":"Using unmanaged keys makes rotation and general management difficult.","title":"Explanation"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/#possible-impact","text":"Using unmanaged keys does not allow for proper management","title":"Possible Impact"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/#suggested-resolution","text":"Use managed keys","title":"Suggested Resolution"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/#insecure-example","text":"The following example will fail the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/#secure-example","text":"The following example will pass the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } kms_key_self_link = \"something\" } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/compute/vm-disk-encryption-customer-key/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#kms_key_self_link","title":"Related Links"},{"location":"checks/google/dns/enable-dnssec/","text":"Explanation DNSSEC authenticates DNS responses, preventing MITM attacks and impersonation. Possible Impact Unverified DNS responses could lead to man-in-the-middle attacks Suggested Resolution Enable DNSSEC Insecure Example The following example will fail the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"bad_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"off\" } } resource \"random_id\" \"rnd\" { byte_length = 4 } Secure Example The following example will pass the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"good_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"on\" } } resource \"random_id\" \"rnd\" { byte_length = 4 } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#state","title":"enable-dnssec"},{"location":"checks/google/dns/enable-dnssec/#explanation","text":"DNSSEC authenticates DNS responses, preventing MITM attacks and impersonation.","title":"Explanation"},{"location":"checks/google/dns/enable-dnssec/#possible-impact","text":"Unverified DNS responses could lead to man-in-the-middle attacks","title":"Possible Impact"},{"location":"checks/google/dns/enable-dnssec/#suggested-resolution","text":"Enable DNSSEC","title":"Suggested Resolution"},{"location":"checks/google/dns/enable-dnssec/#insecure-example","text":"The following example will fail the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"bad_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"off\" } } resource \"random_id\" \"rnd\" { byte_length = 4 }","title":"Insecure Example"},{"location":"checks/google/dns/enable-dnssec/#secure-example","text":"The following example will pass the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"good_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"on\" } } resource \"random_id\" \"rnd\" { byte_length = 4 }","title":"Secure Example"},{"location":"checks/google/dns/enable-dnssec/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#state","title":"Related Links"},{"location":"checks/google/dns/no-rsa-sha1/","text":"Explanation RSA SHA1 is a weaker algorithm than SHA2-based algorithms such as RSA SHA256/512 Possible Impact Less secure encryption algorithm than others available Suggested Resolution Use RSA SHA512 Insecure Example The following example will fail the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha1\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record } Secure Example The following example will pass the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha512\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#algorithm","title":"no-rsa-sha1"},{"location":"checks/google/dns/no-rsa-sha1/#explanation","text":"RSA SHA1 is a weaker algorithm than SHA2-based algorithms such as RSA SHA256/512","title":"Explanation"},{"location":"checks/google/dns/no-rsa-sha1/#possible-impact","text":"Less secure encryption algorithm than others available","title":"Possible Impact"},{"location":"checks/google/dns/no-rsa-sha1/#suggested-resolution","text":"Use RSA SHA512","title":"Suggested Resolution"},{"location":"checks/google/dns/no-rsa-sha1/#insecure-example","text":"The following example will fail the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha1\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record }","title":"Insecure Example"},{"location":"checks/google/dns/no-rsa-sha1/#secure-example","text":"The following example will pass the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha512\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record }","title":"Secure Example"},{"location":"checks/google/dns/no-rsa-sha1/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#algorithm","title":"Related Links"},{"location":"checks/google/gke/enable-auto-repair/","text":"Explanation Automatic repair will monitor nodes and attempt repair when a node fails multiple subsequent health checks Possible Impact Failing nodes will require manual repair. Suggested Resolution Enable automatic repair Insecure Example The following example will fail the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = false } } Secure Example The following example will pass the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = true } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_repair","title":"enable-auto-repair"},{"location":"checks/google/gke/enable-auto-repair/#explanation","text":"Automatic repair will monitor nodes and attempt repair when a node fails multiple subsequent health checks","title":"Explanation"},{"location":"checks/google/gke/enable-auto-repair/#possible-impact","text":"Failing nodes will require manual repair.","title":"Possible Impact"},{"location":"checks/google/gke/enable-auto-repair/#suggested-resolution","text":"Enable automatic repair","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-auto-repair/#insecure-example","text":"The following example will fail the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = false } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-auto-repair/#secure-example","text":"The following example will pass the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = true } }","title":"Secure Example"},{"location":"checks/google/gke/enable-auto-repair/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_repair","title":"Related Links"},{"location":"checks/google/gke/enable-auto-upgrade/","text":"Explanation Automatic updates keep nodes updated with the latest cluster master version. Possible Impact Nodes will need the cluster master version manually updating Suggested Resolution Enable automatic upgrades Insecure Example The following example will fail the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = false } } Secure Example The following example will pass the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = true } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_upgrade","title":"enable-auto-upgrade"},{"location":"checks/google/gke/enable-auto-upgrade/#explanation","text":"Automatic updates keep nodes updated with the latest cluster master version.","title":"Explanation"},{"location":"checks/google/gke/enable-auto-upgrade/#possible-impact","text":"Nodes will need the cluster master version manually updating","title":"Possible Impact"},{"location":"checks/google/gke/enable-auto-upgrade/#suggested-resolution","text":"Enable automatic upgrades","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-auto-upgrade/#insecure-example","text":"The following example will fail the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = false } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-auto-upgrade/#secure-example","text":"The following example will pass the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = true } }","title":"Secure Example"},{"location":"checks/google/gke/enable-auto-upgrade/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_upgrade","title":"Related Links"},{"location":"checks/google/gke/enable-ip-aliasing/","text":"Explanation IP aliasing allows the reuse of public IPs internally, removing the need for a NAT gateway. Possible Impact Nodes need a NAT gateway to access local services Suggested Resolution Enable IP aliasing Insecure Example The following example will fail the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 ip_allocation_policy = {} } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#ip_allocation_policy","title":"enable-ip-aliasing"},{"location":"checks/google/gke/enable-ip-aliasing/#explanation","text":"IP aliasing allows the reuse of public IPs internally, removing the need for a NAT gateway.","title":"Explanation"},{"location":"checks/google/gke/enable-ip-aliasing/#possible-impact","text":"Nodes need a NAT gateway to access local services","title":"Possible Impact"},{"location":"checks/google/gke/enable-ip-aliasing/#suggested-resolution","text":"Enable IP aliasing","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-ip-aliasing/#insecure-example","text":"The following example will fail the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-ip-aliasing/#secure-example","text":"The following example will pass the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 ip_allocation_policy = {} } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/enable-ip-aliasing/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#ip_allocation_policy","title":"Related Links"},{"location":"checks/google/gke/enable-master-networks/","text":"Explanation Enabling authorized networks means you can restrict master access to a fixed set of CIDR ranges Possible Impact Unrestricted network access to the master Suggested Resolution Enable master authorized networks Insecure Example The following example will fail the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#","title":"enable-master-networks"},{"location":"checks/google/gke/enable-master-networks/#explanation","text":"Enabling authorized networks means you can restrict master access to a fixed set of CIDR ranges","title":"Explanation"},{"location":"checks/google/gke/enable-master-networks/#possible-impact","text":"Unrestricted network access to the master","title":"Possible Impact"},{"location":"checks/google/gke/enable-master-networks/#suggested-resolution","text":"Enable master authorized networks","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-master-networks/#insecure-example","text":"The following example will fail the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-master-networks/#secure-example","text":"The following example will pass the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/enable-master-networks/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#","title":"Related Links"},{"location":"checks/google/gke/enable-network-policy/","text":"Explanation Enabling a network policy allows the segregation of network traffic by namespace Possible Impact Unrestricted inter-cluster communication Suggested Resolution Enable network policy Insecure Example The following example will fail the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enabled","title":"enable-network-policy"},{"location":"checks/google/gke/enable-network-policy/#explanation","text":"Enabling a network policy allows the segregation of network traffic by namespace","title":"Explanation"},{"location":"checks/google/gke/enable-network-policy/#possible-impact","text":"Unrestricted inter-cluster communication","title":"Possible Impact"},{"location":"checks/google/gke/enable-network-policy/#suggested-resolution","text":"Enable network policy","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-network-policy/#insecure-example","text":"The following example will fail the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-network-policy/#secure-example","text":"The following example will pass the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/enable-network-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enabled","title":"Related Links"},{"location":"checks/google/gke/enable-private-cluster/","text":"Explanation Enabling private nodes on a cluster ensures the nodes are only available internally as they will only be assigned internal addresses. Possible Impact Nodes may be exposed to the public internet Suggested Resolution Enable private cluster Insecure Example The following example will fail the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_private_nodes","title":"enable-private-cluster"},{"location":"checks/google/gke/enable-private-cluster/#explanation","text":"Enabling private nodes on a cluster ensures the nodes are only available internally as they will only be assigned internal addresses.","title":"Explanation"},{"location":"checks/google/gke/enable-private-cluster/#possible-impact","text":"Nodes may be exposed to the public internet","title":"Possible Impact"},{"location":"checks/google/gke/enable-private-cluster/#suggested-resolution","text":"Enable private cluster","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-private-cluster/#insecure-example","text":"The following example will fail the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-private-cluster/#secure-example","text":"The following example will pass the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/enable-private-cluster/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_private_nodes","title":"Related Links"},{"location":"checks/google/gke/enable-stackdriver-logging/","text":"Explanation StackDriver logging provides a useful interface to all of stdout/stderr for each container and should be enabled for moitoring, debugging, etc. Possible Impact Visibility will be reduced Suggested Resolution Enable StackDriver logging Insecure Example The following example will fail the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#logging_service","title":"enable-stackdriver-logging"},{"location":"checks/google/gke/enable-stackdriver-logging/#explanation","text":"StackDriver logging provides a useful interface to all of stdout/stderr for each container and should be enabled for moitoring, debugging, etc.","title":"Explanation"},{"location":"checks/google/gke/enable-stackdriver-logging/#possible-impact","text":"Visibility will be reduced","title":"Possible Impact"},{"location":"checks/google/gke/enable-stackdriver-logging/#suggested-resolution","text":"Enable StackDriver logging","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-stackdriver-logging/#insecure-example","text":"The following example will fail the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-stackdriver-logging/#secure-example","text":"The following example will pass the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/enable-stackdriver-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#logging_service","title":"Related Links"},{"location":"checks/google/gke/enable-stackdriver-monitoring/","text":"Explanation StackDriver monitoring aggregates logs, events, and metrics from your Kubernetes environment on GKE to help you understand your application's behavior in production. Possible Impact Visibility will be reduced Suggested Resolution Enable StackDriver monitoring Insecure Example The following example will fail the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#monitoring_service","title":"enable-stackdriver-monitoring"},{"location":"checks/google/gke/enable-stackdriver-monitoring/#explanation","text":"StackDriver monitoring aggregates logs, events, and metrics from your Kubernetes environment on GKE to help you understand your application's behavior in production.","title":"Explanation"},{"location":"checks/google/gke/enable-stackdriver-monitoring/#possible-impact","text":"Visibility will be reduced","title":"Possible Impact"},{"location":"checks/google/gke/enable-stackdriver-monitoring/#suggested-resolution","text":"Enable StackDriver monitoring","title":"Suggested Resolution"},{"location":"checks/google/gke/enable-stackdriver-monitoring/#insecure-example","text":"The following example will fail the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/enable-stackdriver-monitoring/#secure-example","text":"The following example will pass the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/enable-stackdriver-monitoring/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#monitoring_service","title":"Related Links"},{"location":"checks/google/gke/enforce-pod-security-policy/","text":"Explanation By default, Pods in Kubernetes can operate with capabilities beyond what they require. You should constrain the Pod's capabilities to only those required for that workload. Kubernetes offers controls for restricting your Pods to execute with only explicitly granted capabilities. Pod Security Policy allows you to set smart defaults for your Pods, and enforce controls you want to enable across your fleet. The policies you define should be specific to the needs of your application Possible Impact Pods could be operating with more permissions than required to be effective Suggested Resolution Use security policies for pods to restrict permissions to those needed to be effective Insecure Example The following example will fail the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"bad_example\" { pod_security_policy_config { enabled = \"false\" } } Secure Example The following example will pass the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"good_example\" { pod_security_policy_config { enabled = \"true\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#pod_security_policy_config https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#admission_controllers","title":"enforce-pod-security-policy"},{"location":"checks/google/gke/enforce-pod-security-policy/#explanation","text":"By default, Pods in Kubernetes can operate with capabilities beyond what they require. You should constrain the Pod's capabilities to only those required for that workload. Kubernetes offers controls for restricting your Pods to execute with only explicitly granted capabilities. Pod Security Policy allows you to set smart defaults for your Pods, and enforce controls you want to enable across your fleet. The policies you define should be specific to the needs of your application","title":"Explanation"},{"location":"checks/google/gke/enforce-pod-security-policy/#possible-impact","text":"Pods could be operating with more permissions than required to be effective","title":"Possible Impact"},{"location":"checks/google/gke/enforce-pod-security-policy/#suggested-resolution","text":"Use security policies for pods to restrict permissions to those needed to be effective","title":"Suggested Resolution"},{"location":"checks/google/gke/enforce-pod-security-policy/#insecure-example","text":"The following example will fail the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"bad_example\" { pod_security_policy_config { enabled = \"false\" } }","title":"Insecure Example"},{"location":"checks/google/gke/enforce-pod-security-policy/#secure-example","text":"The following example will pass the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"good_example\" { pod_security_policy_config { enabled = \"true\" } }","title":"Secure Example"},{"location":"checks/google/gke/enforce-pod-security-policy/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#pod_security_policy_config https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#admission_controllers","title":"Related Links"},{"location":"checks/google/gke/metadata-endpoints-disabled/","text":"Explanation The Compute Engine instance metadata server exposes legacy v0.1 and v1beta1 endpoints, which do not enforce metadata query headers. This is a feature in the v1 APIs that makes it more difficult for a potential attacker to retrieve instance metadata. Unless specifically required, we recommend you disable these legacy APIs. When setting the metadata block, the default value for disable-legacy-endpoints is set to true, they should not be explicitly enabled. Possible Impact Legacy metadata endpoints don't require metadata headers Suggested Resolution Disable legacy metadata endpoints Insecure Example The following example will fail the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"bad_example\" { metadata { disable-legacy-endpoints = false } } Secure Example The following example will pass the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"good_example\" { metadata { disable-legacy-endpoints = true } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#metadata https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#protect_node_metadata_default_for_112","title":"metadata-endpoints-disabled"},{"location":"checks/google/gke/metadata-endpoints-disabled/#explanation","text":"The Compute Engine instance metadata server exposes legacy v0.1 and v1beta1 endpoints, which do not enforce metadata query headers. This is a feature in the v1 APIs that makes it more difficult for a potential attacker to retrieve instance metadata. Unless specifically required, we recommend you disable these legacy APIs. When setting the metadata block, the default value for disable-legacy-endpoints is set to true, they should not be explicitly enabled.","title":"Explanation"},{"location":"checks/google/gke/metadata-endpoints-disabled/#possible-impact","text":"Legacy metadata endpoints don't require metadata headers","title":"Possible Impact"},{"location":"checks/google/gke/metadata-endpoints-disabled/#suggested-resolution","text":"Disable legacy metadata endpoints","title":"Suggested Resolution"},{"location":"checks/google/gke/metadata-endpoints-disabled/#insecure-example","text":"The following example will fail the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"bad_example\" { metadata { disable-legacy-endpoints = false } }","title":"Insecure Example"},{"location":"checks/google/gke/metadata-endpoints-disabled/#secure-example","text":"The following example will pass the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"good_example\" { metadata { disable-legacy-endpoints = true } }","title":"Secure Example"},{"location":"checks/google/gke/metadata-endpoints-disabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#metadata https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#protect_node_metadata_default_for_112","title":"Related Links"},{"location":"checks/google/gke/no-legacy-auth/","text":"Explanation Client certificates are the most secure and recommended method of authentication. Possible Impact Less secure authentication method in use Suggested Resolution Use client certificates for authentication Insecure Example The following example will fail the google-gke-no-legacy-auth check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_auth { client_certificate_config { issue_client_certificate = true } } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-no-legacy-auth check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#restrict_authn_methods","title":"no-legacy-auth"},{"location":"checks/google/gke/no-legacy-auth/#explanation","text":"Client certificates are the most secure and recommended method of authentication.","title":"Explanation"},{"location":"checks/google/gke/no-legacy-auth/#possible-impact","text":"Less secure authentication method in use","title":"Possible Impact"},{"location":"checks/google/gke/no-legacy-auth/#suggested-resolution","text":"Use client certificates for authentication","title":"Suggested Resolution"},{"location":"checks/google/gke/no-legacy-auth/#insecure-example","text":"The following example will fail the google-gke-no-legacy-auth check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_auth { client_certificate_config { issue_client_certificate = true } } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/no-legacy-auth/#secure-example","text":"The following example will pass the google-gke-no-legacy-auth check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/no-legacy-auth/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#restrict_authn_methods","title":"Related Links"},{"location":"checks/google/gke/no-legacy-authentication/","text":"Explanation It is recommended to use Service Accounts and OAuth as authentication methods for accessing the master in the container cluster. Basic authentication should be disabled by explicitly unsetting the username and password on the master_auth block. Possible Impact Username and password authentication methods are less secure Suggested Resolution Use service account or OAuth for authentication Insecure Example The following example will fail the google-gke-no-legacy-authentication check. resource \"google_container_cluster\" \"bad_example\" { } resource \"google_container_cluster\" \"gke\" { master_auth { username = \"\" password = \"\" client_certificate_config { issue_client_certificate = true } } } Secure Example The following example will pass the google-gke-no-legacy-authentication check. resource \"google_container_cluster\" \"good_example\" { master_auth { username = \"\" password = \"\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#restrict_authn_methods","title":"no-legacy-authentication"},{"location":"checks/google/gke/no-legacy-authentication/#explanation","text":"It is recommended to use Service Accounts and OAuth as authentication methods for accessing the master in the container cluster. Basic authentication should be disabled by explicitly unsetting the username and password on the master_auth block.","title":"Explanation"},{"location":"checks/google/gke/no-legacy-authentication/#possible-impact","text":"Username and password authentication methods are less secure","title":"Possible Impact"},{"location":"checks/google/gke/no-legacy-authentication/#suggested-resolution","text":"Use service account or OAuth for authentication","title":"Suggested Resolution"},{"location":"checks/google/gke/no-legacy-authentication/#insecure-example","text":"The following example will fail the google-gke-no-legacy-authentication check. resource \"google_container_cluster\" \"bad_example\" { } resource \"google_container_cluster\" \"gke\" { master_auth { username = \"\" password = \"\" client_certificate_config { issue_client_certificate = true } } }","title":"Insecure Example"},{"location":"checks/google/gke/no-legacy-authentication/#secure-example","text":"The following example will pass the google-gke-no-legacy-authentication check. resource \"google_container_cluster\" \"good_example\" { master_auth { username = \"\" password = \"\" } }","title":"Secure Example"},{"location":"checks/google/gke/no-legacy-authentication/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#restrict_authn_methods","title":"Related Links"},{"location":"checks/google/gke/no-public-control-plane/","text":"Explanation The GKE control plane is exposed to the public internet by default. Possible Impact GKE control plane exposed to public internet Suggested Resolution Use private nodes and master authorised networks to prevent exposure Insecure Example The following example will fail the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"0.0.0.0/0\" display_name = \"external\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#","title":"no-public-control-plane"},{"location":"checks/google/gke/no-public-control-plane/#explanation","text":"The GKE control plane is exposed to the public internet by default.","title":"Explanation"},{"location":"checks/google/gke/no-public-control-plane/#possible-impact","text":"GKE control plane exposed to public internet","title":"Possible Impact"},{"location":"checks/google/gke/no-public-control-plane/#suggested-resolution","text":"Use private nodes and master authorised networks to prevent exposure","title":"Suggested Resolution"},{"location":"checks/google/gke/no-public-control-plane/#insecure-example","text":"The following example will fail the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"0.0.0.0/0\" display_name = \"external\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/no-public-control-plane/#secure-example","text":"The following example will pass the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/no-public-control-plane/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#","title":"Related Links"},{"location":"checks/google/gke/node-metadata-security/","text":"Explanation If the workload_metadata_config block within node_config is included, the node_metadata attribute should be configured securely. The attribute should be set to SECURE to use metadata concealment, or GKE_METADATA_SERVER if workload identity is enabled. This ensures that the VM metadata is not unnecessarily exposed to pods. Possible Impact Metadata that isn't concealed potentially risks leakage of sensitive data Suggested Resolution Set node metadata to SECURE or GKE_METADATA_SERVER Insecure Example The following example will fail the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"bad_example\" { node_config { workload_metadata_config { node_metadata = \"EXPOSE\" } } } Secure Example The following example will pass the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"good_example\" { node_config { workload_metadata_config { node_metadata = \"SECURE\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#node_metadata https://cloud.google.com/kubernetes-engine/docs/how-to/protecting-cluster-metadata#create-concealed","title":"node-metadata-security"},{"location":"checks/google/gke/node-metadata-security/#explanation","text":"If the workload_metadata_config block within node_config is included, the node_metadata attribute should be configured securely. The attribute should be set to SECURE to use metadata concealment, or GKE_METADATA_SERVER if workload identity is enabled. This ensures that the VM metadata is not unnecessarily exposed to pods.","title":"Explanation"},{"location":"checks/google/gke/node-metadata-security/#possible-impact","text":"Metadata that isn't concealed potentially risks leakage of sensitive data","title":"Possible Impact"},{"location":"checks/google/gke/node-metadata-security/#suggested-resolution","text":"Set node metadata to SECURE or GKE_METADATA_SERVER","title":"Suggested Resolution"},{"location":"checks/google/gke/node-metadata-security/#insecure-example","text":"The following example will fail the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"bad_example\" { node_config { workload_metadata_config { node_metadata = \"EXPOSE\" } } }","title":"Insecure Example"},{"location":"checks/google/gke/node-metadata-security/#secure-example","text":"The following example will pass the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"good_example\" { node_config { workload_metadata_config { node_metadata = \"SECURE\" } } }","title":"Secure Example"},{"location":"checks/google/gke/node-metadata-security/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#node_metadata https://cloud.google.com/kubernetes-engine/docs/how-to/protecting-cluster-metadata#create-concealed","title":"Related Links"},{"location":"checks/google/gke/node-pool-uses-cos/","text":"Explanation GKE supports several OS image types but COS_CONTAINERD is the recommended OS image to use on cluster nodes for enhanced security Possible Impact COS_CONTAINERD is the recommended OS image to use on cluster nodes Suggested Resolution Use the COS_CONTAINERD image type Insecure Example The following example will fail the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"something\" } } Secure Example The following example will pass the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"COS_CONTAINERD\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#image_type https://cloud.google.com/kubernetes-engine/docs/concepts/node-images","title":"node-pool-uses-cos"},{"location":"checks/google/gke/node-pool-uses-cos/#explanation","text":"GKE supports several OS image types but COS_CONTAINERD is the recommended OS image to use on cluster nodes for enhanced security","title":"Explanation"},{"location":"checks/google/gke/node-pool-uses-cos/#possible-impact","text":"COS_CONTAINERD is the recommended OS image to use on cluster nodes","title":"Possible Impact"},{"location":"checks/google/gke/node-pool-uses-cos/#suggested-resolution","text":"Use the COS_CONTAINERD image type","title":"Suggested Resolution"},{"location":"checks/google/gke/node-pool-uses-cos/#insecure-example","text":"The following example will fail the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"something\" } }","title":"Insecure Example"},{"location":"checks/google/gke/node-pool-uses-cos/#secure-example","text":"The following example will pass the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"COS_CONTAINERD\" } }","title":"Secure Example"},{"location":"checks/google/gke/node-pool-uses-cos/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#image_type https://cloud.google.com/kubernetes-engine/docs/concepts/node-images","title":"Related Links"},{"location":"checks/google/gke/node-shielding-enabled/","text":"Explanation CIS GKE Benchmark Recommendation: 6.5.5. Ensure Shielded GKE Nodes are Enabled Shielded GKE Nodes provide strong, verifiable node identity and integrity to increase the security of GKE nodes and should be enabled on all GKE clusters. Possible Impact Node identity and integrity can't be verified without shielded GKE nodes Suggested Resolution Enable node shielding Insecure Example The following example will fail the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"bad_example\" { enable_shielded_nodes = \"false\" } Secure Example The following example will pass the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"good_example\" { enable_shielded_nodes = \"true\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_shielded_nodes https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#shielded_nodes","title":"node-shielding-enabled"},{"location":"checks/google/gke/node-shielding-enabled/#explanation","text":"CIS GKE Benchmark Recommendation: 6.5.5. Ensure Shielded GKE Nodes are Enabled Shielded GKE Nodes provide strong, verifiable node identity and integrity to increase the security of GKE nodes and should be enabled on all GKE clusters.","title":"Explanation"},{"location":"checks/google/gke/node-shielding-enabled/#possible-impact","text":"Node identity and integrity can't be verified without shielded GKE nodes","title":"Possible Impact"},{"location":"checks/google/gke/node-shielding-enabled/#suggested-resolution","text":"Enable node shielding","title":"Suggested Resolution"},{"location":"checks/google/gke/node-shielding-enabled/#insecure-example","text":"The following example will fail the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"bad_example\" { enable_shielded_nodes = \"false\" }","title":"Insecure Example"},{"location":"checks/google/gke/node-shielding-enabled/#secure-example","text":"The following example will pass the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"good_example\" { enable_shielded_nodes = \"true\" }","title":"Secure Example"},{"location":"checks/google/gke/node-shielding-enabled/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_shielded_nodes https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#shielded_nodes","title":"Related Links"},{"location":"checks/google/gke/use-cluster-labels/","text":"Explanation Labels make it easier to manage assets and differentiate between clusters and environments, allowing the mapping of computational resources to the wider organisational structure. Possible Impact Asset management can be limited/more difficult Suggested Resolution Set cluster resource labels Insecure Example The following example will fail the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 resource_labels = { \"env\" = \"staging\" } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#resource_labels","title":"use-cluster-labels"},{"location":"checks/google/gke/use-cluster-labels/#explanation","text":"Labels make it easier to manage assets and differentiate between clusters and environments, allowing the mapping of computational resources to the wider organisational structure.","title":"Explanation"},{"location":"checks/google/gke/use-cluster-labels/#possible-impact","text":"Asset management can be limited/more difficult","title":"Possible Impact"},{"location":"checks/google/gke/use-cluster-labels/#suggested-resolution","text":"Set cluster resource labels","title":"Suggested Resolution"},{"location":"checks/google/gke/use-cluster-labels/#insecure-example","text":"The following example will fail the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Insecure Example"},{"location":"checks/google/gke/use-cluster-labels/#secure-example","text":"The following example will pass the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 resource_labels = { \"env\" = \"staging\" } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }","title":"Secure Example"},{"location":"checks/google/gke/use-cluster-labels/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#resource_labels","title":"Related Links"},{"location":"checks/google/gke/use-rbac-permissions/","text":"Explanation You should disable Attribute-Based Access Control (ABAC), and instead use Role-Based Access Control (RBAC) in GKE. RBAC has significant security advantages and is now stable in Kubernetes, so it\u2019s time to disable ABAC. Possible Impact ABAC permissions are less secure than RBAC permissions Suggested Resolution Switch to using RBAC permissions Insecure Example The following example will fail the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"bad_example\" { enable_legacy_abac = \"true\" } Secure Example The following example will pass the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"good_example\" { # ... # enable_legacy_abac not set # ... } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_legacy_abac https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#leave_abac_disabled_default_for_110","title":"use-rbac-permissions"},{"location":"checks/google/gke/use-rbac-permissions/#explanation","text":"You should disable Attribute-Based Access Control (ABAC), and instead use Role-Based Access Control (RBAC) in GKE. RBAC has significant security advantages and is now stable in Kubernetes, so it\u2019s time to disable ABAC.","title":"Explanation"},{"location":"checks/google/gke/use-rbac-permissions/#possible-impact","text":"ABAC permissions are less secure than RBAC permissions","title":"Possible Impact"},{"location":"checks/google/gke/use-rbac-permissions/#suggested-resolution","text":"Switch to using RBAC permissions","title":"Suggested Resolution"},{"location":"checks/google/gke/use-rbac-permissions/#insecure-example","text":"The following example will fail the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"bad_example\" { enable_legacy_abac = \"true\" }","title":"Insecure Example"},{"location":"checks/google/gke/use-rbac-permissions/#secure-example","text":"The following example will pass the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"good_example\" { # ... # enable_legacy_abac not set # ... }","title":"Secure Example"},{"location":"checks/google/gke/use-rbac-permissions/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_legacy_abac https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#leave_abac_disabled_default_for_110","title":"Related Links"},{"location":"checks/google/gke/use-service-account/","text":"Explanation You should create and use a minimally privileged service account to run your GKE cluster instead of using the Compute Engine default service account. Possible Impact Service accounts with wide permissions can increase the risk of compromise Suggested Resolution Use limited permissions for service accounts to be effective Insecure Example The following example will fail the google-gke-use-service-account check. resource \"google_container_cluster\" \"bad_example\" { node_config { } } Secure Example The following example will pass the google-gke-use-service-account check. resource \"google_container_cluster\" \"good_example\" { node_config { service_account = \"cool-service-account@example.com\" } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#service_account https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa","title":"use-service-account"},{"location":"checks/google/gke/use-service-account/#explanation","text":"You should create and use a minimally privileged service account to run your GKE cluster instead of using the Compute Engine default service account.","title":"Explanation"},{"location":"checks/google/gke/use-service-account/#possible-impact","text":"Service accounts with wide permissions can increase the risk of compromise","title":"Possible Impact"},{"location":"checks/google/gke/use-service-account/#suggested-resolution","text":"Use limited permissions for service accounts to be effective","title":"Suggested Resolution"},{"location":"checks/google/gke/use-service-account/#insecure-example","text":"The following example will fail the google-gke-use-service-account check. resource \"google_container_cluster\" \"bad_example\" { node_config { } }","title":"Insecure Example"},{"location":"checks/google/gke/use-service-account/#secure-example","text":"The following example will pass the google-gke-use-service-account check. resource \"google_container_cluster\" \"good_example\" { node_config { service_account = \"cool-service-account@example.com\" } }","title":"Secure Example"},{"location":"checks/google/gke/use-service-account/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#service_account https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa","title":"Related Links"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/","text":"Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam","title":"no-folder-level-default-service-account-assignment"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/#explanation","text":"Default service accounts should not be used - consider creating specialised service accounts for individual purposes.","title":"Explanation"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/#possible-impact","text":"Violation of principal of least privilege","title":"Possible Impact"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/#suggested-resolution","text":"Use specialised service accounts for specific purposes.","title":"Suggested Resolution"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/#insecure-example","text":"The following example will fail the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/#secure-example","text":"The following example will pass the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }","title":"Secure Example"},{"location":"checks/google/iam/no-folder-level-default-service-account-assignment/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam","title":"Related Links"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/","text":"Explanation Users with service account access at folder level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of folder-level, if required Insecure Example The following example will fail the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/nothingInParticular\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam https://cloud.google.com/iam/docs/impersonating-service-accounts","title":"no-folder-level-service-account-impersonation"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/#explanation","text":"Users with service account access at folder level can impersonate any service account. Instead, they should be given access to particular service accounts as required.","title":"Explanation"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/#possible-impact","text":"Privilege escalation, impersonation of any/all services","title":"Possible Impact"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/#suggested-resolution","text":"Provide access at the service-level instead of folder-level, if required","title":"Suggested Resolution"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/#insecure-example","text":"The following example will fail the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/iam.serviceAccountUser\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/#secure-example","text":"The following example will pass the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/nothingInParticular\" }","title":"Secure Example"},{"location":"checks/google/iam/no-folder-level-service-account-impersonation/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam https://cloud.google.com/iam/docs/impersonating-service-accounts","title":"Related Links"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/","text":"Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-iam-no-org-level-default-service-account-assignment check. resource \"google_organization_iam_member\" \"org-123\" { org_id = \"organization-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-iam-no-org-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_organization_iam_member\" \"org-123\" { org_id = \"org-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam","title":"no-org-level-default-service-account-assignment"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/#explanation","text":"Default service accounts should not be used - consider creating specialised service accounts for individual purposes.","title":"Explanation"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/#possible-impact","text":"Violation of principal of least privilege","title":"Possible Impact"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/#suggested-resolution","text":"Use specialised service accounts for specific purposes.","title":"Suggested Resolution"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/#insecure-example","text":"The following example will fail the google-iam-no-org-level-default-service-account-assignment check. resource \"google_organization_iam_member\" \"org-123\" { org_id = \"organization-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/#secure-example","text":"The following example will pass the google-iam-no-org-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_organization_iam_member\" \"org-123\" { org_id = \"org-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }","title":"Secure Example"},{"location":"checks/google/iam/no-org-level-default-service-account-assignment/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam","title":"Related Links"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/","text":"Explanation Users with service account access at organization level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of organization-level, if required Insecure Example The following example will fail the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/nothingInParticular\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam https://cloud.google.com/iam/docs/impersonating-service-accounts","title":"no-org-level-service-account-impersonation"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/#explanation","text":"Users with service account access at organization level can impersonate any service account. Instead, they should be given access to particular service accounts as required.","title":"Explanation"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/#possible-impact","text":"Privilege escalation, impersonation of any/all services","title":"Possible Impact"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/#suggested-resolution","text":"Provide access at the service-level instead of organization-level, if required","title":"Suggested Resolution"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/#insecure-example","text":"The following example will fail the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/iam.serviceAccountUser\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/#secure-example","text":"The following example will pass the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/nothingInParticular\" }","title":"Secure Example"},{"location":"checks/google/iam/no-org-level-service-account-impersonation/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam https://cloud.google.com/iam/docs/impersonating-service-accounts","title":"Related Links"},{"location":"checks/google/iam/no-privileged-service-accounts/","text":"Explanation Service accounts should have a minimal set of permissions assigned in order to do their job. They should never have excessive access as if compromised, an attacker can escalate privileges and take over the entire account. Possible Impact Cloud account takeover if a resource using a service account is compromised Suggested Resolution Limit service account access to minimal required set Insecure Example The following example will fail the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/owner\" member = \"serviceAccount:${google_service_account.test.email}\" } Secure Example The following example will pass the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/logging.logWriter\" member = \"serviceAccount:${google_service_account.test.email}\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/understanding-roles","title":"no-privileged-service-accounts"},{"location":"checks/google/iam/no-privileged-service-accounts/#explanation","text":"Service accounts should have a minimal set of permissions assigned in order to do their job. They should never have excessive access as if compromised, an attacker can escalate privileges and take over the entire account.","title":"Explanation"},{"location":"checks/google/iam/no-privileged-service-accounts/#possible-impact","text":"Cloud account takeover if a resource using a service account is compromised","title":"Possible Impact"},{"location":"checks/google/iam/no-privileged-service-accounts/#suggested-resolution","text":"Limit service account access to minimal required set","title":"Suggested Resolution"},{"location":"checks/google/iam/no-privileged-service-accounts/#insecure-example","text":"The following example will fail the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/owner\" member = \"serviceAccount:${google_service_account.test.email}\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-privileged-service-accounts/#secure-example","text":"The following example will pass the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/logging.logWriter\" member = \"serviceAccount:${google_service_account.test.email}\" }","title":"Secure Example"},{"location":"checks/google/iam/no-privileged-service-accounts/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/understanding-roles","title":"Related Links"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/","text":"Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-iam-no-project-level-default-service-account-assignment check. resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-iam-no-project-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam","title":"no-project-level-default-service-account-assignment"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/#explanation","text":"Default service accounts should not be used - consider creating specialised service accounts for individual purposes.","title":"Explanation"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/#possible-impact","text":"Violation of principal of least privilege","title":"Possible Impact"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/#suggested-resolution","text":"Use specialised service accounts for specific purposes.","title":"Suggested Resolution"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/#insecure-example","text":"The following example will fail the google-iam-no-project-level-default-service-account-assignment check. resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/#secure-example","text":"The following example will pass the google-iam-no-project-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }","title":"Secure Example"},{"location":"checks/google/iam/no-project-level-default-service-account-assignment/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam","title":"Related Links"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/","text":"Explanation Users with service account access at project level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of project-level, if required Insecure Example The following example will fail the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/nothingInParticular\" } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/impersonating-service-accounts","title":"no-project-level-service-account-impersonation"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/#explanation","text":"Users with service account access at project level can impersonate any service account. Instead, they should be given access to particular service accounts as required.","title":"Explanation"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/#possible-impact","text":"Privilege escalation, impersonation of any/all services","title":"Possible Impact"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/#suggested-resolution","text":"Provide access at the service-level instead of project-level, if required","title":"Suggested Resolution"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/#insecure-example","text":"The following example will fail the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/iam.serviceAccountUser\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/#secure-example","text":"The following example will pass the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/nothingInParticular\" }","title":"Secure Example"},{"location":"checks/google/iam/no-project-level-service-account-impersonation/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/impersonating-service-accounts","title":"Related Links"},{"location":"checks/google/iam/no-user-granted-permissions/","text":"Explanation Permissions should not be directly granted to users, you identify roles that contain the appropriate permissions, and then grant those roles to the user. Granting permissions to users quickly become unwieldy and complex to make large scale changes to remove access to a particular resource. Permissions should be granted on roles, groups, services accounts instead. Possible Impact Users shouldn't have permissions granted to them directly Suggested Resolution Roles should be granted permissions and assigned to users Insecure Example The following example will fail the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"bad_example\" { members = [ \"user:test@example.com\" , ] } resource \"google_project_iam_member\" \"bad_example\" { member = \"user:test@example.com\" } Secure Example The following example will pass the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"good_example\" { members = [ \"group:test@example.com\" , ] } resource \"google_storage_bucket_iam_member\" \"good_example\" { member = \"serviceAccount:test@example.com\" } Related Links https://www.terraform.io/docs/providers/google/d/iam_policy.html#members https://cloud.google.com/iam/docs/overview#permissions https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy","title":"no-user-granted-permissions"},{"location":"checks/google/iam/no-user-granted-permissions/#explanation","text":"Permissions should not be directly granted to users, you identify roles that contain the appropriate permissions, and then grant those roles to the user. Granting permissions to users quickly become unwieldy and complex to make large scale changes to remove access to a particular resource. Permissions should be granted on roles, groups, services accounts instead.","title":"Explanation"},{"location":"checks/google/iam/no-user-granted-permissions/#possible-impact","text":"Users shouldn't have permissions granted to them directly","title":"Possible Impact"},{"location":"checks/google/iam/no-user-granted-permissions/#suggested-resolution","text":"Roles should be granted permissions and assigned to users","title":"Suggested Resolution"},{"location":"checks/google/iam/no-user-granted-permissions/#insecure-example","text":"The following example will fail the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"bad_example\" { members = [ \"user:test@example.com\" , ] } resource \"google_project_iam_member\" \"bad_example\" { member = \"user:test@example.com\" }","title":"Insecure Example"},{"location":"checks/google/iam/no-user-granted-permissions/#secure-example","text":"The following example will pass the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"good_example\" { members = [ \"group:test@example.com\" , ] } resource \"google_storage_bucket_iam_member\" \"good_example\" { member = \"serviceAccount:test@example.com\" }","title":"Secure Example"},{"location":"checks/google/iam/no-user-granted-permissions/#related-links","text":"https://www.terraform.io/docs/providers/google/d/iam_policy.html#members https://cloud.google.com/iam/docs/overview#permissions https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy","title":"Related Links"},{"location":"checks/google/kms/rotate-kms-keys/","text":"Explanation Keys should be rotated on a regular basis to limit exposure if a given key should become compromised. Possible Impact Exposure is greater if the same keys are used over a long period Suggested Resolution Set key rotation period to 90 days Insecure Example The following example will fail the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"15552000s\" lifecycle { prevent_destroy = true } } Secure Example The following example will pass the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"7776000s\" lifecycle { prevent_destroy = true } } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id algorithm = \"EXTERNAL_SYMMETRIC_ENCRYPTION\" protectionLevel = \"EXTERNAL\" lifecycle { prevent_destroy = true } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/kms_crypto_key#rotation_period","title":"rotate-kms-keys"},{"location":"checks/google/kms/rotate-kms-keys/#explanation","text":"Keys should be rotated on a regular basis to limit exposure if a given key should become compromised.","title":"Explanation"},{"location":"checks/google/kms/rotate-kms-keys/#possible-impact","text":"Exposure is greater if the same keys are used over a long period","title":"Possible Impact"},{"location":"checks/google/kms/rotate-kms-keys/#suggested-resolution","text":"Set key rotation period to 90 days","title":"Suggested Resolution"},{"location":"checks/google/kms/rotate-kms-keys/#insecure-example","text":"The following example will fail the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"15552000s\" lifecycle { prevent_destroy = true } }","title":"Insecure Example"},{"location":"checks/google/kms/rotate-kms-keys/#secure-example","text":"The following example will pass the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"7776000s\" lifecycle { prevent_destroy = true } } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id algorithm = \"EXTERNAL_SYMMETRIC_ENCRYPTION\" protectionLevel = \"EXTERNAL\" lifecycle { prevent_destroy = true } }","title":"Secure Example"},{"location":"checks/google/kms/rotate-kms-keys/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/kms_crypto_key#rotation_period","title":"Related Links"},{"location":"checks/google/project/no-default-network/","text":"Explanation The default network which is provided for a project contains multiple insecure firewall rules which allow ingress to the project's infrastructure. Creation of this network should therefore be disabled. Possible Impact Exposure of internal infrastructure/services to public internet Suggested Resolution Disable automatic default network creation Insecure Example The following example will fail the google-project-no-default-network check. resource \"google_project\" \"bad_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = true } Secure Example The following example will pass the google-project-no-default-network check. resource \"google_project\" \"good_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = false } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#auto_create_network","title":"no-default-network"},{"location":"checks/google/project/no-default-network/#explanation","text":"The default network which is provided for a project contains multiple insecure firewall rules which allow ingress to the project's infrastructure. Creation of this network should therefore be disabled.","title":"Explanation"},{"location":"checks/google/project/no-default-network/#possible-impact","text":"Exposure of internal infrastructure/services to public internet","title":"Possible Impact"},{"location":"checks/google/project/no-default-network/#suggested-resolution","text":"Disable automatic default network creation","title":"Suggested Resolution"},{"location":"checks/google/project/no-default-network/#insecure-example","text":"The following example will fail the google-project-no-default-network check. resource \"google_project\" \"bad_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = true }","title":"Insecure Example"},{"location":"checks/google/project/no-default-network/#secure-example","text":"The following example will pass the google-project-no-default-network check. resource \"google_project\" \"good_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = false }","title":"Secure Example"},{"location":"checks/google/project/no-default-network/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#auto_create_network","title":"Related Links"},{"location":"checks/google/sql/enable-backup/","text":"Explanation Automated backups are not enabled by default. Backups are an easy way to restore data in a corruption or data-loss scenario. Possible Impact No recovery of lost or corrupted data Suggested Resolution Enable automated backups Insecure Example The following example will fail the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = false } } } Secure Example The following example will pass the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = true } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance#settings.backup_configuration.enabled=true https://cloud.google.com/sql/docs/mysql/backup-recovery/backups","title":"enable-backup"},{"location":"checks/google/sql/enable-backup/#explanation","text":"Automated backups are not enabled by default. Backups are an easy way to restore data in a corruption or data-loss scenario.","title":"Explanation"},{"location":"checks/google/sql/enable-backup/#possible-impact","text":"No recovery of lost or corrupted data","title":"Possible Impact"},{"location":"checks/google/sql/enable-backup/#suggested-resolution","text":"Enable automated backups","title":"Suggested Resolution"},{"location":"checks/google/sql/enable-backup/#insecure-example","text":"The following example will fail the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = false } } }","title":"Insecure Example"},{"location":"checks/google/sql/enable-backup/#secure-example","text":"The following example will pass the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = true } } }","title":"Secure Example"},{"location":"checks/google/sql/enable-backup/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance#settings.backup_configuration.enabled=true https://cloud.google.com/sql/docs/mysql/backup-recovery/backups","title":"Related Links"},{"location":"checks/google/sql/enable-pg-temp-file-logging/","text":"Explanation Temporary files are not logged by default. To log all temporary files, a value of 0 should set in the log_temp_files flag - as all files greater in size than the number of bytes set in this flag will be logged. Possible Impact Use of temporary files will not be logged Suggested Resolution Enable temporary file logging for all files Insecure Example The following example will fail the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" } Secure Example The following example will pass the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_temp_files\" value = \"0\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_temp_files/","title":"enable-pg-temp-file-logging"},{"location":"checks/google/sql/enable-pg-temp-file-logging/#explanation","text":"Temporary files are not logged by default. To log all temporary files, a value of 0 should set in the log_temp_files flag - as all files greater in size than the number of bytes set in this flag will be logged.","title":"Explanation"},{"location":"checks/google/sql/enable-pg-temp-file-logging/#possible-impact","text":"Use of temporary files will not be logged","title":"Possible Impact"},{"location":"checks/google/sql/enable-pg-temp-file-logging/#suggested-resolution","text":"Enable temporary file logging for all files","title":"Suggested Resolution"},{"location":"checks/google/sql/enable-pg-temp-file-logging/#insecure-example","text":"The following example will fail the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" }","title":"Insecure Example"},{"location":"checks/google/sql/enable-pg-temp-file-logging/#secure-example","text":"The following example will pass the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_temp_files\" value = \"0\" } } }","title":"Secure Example"},{"location":"checks/google/sql/enable-pg-temp-file-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_temp_files/","title":"Related Links"},{"location":"checks/google/sql/encrypt-in-transit-data/","text":"Explanation In-transit data should be encrypted so that if traffic is intercepted data will not be exposed in plaintext to attackers. Possible Impact Intercepted data can be read in transit Suggested Resolution Enforce SSL for all connections Insecure Example The following example will fail the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = false } } } Secure Example The following example will pass the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = true } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://cloud.google.com/sql/docs/mysql/configure-ssl-instance","title":"encrypt-in-transit-data"},{"location":"checks/google/sql/encrypt-in-transit-data/#explanation","text":"In-transit data should be encrypted so that if traffic is intercepted data will not be exposed in plaintext to attackers.","title":"Explanation"},{"location":"checks/google/sql/encrypt-in-transit-data/#possible-impact","text":"Intercepted data can be read in transit","title":"Possible Impact"},{"location":"checks/google/sql/encrypt-in-transit-data/#suggested-resolution","text":"Enforce SSL for all connections","title":"Suggested Resolution"},{"location":"checks/google/sql/encrypt-in-transit-data/#insecure-example","text":"The following example will fail the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = false } } }","title":"Insecure Example"},{"location":"checks/google/sql/encrypt-in-transit-data/#secure-example","text":"The following example will pass the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = true } } }","title":"Secure Example"},{"location":"checks/google/sql/encrypt-in-transit-data/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://cloud.google.com/sql/docs/mysql/configure-ssl-instance","title":"Related Links"},{"location":"checks/google/sql/mysql-no-local-infile/","text":"Explanation Arbitrary files can be read from the system using LOAD_DATA unless this setting is disabled. Possible Impact Arbitrary files read by attackers when combined with a SQL injection vulnerability. Suggested Resolution Disable the local infile setting Insecure Example The following example will fail the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"on\" } } } Secure Example The following example will pass the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"off\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html","title":"mysql-no-local-infile"},{"location":"checks/google/sql/mysql-no-local-infile/#explanation","text":"Arbitrary files can be read from the system using LOAD_DATA unless this setting is disabled.","title":"Explanation"},{"location":"checks/google/sql/mysql-no-local-infile/#possible-impact","text":"Arbitrary files read by attackers when combined with a SQL injection vulnerability.","title":"Possible Impact"},{"location":"checks/google/sql/mysql-no-local-infile/#suggested-resolution","text":"Disable the local infile setting","title":"Suggested Resolution"},{"location":"checks/google/sql/mysql-no-local-infile/#insecure-example","text":"The following example will fail the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"on\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/mysql-no-local-infile/#secure-example","text":"The following example will pass the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"off\" } } }","title":"Secure Example"},{"location":"checks/google/sql/mysql-no-local-infile/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html","title":"Related Links"},{"location":"checks/google/sql/no-contained-db-auth/","text":"Explanation Users with ALTER permissions on users can grant access to a contained database without the knowledge of an administrator Possible Impact Access can be granted without knowledge of the database administrator Suggested Resolution Disable contained database authentication Insecure Example The following example will fail the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" } Secure Example The following example will pass the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"contained database authentication\" value = \"off\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/contained-database-authentication-server-configuration-option?view=sql-server-ver15","title":"no-contained-db-auth"},{"location":"checks/google/sql/no-contained-db-auth/#explanation","text":"Users with ALTER permissions on users can grant access to a contained database without the knowledge of an administrator","title":"Explanation"},{"location":"checks/google/sql/no-contained-db-auth/#possible-impact","text":"Access can be granted without knowledge of the database administrator","title":"Possible Impact"},{"location":"checks/google/sql/no-contained-db-auth/#suggested-resolution","text":"Disable contained database authentication","title":"Suggested Resolution"},{"location":"checks/google/sql/no-contained-db-auth/#insecure-example","text":"The following example will fail the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" }","title":"Insecure Example"},{"location":"checks/google/sql/no-contained-db-auth/#secure-example","text":"The following example will pass the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"contained database authentication\" value = \"off\" } } }","title":"Secure Example"},{"location":"checks/google/sql/no-contained-db-auth/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/contained-database-authentication-server-configuration-option?view=sql-server-ver15","title":"Related Links"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/","text":"Explanation Cross-database ownership chaining, also known as cross-database chaining, is a security feature of SQL Server that allows users of databases access to other databases besides the one they are currently using. Possible Impact Unintended access to sensitive data Suggested Resolution Disable cross database ownership chaining Insecure Example The following example will fail the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" } Secure Example The following example will pass the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"cross db ownership chaining\" value = \"off\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15","title":"no-cross-db-ownership-chaining"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/#explanation","text":"Cross-database ownership chaining, also known as cross-database chaining, is a security feature of SQL Server that allows users of databases access to other databases besides the one they are currently using.","title":"Explanation"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/#possible-impact","text":"Unintended access to sensitive data","title":"Possible Impact"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/#suggested-resolution","text":"Disable cross database ownership chaining","title":"Suggested Resolution"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/#insecure-example","text":"The following example will fail the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" }","title":"Insecure Example"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/#secure-example","text":"The following example will pass the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"cross db ownership chaining\" value = \"off\" } } }","title":"Secure Example"},{"location":"checks/google/sql/no-cross-db-ownership-chaining/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15","title":"Related Links"},{"location":"checks/google/sql/no-public-access/","text":"Explanation Database instances should be configured so that they are not available over the public internet, but to internal compute resources which access them. Possible Impact Public exposure of sensitive data Suggested Resolution Remove public access from database instances Insecure Example The following example will fail the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } authorized_networks { value = \"0.0.0.0/0\" name = \"internet\" } } } } Secure Example The following example will pass the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.cloudconformity.com/knowledge-base/gcp/CloudSQL/publicly-accessible-cloud-sql-instances.html","title":"no-public-access"},{"location":"checks/google/sql/no-public-access/#explanation","text":"Database instances should be configured so that they are not available over the public internet, but to internal compute resources which access them.","title":"Explanation"},{"location":"checks/google/sql/no-public-access/#possible-impact","text":"Public exposure of sensitive data","title":"Possible Impact"},{"location":"checks/google/sql/no-public-access/#suggested-resolution","text":"Remove public access from database instances","title":"Suggested Resolution"},{"location":"checks/google/sql/no-public-access/#insecure-example","text":"The following example will fail the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } authorized_networks { value = \"0.0.0.0/0\" name = \"internet\" } } } }","title":"Insecure Example"},{"location":"checks/google/sql/no-public-access/#secure-example","text":"The following example will pass the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } } } }","title":"Secure Example"},{"location":"checks/google/sql/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.cloudconformity.com/knowledge-base/gcp/CloudSQL/publicly-accessible-cloud-sql-instances.html","title":"Related Links"},{"location":"checks/google/sql/pg-log-checkpoints/","text":"Explanation Logging checkpoints provides useful diagnostic data, which can identify performance issues in an application and potential DoS vectors. Possible Impact Insufficient diagnostic data. Suggested Resolution Enable checkpoints logging. Insecure Example The following example will fail the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"on\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CHECKPOINTS","title":"pg-log-checkpoints"},{"location":"checks/google/sql/pg-log-checkpoints/#explanation","text":"Logging checkpoints provides useful diagnostic data, which can identify performance issues in an application and potential DoS vectors.","title":"Explanation"},{"location":"checks/google/sql/pg-log-checkpoints/#possible-impact","text":"Insufficient diagnostic data.","title":"Possible Impact"},{"location":"checks/google/sql/pg-log-checkpoints/#suggested-resolution","text":"Enable checkpoints logging.","title":"Suggested Resolution"},{"location":"checks/google/sql/pg-log-checkpoints/#insecure-example","text":"The following example will fail the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"off\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/pg-log-checkpoints/#secure-example","text":"The following example will pass the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"on\" } } }","title":"Secure Example"},{"location":"checks/google/sql/pg-log-checkpoints/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CHECKPOINTS","title":"Related Links"},{"location":"checks/google/sql/pg-log-connections/","text":"Explanation Logging connections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors. Possible Impact Insufficient diagnostic data. Suggested Resolution Enable connection logging. Insecure Example The following example will fail the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"on\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CONNECTIONS","title":"pg-log-connections"},{"location":"checks/google/sql/pg-log-connections/#explanation","text":"Logging connections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors.","title":"Explanation"},{"location":"checks/google/sql/pg-log-connections/#possible-impact","text":"Insufficient diagnostic data.","title":"Possible Impact"},{"location":"checks/google/sql/pg-log-connections/#suggested-resolution","text":"Enable connection logging.","title":"Suggested Resolution"},{"location":"checks/google/sql/pg-log-connections/#insecure-example","text":"The following example will fail the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"off\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/pg-log-connections/#secure-example","text":"The following example will pass the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"on\" } } }","title":"Secure Example"},{"location":"checks/google/sql/pg-log-connections/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CONNECTIONS","title":"Related Links"},{"location":"checks/google/sql/pg-log-disconnections/","text":"Explanation Logging disconnections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors. Possible Impact Insufficient diagnostic data. Suggested Resolution Enable disconnection logging. Insecure Example The following example will fail the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"on\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-DISCONNECTIONS","title":"pg-log-disconnections"},{"location":"checks/google/sql/pg-log-disconnections/#explanation","text":"Logging disconnections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors.","title":"Explanation"},{"location":"checks/google/sql/pg-log-disconnections/#possible-impact","text":"Insufficient diagnostic data.","title":"Possible Impact"},{"location":"checks/google/sql/pg-log-disconnections/#suggested-resolution","text":"Enable disconnection logging.","title":"Suggested Resolution"},{"location":"checks/google/sql/pg-log-disconnections/#insecure-example","text":"The following example will fail the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"off\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/pg-log-disconnections/#secure-example","text":"The following example will pass the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"on\" } } }","title":"Secure Example"},{"location":"checks/google/sql/pg-log-disconnections/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-DISCONNECTIONS","title":"Related Links"},{"location":"checks/google/sql/pg-log-errors/","text":"Explanation Setting the minimum log severity too high will cause errors not to be logged Possible Impact Loss of error logging Suggested Resolution Set the minimum log severity to at least ERROR Insecure Example The following example will fail the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"PANIC\" } } } Secure Example The following example will pass the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"WARNING\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_min_messages/ https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-MESSAGES","title":"pg-log-errors"},{"location":"checks/google/sql/pg-log-errors/#explanation","text":"Setting the minimum log severity too high will cause errors not to be logged","title":"Explanation"},{"location":"checks/google/sql/pg-log-errors/#possible-impact","text":"Loss of error logging","title":"Possible Impact"},{"location":"checks/google/sql/pg-log-errors/#suggested-resolution","text":"Set the minimum log severity to at least ERROR","title":"Suggested Resolution"},{"location":"checks/google/sql/pg-log-errors/#insecure-example","text":"The following example will fail the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"PANIC\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/pg-log-errors/#secure-example","text":"The following example will pass the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"WARNING\" } } }","title":"Secure Example"},{"location":"checks/google/sql/pg-log-errors/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_min_messages/ https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-MESSAGES","title":"Related Links"},{"location":"checks/google/sql/pg-log-lock-waits/","text":"Explanation Lock waits are often an indication of poor performance and often an indicator of a potential denial of service vulnerability, therefore occurrences should be logged for analysis. Possible Impact Issues leading to denial of service may not be identified. Suggested Resolution Enable lock wait logging. Insecure Example The following example will fail the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"on\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-LOCK-WAITS","title":"pg-log-lock-waits"},{"location":"checks/google/sql/pg-log-lock-waits/#explanation","text":"Lock waits are often an indication of poor performance and often an indicator of a potential denial of service vulnerability, therefore occurrences should be logged for analysis.","title":"Explanation"},{"location":"checks/google/sql/pg-log-lock-waits/#possible-impact","text":"Issues leading to denial of service may not be identified.","title":"Possible Impact"},{"location":"checks/google/sql/pg-log-lock-waits/#suggested-resolution","text":"Enable lock wait logging.","title":"Suggested Resolution"},{"location":"checks/google/sql/pg-log-lock-waits/#insecure-example","text":"The following example will fail the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"off\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/pg-log-lock-waits/#secure-example","text":"The following example will pass the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"on\" } } }","title":"Secure Example"},{"location":"checks/google/sql/pg-log-lock-waits/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-LOCK-WAITS","title":"Related Links"},{"location":"checks/google/sql/pg-no-min-statement-logging/","text":"Explanation Logging of statements which could contain sensitive data is not advised, therefore this setting should preclude all statements from being logged. Possible Impact Sensitive data could be exposed in the database logs. Suggested Resolution Disable minimum duration statement logging completely Insecure Example The following example will fail the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"99\" } } } Secure Example The following example will pass the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"-1\" } } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT","title":"pg-no-min-statement-logging"},{"location":"checks/google/sql/pg-no-min-statement-logging/#explanation","text":"Logging of statements which could contain sensitive data is not advised, therefore this setting should preclude all statements from being logged.","title":"Explanation"},{"location":"checks/google/sql/pg-no-min-statement-logging/#possible-impact","text":"Sensitive data could be exposed in the database logs.","title":"Possible Impact"},{"location":"checks/google/sql/pg-no-min-statement-logging/#suggested-resolution","text":"Disable minimum duration statement logging completely","title":"Suggested Resolution"},{"location":"checks/google/sql/pg-no-min-statement-logging/#insecure-example","text":"The following example will fail the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"99\" } } }","title":"Insecure Example"},{"location":"checks/google/sql/pg-no-min-statement-logging/#secure-example","text":"The following example will pass the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"-1\" } } }","title":"Secure Example"},{"location":"checks/google/sql/pg-no-min-statement-logging/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT","title":"Related Links"},{"location":"checks/google/storage/enable-ubla/","text":"Explanation When you enable uniform bucket-level access on a bucket, Access Control Lists (ACLs) are disabled, and only bucket-level Identity and Access Management (IAM) permissions grant access to that bucket and the objects it contains. You revoke all access granted by object ACLs and the ability to administrate permissions using bucket ACLs. Possible Impact ACLs are difficult to manage and often lead to incorrect/unintended configurations. Suggested Resolution Enable uniform bucket level access to provide a uniform permissioning system. Insecure Example The following example will fail the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = false website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } } Secure Example The following example will pass the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = true website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket#uniform_bucket_level_access https://cloud.google.com/storage/docs/uniform-bucket-level-access https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b","title":"enable-ubla"},{"location":"checks/google/storage/enable-ubla/#explanation","text":"When you enable uniform bucket-level access on a bucket, Access Control Lists (ACLs) are disabled, and only bucket-level Identity and Access Management (IAM) permissions grant access to that bucket and the objects it contains. You revoke all access granted by object ACLs and the ability to administrate permissions using bucket ACLs.","title":"Explanation"},{"location":"checks/google/storage/enable-ubla/#possible-impact","text":"ACLs are difficult to manage and often lead to incorrect/unintended configurations.","title":"Possible Impact"},{"location":"checks/google/storage/enable-ubla/#suggested-resolution","text":"Enable uniform bucket level access to provide a uniform permissioning system.","title":"Suggested Resolution"},{"location":"checks/google/storage/enable-ubla/#insecure-example","text":"The following example will fail the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = false website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } }","title":"Insecure Example"},{"location":"checks/google/storage/enable-ubla/#secure-example","text":"The following example will pass the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = true website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } }","title":"Secure Example"},{"location":"checks/google/storage/enable-ubla/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket#uniform_bucket_level_access https://cloud.google.com/storage/docs/uniform-bucket-level-access https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b","title":"Related Links"},{"location":"checks/google/storage/no-public-access/","text":"Explanation Using 'allUsers' or 'allAuthenticatedUsers' as members in an IAM member/binding causes data to be exposed outside of the organisation. Possible Impact Public exposure of sensitive data. Suggested Resolution Restrict public access to the bucket. Insecure Example The following example will fail the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"allAuthenticatedUsers\" , ] } Secure Example The following example will pass the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"user:jane@example.com\" , ] } Related Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket_iam#member/members https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b","title":"no-public-access"},{"location":"checks/google/storage/no-public-access/#explanation","text":"Using 'allUsers' or 'allAuthenticatedUsers' as members in an IAM member/binding causes data to be exposed outside of the organisation.","title":"Explanation"},{"location":"checks/google/storage/no-public-access/#possible-impact","text":"Public exposure of sensitive data.","title":"Possible Impact"},{"location":"checks/google/storage/no-public-access/#suggested-resolution","text":"Restrict public access to the bucket.","title":"Suggested Resolution"},{"location":"checks/google/storage/no-public-access/#insecure-example","text":"The following example will fail the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"allAuthenticatedUsers\" , ] }","title":"Insecure Example"},{"location":"checks/google/storage/no-public-access/#secure-example","text":"The following example will pass the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"user:jane@example.com\" , ] }","title":"Secure Example"},{"location":"checks/google/storage/no-public-access/#related-links","text":"https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket_iam#member/members https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b","title":"Related Links"},{"location":"checks/kubernetes/home/","text":"The included Kubernetes checks are listed below. For more information about each check, see the link provided. Checks kubernetes-network-no-public-egress Public egress should not be allowed via network policies kubernetes-network-no-public-ingress Public ingress should not be allowed via network policies","title":"kubernetes"},{"location":"checks/kubernetes/network/no-public-egress/","text":"Explanation You should not expose infrastructure to the public internet except where explicitly required Possible Impact Exfiltration of data to the public internet Suggested Resolution Remove public access except where explicitly required Insecure Example The following example will fail the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Secure Example The following example will pass the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr","title":"no-public-egress"},{"location":"checks/kubernetes/network/no-public-egress/#explanation","text":"You should not expose infrastructure to the public internet except where explicitly required","title":"Explanation"},{"location":"checks/kubernetes/network/no-public-egress/#possible-impact","text":"Exfiltration of data to the public internet","title":"Possible Impact"},{"location":"checks/kubernetes/network/no-public-egress/#suggested-resolution","text":"Remove public access except where explicitly required","title":"Suggested Resolution"},{"location":"checks/kubernetes/network/no-public-egress/#insecure-example","text":"The following example will fail the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }","title":"Insecure Example"},{"location":"checks/kubernetes/network/no-public-egress/#secure-example","text":"The following example will pass the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }","title":"Secure Example"},{"location":"checks/kubernetes/network/no-public-egress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr","title":"Related Links"},{"location":"checks/kubernetes/network/no-public-ingress/","text":"Explanation You should not expose infrastructure to the public internet except where explicitly required Possible Impact Exposure of infrastructure to the public internet Suggested Resolution Remove public access except where explicitly required Insecure Example The following example will fail the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Secure Example The following example will pass the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Related Links https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr","title":"no-public-ingress"},{"location":"checks/kubernetes/network/no-public-ingress/#explanation","text":"You should not expose infrastructure to the public internet except where explicitly required","title":"Explanation"},{"location":"checks/kubernetes/network/no-public-ingress/#possible-impact","text":"Exposure of infrastructure to the public internet","title":"Possible Impact"},{"location":"checks/kubernetes/network/no-public-ingress/#suggested-resolution","text":"Remove public access except where explicitly required","title":"Suggested Resolution"},{"location":"checks/kubernetes/network/no-public-ingress/#insecure-example","text":"The following example will fail the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }","title":"Insecure Example"},{"location":"checks/kubernetes/network/no-public-ingress/#secure-example","text":"The following example will pass the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }","title":"Secure Example"},{"location":"checks/kubernetes/network/no-public-ingress/#related-links","text":"https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr","title":"Related Links"},{"location":"checks/openstack/home/","text":"The included OpenStack checks are listed below. For more information about each check, see the link provided. Checks openstack-compute-no-plaintext-password No plaintext password for compute instance openstack-fw-no-public-access A firewall rule allows traffic from/to the public internet","title":"openstack"},{"location":"checks/openstack/compute/no-plaintext-password/","text":"Explanation Assigning a password to the compute instance using plaintext could lead to compromise; it would be preferable to use key-pairs as a login mechanism Possible Impact Including a plaintext password could lead to compromised instance Suggested Resolution Do not use plaintext passwords in terraform files Insecure Example The following example will fail the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"bad_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" admin_pass = \"N0tSoS3cretP4ssw0rd\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } } Secure Example The following example will pass the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"good_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" key_pair = \"my_key_pair_name\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } } Related Links https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/compute_instance_v2#admin_pass","title":"no-plaintext-password"},{"location":"checks/openstack/compute/no-plaintext-password/#explanation","text":"Assigning a password to the compute instance using plaintext could lead to compromise; it would be preferable to use key-pairs as a login mechanism","title":"Explanation"},{"location":"checks/openstack/compute/no-plaintext-password/#possible-impact","text":"Including a plaintext password could lead to compromised instance","title":"Possible Impact"},{"location":"checks/openstack/compute/no-plaintext-password/#suggested-resolution","text":"Do not use plaintext passwords in terraform files","title":"Suggested Resolution"},{"location":"checks/openstack/compute/no-plaintext-password/#insecure-example","text":"The following example will fail the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"bad_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" admin_pass = \"N0tSoS3cretP4ssw0rd\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } }","title":"Insecure Example"},{"location":"checks/openstack/compute/no-plaintext-password/#secure-example","text":"The following example will pass the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"good_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" key_pair = \"my_key_pair_name\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } }","title":"Secure Example"},{"location":"checks/openstack/compute/no-plaintext-password/#related-links","text":"https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/compute_instance_v2#admin_pass","title":"Related Links"},{"location":"checks/openstack/fw/no-public-access/","text":"Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact Exposure of infrastructure to the public internet Suggested Resolution Employ more restrictive firewall rules Insecure Example The following example will fail the openstack-fw-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"let anyone in\" action = \"allow\" protocol = \"tcp\" destination_port = \"22\" enabled = \"true\" } Secure Example The following example will pass the openstack-fw-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"don't let just anyone in\" action = \"allow\" protocol = \"tcp\" destination_ip_address = \"10.10.10.1\" source_ip_address = \"10.10.10.2\" destination_port = \"22\" enabled = \"true\" } Related Links https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/fw_rule_v1","title":"no-public-access"},{"location":"checks/openstack/fw/no-public-access/#explanation","text":"Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/openstack/fw/no-public-access/#possible-impact","text":"Exposure of infrastructure to the public internet","title":"Possible Impact"},{"location":"checks/openstack/fw/no-public-access/#suggested-resolution","text":"Employ more restrictive firewall rules","title":"Suggested Resolution"},{"location":"checks/openstack/fw/no-public-access/#insecure-example","text":"The following example will fail the openstack-fw-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"let anyone in\" action = \"allow\" protocol = \"tcp\" destination_port = \"22\" enabled = \"true\" }","title":"Insecure Example"},{"location":"checks/openstack/fw/no-public-access/#secure-example","text":"The following example will pass the openstack-fw-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"don't let just anyone in\" action = \"allow\" protocol = \"tcp\" destination_ip_address = \"10.10.10.1\" source_ip_address = \"10.10.10.2\" destination_port = \"22\" enabled = \"true\" }","title":"Secure Example"},{"location":"checks/openstack/fw/no-public-access/#related-links","text":"https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/fw_rule_v1","title":"Related Links"},{"location":"checks/oracle/home/","text":"The included Oracle checks are listed below. For more information about each check, see the link provided. Checks oracle-compute-no-public-ip Compute instance requests an IP reservation from a public pool","title":"oracle"},{"location":"checks/oracle/compute/no-public-ip/","text":"Explanation Compute instance requests an IP reservation from a public pool The compute instance has the ability to be reached from outside, you might want to sonder the use of a non public IP. Possible Impact The compute instance has the ability to be reached from outside Suggested Resolution Reconsider the use of an public IP Insecure Example The following example will fail the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"bad_example\" { name = \"my-ip-address\" ip_address_pool = \"public-ippool\" } Secure Example The following example will pass the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"good_example\" { name = \"my-ip-address\" ip_address_pool = \"cloud-ippool\" } Related Links https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_ip_address_reservation https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_instance","title":"no-public-ip"},{"location":"checks/oracle/compute/no-public-ip/#explanation","text":"Compute instance requests an IP reservation from a public pool The compute instance has the ability to be reached from outside, you might want to sonder the use of a non public IP.","title":"Explanation"},{"location":"checks/oracle/compute/no-public-ip/#possible-impact","text":"The compute instance has the ability to be reached from outside","title":"Possible Impact"},{"location":"checks/oracle/compute/no-public-ip/#suggested-resolution","text":"Reconsider the use of an public IP","title":"Suggested Resolution"},{"location":"checks/oracle/compute/no-public-ip/#insecure-example","text":"The following example will fail the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"bad_example\" { name = \"my-ip-address\" ip_address_pool = \"public-ippool\" }","title":"Insecure Example"},{"location":"checks/oracle/compute/no-public-ip/#secure-example","text":"The following example will pass the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"good_example\" { name = \"my-ip-address\" ip_address_pool = \"cloud-ippool\" }","title":"Secure Example"},{"location":"checks/oracle/compute/no-public-ip/#related-links","text":"https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_ip_address_reservation https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_instance","title":"Related Links"},{"location":"getting-started/credit/","text":"Authors Liam Galvin (liamg) Owen Rumney (owenrumney) Contributors Thanks to all contributors","title":"Credits"},{"location":"getting-started/credit/#authors","text":"Liam Galvin (liamg) Owen Rumney (owenrumney)","title":"Authors"},{"location":"getting-started/credit/#contributors","text":"Thanks to all contributors","title":"Contributors"},{"location":"getting-started/installation/","text":"Install with brew/linuxbrew brew install tfsec Install with Chocolatey choco install tfsec Install with Scoop scoop install tfsec You can also grab the binary for your system from the releases page . Alternatively, install with Go: go install github.com/aquasecurity/tfsec/cmd/tfsec@latest","title":"Installation"},{"location":"getting-started/quickstart/","text":"Using as a command line tool The easiest way to run tfsec is to run it in the directory you want to scan. tfsec tfsec will traverse the directory till it finds a valid Terraform file; the directory it finds this file in will be considered to the working directory. If you want to run on a specific location, this can be passed as an argument; tfsec ./tf/prod The exit status will be non-zero if tfsec finds problems, otherwise the exit status will be zero. Use with Docker As an alternative to installing and running tfsec on your system, you may run tfsec in a Docker container. To run: docker run --rm -it -v \" $( pwd ) :/src\" aquasec/tfsec /src Using in CI tfsec can be added to any CI pipeline as a command with the exit code dictating if it breaks the build. We do provide a GitHub Action that will also upload the results to GitHub code scanning UI. Passing Arguments This page only covers the basics of what tfsec can do - much more is achievable using the arguments on the Parameters page.","title":"Quick Start"},{"location":"getting-started/quickstart/#using-as-a-command-line-tool","text":"The easiest way to run tfsec is to run it in the directory you want to scan. tfsec tfsec will traverse the directory till it finds a valid Terraform file; the directory it finds this file in will be considered to the working directory. If you want to run on a specific location, this can be passed as an argument; tfsec ./tf/prod The exit status will be non-zero if tfsec finds problems, otherwise the exit status will be zero.","title":"Using as a command line tool"},{"location":"getting-started/quickstart/#use-with-docker","text":"As an alternative to installing and running tfsec on your system, you may run tfsec in a Docker container. To run: docker run --rm -it -v \" $( pwd ) :/src\" aquasec/tfsec /src","title":"Use with Docker"},{"location":"getting-started/quickstart/#using-in-ci","text":"tfsec can be added to any CI pipeline as a command with the exit code dictating if it breaks the build. We do provide a GitHub Action that will also upload the results to GitHub code scanning UI.","title":"Using in CI"},{"location":"getting-started/quickstart/#passing-arguments","text":"This page only covers the basics of what tfsec can do - much more is achievable using the arguments on the Parameters page.","title":"Passing Arguments"},{"location":"getting-started/signing/","text":"Verifying signed binaries All tfsec binaries are signed with out signing key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE . The steps below detail how to verify the signature of the keys. Public Key The public key for signing@tfsec.dev can be downloaded here -----BEGIN PGP PUBLIC KEY BLOCK----- mQINBGCmSy4BEAC9IxH3DeV+xeORRypRZe28YYSvDvBZdfer0apm+p1kJFsXM6ns dng9PThUihEt11BMtLmlQyPMQ0TsONOjqFaqNEitzNe55MSHxTYkTrnctrF3IKS4 G35RHcHUctx9j4Cg56eRxU1cb0B/JJdh9HjZtQG9CJB0+WU/UlXOgYn/17ZScS6Q tq56SKd+lW5BfTzl+aYdzbrlWh1Ukla7DvydQmxY7XHgfKbLrGJVQdL91opJvXKr D1vxDuMpZHSm9lp6G5GXsZIA080QKcD3nSjeeRTxuABDwHD/1OS03iZQtxwjUMRw FYFlrcSVap20SXMLAtKRDpWGhAyzI+JUhZQMuRj22jcicEs7CKGXteFMFlgh3RU1 K4DfQwFT436ywuDCAuu/vAhVwZmLaUlf6YIWnGBYOjHXjas/f1z7ZTe2dHxQfNg4 xsmefH++I4qRHF+e2ggMGF2JAv8Y7T3+QDkXDiQ/kTJaFvWqoe0A5V+CmdL01giW AkCfqtRIEKuF7NSYsekY0HVGwxDGG/gKWfWw0bq+KxsVwk9/KDVBZIRdimqcuJm1 PIssx5v+V4BIkYWhKNX0rIu5bi9UAXHJJuCEdzHsiWUp+UA6MBv1FNNWdPJoEwkc BgmryUFYr7UVb0+9NkII0rYmnwHcuFO9tErqccN+Ru2f920R40J/jH3GMQARAQAB tDpUZnNlYyBTaWduaW5nIChDb2RlIHNpZ25pbmcgZm9yIHRmc2VjKSA8c2lnbmlu Z0B0ZnNlYy5kZXY+iQJOBBMBCgA4FiEE1msiKj6kwl1dGgl/w0rO+0bsOc4FAmCm Sy4CGwMFCwkIBwIGFQoJCAsCBBYCAwECHgECF4AACgkQw0rO+0bsOc6zRA/+JZUV Q4ip9qGt6mMN+bkFm67218F5J/e1EKC9lbf4yuw56Jgz1+MdENUVROdqTxxXPWqX XaS0VD4obq/0G83dVgxuMFuW8LM+Uey6adGLn4QPoxt6Y0lRlQJmsP9aicw+rcvf drV34GwUPTEwbIW1AAhTi1hS+9/EsBqzMnIzL6xBsN29bHFiqQlC0bodDwVU7uYc tgh6D8W5FKeQkUiHJlZxGpcY7TEMmhcp26tdIWAfUFBDbwqoS/NZy3ZWJ3QLu1WQ 72u7gD7tR4NoZwYiSGLZBp8Qz3g1a5RNdsN7U63bMhP8LWuvOYNe886DGAD4Olxa HkPowUJ3GVd1v7WE02Zu/72YEQB0XL2gy/QclX56gx0jXDBoyQrzdSHXYQzI3Y0Z W7T7ETxkvGsWEHkU+20KJKSTEWKVIQN7kKVT9RbMUvYBTex6oFnzDZvOBhbrWxjP 4ojHHCkhTyffWZ2LKPDueFuzGLdf/F+Di2//Yc5ylYxPF2mBDp0ptUXPOFCN/5o/ smBoDBzVU49Rnnw9qOUZ5PLs+HmPT4MMdGJKO1bD7JRA8zKtzIgNE568U5IjbOjV WXYhy9QFoQINjkiGBw0TQf7Yb8O0u0EnumXqYEPcyKgJaIhquduQllaoepJa27qR ZchuaBTiTJwaMIaz5m8MOQsVMfEgU3tDf0RbufG5Ag0EYKZLLgEQAMjL3IEmut/B k/FzcMGbvpf/dlIqnNDFsRLYexmhqfU7n5Nm0bWYhYArszBYfvYlZCXOsjmeRnSa fR85mw98ZMxR9n87NtgnNdEFnWceJ+3TkTIlcIZsGqCodWaxKW99q0w2z9MQ8Twn 4ciioKvinw9FE2YdfnPe7gY3DfvvTWurhvssUh3YLIaGMt3KcRtEVsPOnsRNLeLD R9T5CGX8H47C/kBxGIPgh6xRf5yxErU7BwiS7BgSSAXwiM3IenuqgeJe4flBggTl 7zcevsgvBrIPVemRl428fCTtBkykEobNXz/2JT/CzgCYJ27zlzdFe81ENoxR9Ieb KyA2EDw41xtjGiHkXsBdavQsikoXqt8PC7sFoIm/b2125fUmDafZ/DVDxLeSjglx izWMN1AG9CV7bEgC/f25UmiQb3V2TkM9Uo+Y5g1ZvJTM83mi2cINjQW5WTwV8fiu DFf2QTXY/4W0jtU5EvI7N3tH7laFBsXz32hnEGImsyBUApJK0s3FPdBjwEYtNSt9 Fn5JFr0+48uIgvmS+CnKp+KzQ7YRWputbJWO3JFvlzMmCKXKU/ss+PkU6admTvnH rm+2qpGWfsmvStsqpgdbivLwujVC1ZyKnv8MkT7pq0iwlyqyAGlYoTkW1JSiCzmd s2kE+hqsIr+u8sd07zjoxtvLdUnF1c81ABEBAAGJAjYEGAEKACAWIQTWayIqPqTC XV0aCX/DSs77Ruw5zgUCYKZLLgIbDAAKCRDDSs77Ruw5znn2D/9scSun7N7UcXCD 0WV4F0QNUU+cu6QeDkjFoolXQZeIBRgSpa1r9qfPzQqB03CF/E5kFQz6APpX9nZX gjCvBo2oeeSusUY3d4gkGUnhLC+rwiPaQrJFgh6pDli3A78KChADq+JzZaxcDb7m Li41jwmfqHdkC0c6LI9QstOcyV2n5u2/HX0tJLGw47w5eEsfhcI5xgw/adBjqpHM lEKTJcyJuIY++9PiNmG5algPwAa+0XrgCdLHyHXHHhoFV+5xj29iWpfPlqLLl1eT QqnbqpcOupcsFsASiM5zVGZHK6LYuDkk9Ey/TrqcAhxfyl8cXNpdRC7PanHtykvC DKa/6fXNJ3MtpQZ+Z+JjoN1PWQP3UqDYhXxizzT6TrT5N72M//bLm0hadPCt+8Wx CzlBBxuxlGEhdriYFUtQ/wN7cRR659qZARylfXI5j1mHBlPuIEoSCMkkz/Nj3Bxo iuzLVVrX0h16N7H2wclTsw2LDf2rPlTIcI5Ct41fOSyyagZhWoR05JbaY4+yfhjx FkM0ly4XGasTbjJpwbJKWtXwiLXNaCCzQJH1DBdh5O3lHIidqcdoi+iAcpgaJCXI p297ny/7PTHmTaZhdjGcBp2tAmd+J0zgsmNk3qUg5pPGKdUnCA5jjENfmTMP4ets nX5QmAEwF/nBYV3Du7TIvHtz91yL8A== =opqY -----END PGP PUBLIC KEY BLOCK----- Steps for Verification Copy the public key block into a new file, eg; /tmp/tfsec_key.txt Import the gpg key gpg --import < /tmp/tfsec_key.txt Verify that the key has been imported gpg --list-keys signing@tfsec.dev check the output is pub rsa4096 2021-05-20 [SC] D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE uid [ultimate] Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev> sub rsa4096 2021-05-20 [E] Download the required binary and its associated sig file Assuming it is tfsec-linux-amd64 the verify command below should be run, passing in the sig file then the binary file gpg --verify tfsec-linux-amd64.D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE.sig tfsec-linux-amd64 This should give you a similar output to that below - the key part is that it is signed and has a Good signature gpg: Signature made Fri 09 Jul 2021 11:41:22 BST gpg: using RSA key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE gpg: Good signature from \"Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev>\" [ultimate]","title":"Signature Verification"},{"location":"getting-started/signing/#verifying-signed-binaries","text":"All tfsec binaries are signed with out signing key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE . The steps below detail how to verify the signature of the keys.","title":"Verifying signed binaries"},{"location":"getting-started/signing/#public-key","text":"The public key for signing@tfsec.dev can be downloaded here -----BEGIN PGP PUBLIC KEY BLOCK----- mQINBGCmSy4BEAC9IxH3DeV+xeORRypRZe28YYSvDvBZdfer0apm+p1kJFsXM6ns dng9PThUihEt11BMtLmlQyPMQ0TsONOjqFaqNEitzNe55MSHxTYkTrnctrF3IKS4 G35RHcHUctx9j4Cg56eRxU1cb0B/JJdh9HjZtQG9CJB0+WU/UlXOgYn/17ZScS6Q tq56SKd+lW5BfTzl+aYdzbrlWh1Ukla7DvydQmxY7XHgfKbLrGJVQdL91opJvXKr D1vxDuMpZHSm9lp6G5GXsZIA080QKcD3nSjeeRTxuABDwHD/1OS03iZQtxwjUMRw FYFlrcSVap20SXMLAtKRDpWGhAyzI+JUhZQMuRj22jcicEs7CKGXteFMFlgh3RU1 K4DfQwFT436ywuDCAuu/vAhVwZmLaUlf6YIWnGBYOjHXjas/f1z7ZTe2dHxQfNg4 xsmefH++I4qRHF+e2ggMGF2JAv8Y7T3+QDkXDiQ/kTJaFvWqoe0A5V+CmdL01giW AkCfqtRIEKuF7NSYsekY0HVGwxDGG/gKWfWw0bq+KxsVwk9/KDVBZIRdimqcuJm1 PIssx5v+V4BIkYWhKNX0rIu5bi9UAXHJJuCEdzHsiWUp+UA6MBv1FNNWdPJoEwkc BgmryUFYr7UVb0+9NkII0rYmnwHcuFO9tErqccN+Ru2f920R40J/jH3GMQARAQAB tDpUZnNlYyBTaWduaW5nIChDb2RlIHNpZ25pbmcgZm9yIHRmc2VjKSA8c2lnbmlu Z0B0ZnNlYy5kZXY+iQJOBBMBCgA4FiEE1msiKj6kwl1dGgl/w0rO+0bsOc4FAmCm Sy4CGwMFCwkIBwIGFQoJCAsCBBYCAwECHgECF4AACgkQw0rO+0bsOc6zRA/+JZUV Q4ip9qGt6mMN+bkFm67218F5J/e1EKC9lbf4yuw56Jgz1+MdENUVROdqTxxXPWqX XaS0VD4obq/0G83dVgxuMFuW8LM+Uey6adGLn4QPoxt6Y0lRlQJmsP9aicw+rcvf drV34GwUPTEwbIW1AAhTi1hS+9/EsBqzMnIzL6xBsN29bHFiqQlC0bodDwVU7uYc tgh6D8W5FKeQkUiHJlZxGpcY7TEMmhcp26tdIWAfUFBDbwqoS/NZy3ZWJ3QLu1WQ 72u7gD7tR4NoZwYiSGLZBp8Qz3g1a5RNdsN7U63bMhP8LWuvOYNe886DGAD4Olxa HkPowUJ3GVd1v7WE02Zu/72YEQB0XL2gy/QclX56gx0jXDBoyQrzdSHXYQzI3Y0Z W7T7ETxkvGsWEHkU+20KJKSTEWKVIQN7kKVT9RbMUvYBTex6oFnzDZvOBhbrWxjP 4ojHHCkhTyffWZ2LKPDueFuzGLdf/F+Di2//Yc5ylYxPF2mBDp0ptUXPOFCN/5o/ smBoDBzVU49Rnnw9qOUZ5PLs+HmPT4MMdGJKO1bD7JRA8zKtzIgNE568U5IjbOjV WXYhy9QFoQINjkiGBw0TQf7Yb8O0u0EnumXqYEPcyKgJaIhquduQllaoepJa27qR ZchuaBTiTJwaMIaz5m8MOQsVMfEgU3tDf0RbufG5Ag0EYKZLLgEQAMjL3IEmut/B k/FzcMGbvpf/dlIqnNDFsRLYexmhqfU7n5Nm0bWYhYArszBYfvYlZCXOsjmeRnSa fR85mw98ZMxR9n87NtgnNdEFnWceJ+3TkTIlcIZsGqCodWaxKW99q0w2z9MQ8Twn 4ciioKvinw9FE2YdfnPe7gY3DfvvTWurhvssUh3YLIaGMt3KcRtEVsPOnsRNLeLD R9T5CGX8H47C/kBxGIPgh6xRf5yxErU7BwiS7BgSSAXwiM3IenuqgeJe4flBggTl 7zcevsgvBrIPVemRl428fCTtBkykEobNXz/2JT/CzgCYJ27zlzdFe81ENoxR9Ieb KyA2EDw41xtjGiHkXsBdavQsikoXqt8PC7sFoIm/b2125fUmDafZ/DVDxLeSjglx izWMN1AG9CV7bEgC/f25UmiQb3V2TkM9Uo+Y5g1ZvJTM83mi2cINjQW5WTwV8fiu DFf2QTXY/4W0jtU5EvI7N3tH7laFBsXz32hnEGImsyBUApJK0s3FPdBjwEYtNSt9 Fn5JFr0+48uIgvmS+CnKp+KzQ7YRWputbJWO3JFvlzMmCKXKU/ss+PkU6admTvnH rm+2qpGWfsmvStsqpgdbivLwujVC1ZyKnv8MkT7pq0iwlyqyAGlYoTkW1JSiCzmd s2kE+hqsIr+u8sd07zjoxtvLdUnF1c81ABEBAAGJAjYEGAEKACAWIQTWayIqPqTC XV0aCX/DSs77Ruw5zgUCYKZLLgIbDAAKCRDDSs77Ruw5znn2D/9scSun7N7UcXCD 0WV4F0QNUU+cu6QeDkjFoolXQZeIBRgSpa1r9qfPzQqB03CF/E5kFQz6APpX9nZX gjCvBo2oeeSusUY3d4gkGUnhLC+rwiPaQrJFgh6pDli3A78KChADq+JzZaxcDb7m Li41jwmfqHdkC0c6LI9QstOcyV2n5u2/HX0tJLGw47w5eEsfhcI5xgw/adBjqpHM lEKTJcyJuIY++9PiNmG5algPwAa+0XrgCdLHyHXHHhoFV+5xj29iWpfPlqLLl1eT QqnbqpcOupcsFsASiM5zVGZHK6LYuDkk9Ey/TrqcAhxfyl8cXNpdRC7PanHtykvC DKa/6fXNJ3MtpQZ+Z+JjoN1PWQP3UqDYhXxizzT6TrT5N72M//bLm0hadPCt+8Wx CzlBBxuxlGEhdriYFUtQ/wN7cRR659qZARylfXI5j1mHBlPuIEoSCMkkz/Nj3Bxo iuzLVVrX0h16N7H2wclTsw2LDf2rPlTIcI5Ct41fOSyyagZhWoR05JbaY4+yfhjx FkM0ly4XGasTbjJpwbJKWtXwiLXNaCCzQJH1DBdh5O3lHIidqcdoi+iAcpgaJCXI p297ny/7PTHmTaZhdjGcBp2tAmd+J0zgsmNk3qUg5pPGKdUnCA5jjENfmTMP4ets nX5QmAEwF/nBYV3Du7TIvHtz91yL8A== =opqY -----END PGP PUBLIC KEY BLOCK-----","title":"Public Key"},{"location":"getting-started/signing/#steps-for-verification","text":"Copy the public key block into a new file, eg; /tmp/tfsec_key.txt Import the gpg key gpg --import < /tmp/tfsec_key.txt Verify that the key has been imported gpg --list-keys signing@tfsec.dev check the output is pub rsa4096 2021-05-20 [SC] D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE uid [ultimate] Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev> sub rsa4096 2021-05-20 [E] Download the required binary and its associated sig file Assuming it is tfsec-linux-amd64 the verify command below should be run, passing in the sig file then the binary file gpg --verify tfsec-linux-amd64.D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE.sig tfsec-linux-amd64 This should give you a similar output to that below - the key part is that it is signed and has a Good signature gpg: Signature made Fri 09 Jul 2021 11:41:22 BST gpg: using RSA key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE gpg: Good signature from \"Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev>\" [ultimate]","title":"Steps for Verification"},{"location":"getting-started/usage/","text":"tfsec can by run with no arguments and will act on the current folder. For a richer experience, there are many additional command line arguments that you can make use of. Argument Short Code Description --allow-checks-to-panic -p Allow panics to propagate up from rule checking --concise-output Reduce the amount of output and no statistics --config-file [path to config file] Config file to use during run --custom-check-dir [path to checks dir] Explicitly the custom checks dir location --debug Enable verbose logging, same as --verbose but for people who prefer to say debug --detailed-exit-code Produce more detailed exit status codes. --exclude [comma,separated,rule,ids] -e Provide comma-separated list of rule IDs to exclude from run. --exclude-path strings Path to exclude from parser, can be used multiple times --exclude-downloaded-modules Remove results for downloaded modules in .terraform folder --filter-results [comma,separated,riles,to,check] Filter results to return specific checks only (supports comma-delimited input). --force-all-dirs Don't search for tf files, include everything below provided directory. --format [default,json,csv,checkstyle,junit,sarif] -f Select output format: default, json, csv, checkstyle, junit, sarif --gif Show a celebratory gif in the terminal if no problems are found (default formatter only) --help -h help for tfsec --ignore-hcl-errors Stop and report an error if an HCL parse error is encountered --include-ignored Ignore comments with have no effect and all resources will be scanned --include-passed Resources that pass checks are included in the result output --no-color Disable colored output (American style!) --no-colour Disable coloured output --out [filepath to output to] Set output file --run-statistics View statistics table of current findings. --soft-fail -s Runs checks but suppresses error code --sort-severity Sort the results by severity from highest to lowest --tfvars-file strings Path to .tfvars file, can be used multiple times and evaluated in order of specification --update Update to latest version --verbose Enable verbose logging --version -v Show version information and exit --workspace [terraform workspace] -w Specify a workspace for ignore limits This list can also be found by running tfsec --help","title":"Parameters"},{"location":"getting-started/configuration/config/","text":"The tfsec config file can override various tfsec configurations. The tfsec config file is a file in the .tfsec folder in the root check path named config.json or config.yml and is automatically loaded if it exists. The config file can also be set with the --config-file option: tfsec --config-file tfsec.yml Syntax and Overrides Severity Overrides There are occasions where the default severity level for one of the built in checks is too severe or in some cases not strong enough. The config file can be used to specify overrides for any check identifier to replace the result output. { \"severity_overrides\" : { \"CUS002\" : \"ERROR\" , \"aws-s3-enable-versioning\" : \"LOW\" } } or in yaml --- severity_overrides : CUS002 : ERROR aws-s3-enable-versioning : HIGH Excluding checks There are moments where the list of checks you'd want to exclude becomes larger and larger. Rather than passing all the excluded checks via the command line, you can use the configuration entry exclude to list them all out. { \"exclude\" : [ \"CUS002\" , \"aws-s3-enable-versioning\" ] } or in yaml --- exclude : - CUS002 - aws-s3-enable-versioning","title":"Config File"},{"location":"getting-started/configuration/config/#syntax-and-overrides","text":"","title":"Syntax and Overrides"},{"location":"getting-started/configuration/config/#severity-overrides","text":"There are occasions where the default severity level for one of the built in checks is too severe or in some cases not strong enough. The config file can be used to specify overrides for any check identifier to replace the result output. { \"severity_overrides\" : { \"CUS002\" : \"ERROR\" , \"aws-s3-enable-versioning\" : \"LOW\" } } or in yaml --- severity_overrides : CUS002 : ERROR aws-s3-enable-versioning : HIGH","title":"Severity Overrides"},{"location":"getting-started/configuration/config/#excluding-checks","text":"There are moments where the list of checks you'd want to exclude becomes larger and larger. Rather than passing all the excluded checks via the command line, you can use the configuration entry exclude to list them all out. { \"exclude\" : [ \"CUS002\" , \"aws-s3-enable-versioning\" ] } or in yaml --- exclude : - CUS002 - aws-s3-enable-versioning","title":"Excluding checks"},{"location":"getting-started/configuration/custom-checks/","text":"What is it? tfsec comes with an ever growing number of built in checks, these cover standard AWS, Azure and GCP provider checks, plus several more. We recognise that there are checks that need performing for an organisation that don't fit with general use cases; for this, there are custom checks. Custom checks offer an accessible approach to injecting checks that satisfy your organisations compliance and security needs. For example, if you require that all EC2 instances have a CostCentre tag, that can be achieved with a custom_check . How does it work? Custom checks are defined as json files which sit in the .tfsec folder in the root check path. any file with the suffix _tfchecks.json or _tfchecks.yaml will be parsed and the checks included during the run. Overriding check directory The default location for custom checks can be overridden, this is done using the --custom-check-dir to specify another location to load the checks from instead. This is useful when global checks are to applied to the terraform under test. What does a check file look like? Check files are simply json, this ensures that checks can be put together without requiring Go knowledge or being able to build a new release of tfsec to include your custom code. Taking the previous example of a required cost centre, the check file might look something like { \"checks\" : [ { \"code\" : \"CUS001\" , \"description\" : \"Custom check to ensure the CostCentre tag is applied to EC2 instances\" , \"impact\" : \"By not having CostCentre we can't keep track of billing\" , \"resolution\" : \"Add the CostCentre tag\" , \"requiredTypes\" : [ \"resource\" ], \"requiredLabels\" : [ \"aws_instance\" ], \"severity\" : \"ERROR\" , \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" }, \"errorMessage\" : \"The required CostCentre tag was missing\" , \"relatedLinks\" : [ \"http://internal.acmecorp.com/standards/aws/tagging.html\" ] } ] } or --- checks : - code : CUS001 description : Custom check to ensure the CostCentre tag is applied to EC2 instances impact : By not having CostCentre we can't keep track of billing resolution : Add the CostCentre tag requiredTypes : - resource requiredLabels : - aws_instance severity : ERROR matchSpec : name : tags action : contains value : CostCentre errorMessage : The required CostCentre tag was missing relatedLinks : - http://internal.acmecorp.com/standards/aws/tagging.html The check contains up of the following attributes; Attribute Description code The custom code that your check will be known as description A description for the code that will be included in the output impact An optional detail about the consequences of not passing the check resolution An optional brief description of how to satisfy the check requiredTypes The block types to apply the check to - resource, data, module, variable requiredLabels The resource type - aws_ec2_instance for example. This also supports wildcards using * , e.g. aws_* severity How severe is the check matchSpec See below for the MatchSpec attributes errorMessage The error message that should be displayed in cases where the check fails relatedLinks A list of related links for the check to be displayed in cases where the check fails The MatchSpec is the what will define the check itself - this is fairly basic and is made up of the following attributes Attribute Description name The name of the attribute or block to run the check on action The check type - see below for more information value In cases where a value is required, the value to look for ignoreUndefined If the attribute is undefined, ignore and pass the check subMatch A sub MatchSpec block for nested checking - think looking for enabled value in a logging block predicateMatchSpec An array of MatchSpec blocks to be logically aggregated by either and or or actions Check Actions There are a number of CheckActions available which should allow you to quickly put together most checks. inModule The inModule check action passes if the resource block is a component of a module. For example, if you're looking to check that an aws_s3_bucket is only created using a custom module, you could use the following MatchSpec ; \"matchSpec\" : { \"action\" : \"inModule\" } matchSpec : action : inModule isPresent The isPresent check action passes if the required block or attribute is available in the checked block. For example, if you're looking to check that an acl is provided and don't care what it is, you can use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isPresent\" } matchSpec : name : acl action : isPresent notPresent Conversely, the noPresent check action passes if the specified block or attribute is not found in the checked block. For example, if you explicitly don't want an acl attribute to be present hou can use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"notPresent\" } matchSpec : name : acl action : notPresent isEmpty The isEmpty check action passes if the named block or attribute is defined by empty. For example, to check that there are not tags you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"isEmpty\" , } matchSpec : name : acl action : isEmpty startsWith The startsWith check action passes if the checked attribute string starts with the specified value. For example, to check that acl begins with public you could use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"startsWith\" , \"value\" : \"public\" } matchSpec : name : acl action : startsWith value : public endsWith The endsWith check action passes if the checked attribute string ends with the specified value. For example, to check that acl ends with read you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"endsWith\" , \"value\" : \"-read\" } matchSpec : name : acl action : endsWith value : -read contains The contains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, if you want to ensure that the CostCentre exists, you might use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" } matchSpec : name : tags action : contains value : CostCentre notContains The notContains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, you want to make sure that an action does not contain kms:* you might use the following MatchSpec : \"matchSpec\" : { \"name\" : \"action\" , \"action\" : \"notContains\" , \"value\" : \"kms:*\" } matchSpec : name : tags action : notContains value : kms:* equals The equals check action passes if the checked attribute equals specified value. The core primitive types are supported, if the subject attribute is a Boolean, the MatchSpec value will attempt to be cast to a Boolean for comparison. For example, to check that acl begins with private you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"private\" } matchSpec : name : acl action : equals value : private lessThan The lessThan check action passes if the checked attribute is numerical and the value is less than the specified value. For example, if you want to ensure that the cpu_core_count is less than 8, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThan\" , \"value\" : 8 } matchSpec : name : cpu_core_count action : lessThan value : 8 lessThanOrEqualTo The lessThanOrEqualTo check action passes if the checked attribute is numerical and the value is less than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is less than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : lessThanOrEqualTo value : 4 greaterThan The greaterThan check action passes if the checked attribute is numerical and the value is greater than the specified value. For example, if you want to ensure that the cpu_core_count is greater than 2, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThan\" , \"value\" : 2 } matchSpec : name : cpu_core_count action : greaterThan value : 2 greaterThanOrEqualTo The greaterThanOrEqualTo check action passes if the checked attribute is numerical and the value is greater than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is greater than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : greaterThanOrEqualTo value : 4 regexMatches The regexMatches check action passes when the regex is matched to the pattern passed in the value. This is check would generally be used as a top level check to filter whether or not to apply a check. For example, this check will ensure that the source attribute of a module matches the supplied regex before continuing with the subMatches. This can be used to ensure that checks are targeted to specific modules. When tackling this specific use case of filtering module blocks by source, the requiredLabels should be set to \"*\" \"matchSpec\" : { \"name\" : \"source\" , \"action\" : \"regexMatches\" , \"value\" : \"^modules\\\\/.*public_.+bucket$\" , \"subMatch\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"public-read\" } } matchSpec : name : source action : regexMatches value : \"^modules\\\\/.*public_.+bucket$\" subMatch : name : acl action : equals value : public-read isAny The isAny check action passes when the attribute value can be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isAny\" , \"value\" : [ \"private\" , \"log-delivery-write\" ] } matchSpec : name : acl action : isAny value : - private - log-delivery-write isNone The isNone check action passes when the attribute value cannot be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isNone\" , \"value\" : [ \"authenticated-read\" , \"public-read\" ] } matchSpec : name : acl action : isNone value : - authenticated-read - public-read requiresPresence The requiresPresence checks that the resource in name is also present in the Terraform code. If you wanted to ensure that aws_vpc_flowlogs is present if there is a aws_vpc , you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"requiresPresence\" , \"name\" : \"aws_vpc_flowlogs\" } matchSpec : name : aws_vpc_flowlogs action : requiresPresence and The and check action passes when all the blocks provided within predicateMatchSpec evaluate to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you wanted to ensure that device_name and encrypted are both present in a nested ebs_block_device block, you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"isPresent\" , \"name\" : \"ebs_block_device\" , \"subMatch\" : { \"action\" : \"and\" , \"predicateMatchSpec\" : [ { \"action\" : \"isPresent\" , \"name\" : \"device_name\" }, { \"action\" : \"isPresent\" , \"name\" : \"encrypted\" } ] } } matchSpec : action : isPresent name : ebs_block_device subMatch : action : and predicateMatchSpec : - action : isPresent name : device_name - action : isPresent name : encrypted or The or check action passes when at least one of the blocks provided within predicateMatchSpec evaluates to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you want to ensure that virtualization_type is assigned to either hvm or paravirtual , while enforcing that their implicitly linked required attributes are also present, you might use the following matchSpec : \"matchSpec\": { \"action\": \"or\", \"predicateMatchSpec\": [ { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"hvm\" } ] }, { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"paravirtual\" }, { \"name\": \"image_location\", \"action\": \"isPresent\" }, { \"name\": \"kernel_id\", \"action\": \"isPresent\" } ] } ] } matchSpec : action : or predicateMatchSpec : - action : and predicateMatchSpec : - name : virtualization_type action : equals value : hvm - name : sriov_net_support action : isPresent - action : and predicateMatchSpec : - name : virtualization_type action : equals value : paravirtual - name : image_location action : isPresent - name : kernel_id action : isPresent not The not check action passes when the predicateMatchSpec evaluates to false . As an example, if you want to represent that a resource should not be included inModule you might use the following matchSpec : \"matchSpec\": { \"action\": \"not\", \"predicateMatchSpec\": [ { \"action\": \"inModule\" } ] } matchSpec : action : not predicateMatchSpec : - action : inModule How do I know my JSON is valid? We have provided the tfsec-checkgen binary which will validate your check file to ensure that it is valid for use with tfsec . In the future, tfsec-checkgen will facilitate the creation of new check files with a wizard approach, for now it can be used to validate your check file. shell script ./tfsec-checkgen validate example/custom/.tfsec/custom_checks.json Are there limitations? At the moment, check MatchSpec is limited in the number of check types it can perform, these are as shown in the previous table. Custom defined checks also don't come with the comprehensive tests that the built in ones have. This will be addressed in future releases.","title":"Custom Checks"},{"location":"getting-started/configuration/custom-checks/#what-is-it","text":"tfsec comes with an ever growing number of built in checks, these cover standard AWS, Azure and GCP provider checks, plus several more. We recognise that there are checks that need performing for an organisation that don't fit with general use cases; for this, there are custom checks. Custom checks offer an accessible approach to injecting checks that satisfy your organisations compliance and security needs. For example, if you require that all EC2 instances have a CostCentre tag, that can be achieved with a custom_check .","title":"What is it?"},{"location":"getting-started/configuration/custom-checks/#how-does-it-work","text":"Custom checks are defined as json files which sit in the .tfsec folder in the root check path. any file with the suffix _tfchecks.json or _tfchecks.yaml will be parsed and the checks included during the run.","title":"How does it work?"},{"location":"getting-started/configuration/custom-checks/#overriding-check-directory","text":"The default location for custom checks can be overridden, this is done using the --custom-check-dir to specify another location to load the checks from instead. This is useful when global checks are to applied to the terraform under test.","title":"Overriding check directory"},{"location":"getting-started/configuration/custom-checks/#what-does-a-check-file-look-like","text":"Check files are simply json, this ensures that checks can be put together without requiring Go knowledge or being able to build a new release of tfsec to include your custom code. Taking the previous example of a required cost centre, the check file might look something like { \"checks\" : [ { \"code\" : \"CUS001\" , \"description\" : \"Custom check to ensure the CostCentre tag is applied to EC2 instances\" , \"impact\" : \"By not having CostCentre we can't keep track of billing\" , \"resolution\" : \"Add the CostCentre tag\" , \"requiredTypes\" : [ \"resource\" ], \"requiredLabels\" : [ \"aws_instance\" ], \"severity\" : \"ERROR\" , \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" }, \"errorMessage\" : \"The required CostCentre tag was missing\" , \"relatedLinks\" : [ \"http://internal.acmecorp.com/standards/aws/tagging.html\" ] } ] } or --- checks : - code : CUS001 description : Custom check to ensure the CostCentre tag is applied to EC2 instances impact : By not having CostCentre we can't keep track of billing resolution : Add the CostCentre tag requiredTypes : - resource requiredLabels : - aws_instance severity : ERROR matchSpec : name : tags action : contains value : CostCentre errorMessage : The required CostCentre tag was missing relatedLinks : - http://internal.acmecorp.com/standards/aws/tagging.html The check contains up of the following attributes; Attribute Description code The custom code that your check will be known as description A description for the code that will be included in the output impact An optional detail about the consequences of not passing the check resolution An optional brief description of how to satisfy the check requiredTypes The block types to apply the check to - resource, data, module, variable requiredLabels The resource type - aws_ec2_instance for example. This also supports wildcards using * , e.g. aws_* severity How severe is the check matchSpec See below for the MatchSpec attributes errorMessage The error message that should be displayed in cases where the check fails relatedLinks A list of related links for the check to be displayed in cases where the check fails The MatchSpec is the what will define the check itself - this is fairly basic and is made up of the following attributes Attribute Description name The name of the attribute or block to run the check on action The check type - see below for more information value In cases where a value is required, the value to look for ignoreUndefined If the attribute is undefined, ignore and pass the check subMatch A sub MatchSpec block for nested checking - think looking for enabled value in a logging block predicateMatchSpec An array of MatchSpec blocks to be logically aggregated by either and or or actions","title":"What does a check file look like?"},{"location":"getting-started/configuration/custom-checks/#check-actions","text":"There are a number of CheckActions available which should allow you to quickly put together most checks.","title":"Check Actions"},{"location":"getting-started/configuration/custom-checks/#inmodule","text":"The inModule check action passes if the resource block is a component of a module. For example, if you're looking to check that an aws_s3_bucket is only created using a custom module, you could use the following MatchSpec ; \"matchSpec\" : { \"action\" : \"inModule\" } matchSpec : action : inModule","title":"inModule"},{"location":"getting-started/configuration/custom-checks/#ispresent","text":"The isPresent check action passes if the required block or attribute is available in the checked block. For example, if you're looking to check that an acl is provided and don't care what it is, you can use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isPresent\" } matchSpec : name : acl action : isPresent","title":"isPresent"},{"location":"getting-started/configuration/custom-checks/#notpresent","text":"Conversely, the noPresent check action passes if the specified block or attribute is not found in the checked block. For example, if you explicitly don't want an acl attribute to be present hou can use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"notPresent\" } matchSpec : name : acl action : notPresent","title":"notPresent"},{"location":"getting-started/configuration/custom-checks/#isempty","text":"The isEmpty check action passes if the named block or attribute is defined by empty. For example, to check that there are not tags you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"isEmpty\" , } matchSpec : name : acl action : isEmpty","title":"isEmpty"},{"location":"getting-started/configuration/custom-checks/#startswith","text":"The startsWith check action passes if the checked attribute string starts with the specified value. For example, to check that acl begins with public you could use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"startsWith\" , \"value\" : \"public\" } matchSpec : name : acl action : startsWith value : public","title":"startsWith"},{"location":"getting-started/configuration/custom-checks/#endswith","text":"The endsWith check action passes if the checked attribute string ends with the specified value. For example, to check that acl ends with read you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"endsWith\" , \"value\" : \"-read\" } matchSpec : name : acl action : endsWith value : -read","title":"endsWith"},{"location":"getting-started/configuration/custom-checks/#contains","text":"The contains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, if you want to ensure that the CostCentre exists, you might use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" } matchSpec : name : tags action : contains value : CostCentre","title":"contains"},{"location":"getting-started/configuration/custom-checks/#notcontains","text":"The notContains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, you want to make sure that an action does not contain kms:* you might use the following MatchSpec : \"matchSpec\" : { \"name\" : \"action\" , \"action\" : \"notContains\" , \"value\" : \"kms:*\" } matchSpec : name : tags action : notContains value : kms:*","title":"notContains"},{"location":"getting-started/configuration/custom-checks/#equals","text":"The equals check action passes if the checked attribute equals specified value. The core primitive types are supported, if the subject attribute is a Boolean, the MatchSpec value will attempt to be cast to a Boolean for comparison. For example, to check that acl begins with private you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"private\" } matchSpec : name : acl action : equals value : private","title":"equals"},{"location":"getting-started/configuration/custom-checks/#lessthan","text":"The lessThan check action passes if the checked attribute is numerical and the value is less than the specified value. For example, if you want to ensure that the cpu_core_count is less than 8, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThan\" , \"value\" : 8 } matchSpec : name : cpu_core_count action : lessThan value : 8","title":"lessThan"},{"location":"getting-started/configuration/custom-checks/#lessthanorequalto","text":"The lessThanOrEqualTo check action passes if the checked attribute is numerical and the value is less than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is less than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : lessThanOrEqualTo value : 4","title":"lessThanOrEqualTo"},{"location":"getting-started/configuration/custom-checks/#greaterthan","text":"The greaterThan check action passes if the checked attribute is numerical and the value is greater than the specified value. For example, if you want to ensure that the cpu_core_count is greater than 2, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThan\" , \"value\" : 2 } matchSpec : name : cpu_core_count action : greaterThan value : 2","title":"greaterThan"},{"location":"getting-started/configuration/custom-checks/#greaterthanorequalto","text":"The greaterThanOrEqualTo check action passes if the checked attribute is numerical and the value is greater than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is greater than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : greaterThanOrEqualTo value : 4","title":"greaterThanOrEqualTo"},{"location":"getting-started/configuration/custom-checks/#regexmatches","text":"The regexMatches check action passes when the regex is matched to the pattern passed in the value. This is check would generally be used as a top level check to filter whether or not to apply a check. For example, this check will ensure that the source attribute of a module matches the supplied regex before continuing with the subMatches. This can be used to ensure that checks are targeted to specific modules. When tackling this specific use case of filtering module blocks by source, the requiredLabels should be set to \"*\" \"matchSpec\" : { \"name\" : \"source\" , \"action\" : \"regexMatches\" , \"value\" : \"^modules\\\\/.*public_.+bucket$\" , \"subMatch\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"public-read\" } } matchSpec : name : source action : regexMatches value : \"^modules\\\\/.*public_.+bucket$\" subMatch : name : acl action : equals value : public-read","title":"regexMatches"},{"location":"getting-started/configuration/custom-checks/#isany","text":"The isAny check action passes when the attribute value can be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isAny\" , \"value\" : [ \"private\" , \"log-delivery-write\" ] } matchSpec : name : acl action : isAny value : - private - log-delivery-write","title":"isAny"},{"location":"getting-started/configuration/custom-checks/#isnone","text":"The isNone check action passes when the attribute value cannot be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isNone\" , \"value\" : [ \"authenticated-read\" , \"public-read\" ] } matchSpec : name : acl action : isNone value : - authenticated-read - public-read","title":"isNone"},{"location":"getting-started/configuration/custom-checks/#requirespresence","text":"The requiresPresence checks that the resource in name is also present in the Terraform code. If you wanted to ensure that aws_vpc_flowlogs is present if there is a aws_vpc , you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"requiresPresence\" , \"name\" : \"aws_vpc_flowlogs\" } matchSpec : name : aws_vpc_flowlogs action : requiresPresence","title":"requiresPresence"},{"location":"getting-started/configuration/custom-checks/#and","text":"The and check action passes when all the blocks provided within predicateMatchSpec evaluate to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you wanted to ensure that device_name and encrypted are both present in a nested ebs_block_device block, you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"isPresent\" , \"name\" : \"ebs_block_device\" , \"subMatch\" : { \"action\" : \"and\" , \"predicateMatchSpec\" : [ { \"action\" : \"isPresent\" , \"name\" : \"device_name\" }, { \"action\" : \"isPresent\" , \"name\" : \"encrypted\" } ] } } matchSpec : action : isPresent name : ebs_block_device subMatch : action : and predicateMatchSpec : - action : isPresent name : device_name - action : isPresent name : encrypted","title":"and"},{"location":"getting-started/configuration/custom-checks/#or","text":"The or check action passes when at least one of the blocks provided within predicateMatchSpec evaluates to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you want to ensure that virtualization_type is assigned to either hvm or paravirtual , while enforcing that their implicitly linked required attributes are also present, you might use the following matchSpec : \"matchSpec\": { \"action\": \"or\", \"predicateMatchSpec\": [ { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"hvm\" } ] }, { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"paravirtual\" }, { \"name\": \"image_location\", \"action\": \"isPresent\" }, { \"name\": \"kernel_id\", \"action\": \"isPresent\" } ] } ] } matchSpec : action : or predicateMatchSpec : - action : and predicateMatchSpec : - name : virtualization_type action : equals value : hvm - name : sriov_net_support action : isPresent - action : and predicateMatchSpec : - name : virtualization_type action : equals value : paravirtual - name : image_location action : isPresent - name : kernel_id action : isPresent","title":"or"},{"location":"getting-started/configuration/custom-checks/#not","text":"The not check action passes when the predicateMatchSpec evaluates to false . As an example, if you want to represent that a resource should not be included inModule you might use the following matchSpec : \"matchSpec\": { \"action\": \"not\", \"predicateMatchSpec\": [ { \"action\": \"inModule\" } ] } matchSpec : action : not predicateMatchSpec : - action : inModule","title":"not"},{"location":"getting-started/configuration/custom-checks/#how-do-i-know-my-json-is-valid","text":"We have provided the tfsec-checkgen binary which will validate your check file to ensure that it is valid for use with tfsec . In the future, tfsec-checkgen will facilitate the creation of new check files with a wizard approach, for now it can be used to validate your check file. shell script ./tfsec-checkgen validate example/custom/.tfsec/custom_checks.json","title":"How do I know my JSON is valid?"},{"location":"getting-started/configuration/custom-checks/#are-there-limitations","text":"At the moment, check MatchSpec is limited in the number of check types it can perform, these are as shown in the previous table. Custom defined checks also don't come with the comprehensive tests that the built in ones have. This will be addressed in future releases.","title":"Are there limitations?"},{"location":"getting-started/configuration/ignores/","text":"Ignoring Warnings You may wish to ignore some warnings. If you'd like to do so, you can simply add a comment containing tfsec:ignore:<rule> to the offending line in your templates. If the problem refers to a block of code, such as a multiline string, you can add the comment on the line above the block, by itself. For example, to ignore an open security group rule: resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] #tfsec:ignore:aws-vpc-no-public-ingress-sgr } ...or... resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" #tfsec:ignore:aws-vpc-no-public-ingress-sgr cidr_blocks = [\"0.0.0.0/0\"] } If you're not sure which line to add the comment on, just check the tfsec output for the line number of the discovered problem. You can ignore multiple rules by concatenating the rules on a single line: #tfsec:ignore:aws-s3-enable-bucket-encryption tfsec:ignore:aws-s3-enable-bucket-logging resource \"aws_s3_bucket\" \"my-bucket\" { bucket = \"foobar\" acl = \"private\" } Expiration Date You can set expiration date for ignore with yyyy-mm-dd format. This is a useful feature when you want to ensure ignored issue won't be forgotten and should be revisited in the future. #tfsec:ignore:aws-s3-enable-bucket-encryption:exp:2022-01-02 Ignore like this will be active only till 2022-01-02 , after this date it will be deactivated. Workspace Ignores Ignoring checks can be scoped to a workspace level. If you add the ws: declaration to your ignore it will only be honoured for that workspace. # tfsec:ignore:AWS006:exp:2221-01-02 #tfsec:ignore:AWS018:ws:development resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, when tfsec is run with the --workspace flag set to development, this ignore will be honoured, but otherwise will be disregarded. tfsec --workspace development . Ignoring specific values We have recently added support for ignoring based on the value that has been provided. This is particularly relevant when using for_each and you want to allow certain values. locals { rules = { http = 80 https = 443 } } #tfsec:ignore:aws-vpc-no-public-ingress-sgr[from_port=443] resource \"aws_security_group_rule\" \"this\" { for_each = local.rules type = \"ingress\" description = \"test\" from_port = each.value to_port = each.value protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, the aws-vpc-no-public-ingress-sgr check will fail for 80 but when it creates the rule for 443 the check will pass. This feature is experimental - while it works successfully, please raise issues through GitHub Issues","title":"Ignoring Checks"},{"location":"getting-started/configuration/ignores/#ignoring-warnings","text":"You may wish to ignore some warnings. If you'd like to do so, you can simply add a comment containing tfsec:ignore:<rule> to the offending line in your templates. If the problem refers to a block of code, such as a multiline string, you can add the comment on the line above the block, by itself. For example, to ignore an open security group rule: resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] #tfsec:ignore:aws-vpc-no-public-ingress-sgr } ...or... resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" #tfsec:ignore:aws-vpc-no-public-ingress-sgr cidr_blocks = [\"0.0.0.0/0\"] } If you're not sure which line to add the comment on, just check the tfsec output for the line number of the discovered problem. You can ignore multiple rules by concatenating the rules on a single line: #tfsec:ignore:aws-s3-enable-bucket-encryption tfsec:ignore:aws-s3-enable-bucket-logging resource \"aws_s3_bucket\" \"my-bucket\" { bucket = \"foobar\" acl = \"private\" }","title":"Ignoring Warnings"},{"location":"getting-started/configuration/ignores/#expiration-date","text":"You can set expiration date for ignore with yyyy-mm-dd format. This is a useful feature when you want to ensure ignored issue won't be forgotten and should be revisited in the future. #tfsec:ignore:aws-s3-enable-bucket-encryption:exp:2022-01-02 Ignore like this will be active only till 2022-01-02 , after this date it will be deactivated.","title":"Expiration Date"},{"location":"getting-started/configuration/ignores/#workspace-ignores","text":"Ignoring checks can be scoped to a workspace level. If you add the ws: declaration to your ignore it will only be honoured for that workspace. # tfsec:ignore:AWS006:exp:2221-01-02 #tfsec:ignore:AWS018:ws:development resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, when tfsec is run with the --workspace flag set to development, this ignore will be honoured, but otherwise will be disregarded. tfsec --workspace development .","title":"Workspace Ignores"},{"location":"getting-started/configuration/ignores/#ignoring-specific-values","text":"We have recently added support for ignoring based on the value that has been provided. This is particularly relevant when using for_each and you want to allow certain values. locals { rules = { http = 80 https = 443 } } #tfsec:ignore:aws-vpc-no-public-ingress-sgr[from_port=443] resource \"aws_security_group_rule\" \"this\" { for_each = local.rules type = \"ingress\" description = \"test\" from_port = each.value to_port = each.value protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, the aws-vpc-no-public-ingress-sgr check will fail for 80 but when it creates the rule for 443 the check will pass. This feature is experimental - while it works successfully, please raise issues through GitHub Issues","title":"Ignoring specific values"},{"location":"getting-started/configuration/github-actions/github-action/","text":"What is it? Github security alerts sit on the Security tab in your github project and detail any security issues that have been found. tfsec can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity. We have provided an action which can be used in your github repo with very little effort. Adding the action Github Actions make it easy to add functionality; to add an action, go to the Action tab to create a new workflow and choose to Set up a workflow yourself. Paste in the workflow content below (be sure to check you're using the latest version of the tfsec-sarif-action by checking here ) name : tfsec on : push : branches : - main pull_request : jobs : tfsec : name : tfsec sarif report runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-sarif-action@main with : sarif_file : tfsec.sarif - name : Upload SARIF file uses : github/codeql-action/upload-sarif@v1 with : # Path to SARIF file relative to the root of the repository sarif_file : tfsec.sarif What is this doing? Basically, this action is starting a new ubuntu github action container and checking out the code for either the pull request or the push to master/main . Once the code has been checked out, tfsec with process everything in the local path and generate a sarif report. Finally, the sarif report will be uploaded and the Security tab updated with the identified checks. It will look something like; Anything else I should know? If you have code that is deeper in the github repo, you can use working_directory for the action; - name : tfsec uses : tfsec/tfsec-sarif-action@v0.0.3 with : working_directory : terraform/relevant sarif_file : tfsec.sarif github_token : ${{ secrets.GITHUB_TOKEN }} This will target the checks to all folders under terraform/relevant","title":"GitHub Action"},{"location":"getting-started/configuration/github-actions/github-action/#what-is-it","text":"Github security alerts sit on the Security tab in your github project and detail any security issues that have been found. tfsec can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity. We have provided an action which can be used in your github repo with very little effort.","title":"What is it?"},{"location":"getting-started/configuration/github-actions/github-action/#adding-the-action","text":"Github Actions make it easy to add functionality; to add an action, go to the Action tab to create a new workflow and choose to Set up a workflow yourself. Paste in the workflow content below (be sure to check you're using the latest version of the tfsec-sarif-action by checking here ) name : tfsec on : push : branches : - main pull_request : jobs : tfsec : name : tfsec sarif report runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-sarif-action@main with : sarif_file : tfsec.sarif - name : Upload SARIF file uses : github/codeql-action/upload-sarif@v1 with : # Path to SARIF file relative to the root of the repository sarif_file : tfsec.sarif","title":"Adding the action"},{"location":"getting-started/configuration/github-actions/github-action/#what-is-this-doing","text":"Basically, this action is starting a new ubuntu github action container and checking out the code for either the pull request or the push to master/main . Once the code has been checked out, tfsec with process everything in the local path and generate a sarif report. Finally, the sarif report will be uploaded and the Security tab updated with the identified checks. It will look something like;","title":"What is this doing?"},{"location":"getting-started/configuration/github-actions/github-action/#anything-else-i-should-know","text":"If you have code that is deeper in the github repo, you can use working_directory for the action; - name : tfsec uses : tfsec/tfsec-sarif-action@v0.0.3 with : working_directory : terraform/relevant sarif_file : tfsec.sarif github_token : ${{ secrets.GITHUB_TOKEN }} This will target the checks to all folders under terraform/relevant","title":"Anything else I should know?"},{"location":"getting-started/configuration/github-actions/pr-commenter/","text":"What is it? The PR Commenter action will process a Pull request and add comments to any areas of the change which fail the tfsec checks. Adding the action To add the action, add tfsec_pr_commenter.yml into the .github/workflows directory in the root of your Github project. The contents of tfsec_pr_commenter.yml should be; name : tfsec-pr-commenter on : pull_request : jobs : tfsec : name : tfsec PR commenter runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-pr-commenter-action@main with : github_token : ${{ secrets.GITHUB_TOKEN }} On each pull request and subsequent commit, tfsec will run and add comments to the PR where tfsec has failed. The comment will only be added once per transgression. Example PR Comment The screenshot below demonstrates the comments that can be expected when using the action","title":"PR Commenter"},{"location":"getting-started/configuration/github-actions/pr-commenter/#what-is-it","text":"The PR Commenter action will process a Pull request and add comments to any areas of the change which fail the tfsec checks.","title":"What is it?"},{"location":"getting-started/configuration/github-actions/pr-commenter/#adding-the-action","text":"To add the action, add tfsec_pr_commenter.yml into the .github/workflows directory in the root of your Github project. The contents of tfsec_pr_commenter.yml should be; name : tfsec-pr-commenter on : pull_request : jobs : tfsec : name : tfsec PR commenter runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-pr-commenter-action@main with : github_token : ${{ secrets.GITHUB_TOKEN }} On each pull request and subsequent commit, tfsec will run and add comments to the PR where tfsec has failed. The comment will only be added once per transgression.","title":"Adding the action"},{"location":"getting-started/configuration/github-actions/pr-commenter/#example-pr-comment","text":"The screenshot below demonstrates the comments that can be expected when using the action","title":"Example PR Comment"}]}